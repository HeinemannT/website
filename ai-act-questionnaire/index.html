<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EU AI Act Interactive Guide</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Host+Grotesk:ital,wght@0,300..800;1,300..800&family=Raleway:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Visualization & Content Choices:
        - Home: Inviting intro, explains Act's complexity & overlapping risks, direct presentation of AI definition & inventory overview.
        - Risk Categories: Donut chart (init on tab view).
        - Full System Assessment: Multi-step questionnaire, role selection, Annex III details, early exits (Not AI, Prohibited), detailed role-based summary.
        - Roles & Responsibilities: Accordions for Provider, Deployer, etc.
        - High-Risk AI Obligations: Detailed accordions.
        - GPAI Models: Detailed accordions.
        - Resources & Timelines: Card layout.
        CONFIRMING NO SVG/Mermaid. -->
    <style>
        body {
            font-family: "Host Grotesk", sans-serif;
            font-optical-sizing: auto;
            font-weight: 400; /* Default weight for body */
            font-style: normal;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }
        /* Raleway for specific elements */
        h1.main-title { /* Specific class for the main page title to use Host Grotesk if body defaults to Raleway, or vice versa */
             font-family: "Host Grotesk", sans-serif;
             font-weight: 700; /* Bold for main title */
        }

        h2, h3, h4, h5, h6, .tab-button, 
        .button-accent-primary, .button-accent-warning, .button-positive, .bg-slate-500,
        .assessment-question-group p.font-medium, 
        .assessment-question-group label, /* This targets the answer text */
        #assessmentResultContent p.font-semibold, /* Summary headings */
        .resource-card h3, 
        .obligation-list h4,
        .accordion-button .icon::before, 
        .annex-iii-details strong, 
        .obligation-list strong,
        #mobile-nav, /* Ensure select dropdown uses Raleway */
        .text-primary-heading, .text-warning-accent, .text-critical-accent, .text-positive-accent, .text-sky-500, .text-warning-message /* Utility text classes */
         {
            font-family: 'Raleway', sans-serif;
        }

        .tab-button {
            color: #e2e8f0; /* slate-200 for inactive tabs on dark nav */
        }
        .tab-button.active {
            border-color: #ffc300; /* Mikado Yellow for active border */
            color: #FFFFFF; /* White text for active tab */
            background-color: #001d3d; /* Oxford Blue for active tab background */
            font-weight: 600;
        }
        .tab-button:hover:not(.active) {
            color: #FFFFFF;
            border-color: #ffc300; /* Mikado Yellow for hover border */
        }
        .content-section {
            display: none;
        }
        .content-section.active {
            display: block;
        }
        .accordion-button .icon::before {
            content: '+'; /* Plus for closed */
            font-weight: bold;
            margin-left: 8px; /* Ensure space */
            display: inline-block;
            transition: transform 0.2s ease-in-out;
        }
        .accordion-button.open .icon::before {
            content: '–'; /* Minus for open */
        }
        .accordion-content {
            display: none;
            padding-left: 1rem; 
            border-left: 2px solid #e2e8f0; /* slate-200 */
            margin-left: 0.5rem; 
            margin-top: 0.75rem; 
        }
        .chart-container-wrapper {
            position: relative;
            margin: auto;
            height: 300px; 
            width: 100%;
            max-width: 450px; 
        }
        @media (min-width: 768px) { 
            .chart-container-wrapper {
                height: 350px;
            }
        }
        .assessment-step {
            display: none; 
        }
        .assessment-step.active {
            display: block; 
        }
        .assessment-question-group {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.375rem; 
        }
        .header-bg-primary { 
            background-color: #001d3d; /* Oxford Blue */
        }
        .nav-bg-secondary { 
            background-color: #003566; /* Yale Blue */
        }
        .button-accent-primary { 
            background-color: #ffc300; /* Mikado Yellow */
            color: #000814; /* Rich Black */
        }
        .button-accent-primary:hover {
            background-color: #e6b000; /* Darker Mikado Yellow */
        }
        .button-accent-warning { 
            background-color: #ffd60a; /* Gold */
            color: #000814; /* Rich Black */
        }
        .button-accent-warning:hover {
            background-color: #e6bf09; /* Darker Gold */
        }
        .button-positive {
            background-color: #16A34A; /* Green-600 */
            color: white;
        }
        .button-positive:hover {
             background-color: #15803d; /* Green-700 */
        }
         .text-primary-heading { color: #003566; } /* Yale Blue for main headings */
         .text-warning-message { color: #c2410c; } /* Muted Rust/Orange for warning text on light bg */
         .text-critical-accent { color: #DC2626; } /* Red-600 */
         .text-positive-accent { color: #16A34A; } /* Green-600 */

        .annex-iii-details ul {
            list-style-type: disc;
            padding-left: 1.5rem;
            font-size: 0.875rem; 
            color: #475569; /* slate-600 */
        }
        .annex-iii-details strong {
            color: #334155; /* slate-700 */
        }
        .assessment-result-box {
            background-color: #fffbeb; /* Corresponds to gold-50 or a very light yellow/gold */
            border-color: #ffd60a; /* Gold */
        }
        .focus-ring-accent:focus {
            outline: 2px solid transparent;
            outline-offset: 2px;
            box-shadow: 0 0 0 2px #ffffff, 0 0 0 4px #ffc300, 0 1px 2px 0 rgba(0, 0, 0, 0);
        }
         .input-focus-accent:focus {
            border-color: #ffc300; /* Mikado Yellow */
            box-shadow: 0 0 0 0.2rem rgba(255, 195, 0, 0.25); /* Mikado Yellow with alpha */
        }
        .resource-card {
            background-color: white;
            border: 1px solid #e2e8f0; /* slate-200 */
            border-radius: 0.5rem; /* rounded-lg */
            padding: 1.5rem; /* p-6 */
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06); /* shadow-md */
        }
        .resource-card h3 {
            color: #003566; /* Yale Blue */
            margin-bottom: 0.75rem; /* mb-3 */
        }
        .obligation-list li { margin-bottom: 0.5rem; }
        .obligation-list strong { 
            color: #001d3d; /* Oxford Blue */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="header-bg-primary text-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-4 flex flex-col sm:flex-row justify-between items-center">
            <h1 class="main-title text-2xl sm:text-3xl font-bold tracking-tight">EU AI Act Interactive Guide</h1>
            <nav class="mt-3 sm:mt-0">
                <select id="mobile-nav" class="lg:hidden nav-bg-secondary text-white p-2 rounded-md border border-slate-700 focus:ring-2 focus-ring-accent">
                    <option value="home">Home</option>
                    <option value="full-assessment">Tool: Full System Assessment</option>
                    <option value="roles-responsibilities">Guide: Roles & Responsibilities</option>
                    <option value="risk-categories">Guide: Risk Categories</option>
                    <option value="high-risk-obligations">Guide: High-Risk Obligations</option>
                    <option value="gpai">Guide: GPAI Models</option>
                    <option value="resources">Guide: Resources & Timelines</option>
                </select>
            </nav>
        </div>
        <div class="hidden lg:block nav-bg-secondary">
            <div class="container mx-auto px-4 sm:px-6 lg:px-8">
                <div id="desktop-nav" class="flex space-x-1 items-center justify-center flex-wrap">
                    <button data-tab="home" class="tab-button active text-sm font-medium py-3 px-3 sm:px-4 border-b-2 transition-colors duration-150">Home</button>
                    <button data-tab="full-assessment" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Tool: Full System Assessment</button>
                    <button data-tab="roles-responsibilities" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Guide: Roles & Responsibilities</button>
                    <button data-tab="risk-categories" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Guide: Risk Categories</button>
                    <button data-tab="high-risk-obligations" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Guide: High-Risk Obligations</button>
                    <button data-tab="gpai" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Guide: GPAI Models</button>
                    <button data-tab="resources" class="tab-button text-sm font-medium py-3 px-3 sm:px-4 border-b-2 border-transparent transition-colors duration-150">Guide: Resources & Timelines</button>
                </div>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div id="home" class="content-section active">
            <h2 class="text-2xl font-semibold text-primary-heading mb-4">Getting to Grips with the EU AI Act</h2>
            <p class="mb-4 text-lg leading-relaxed">The EU's AI Act is here, and it's a big deal for anyone working with artificial intelligence. It's all about making AI safe, fair, and trustworthy. Sounds good, right? But let's be honest, new regulations can be a bit of a maze.</p>
            <p class="mb-4 leading-relaxed">You've probably seen the AI Act described as a pyramid: some AI is banned (unacceptable risk), some is high-risk with lots of rules, then limited risk with transparency duties, and finally, minimal risk with fewer worries. That's a helpful starting point, but the truth is, it's not always that neat. Sometimes, an AI system might tick boxes in more than one category, or involve complex components like General Purpose AI models that have their own specific rules. It's like a puzzle where the pieces can overlap.</p>
            <p class="mb-6 leading-relaxed">This guide is designed to help you make sense of it all. We'll break down the key ideas and point you to our assessment tool so you can start figuring out where your AI systems fit in.</p>
            
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3">First Things First: Is It an "AI System"?</h3>
                <p class="mb-2 leading-relaxed">Before diving into risks, you need to know if what you're working with is even considered an "AI system" by the Act. Article 3(1) defines it as: "a machine-based system that is designed to operate with varying levels of autonomy and that may exhibit adaptiveness after deployment, and that, for explicit or implicit objectives, infers, from the input it receives, how to generate outputs such as predictions, content, recommendations, or decisions”.</p>
                <h4 class="font-semibold mt-3 mb-1 text-slate-700">In simpler terms, look for:</h4>
                <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm mb-3 leading-relaxed">
                    <li>It's <strong>machine-based</strong> (hardware/software).</li>
                    <li>It has some <strong>autonomy</strong> (operates without constant human command).</li>
                    <li>It <strong>infers</strong> outputs (like predictions or decisions) from inputs.</li>
                    <li>It might be <strong>adaptive</strong> (learns over time), but this isn't a must.</li>
                </ul>
                <p class="mt-2 text-sm text-slate-500 leading-relaxed">The <strong>"intended purpose"</strong> – what you plan to use the AI for – is key for figuring out its risk level. Our <button onclick="navigateToTab('full-assessment')" class="text-primary-heading underline font-semibold">Tool: Full System Assessment</button> can help you with this.</p>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3">Keeping Track: Your AI Asset Inventory</h3>
                <p class="mb-2 text-sm leading-relaxed">Think of an AI asset inventory as your central hub for AI Act compliance. It's not just a list; it's a living record that helps you manage risks and obligations.</p>
                <h4 class="font-semibold mt-3 mb-1 text-slate-700">Key Steps to Manage Your Inventory:</h4>
                 <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm leading-relaxed">
                    <li>List all your potential AI systems.</li>
                    <li>Check if they fit the Act's definition of an "AI System."</li>
                    <li>Clearly define the "Intended Purpose(s)" for each.</li>
                    <li>Classify each system (Prohibited, High, Limited, Minimal Risk) – our <button onclick="navigateToTab('full-assessment')" class="text-primary-heading underline font-semibold">Assessment Tool</button> is designed for this.</li>
                    <li>Document why you classified it that way and what rules apply.</li>
                    <li>Review and update regularly, especially if things change.</li>
                </ul>
                 <p class="mt-2 text-sm text-slate-500 leading-relaxed">For more on risk levels and specific duties, check out the <button onclick="navigateToTab('risk-categories')" class="text-primary-heading underline font-semibold">Guide: Risk Categories</button> and <button onclick="navigateToTab('high-risk-obligations')" class="text-primary-heading underline font-semibold">Guide: High-Risk Obligations</button>.</p>
            </div>
            <p class="mt-6 leading-relaxed">Ready to dive deeper? Use the tabs above to explore specific topics or head straight to the assessment tool.</p>
        </div>

        <div id="roles-responsibilities" class="content-section">
            <h2 class="text-2xl font-semibold text-primary-heading mb-6">Guide: Roles & Responsibilities under the EU AI Act</h2>
            <p class="mb-4">The EU AI Act defines specific roles for entities involved in the AI lifecycle. Understanding your role is crucial for identifying applicable obligations.</p>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Provider</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2"><strong>Definition (Art. 3(2)):</strong> Develops an AI system or has one developed and places it on the market/service under its own name/trademark.</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Key Responsibilities:</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li>Ensuring compliance, conformity assessments, technical documentation, QMS, registration, PMS.</li>
                    </ul>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Deployer</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2"><strong>Definition (Art. 3(4)):</strong> Uses an AI system under its authority (except personal non-professional use).</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Key Responsibilities (High-Risk AI - Art. 26):</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li>Use per instructions, ensure relevant input data, monitor, keep logs, human oversight, potential FRIA.</li>
                    </ul>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Importer</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2"><strong>Definition (Art. 3(5)):</strong> Places an AI system from outside the EU on the market.</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Key Responsibilities (Art. 23):</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li>Ensure non-EU provider completed conformity & docs, verify CE mark, indicate contact details.</li>
                    </ul>
                </div>
            </div>

             <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Distributor</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2"><strong>Definition (Art. 3(6)):</strong> Makes an AI system available on the market (not provider/importer).</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Key Responsibilities (Art. 24):</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li>Verify CE mark & docs, ensure provider/importer compliance, don't make non-conforming systems available.</li>
                    </ul>
                </div>
            </div>
            <p class="mt-4 text-sm text-slate-500">Note: An entity can fulfill multiple roles. Obligations depend on activities performed.</p>
        </div>
        
        <div id="full-assessment" class="content-section">
            <h2 class="text-2xl font-semibold text-primary-heading mb-4">Tool: Full AI System Assessment</h2>
            <p class="mb-6">This questionnaire will guide you through a series of questions to help determine a preliminary classification for your AI system under the EU AI Act. This is not legal advice but an informational tool.</p>

            <div id="assessmentContainer" class="bg-white p-6 rounded-lg shadow">
                <div id="assessment-step-role" class="assessment-step active">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 0: Your Role</h3>
                     <div class="assessment-question-group">
                        <p class="font-medium mb-2">0.1. What is your primary role concerning this AI system?</p>
                        <div class="space-y-1">
                            <label class="block"><input type="radio" name="q0_1_user_role" value="Provider" class="mr-2 input-focus-accent"> Provider</label>
                            <label class="block"><input type="radio" name="q0_1_user_role" value="Deployer" class="mr-2 input-focus-accent"> Deployer</label>
                            <label class="block"><input type="radio" name="q0_1_user_role" value="Importer" class="mr-2 input-focus-accent"> Importer</label>
                            <label class="block"><input type="radio" name="q0_1_user_role" value="Distributor" class="mr-2 input-focus-accent"> Distributor</label>
                            <label class="block"><input type="radio" name="q0_1_user_role" value="Other" class="mr-2 input-focus-accent"> Other / Unsure</label>
                        </div>
                    </div>
                    <button data-next="assessment-step-1-definition" class="assessment-next-btn button-accent-primary px-6 py-2 rounded-md transition duration-150">Start Assessment</button>
                </div>

                <div id="assessment-step-1-definition" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 1: AI System Definition (Art 3(1))</h3>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">1.1. Is the system machine-based?</p>
                        <label class="mr-4"><input type="radio" name="q1_1_machine_based" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q1_1_machine_based" value="no" class="mr-1 input-focus-accent"> No</label>
                    </div>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">1.2. Does it operate with autonomy?</p>
                        <label class="mr-4"><input type="radio" name="q1_2_autonomy" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q1_2_autonomy" value="no" class="mr-1 input-focus-accent"> No</label>
                    </div>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">1.3. Does it infer outputs?</p>
                        <label class="mr-4"><input type="radio" name="q1_3_inference" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q1_3_inference" value="no" class="mr-1 input-focus-accent"> No</label>
                    </div>
                    <button data-next="assessment-step-2-prohibited" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>

                <div id="assessment-step-2-prohibited" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 2: Prohibited AI Practices (Art 5)</h3>
                    <p class="text-sm mb-3 text-slate-500">Does your AI system involve any of the following? (Select all that apply)</p>
                    <div class="assessment-question-group space-y-2">
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="social_scoring" class="mr-2 input-focus-accent"> Social scoring.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="exploit_vulnerabilities_harm" class="mr-2 input-focus-accent"> Exploitation of vulnerabilities causing harm.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="subliminal_manipulative_harm" class="mr-2 input-focus-accent"> Subliminal/manipulative techniques causing harm.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="real_time_remote_biometric_le" class="mr-2 input-focus-accent"> 'Real-time' remote biometric ID by LE (public spaces).</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="untargeted_scraping_facial" class="mr-2 input-focus-accent"> Untargeted scraping for facial recognition.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="emotion_recognition_work_edu" class="mr-2 input-focus-accent"> Emotion recognition in workplace/education.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="biometric_categorization_sensitive" class="mr-2 input-focus-accent"> Biometric categorization on sensitive attributes.</label>
                        <label class="block"><input type="checkbox" name="q2_prohibited" value="risk_assessment_criminal_profiling" class="mr-2 input-focus-accent"> Crime risk assessment (solely profiling).</label>
                    </div>
                    <button data-next="assessment-step-3-highrisk-pathway" id="nextFromProhibited" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>

                <div id="assessment-step-3-highrisk-pathway" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 3: High-Risk Pathway Identification (Art 6)</h3>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">3.1. Is the AI system an Annex I product/safety component requiring 3rd party assessment?</p>
                        <label class="mr-4"><input type="radio" name="q3_1_annex_i" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q3_1_annex_i" value="no" class="mr-1 input-focus-accent"> No</label>
                    </div>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">3.2. Is the AI system's intended purpose listed in Annex III?</p>
                        <label class="mr-4"><input type="radio" name="q3_2_annex_iii" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q3_2_annex_iii" value="no" class="mr-1 input-focus-accent"> No</label>
                        <div class="mt-3">
                            <button type="button" id="toggleAnnexIIIDetails" class="accordion-button text-sm text-primary-heading hover:underline w-full text-left p-2 bg-slate-100 rounded-md flex justify-between items-center"><span>View Annex III Categories</span><span class="icon"></span></button>
                            <div id="annexIIIDetails" class="accordion-content annex-iii-details mt-2 p-3 bg-slate-50 rounded-md border border-slate-200">
                                <p class="text-xs text-slate-500 mb-2">This is an indicative list. Refer to the official EU AI Act for the definitive text.</p>
                                <ul>
                                    <li><strong>Biometric identification and categorisation.</strong></li>
                                    <li><strong>Management/operation of critical infrastructure.</strong></li>
                                    <li><strong>Education and vocational training.</strong></li>
                                    <li><strong>Employment, workers management, access to self-employment.</strong></li>
                                    <li><strong>Access to essential private/public services and benefits.</strong></li>
                                    <li><strong>Law enforcement.</strong></li>
                                    <li><strong>Migration, asylum, and border control management.</strong></li>
                                    <li><strong>Administration of justice and democratic processes.</strong></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <button data-next="assessment-step-4a-annex3-profiling" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>
                
                <div id="assessment-step-4a-annex3-profiling" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 4 (For Annex III Systems): Profiling Check</h3>
                    <div class="assessment-question-group">
                        <p class="font-medium mb-2">4.1. Does your Annex III system perform "profiling of natural persons"?</p>
                        <label class="mr-4"><input type="radio" name="q4_1_profiling" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q4_1_profiling" value="no" class="mr-1 input-focus-accent"> No</label>
                         <p class="text-xs text-slate-500 mt-1">If yes, it's High-Risk (derogation N/A).</p>
                    </div>
                    <button data-next="assessment-step-4b-annex3-harm" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>

                <div id="assessment-step-4b-annex3-harm" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 4 (Annex III, No Profiling): Significant Harm Check</h3>
                     <div class="assessment-question-group">
                        <p class="font-medium mb-2">4.2. Does the system pose a significant risk of harm to health, safety, or fundamental rights?</p>
                        <label class="mr-4"><input type="radio" name="q4_2_significant_harm" value="yes" class="mr-1 input-focus-accent"> Yes</label>
                        <label><input type="radio" name="q4_2_significant_harm" value="no" class="mr-1 input-focus-accent"> No</label>
                        <p class="text-xs text-slate-500 mt-1">If yes, likely High-Risk. If no, check derogation conditions.</p>
                    </div>
                    <button data-next="assessment-step-4c-annex3-conditions" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>

                <div id="assessment-step-4c-annex3-conditions" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 4 (Annex III, No Profiling/Harm): Derogation Conditions</h3>
                    <p class="text-sm mb-3 text-slate-500">Does it fulfill AT LEAST ONE condition for derogation?</p>
                    <div class="assessment-question-group space-y-2">
                        <label class="block"><input type="checkbox" name="q4_3_derogation_condition" value="narrow_procedural" class="mr-2 input-focus-accent"> Narrow procedural task.</label>
                        <label class="block"><input type="checkbox" name="q4_3_derogation_condition" value="improve_human" class="mr-2 input-focus-accent"> Improves prior human activity.</label>
                        <label class="block"><input type="checkbox" name="q4_3_derogation_condition" value="detect_patterns" class="mr-2 input-focus-accent"> Detects patterns (no influence w/o review).</label>
                        <label class="block"><input type="checkbox" name="q4_3_derogation_condition" value="preparatory_task" class="mr-2 input-focus-accent"> Preparatory task for Annex III assessment.</label>
                        <p class="text-xs text-slate-500 mt-1">If yes (and no profiling/harm), derogation MAY apply. Else, High-Risk.</p>
                    </div>
                    <button data-next="assessment-step-5-limited" class="assessment-next-btn button-accent-primary px-4 py-2 rounded-md">Next</button>
                </div>
                
                <div id="assessment-step-5-limited" class="assessment-step">
                    <h3 class="text-lg font-semibold text-slate-700 mb-3">Step 5: Limited Risk AI (Art 50 Transparency)</h3>
                    <p class="text-sm mb-3 text-slate-500">Does it involve any of these functionalities? (Select all that apply)</p>
                    <div class="assessment-question-group space-y-2">
                        <label class="block"><input type="checkbox" name="q5_limited_risk" value="chatbot" class="mr-2 input-focus-accent"> Interacts with humans (e.g., chatbot).</label>
                        <label class="block"><input type="checkbox" name="q5_limited_risk" value="emotion_biometric_categorization" class="mr-2 input-focus-accent"> Emotion recognition/biometric categorization.</label>
                        <label class="block"><input type="checkbox" name="q5_limited_risk" value="deep_fake" class="mr-2 input-focus-accent"> Generates "deep fakes".</label>
                        <label class="block"><input type="checkbox" name="q5_limited_risk" value="generative_text_public_interest" class="mr-2 input-focus-accent"> Generates text on public interest matters.</label>
                    </div>
                     <button id="viewAssessmentResultBtn" class="assessment-next-btn button-positive px-6 py-2 rounded-md transition duration-150">View Assessment</button>
                </div>

                <div id="assessment-result-display" class="mt-6 hidden">
                    <h3 class="text-xl font-semibold text-primary-heading mb-3">Assessment Summary</h3>
                    <div id="assessmentResultContent" class="p-4 border rounded-md assessment-result-box space-y-3">
                    </div>
                    <button id="resetAssessmentBtn" class="mt-4 bg-slate-500 text-white px-4 py-2 rounded-md hover:bg-slate-600">Start New Assessment</button>
                </div>
            </div>
        </div>


        <div id="risk-categories" class="content-section">
            <h2 class="text-2xl font-semibold text-primary-heading mb-4">Guide: EU AI Act Risk Categories</h2>
            <p class="mb-6">The Act categorizes AI systems into four main risk levels, with obligations proportionate to the risk. Understanding these categories is crucial for compliance.</p>
            
            <div class="chart-container-wrapper mb-8">
                <canvas id="riskDistributionChart"></canvas>
            </div>
            <p class="text-center text-sm text-slate-500 mb-8">Illustrative conceptual distribution of AI systems by risk. Actual distribution varies.</p>

            <div class="grid md:grid-cols-2 gap-6">
                <div id="prohibited-ai-section" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-critical-accent mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Prohibited AI (Unacceptable Risk)</span><span class="icon"></span></h3>
                    <div class="accordion-content">
                        <p class="mb-2">Practices posing a clear threat to safety, livelihoods, and fundamental rights (Article 5). These are banned.</p>
                         <p class="font-semibold text-sm mt-1">Inventory State: <code class="bg-red-100 text-critical-accent px-1 rounded">Prohibited - Cease/Prevent Deployment</code></p>
                    </div>
                </div>

                <div id="high-risk-ai-section-summary" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-warning-accent mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>High-Risk AI</span><span class="icon"></span></h3>
                     <div class="accordion-content">
                        <p class="mb-2">Systems that can adversely impact safety or fundamental rights (Article 6). Permitted but subject to stringent requirements.</p>
                        <p class="font-semibold text-sm mt-1">Inventory State: <code class="bg-orange-100 text-warning-accent px-1 rounded">Potentially High-Risk</code></p>
                        <button onclick="navigateToTab('high-risk-obligations')" class="mt-3 text-sm text-primary-heading hover:underline font-medium">Learn more about High-Risk AI Obligations &raquo;</button>
                    </div>
                </div>

                <div id="limited-risk-ai-section" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-sky-500 mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Limited Risk AI</span><span class="icon"></span></h3>
                    <div class="accordion-content">
                        <p class="mb-2">Systems posing specific transparency risks (Article 50). Users must be aware of AI interaction or AI-generated content.</p>
                        <p class="font-semibold text-sm mt-1">Inventory State: <code class="bg-sky-100 text-sky-700 px-1 rounded">Limited Risk - Transparency Obligations Apply</code></p>
                    </div>
                </div>

                <div id="minimal-risk-ai-section" class="bg-white p-6 rounded-lg shadow">
                    <h3 class="text-xl font-semibold text-positive-accent mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Minimal or No Risk AI</span><span class="icon"></span></h3>
                    <div class="accordion-content">
                        <p class="mb-2">Systems not falling into Prohibited, High, or Limited risk categories. Generally permitted without additional specific AI Act obligations.</p>
                        <p class="font-semibold text-sm mt-1">Inventory State: <code class="bg-green-100 text-positive-accent px-1 rounded">Minimal Risk - Monitor</code></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="high-risk-obligations" class="content-section"> 
            <h2 class="text-2xl font-semibold text-primary-heading mb-4">Guide: High-Risk AI System Obligations (Provider Focus)</h2>
            <p class="mb-6">Providers of High-Risk AI systems face significant obligations under Chapter III of the EU AI Act. This section outlines key requirements. Deployers also have specific duties (Art. 26), detailed further in the "Roles & Responsibilities" guide.</p>
            <div class="space-y-4 obligation-list">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Risk Management System (Art. 9)</strong></h4>
                    <p class="text-sm text-slate-600">Establish, implement, document, and maintain a continuous, iterative risk management system throughout the AI system's entire lifecycle. This includes identification, estimation, evaluation of risks, and adoption of risk mitigation measures.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Data and Data Governance (Art. 10)</strong></h4>
                    <p class="text-sm text-slate-600">Implement appropriate data governance and management practices for training, validation, and testing data sets. Ensure data is relevant, representative, free of errors, complete, and has the appropriate statistical properties. Address possible biases.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Technical Documentation (Art. 11 & Annex IV)</strong></h4>
                    <p class="text-sm text-slate-600">Prepare and maintain extensive technical documentation <strong>before</strong> market placement. This must demonstrate compliance and include system description, capabilities, limitations, algorithms, data, training/testing/validation procedures, risk management, instructions for use, and PMS plan.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Record-Keeping (Logs) (Art. 12)</strong></h4>
                    <p class="text-sm text-slate-600">Design systems for automatic, traceable, secure, and robust logging of operations relevant for risk identification, monitoring, and post-market surveillance.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Transparency & Info to Deployers (Art. 13)</strong></h4>
                    <p class="text-sm text-slate-600">Provide clear, concise, and comprehensive instructions for use, covering identity, intended purpose, capabilities, limitations, accuracy, robustness, cybersecurity, human oversight measures, computational resources, expected lifetime, and maintenance.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Human Oversight (Art. 14)</strong></h4>
                    <p class="text-sm text-slate-600">Design systems for effective human oversight, allowing intervention, disregard, or override of outputs. Measures should be proportionate to risks.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Accuracy, Robustness, and Cybersecurity (Art. 15)</strong></h4>
                    <p class="text-sm text-slate-600">Ensure appropriate levels throughout the lifecycle. Systems must be resilient to errors, faults, inconsistencies, and attempts to alter use or behavior. Implement cybersecurity measures.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Quality Management System (Art. 17)</strong></h4>
                    <p class="text-sm text-slate-600">Implement a QMS ensuring compliance with the Act, covering strategy, design controls, testing, post-market monitoring, incident reporting, and accountability.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Conformity Assessment (Art. 43)</strong></h4>
                    <p class="text-sm text-slate-600">Undergo the relevant conformity assessment procedure before market placement and for substantial modifications. This may involve internal controls or a Notified Body, depending on the system.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Registration (Art. 49)</strong></h4>
                    <p class="text-sm text-slate-600">Providers must register their high-risk AI systems in a publicly accessible EU database before placing them on the market or putting them into service.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Post-Market Monitoring (PMS) (Art. 72)</strong></h4>
                    <p class="text-sm text-slate-600">Establish and document a PMS system to proactively collect, document, and analyze data on the performance of high-risk AI systems throughout their lifetime, and take corrective actions if necessary.</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow">
                    <h4 class="font-semibold text-primary-heading"><strong>Serious Incident Reporting (Art. 73)</strong></h4>
                    <p class="text-sm text-slate-600">Report any serious incidents and any malfunctioning of AI systems that might lead to such incidents to the relevant national competent authorities.</p>
                </div>
            </div>
        </div>

        <div id="gpai" class="content-section">
            <h2 class="text-2xl font-semibold text-primary-heading mb-4">Guide: General Purpose AI (GPAI) Models</h2>
            <p class="mb-4">This section provides a detailed overview of General Purpose AI (GPAI) models as defined and regulated by the EU AI Act. Understanding these provisions is crucial if your organization develops, provides, or integrates GPAI models.</p>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Defining GPAI Models (Article 3(63))</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2">A GPAI model is defined as "an AI model, including where such an AI model is trained with a large amount of data using self-supervision at scale, that displays significant generality and is capable of competently performing a wide range of distinct tasks regardless of the way the model is placed on the market and that can be integrated into a variety of downstream systems or applications."</p>
                    <p class="mt-2 text-sm text-slate-600">These are foundational components, like large language or image generation models, designed for broad applicability. <strong>"Significant generality"</strong> is a key characteristic.</p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Obligations for ALL Providers of GPAI Models (Article 53)</span><span class="icon"></span></h3>
                <div class="accordion-content">
                     <p class="mb-2 text-sm">These baseline obligations apply from August 2, 2025, to all GPAI model providers:</p>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li><strong>Technical Documentation:</strong> Draw up and maintain up-to-date technical documentation (Art. 53(1)(a) & (b)). This must contain information for downstream providers to understand the GPAI model's capabilities, limitations, and comply with their own AI Act obligations. It must be provided to the AI Office, national authorities on request, and downstream providers.</li>
                        <li><strong>Copyright Policy (Art. 53(1)(c)):</strong> Implement a policy to respect Union copyright law, particularly identifying and respecting reservations of rights under Article 4(3) of the Copyright Directive (EU) 2019/790.</li>
                        <li><strong>Training Data Summary (Art. 53(1)(d)):</strong> Prepare and make publicly available a "sufficiently detailed summary" of the content used for training the GPAI model.</li>
                    </ul>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-critical-accent mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>GPAI Models with Systemic Risk (Articles 51, 52, 55 & Annex XIII)</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2">GPAI models with <strong>"high-impact capabilities"</strong> are deemed to pose systemic risks and face more stringent obligations.</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Classification Criteria (Article 51):</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm mb-2">
                        <li><strong>Presumption by FLOPs:</strong> A model is presumed to have systemic risk if the cumulative amount of computation used for its training (measured in floating-point operations - FLOPs) is greater than $10^{25}$. The Commission can update this threshold.</li>
                        <li><strong>Commission Designation:</strong> The Commission can designate other GPAI models as systemic risk based on criteria in Annex XIII, such as:
                            <ul>
                                <li>High number of parameters.</li>
                                <li>High number of registered users or business users.</li>
                                <li>Input and output modalities (e.g., text, image, speech, structured data).</li>
                                <li>Perceived or actual level of autonomy and sophistication.</li>
                                <li>Degree of scalability in terms of users or tasks.</li>
                                <li>Access to tools (e.g., internet access, ability to call APIs).</li>
                            </ul>
                        </li>
                    </ul>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Provider Notification (Article 52(1)):</h4>
                     <p class="text-sm text-slate-600 mb-2">Providers must notify the Commission within two weeks if their GPAI model meets the systemic risk criteria (e.g., exceeds FLOPs threshold or they anticipate it will).</p>
                    <h4 class="font-semibold mt-3 mb-1 text-slate-700">Additional Obligations for Systemic Risk GPAI Providers (Article 55):</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-600 text-sm">
                        <li><strong>Model Evaluations:</strong> Perform and document model evaluations, including adversarial testing, to identify and assess systemic risks.</li>
                        <li><strong>Systemic Risk Assessment & Mitigation:</strong> Assess and mitigate possible systemic risks (e.g., to public health, safety, fundamental rights, society) throughout the model's lifecycle.</li>
                        <li><strong>Serious Incident Reporting:</strong> Track, document, and report serious incidents and corrective measures to the AI Office and national authorities.</li>
                        <li><strong>Cybersecurity Protection:</strong> Ensure adequate cybersecurity for the model and its physical infrastructure.</li>
                    </ul>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Open-Source GPAI Models (Article 53(2))</span><span class="icon"></span></h3>
                 <div class="accordion-content">
                    <p class="mb-2 text-sm text-slate-600">Providers of GPAI models released under a free and open-source license that allows access, use, modification, and distribution of the model are exempt from certain obligations under Art. 53(1)(a) (technical documentation to AI Office/authorities) and Art. 53(1)(b) (technical documentation to downstream providers), provided the model's parameters, architecture, and usage information are publicly available.</p>
                    <p class="mt-1 text-sm text-slate-600 font-semibold">However, this exemption does NOT apply to GPAI models with systemic risk. Systemic risk GPAI models must comply with all obligations, regardless of their open-source status.</p>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow mb-6">
                <h3 class="text-xl font-semibold text-primary-heading mb-3 accordion-button cursor-pointer flex justify-between items-center"><span>Interaction with AI System Rules & Fine-tuning</span><span class="icon"></span></h3>
                <div class="accordion-content">
                    <p class="mb-2 text-sm text-slate-600">A GPAI model is a component. An AI <strong>system</strong> incorporating it still needs its own risk classification (Prohibited, High, Limited, Minimal) based on its specific intended purpose.</p>
                    <p class="mt-1 text-sm text-slate-600">If an organization develops a high-risk AI system that integrates a systemic risk GPAI model they also developed, they face compounded compliance burdens (Chapter III for the system + Art. 53 & 55 for the model).</p>
                    <p class="mt-1 text-sm text-slate-600">Entities fine-tuning an existing GPAI model may become providers of a new GPAI model, incurring provider obligations for the modification/fine-tuning. The AI Office is expected to provide further clarifications.</p>
                </div>
            </div>
        </div>

        <div id="resources" class="content-section">
            <h2 class="text-2xl font-semibold text-primary-heading mb-6">Guide: Resources & Key Timelines</h2>
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="resource-card">
                    <h3 class="text-xl font-semibold">Key Definitions (Simplified)</h3>
                    <ul class="space-y-2 text-sm text-slate-700">
                        <li><strong>AI System:</strong> Machine-based, autonomous, infers outputs.</li>
                        <li><strong>Provider:</strong> Develops AI system or has it developed, places on market/service under own name/trademark.</li>
                        <li><strong>Deployer:</strong> Uses AI system under its authority (except personal non-professional activity).</li>
                        <li><strong>Intended Purpose:</strong> Use for which an AI system is intended by the provider.</li>
                        <li><strong>GPAI Model:</strong> AI model with significant generality, capable of wide range of tasks.</li>
                    </ul>
                </div>
                <div class="resource-card">
                    <h3 class="text-xl font-semibold">Key Application Dates</h3>
                    <ul class="space-y-2 text-sm text-slate-700">
                        <li><strong>Feb 2, 2025:</strong> Most prohibitions (Art. 5) apply.</li>
                        <li><strong>Aug 2, 2025:</strong> Rules on GPAI models apply.</li>
                        <li><strong>Aug 2, 2026:</strong> Majority of AI Act provisions apply (incl. most High-Risk).</li>
                        <li><strong>Aug 2, 2027:</strong> Obligations for High-Risk AI (Annex I, Section A products).</li>
                    </ul>
                    <p class="mt-3 text-xs text-slate-500">This is a simplified overview. Refer to official text.</p>
                </div>
            </div>

            <div class="resource-card">
                <h3 class="text-xl font-semibold">Further Information</h3>
                <p class="mb-2">For complete and official texts, guidelines, and updates, refer to official EU sources:</p>
                <ul class="list-disc list-inside space-y-1">
                    <li><a href="https://eur-lex.europa.eu/" target="_blank" rel="noopener noreferrer" class="text-primary-heading hover:underline">EUR-Lex (Official Journal of the EU)</a></li>
                    <li><a href="https://digital-strategy.ec.europa.eu/en/policies/european-approach-artificial-intelligence" target="_blank" rel="noopener noreferrer" class="text-primary-heading hover:underline">European Commission - AI Strategy</a></li>
                </ul>
                 <p class="mt-4 text-sm text-slate-500">This guide is for informational purposes only and does not constitute legal advice. Consult with legal professionals for specific guidance on EU AI Act compliance.</p>
            </div>
        </div>
    </main>

<script>
    let assessmentState = {};
    const assessmentSteps = [
        "assessment-step-role", 
        "assessment-step-1-definition",
        "assessment-step-2-prohibited",
        "assessment-step-3-highrisk-pathway",
        "assessment-step-4a-annex3-profiling",
        "assessment-step-4b-annex3-harm",
        "assessment-step-4c-annex3-conditions",
        "assessment-step-5-limited"
    ];
    let currentStepIndex = 0; 
    let riskChart = null; 

    function navigateToTab(tabId) {
        const tabs = document.querySelectorAll('.tab-button');
        const contentSections = document.querySelectorAll('.content-section');
        const mobileNav = document.getElementById('mobile-nav');

        contentSections.forEach(section => section.classList.remove('active'));
        const activeSection = document.getElementById(tabId);
        if (activeSection) activeSection.classList.add('active');

        tabs.forEach(tab => {
            tab.classList.toggle('active', tab.dataset.tab === tabId);
        });
        if (mobileNav.value !== tabId) mobileNav.value = tabId;
        window.scrollTo(0, 0);

        if (tabId === 'risk-categories' && !riskChart) { 
            const ctxRisk = document.getElementById('riskDistributionChart');
            if (ctxRisk) {
                riskChart = new Chart(ctxRisk, {
                    type: 'doughnut',
                    data: {
                        labels: ['Minimal Risk', 'Limited Risk', 'High-Risk', 'Prohibited'],
                        datasets: [{
                            label: 'Conceptual Risk Distribution', data: [70, 15, 14, 1],
                            backgroundColor: ['#16A34A', '#a5d1ff', '#ffd60a', '#DC2626'], 
                            borderColor: ['#15803d', '#001d3d', '#d4b100', '#b91c1c'],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom', labels: { font: { size: 10, family: 'Raleway' }, padding: 10 }},
                            title: { display: true, text: 'Conceptual AI Risk Distribution', font: { size: 14, family: 'Raleway' }, padding: { bottom:15 } },
                            tooltip: { callbacks: { label: function(context) {
                                let label = context.label || ''; if (label) { label += ': '; }
                                if (context.parsed !== null) { label += context.parsed + '%'; } return label;
                            }}}
                        }
                    }
                });
            }
        }
    }


    function showAssessmentStep(stepId) {
        document.querySelectorAll('.assessment-step').forEach(step => step.classList.remove('active'));
        const currentStepElement = document.getElementById(stepId);
        if (currentStepElement) {
            currentStepElement.classList.add('active');
        }
    }

    function collectAnswers() {
        assessmentState = {}; 
        
        assessmentState.userRole = document.querySelector('input[name="q0_1_user_role"]:checked')?.value || 'Not Specified';

        assessmentState.isMachineBased = document.querySelector('input[name="q1_1_machine_based"]:checked')?.value;
        assessmentState.hasAutonomy = document.querySelector('input[name="q1_2_autonomy"]:checked')?.value;
        assessmentState.hasInference = document.querySelector('input[name="q1_3_inference"]:checked')?.value;
        assessmentState.isAISystem = (assessmentState.isMachineBased === 'yes' && assessmentState.hasAutonomy === 'yes' && assessmentState.hasInference === 'yes');

        assessmentState.prohibitedPractices = Array.from(document.querySelectorAll('input[name="q2_prohibited"]:checked')).map(cb => cb.value);
        assessmentState.isProhibited = assessmentState.prohibitedPractices.length > 0;

        assessmentState.isAnnexI = document.querySelector('input[name="q3_1_annex_i"]:checked')?.value;
        assessmentState.isAnnexIII = document.querySelector('input[name="q3_2_annex_iii"]:checked')?.value;

        if (assessmentState.isAnnexIII === 'yes') {
            assessmentState.performsProfiling = document.querySelector('input[name="q4_1_profiling"]:checked')?.value;
            if (assessmentState.performsProfiling === 'no') {
                assessmentState.posesSignificantHarm = document.querySelector('input[name="q4_2_significant_harm"]:checked')?.value;
                if (assessmentState.posesSignificantHarm === 'no') {
                    assessmentState.derogationConditionsMet = Array.from(document.querySelectorAll('input[name="q4_3_derogation_condition"]:checked')).map(cb => cb.value).length > 0;
                }
            }
        }
        
        assessmentState.isHighRisk = false;
        assessmentState.highRiskReason = "Not applicable or not determined.";
        if (assessmentState.isAnnexI === 'yes') {
            assessmentState.isHighRisk = true;
            assessmentState.highRiskReason = "System is indicated as falling under Annex I (safety component of a regulated product requiring third-party conformity assessment - based on your answer to Q3.1).";
        } else if (assessmentState.isAnnexIII === 'yes') {
            if (assessmentState.performsProfiling === 'yes') {
                assessmentState.isHighRisk = true;
                assessmentState.highRiskReason = "System is indicated as listed in Annex III (Q3.2: Yes) AND performs profiling of natural persons (Q4.1: Yes). Derogation does not apply.";
            } else if (assessmentState.posesSignificantHarm === 'yes') {
                assessmentState.isHighRisk = true;
                assessmentState.highRiskReason = "System is indicated as listed in Annex III (Q3.2: Yes), does not perform profiling (Q4.1: No), BUT poses a significant risk of harm to health, safety, or fundamental rights (Q4.2: Yes).";
            } else if (assessmentState.posesSignificantHarm === 'no' && (typeof assessmentState.derogationConditionsMet === 'undefined' || !assessmentState.derogationConditionsMet)) {
                assessmentState.isHighRisk = true;
                assessmentState.highRiskReason = "System is indicated as listed in Annex III (Q3.2: Yes), does not perform profiling (Q4.1: No), does not pose significant harm (Q4.2: No), BUT does NOT meet any of the specific derogation conditions (Q4.3).";
            } else if (assessmentState.posesSignificantHarm === 'no' && assessmentState.derogationConditionsMet) {
                assessmentState.isHighRisk = false; 
                assessmentState.highRiskReason = "System is indicated as listed in Annex III (Q3.2: Yes), but derogation from High-Risk classification LIKELY applies because: it does NOT perform profiling (Q4.1: No), does NOT pose significant harm (Q4.2: No), AND meets at least one specific derogation condition (Q4.3). Thorough documentation of this assessment is required.";
            }
        }

        assessmentState.limitedRiskPractices = Array.from(document.querySelectorAll('input[name="q5_limited_risk"]:checked')).map(cb => cb.value);
        assessmentState.isLimitedRisk = assessmentState.limitedRiskPractices.length > 0;
    }

    function displayAssessmentResult() {
        const resultContentDiv = document.getElementById('assessmentResultContent');
        resultContentDiv.innerHTML = `<p class="font-semibold text-primary-heading text-lg mb-2">Assessment Summary (Role: ${assessmentState.userRole}):</p>`;
        let primaryClassificationDetermined = false;

        if (!assessmentState.isAISystem) {
            resultContentDiv.innerHTML += `<p class="text-critical-accent font-medium">System does NOT appear to meet the AI Act definition of an "AI System" based on your answers to Step 1 (Machine-based: ${assessmentState.isMachineBased || 'N/A'}, Autonomy: ${assessmentState.hasAutonomy || 'N/A'}, Inference: ${assessmentState.hasInference || 'N/A'}). If this is correct, the Act's specific AI rules may not apply. Verify carefully.</p>`;
            document.getElementById('assessment-result-display').classList.remove('hidden');
            primaryClassificationDetermined = true; 
            return;
        } else {
            resultContentDiv.innerHTML += `<p class="text-positive-accent">System appears to meet the AI Act definition of an "AI System" (Machine-based: ${assessmentState.isMachineBased}, Autonomy: ${assessmentState.hasAutonomy}, Inference: ${assessmentState.hasInference}).</p>`;
        }

        if (assessmentState.isProhibited) {
            resultContentDiv.innerHTML += `<p class="text-critical-accent font-bold mt-2">POTENTIAL CLASSIFICATION: Prohibited AI (Unacceptable Risk).</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Justification:</strong> Your answers indicate involvement in one or more prohibited practices (Step 2), such as: ${assessmentState.prohibitedPractices.join(', ').replace(/_/g, ' ')}.</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Action:</strong> Cease development and prevent deployment. These systems are banned under Article 5.</p>`;
            primaryClassificationDetermined = true;
        }
        
        if (!primaryClassificationDetermined && assessmentState.isHighRisk) {
            resultContentDiv.innerHTML += `<p class="text-warning-accent font-bold mt-2">POTENTIAL CLASSIFICATION: High-Risk AI.</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Justification:</strong> ${assessmentState.highRiskReason}</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Action for ${assessmentState.userRole}:</strong> `;
            if (assessmentState.userRole === 'Provider') {
                resultContentDiv.innerHTML += `Subject to stringent obligations under Chapter III of the AI Act (e.g., risk management, data governance, technical documentation, conformity assessment, human oversight, post-market monitoring, registration). Refer to the "Guide: High-Risk Obligations" for details.`;
            } else if (assessmentState.userRole === 'Deployer') {
                 resultContentDiv.innerHTML += `Ensure use per instructions, appropriate human oversight, monitor operation, keep logs, and potentially conduct a Fundamental Rights Impact Assessment (FRIA) if Annex III (pts 2-8) and you are a public authority or providing essential public services. Ensure the provider meets their obligations.`;
            } else if (assessmentState.userRole === 'Importer' || assessmentState.userRole === 'Distributor') {
                 resultContentDiv.innerHTML += `Verify provider compliance (CE mark, documentation). Do not make non-conforming systems available. Consult Articles 23 (Importers) & 24 (Distributors).`;
            } else {
                 resultContentDiv.innerHTML += `Consult specific obligations for your role. Providers bear primary responsibility for conformity.`;
            }
            resultContentDiv.innerHTML += `</p>`;
            primaryClassificationDetermined = true;
        }
        
        if (!primaryClassificationDetermined && assessmentState.isAnnexIII === 'yes' && assessmentState.highRiskReason && assessmentState.highRiskReason.includes("derogation likely applies")) {
            resultContentDiv.innerHTML += `<p class="text-positive-accent font-bold mt-2">POTENTIAL CLASSIFICATION: Not High-Risk (Annex III Derogation Likely Applies).</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Justification:</strong> ${assessmentState.highRiskReason}</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Action for ${assessmentState.userRole}:</strong> `;
             if (assessmentState.userRole === 'Provider') {
                resultContentDiv.innerHTML += `You must thoroughly document this assessment demonstrating that all derogation criteria under Article 6(3) are met and register the system in the EU database as per Article 49(2). This documentation must be provided to authorities upon request.`;
            } else {
                 resultContentDiv.innerHTML += `Ensure the provider has documented this derogation and registered the system appropriately.`;
            }
            resultContentDiv.innerHTML += `</p>`;
            primaryClassificationDetermined = true; 
        }
        
        if (assessmentState.isLimitedRisk) {
             if (!primaryClassificationDetermined) { 
                resultContentDiv.innerHTML += `<p class="text-sky-600 font-bold mt-2">POTENTIAL CLASSIFICATION: Limited Risk AI.</p>`;
                primaryClassificationDetermined = true;
            } else {
                 resultContentDiv.innerHTML += `<p class="text-sky-600 font-semibold mt-2">ADDITIONAL CONSIDERATION: Limited Risk (Transparency Obligations).</p>`;
            }
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Justification:</strong> Your answers indicate the system has functionalities requiring transparency under Article 50 (Step 5), such as: ${assessmentState.limitedRiskPractices.join(', ').replace(/_/g, ' ')}.</p>`;
            resultContentDiv.innerHTML += `<p class="text-sm"><strong>Action for ${assessmentState.userRole}:</strong> Implement required transparency measures (e.g., inform users of AI interaction, label AI-generated content).</p>`;
        }
        
        if (!primaryClassificationDetermined) {
             resultContentDiv.innerHTML += `<p class="text-positive-accent font-bold mt-2">POTENTIAL CLASSIFICATION: Minimal Risk AI.</p>`;
             resultContentDiv.innerHTML += `<p class="text-sm"><strong>Justification:</strong> Based on your answers, the system does not appear to fall into Prohibited, High-Risk (either directly or via Annex III without valid derogation), or Limited Risk categories.</p>`;
             resultContentDiv.innerHTML += `<p class="text-sm"><strong>Action for ${assessmentState.userRole}:</strong> Generally permitted under the AI Act. Monitor for changes in functionality or intended use that could alter its risk profile. Voluntary codes of conduct are encouraged.</p>`;
        }

        resultContentDiv.innerHTML += `<hr class="my-3 border-slate-300">`;
        resultContentDiv.innerHTML += `<p class="font-semibold text-primary-heading">Note on Open Source AI Systems:</p>`;
        resultContentDiv.innerHTML += `<p class="text-sm">If your AI system (whether classified as High-Risk, Limited Risk, or Minimal Risk) is developed or distributed under a free and open-source license, this promotes transparency and community review. However, under the EU AI Act, the classification of an AI <strong>system</strong> and its corresponding legal obligations are primarily determined by its intended purpose, functionalities, and potential impact. Making a High-Risk or Limited-Risk AI <strong>system</strong> open-source does <strong>not</strong> generally exempt it from the specific obligations applicable to its risk category. For instance, a High-Risk AI system, even if open-source, must still meet all requirements of Chapter III of the Act (risk management, data governance, conformity assessment, etc.).</p>`;
        
        resultContentDiv.innerHTML += `<hr class="my-3 border-slate-300"><p class="text-xs text-slate-500 mt-2"><strong>Disclaimer:</strong> This is a preliminary assessment based on your inputs and for informational purposes only. It does not constitute legal advice. Always refer to the official EU AI Act text and consult with legal professionals for definitive classification and compliance guidance for your specific AI system.</p>`;
        document.getElementById('assessment-result-display').classList.remove('hidden');
        document.getElementById('assessment-result-display').scrollIntoView({ behavior: 'smooth' });
    }


    document.addEventListener('DOMContentLoaded', function () {
        const tabs = document.querySelectorAll('.tab-button');
        const mobileNav = document.getElementById('mobile-nav');
        const contentSections = document.querySelectorAll('.content-section');
        const accordions = document.querySelectorAll('.accordion-button');

        function showTab(tabId) {
            contentSections.forEach(section => section.classList.remove('active'));
            const activeSection = document.getElementById(tabId);
            if (activeSection) activeSection.classList.add('active');

            tabs.forEach(tab => tab.classList.toggle('active', tab.dataset.tab === tabId));
            if (mobileNav.value !== tabId) mobileNav.value = tabId;
            window.scrollTo(0, 0);

            if (tabId === 'risk-categories' && !riskChart) { 
                const ctxRisk = document.getElementById('riskDistributionChart');
                if (ctxRisk) {
                    riskChart = new Chart(ctxRisk, {
                        type: 'doughnut',
                        data: {
                            labels: ['Minimal Risk', 'Limited Risk', 'High-Risk', 'Prohibited'],
                            datasets: [{
                                label: 'Conceptual Risk Distribution', data: [70, 15, 14, 1],
                                backgroundColor: ['#16A34A', '#a5d1ff', '#ffd60a', '#DC2626'], 
                                borderColor: ['#15803d', '#001d3d', '#d4b100', '#b91c1c'],
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true, maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom', labels: { font: { size: 10, family: 'Raleway' }, padding: 10 }},
                                title: { display: true, text: 'Conceptual AI Risk Distribution', font: { size: 14, family: 'Raleway' }, padding: { bottom:15 } },
                                tooltip: { callbacks: { label: function(context) {
                                    let label = context.label || ''; if (label) { label += ': '; }
                                    if (context.parsed !== null) { label += context.parsed + '%'; } return label;
                                }}}
                            }
                        }
                    });
                }
            }
        }
        window.navigateToTab = showTab; 

        tabs.forEach(tab => tab.addEventListener('click', () => showTab(tab.dataset.tab)));
        mobileNav.addEventListener('change', (event) => showTab(event.target.value));
        showTab('home'); // Initialize with the home tab

        accordions.forEach(button => {
            button.addEventListener('click', () => {
                button.classList.toggle('open');
                const content = button.nextElementSibling;
                if (content && content.classList.contains('accordion-content')) {
                    content.style.display = content.style.display === "block" ? "none" : "block";
                }
            });
        });
        
        const checkAiSystemButton = document.getElementById('checkAiSystemButton');
        const aiSystemResult = document.getElementById('aiSystemResult');
        if(checkAiSystemButton) {
            checkAiSystemButton.addEventListener('click', () => {
                const criteria = {
                    machine_based: document.querySelector('input[data-criterion="machine_based"]').checked,
                    autonomy: document.querySelector('input[data-criterion="autonomy"]').checked,
                    inference: document.querySelector('input[data-criterion="inference"]').checked
                };
                if (criteria.machine_based && criteria.autonomy && criteria.inference) {
                    aiSystemResult.textContent = "Preliminary: Likely an AI System. Further assessment of its intended purpose is needed for risk classification.";
                    aiSystemResult.className = "mt-3 font-semibold text-positive-accent";
                } else {
                    aiSystemResult.textContent = "Preliminary: May not meet all core criteria for an AI System under the Act. Review definition carefully.";
                    aiSystemResult.className = "mt-3 font-semibold text-warning-message"; 
                }
            });
        }

        const profilingRadios = document.querySelectorAll('input[name="profiling"]');
        const derogationQ2Div = document.getElementById('derogationQ2');
        const derogationQ3Div = document.getElementById('derogationQ3');
        const assessDerogationButton = document.getElementById('assessDerogationButton');
        const derogationResultP = document.getElementById('derogationResult');

        if(profilingRadios.length > 0 && derogationQ2Div && assessDerogationButton && derogationResultP) {
            profilingRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'no') {
                        derogationQ2Div.classList.remove('hidden');
                    } else {
                        derogationQ2Div.classList.add('hidden');
                        if(derogationQ3Div) derogationQ3Div.classList.add('hidden');
                        derogationResultP.textContent = "If profiling is performed, the Annex III system is High-Risk. Derogation does not apply.";
                        derogationResultP.className = "mt-3 font-semibold text-critical-accent";
                    }
                });
            });

            const significantHarmRadios = document.querySelectorAll('input[name="significant_harm"]');
            significantHarmRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'no' && derogationQ3Div) {
                        derogationQ3Div.classList.remove('hidden');
                    } else if (derogationQ3Div) {
                        derogationQ3Div.classList.add('hidden');
                        derogationResultP.textContent = ""; 
                    }
                });
            });

            assessDerogationButton.addEventListener('click', () => {
                const profiling = document.querySelector('input[name="profiling"]:checked');
                const significantHarm = document.querySelector('input[name="significant_harm"]:checked');
                const conditions = Array.from(document.querySelectorAll('input[name="derogation_condition"]:checked')).map(cb => cb.value);

                if (!profiling) {
                    derogationResultP.textContent = "Please answer Question 1 (Profiling).";
                    derogationResultP.className = "mt-3 font-semibold text-critical-accent"; return;
                }
                if (profiling.value === 'yes') {
                    derogationResultP.textContent = "System is High-Risk (performs profiling). Derogation does not apply.";
                    derogationResultP.className = "mt-3 font-semibold text-critical-accent"; return;
                }
                if (!significantHarm) {
                    derogationResultP.textContent = "Please answer Question 2 (Significant Harm).";
                    derogationResultP.className = "mt-3 font-semibold text-critical-accent"; return;
                }
                if (significantHarm.value === 'yes') {
                    derogationResultP.textContent = "System is likely High-Risk (poses significant harm).";
                    derogationResultP.className = "mt-3 font-semibold text-warning-message"; 
                } else { 
                    if (conditions.length > 0) {
                        derogationResultP.textContent = "Derogation may apply. System might not be High-Risk. Thoroughly document your assessment as per Art 6(3).";
                        derogationResultP.className = "mt-3 font-semibold text-positive-accent";
                    } else {
                        derogationResultP.textContent = "System is likely High-Risk (does not meet derogation conditions in Q3).";
                        derogationResultP.className = "mt-3 font-semibold text-warning-message"; 
                    }
                }
            });
        }
        
        const assessmentNextBtns = document.querySelectorAll('.assessment-next-btn');
        const resetAssessmentBtn = document.getElementById('resetAssessmentBtn');
        
        showAssessmentStep(assessmentSteps[0]); 

        assessmentNextBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                if (btn.id === 'viewAssessmentResultBtn') { 
                    collectAnswers();
                    displayAssessmentResult();
                    return; 
                }

                const currentStepId = assessmentSteps[currentStepIndex];
                let nextStepId = btn.dataset.next; 

                // Early exit for Not an AI System
                if (currentStepId === "assessment-step-1-definition") {
                    collectAnswers(); // Collect answers for step 1
                    if (!assessmentState.isAISystem) {
                        displayAssessmentResult(); // Display "Not an AI System" result
                        return; // Stop further progression
                    }
                }
                
                // Early exit for Prohibited AI
                if (currentStepId === "assessment-step-2-prohibited") {
                    const prohibitedCheckboxes = document.querySelectorAll('input[name="q2_prohibited"]:checked');
                    if (prohibitedCheckboxes.length > 0) {
                        collectAnswers(); 
                        displayAssessmentResult(); 
                        return; 
                    }
                }


                if (currentStepId === "assessment-step-3-highrisk-pathway") { 
                    const isAnnexIII = document.querySelector('input[name="q3_2_annex_iii"]:checked')?.value;
                    if (isAnnexIII !== 'yes') { 
                        nextStepId = "assessment-step-5-limited"; 
                    } else {
                        nextStepId = "assessment-step-4a-annex3-profiling";
                    }
                } else if (currentStepId === "assessment-step-4a-annex3-profiling") { 
                    const performsProfiling = document.querySelector('input[name="q4_1_profiling"]:checked')?.value;
                    if (performsProfiling === 'yes') { 
                        nextStepId = "assessment-step-5-limited";
                    } else {
                        nextStepId = "assessment-step-4b-annex3-harm";
                    }
                } else if (currentStepId === "assessment-step-4b-annex3-harm") { 
                    const posesHarm = document.querySelector('input[name="q4_2_significant_harm"]:checked')?.value;
                    if (posesHarm === 'yes') { 
                        nextStepId = "assessment-step-5-limited";
                    } else {
                         nextStepId = "assessment-step-4c-annex3-conditions";
                    }
                }
                
                if (nextStepId) {
                    const nextStepIndexAttempt = assessmentSteps.indexOf(nextStepId);
                    if (nextStepIndexAttempt !== -1) {
                        currentStepIndex = nextStepIndexAttempt;
                        showAssessmentStep(assessmentSteps[currentStepIndex]);
                    }
                }
            });
        });
        
        if (resetAssessmentBtn) {
            resetAssessmentBtn.addEventListener('click', () => {
                document.getElementById('assessmentContainer').querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => input.checked = false);
                currentStepIndex = 0; 
                showAssessmentStep(assessmentSteps[currentStepIndex]);
                document.getElementById('assessment-result-display').classList.add('hidden');
                const annexIIIDetails = document.getElementById('annexIIIDetails');
                const toggleBtn = document.getElementById('toggleAnnexIIIDetails');
                if(annexIIIDetails && toggleBtn && annexIIIDetails.style.display === 'block') {
                    annexIIIDetails.style.display = 'none';
                    toggleBtn.classList.remove('open');
                }
            });
        }

    });
</script>

</body>
</html>
