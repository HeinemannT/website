import{k as S,e as w,l as u,z as o,m,u as x,x as F,q as i,i as P,y as $,p as C,E as D,G as L,U as h,V as k,v as G,B as M,F as q}from"./core-vendor-rJyK4pSc.js";import{p as W,b as R,q as B,a as Z,C as K}from"./ui-vendor-BUCNl-D1.js";import{C as X}from"./CodeOutputPanel-CKE55Law.js";import{S as J,_ as Y,a as H}from"./ScriptBuilder-B0ANh3C-.js";import{u as Q}from"./index-B3_LPi4U.js";import{g as ee,c as te}from"./gzip-CSDAKxWS.js";const se={class:"p-3 bg-slate-100 dark:bg-slate-800 rounded-full mb-3"},oe=S({__name:"FileDropZone",emits:["drop"],setup(z,{emit:v}){const a=v,g=w(!1);function f(l){l.preventDefault(),g.value=!1,l.dataTransfer?.files&&a("drop",l.dataTransfer.files)}function y(l){l.preventDefault(),g.value=!0}function _(l){l.preventDefault(),g.value=!1}return(l,b)=>(i(),u("div",{onDrop:f,onDragover:y,onDragleave:_,class:F(["relative border-2 border-dashed rounded-xl flex flex-col items-center justify-center p-8 transition-colors cursor-pointer",[g.value?"border-cora-500 bg-cora-50 dark:bg-cora-500/10":"border-slate-200 dark:border-slate-700 hover:border-cora-400 hover:bg-slate-50 dark:hover:bg-slate-800"]])},[o("div",se,[m(x(W),{class:F(["w-6 h-6 text-slate-400",{"text-cora-500":g.value}])},null,8,["class"])]),b[1]||(b[1]=o("p",{class:"text-sm font-medium text-slate-700 dark:text-slate-300"}," Drag & Drop files here ",-1)),b[2]||(b[2]=o("p",{class:"text-xs text-slate-500 mt-1"}," or click to browse ",-1)),o("input",{type:"file",multiple:"",class:"absolute inset-0 opacity-0 cursor-pointer",onChange:b[0]||(b[0]=U=>a("drop",U.target.files))},null,32)],34))}}),re={class:"flex flex-col h-full overflow-hidden"},ae={class:"p-6 overflow-y-auto"},le={class:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"},ne={class:"lg:col-span-2"},ie={class:"flex flex-col items-center justify-center pt-5 pb-6 text-center"},de={class:"mb-4 p-4 rounded-full bg-indigo-50 dark:bg-indigo-900/20 text-indigo-500 group-hover:scale-110 transition-transform"},ce={class:"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-5 shadow-sm flex flex-col gap-4"},pe={class:"flex items-center bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg px-3 py-2"},ue={class:"flex-1 flex flex-col"},ge={class:"bg-indigo-50 dark:bg-indigo-900/10 border border-indigo-100 dark:border-indigo-900/50 rounded-lg p-3"},be={class:"flex gap-2"},me=["disabled"],fe={class:"space-y-3"},xe={key:0,class:"text-center py-12 text-slate-400 dark:text-slate-600 italic"},ve={class:"w-16 h-16 shrink-0 bg-slate-100 dark:bg-slate-900 rounded border border-slate-200 dark:border-slate-700 overflow-hidden flex items-center justify-center"},he=["src"],ke={class:"flex-grow min-w-0 grid grid-cols-2 gap-3"},we=["onUpdate:modelValue"],ye=["onUpdate:modelValue"],_e={class:"flex flex-col items-end gap-2 shrink-0"},Ue={key:0,class:"text-emerald-500 flex items-center text-xs font-bold"},Ie={key:1,class:"text-pink-500 flex items-center text-xs font-bold"},Ce={key:2,class:"text-indigo-500 text-xs font-bold animate-pulse"},De={key:3,class:"text-slate-400 text-xs font-medium"},Le=["onClick"],Re={key:0,class:"mt-6 text-center text-xs text-slate-400"},Ae=S({__name:"ImageUpload",setup(z){const{add:v}=Q(),a=w([]),g=w("vFolder"),f=w(""),y=[s=>`https://corsproxy.io/?${encodeURIComponent(s)}`,s=>`https://api.allorigins.win/raw?url=${encodeURIComponent(s)}`,s=>`https://thingproxy.freeboard.io/fetch/${s}`],_=async s=>{for(const e of y){const t=e(s);try{const r=await fetch(t);if(!r.ok)continue;const d=await r.blob();if(d.size>0&&d.type.startsWith("image/"))return d}catch(r){console.warn(`Proxy failed: ${t}`,r)}}throw new Error("All proxies failed")},l=new Map,b=async s=>{try{s.status="processing";let e;if(s.file)e=new Uint8Array(await s.file.arrayBuffer());else if(s.blob)e=new Uint8Array(await s.blob.arrayBuffer());else throw new Error("No data");const t=await ee(e),r=te(t),d=`${s.name};${s.mimeType};${r}`;l.set(s.id,d),s.status="done"}catch(e){console.error("Processing failed for",s.name,e),s.status="error"}},U=(s,e,t)=>({id:s,url:e,name:t,scriptId:"",status:"pending",mimeType:"image/png",sizeLabel:"Fetching..."}),A=async()=>{if(!f.value)return;const s=f.value.trim().split(/\r?\n/).filter(c=>c.trim()!==""),e=[...new Set(s.map(c=>c.trim()))];if(e.length===0)return;v(`Fetching ${e.length} image(s)...`,"info");const t=e.map(c=>{const I=(((c.split("/").pop()??"image").split("?")[0]??"image").split(".")[0]??"image").replace(/[^a-zA-Z0-9_-]/g,"_"),j=crypto.randomUUID();return U(j,c,I)});a.value.push(...t),f.value="";let r=0,d=0;await Promise.allSettled(t.map(async c=>{const n=a.value.find(p=>p.id===c.id);if(n)try{const p=await _(c.url);n.blob=p,n.previewUrl=URL.createObjectURL(p),n.mimeType=p.type,n.sizeLabel=(p.size/1024).toFixed(1)+" KB",await b(n),n.status==="done"?r++:d++}catch{n.status="error",n.sizeLabel="Failed",d++}})),r>0&&v(`Imported ${r} images`,"success"),d>0&&v(`Failed to import ${d} images`,"error")},N=s=>{const e=Array.from(s).filter(t=>t.type.startsWith("image/"));e.forEach(async t=>{if(!t)return;const c=(t.name.split(".")[0]||"image").replace(/[^a-zA-Z0-9_-]/g,"_"),n={id:crypto.randomUUID(),file:t,name:c,scriptId:"",status:"pending",previewUrl:URL.createObjectURL(t),mimeType:t.type||"image/png",sizeLabel:(t.size/1024).toFixed(1)+" KB"};a.value.push(n);const p=a.value.find(I=>I.id===n.id);p&&await b(p)}),e.length===0&&(s instanceof FileList,s.length>0)&&v("No image files found in selection","info")},O=s=>{const e=a.value.find(t=>t.id===s);if(e){e.previewUrl&&URL.revokeObjectURL(e.previewUrl),l.delete(s);const t=a.value.indexOf(e);a.value.splice(t,1)}},T=()=>{a.value.forEach(s=>{s.previewUrl&&URL.revokeObjectURL(s.previewUrl)}),a.value=[],l.clear()},V=P(()=>{const s=a.value.filter(t=>t.status==="done");if(s.length===0)return"";const e=new J(`Image Upload Script (${s.length} files)`);for(const t of s){const r=l.get(t.id);r&&e.createObject(g.value,"FileResource",{id:t.scriptId,name:t.name,content:r})}return e.toString()}),E=P(()=>a.value.some(s=>s.status==="processing"||s.status==="pending"));return(s,e)=>(i(),$(H,{sidebarClass:"w-full md:w-1/3"},{main:C(()=>[o("div",re,[m(Y,{title:"Image Upload",icon:x(R),"icon-color":"text-violet-600 dark:text-violet-400"},null,8,["icon"]),o("div",ae,[o("div",le,[o("div",ne,[m(oe,{onDrop:N,class:"h-full min-h-[200px] border-2 border-dashed border-slate-300 dark:border-slate-700 hover:border-indigo-500 dark:hover:border-indigo-500 bg-slate-50 dark:bg-slate-900/50 rounded-xl transition-all group cursor-pointer",accept:"image/*"},{default:C(()=>[o("div",ie,[o("div",de,[m(x(R),{class:"w-8 h-8"})]),e[2]||(e[2]=o("p",{class:"mb-2 text-sm text-slate-500 dark:text-slate-400"},[o("span",{class:"font-bold text-indigo-500"},"Click to upload"),L(" or drag and drop")],-1)),e[3]||(e[3]=o("p",{class:"text-xs text-slate-400 dark:text-slate-500"},"SVG, PNG, JPG or GIF (MAX. 10MB)",-1))])]),_:1})]),o("div",ce,[o("div",null,[e[5]||(e[5]=o("label",{class:"text-[10px] uppercase font-bold text-slate-400 tracking-wider mb-2 block"},"Target Variable",-1)),o("div",pe,[e[4]||(e[4]=o("span",{class:"text-indigo-500 font-mono text-xs mr-2"},":=",-1)),h(o("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>g.value=t),type:"text",spellcheck:"false",class:"bg-transparent border-none text-sm font-bold text-slate-700 dark:text-slate-200 focus:outline-none w-full"},null,512),[[k,g.value]])])]),o("div",ue,[o("div",ge,[e[6]||(e[6]=o("div",{class:"flex justify-between items-center mb-2"},[o("span",{class:"text-indigo-600 dark:text-indigo-400 font-bold text-xs uppercase tracking-wider"},"Bulk Import"),o("span",{class:"text-indigo-400 text-xs normal-case"},"Paste URLs (one per line)")],-1)),h(o("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>f.value=t),rows:"3",class:"w-full bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg p-3 text-xs font-mono resize-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none mb-3",placeholder:`https://example.com/image.png
https://othersite.com/logo.svg`},null,512),[[k,f.value]]),o("div",be,[o("button",{onClick:A,disabled:!f.value,class:"flex-1 bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-xs font-bold py-2 rounded-lg transition-colors shadow-lg shadow-indigo-500/20"}," Fetch Images ",8,me),a.value.length?(i(),u("button",{key:0,onClick:T,class:"px-3 bg-red-50 hover:bg-red-100 text-red-500 hover:text-red-600 rounded-lg transition-colors"},[m(x(B),{class:"w-4 h-4"})])):D("",!0)])])])])]),o("div",fe,[a.value.length===0?(i(),u("div",xe," Images to process will appear here... ")):D("",!0),(i(!0),u(q,null,G(a.value,t=>(i(),u("div",{key:t.id,class:"group flex items-center gap-4 p-3 bg-white dark:bg-slate-800 rounded-lg border border-slate-200 dark:border-slate-700 shadow-sm transition-all hover:border-indigo-300 dark:hover:border-indigo-700"},[o("div",ve,[t.previewUrl?(i(),u("img",{key:0,src:t.previewUrl,class:"w-full h-full object-cover"},null,8,he)):(i(),$(x(R),{key:1,class:"w-6 h-6 text-slate-400"}))]),o("div",ke,[o("div",null,[e[7]||(e[7]=o("label",{class:"block text-[10px] font-bold text-slate-400 uppercase mb-0.5"},"ID",-1)),h(o("input",{"onUpdate:modelValue":r=>t.scriptId=r,class:"w-full text-xs font-mono bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 focus:border-indigo-500 outline-none"},null,8,we),[[k,t.scriptId]])]),o("div",null,[e[8]||(e[8]=o("label",{class:"block text-[10px] font-bold text-slate-400 uppercase mb-0.5"},"Resource Name",-1)),h(o("input",{"onUpdate:modelValue":r=>t.name=r,class:"w-full text-xs font-mono bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 focus:border-indigo-500 outline-none"},null,8,ye),[[k,t.name]])])]),o("div",_e,[t.status==="done"?(i(),u("div",Ue,[m(x(Z),{class:"w-3 h-3 mr-1"}),e[9]||(e[9]=L(" DONE",-1))])):t.status==="error"?(i(),u("div",Ie,[m(x(K),{class:"w-3 h-3 mr-1"}),e[10]||(e[10]=L(" ERROR",-1))])):t.status==="processing"?(i(),u("div",Ce,"PROCESSING...")):(i(),u("div",De,M(t.sizeLabel),1)),o("button",{onClick:r=>O(t.id),class:"text-slate-400 hover:text-pink-500 p-1 rounded hover:bg-pink-50 dark:hover:bg-pink-900/20 transition-colors"},[m(x(B),{class:"w-4 h-4"})],8,Le)])]))),128))]),E.value?(i(),u("div",Re,[...e[11]||(e[11]=[o("span",{class:"animate-pulse"},"Processing images...",-1)])])):D("",!0)])])]),sidebar:C(()=>[m(X,{title:"Extended Code",code:V.value},null,8,["code"])]),_:1}))}});export{Ae as default};
