import{k as Ou,l as ze,x as cr,E as ht,z as K,X as ic,B as $u,q as Be,e as Ne,s as rc,o as Xf,n as oc,y as Zf,p as st,U as un,Y as ac,Z as wo,V as $i,u as Re,m as se,G as Bi,F as Jf,v as Qf}from"./core-vendor-rJyK4pSc.js";import{B as ya,e as M,I as eh,i as V,a as H,b as Ke,c as S,d as ge,f as li,t as tn,g as nn,h as th,V as ui,j as w,s as bt,k as U,l as _a,m as be,n as Me,q as de,o as Qn,p as tt,r as Tr,u as ee,v as ba,O as Bu,w as ju,x as je,y as xn,z as Et,C as R,A as Pr,D as Nt,E as ie,F as k,G as L,H as Se,J as Dr,K as z,L as xe,M as P,N as m,P as xa,Q as Mr,R as Ar,S as yt,T as Ae,U as Ea,W as ut,X as F,Y as So,Z as Hu,_ as it,$ as zu,a0 as nh,a1 as W,a2 as Go,a3 as mt,a4 as X,a5 as te,a6 as Te,a7 as $,a8 as ih,a9 as we,aa as wa,ab as Vo,ac as rh,ad as Fu,ae as Uo,af as xt,ag as kr,ah as ei,ai as Gu,aj as Vu,ak as _n,al as Ir,am as Sa,an as Pe,ao as me,ap as ye,aq as Z,ar as G,as as Nr,at as ti,au as En,av as rn,aw as He,ax as Y,ay as pi,az as ni,aA as Uu,aB as di,aC as yn,aD as lr,aE as Kt,aF as sc,aG as oh,aH as ah,aI as sh,aJ as ch,aK as lh,aL as Wu,aM as kt,aN as Wo,aO as Ku,aP as uh,aQ as Ca,aR as ph,aS as Ra,aT as dh,aU as fh,aV as hh,aW as vh,aX as Ko,aY as Yu,aZ as mh,a_ as gh,a$ as cc,b0 as qu,b1 as yh,b2 as _h,b3 as bh,b4 as xh,b5 as Ta,b6 as Eh,b7 as Xu,b8 as Zu,b9 as wh,ba as Sh,bb as Ch}from"./bpmn-vendor-ZNR6v_Fd.js";import{_ as pn,a as ji}from"./BaseInput.vue_vue_type_script_setup_true_lang-B5M67uNm.js";import{C as Rh}from"./CodeOutputPanel-CKE55Law.js";import{u as Th,_ as Ph}from"./index-B3_LPi4U.js";import{u as Dh,_ as Mh,a as Ah,S as kh}from"./ScriptBuilder-B0ANh3C-.js";import{b as Ih,a as Nh,c as Lh}from"./gzip-CSDAKxWS.js";import{u as Hi}from"./usePersistentState-CDZ61fLN.js";import{a as Oh,Z as $h,m as Bh,X as lc,D as jh,n as Hh,l as zh,R as Fh,L as uc,o as Gh}from"./ui-vendor-BUCNl-D1.js";function fi(e){ya.call(this,e),this.on("import.parse.complete",function(t){t.error||this._collectIds(t.definitions,t.elementsById)},this),this.on("diagram.destroy",function(){this.get("moddle").ids.clear()},this)}M(fi,ya);fi.prototype._createModdle=function(e){var t=ya.prototype._createModdle.call(this,e);return t.ids=new eh([32,36,1]),t};fi.prototype._collectIds=function(e,t){var n=e.$model,i=n.ids,r;i.clear();for(r in t)i.claim(r,t[r])};var Vh=["c","C"],Uh=["v","V"],Wh=["y","Y"],Ju=["z","Z"];function Kh(e){return e.ctrlKey||e.metaKey||e.shiftKey||e.altKey}function We(e){return e.altKey?!1:e.ctrlKey||e.metaKey}function _e(e,t){return e=V(e)?e:[e],e.indexOf(t.key)!==-1||e.indexOf(t.code)!==-1}function Pa(e){return e.shiftKey}function Yh(e){return We(e)&&_e(Vh,e)}function qh(e){return We(e)&&_e(Uh,e)}function Xh(e){return We(e)&&!Pa(e)&&_e(Ju,e)}function Zh(e){return We(e)&&(_e(Wh,e)||_e(Ju,e)&&Pa(e))}var Lr="keyboard.keydown",Jh="keyboard.keyup",Qh=1e3,Qu="Keyboard binding is now implicit; explicit binding to an element got removed. For more information, see https://github.com/bpmn-io/diagram-js/issues/661";function De(e,t){var n=this;this._config=e=e||{},this._eventBus=t,this._keydownHandler=this._keydownHandler.bind(this),this._keyupHandler=this._keyupHandler.bind(this),t.on("diagram.destroy",function(){n._fire("destroy"),n.unbind()}),e.bindTo&&console.error("unsupported configuration <keyboard.bindTo>",new Error(Qu));var i=e&&e.bind!==!1;t.on("canvas.init",function(r){n._target=r.svg,i&&n.bind(),n._fire("init")})}De.$inject=["config.keyboard","eventBus"];De.prototype._keydownHandler=function(e){this._keyHandler(e,Lr)};De.prototype._keyupHandler=function(e){this._keyHandler(e,Jh)};De.prototype._keyHandler=function(e,t){var n;if(!this._isEventIgnored(e)){var i={keyEvent:e};n=this._eventBus.fire(t||Lr,i),n&&e.preventDefault()}};De.prototype._isEventIgnored=function(e){return!1};De.prototype.bind=function(e){e&&console.error("unsupported argument <node>",new Error(Qu)),this.unbind(),e=this._node=this._target,H.bind(e,"keydown",this._keydownHandler),H.bind(e,"keyup",this._keyupHandler),this._fire("bind")};De.prototype.getBinding=function(){return this._node};De.prototype.unbind=function(){var e=this._node;e&&(this._fire("unbind"),H.unbind(e,"keydown",this._keydownHandler),H.unbind(e,"keyup",this._keyupHandler)),this._node=null};De.prototype._fire=function(e){this._eventBus.fire("keyboard."+e,{node:this._node})};De.prototype.addListener=function(e,t,n){Ke(e)&&(n=t,t=e,e=Qh),this._eventBus.on(n||Lr,e,t)};De.prototype.removeListener=function(e,t){this._eventBus.off(t||Lr,e)};De.prototype.hasModifier=Kh;De.prototype.isCmd=We;De.prototype.isShift=Pa;De.prototype.isKey=_e;var ev=500;function Mn(e,t){var n=this;e.on("editorActions.init",ev,function(i){var r=i.editorActions;n.registerBindings(t,r)})}Mn.$inject=["eventBus","keyboard"];Mn.prototype.registerBindings=function(e,t){function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("undo",function(i){var r=i.keyEvent;if(Xh(r))return t.trigger("undo"),!0}),n("redo",function(i){var r=i.keyEvent;if(Zh(r))return t.trigger("redo"),!0}),n("copy",function(i){var r=i.keyEvent;if(Yh(r))return t.trigger("copy"),!0}),n("paste",function(i){var r=i.keyEvent;if(qh(r))return t.trigger("paste"),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(_e(["+","Add","="],r)&&We(r))return t.trigger("stepZoom",{value:1}),!0}),n("stepZoom",function(i){var r=i.keyEvent;if(_e(["-","Subtract"],r)&&We(r))return t.trigger("stepZoom",{value:-1}),!0}),n("zoom",function(i){var r=i.keyEvent;if(_e("0",r)&&We(r))return t.trigger("zoom",{value:1}),!0}),n("removeSelection",function(i){var r=i.keyEvent;if(_e(["Backspace","Delete","Del"],r))return t.trigger("removeSelection"),!0})};const Da={__init__:["keyboard","keyboardBindings"],keyboard:["type",De],keyboardBindings:["type",Mn]};var tv={moveSpeed:50,moveSpeedAccelerated:200};function ep(e,t,n){var i=this;this._config=S({},tv,e||{}),t.addListener(r);function r(o){var a=o.keyEvent,s=i._config;if(t.isCmd(a)&&t.isKey(["ArrowLeft","Left","ArrowUp","Up","ArrowDown","Down","ArrowRight","Right"],a)){var c=t.isShift(a)?s.moveSpeedAccelerated:s.moveSpeed,l;switch(a.key){case"ArrowLeft":case"Left":l="left";break;case"ArrowUp":case"Up":l="up";break;case"ArrowRight":case"Right":l="right";break;case"ArrowDown":case"Down":l="down";break}return i.moveCanvas({speed:c,direction:l}),!0}}this.moveCanvas=function(o){var a=0,s=0,c=o.speed,l=c/Math.min(Math.sqrt(n.viewbox().scale),1);switch(o.direction){case"left":a=l;break;case"up":s=l;break;case"right":a=-l;break;case"down":s=-l;break}n.scroll({dx:a,dy:s})}}ep.$inject=["config.keyboardMove","keyboard","canvas"];const tp={__depends__:[Da],__init__:["keyboardMove"],keyboardMove:["type",ep]};var nv=/^djs-cursor-.*$/;function Or(e){var t=ge(document.body);t.removeMatching(nv),e&&t.add("djs-cursor-"+e)}function np(){Or(null)}var iv=5e3;function ip(e,t){t=t||"element.click";function n(){return!1}return e.once(t,iv,n),function(){e.off(t,n)}}function Xn(e){return{x:e.x+e.width/2,y:e.y+e.height/2}}function nt(e,t){return{x:e.x-t.x,y:e.y-t.y}}var rv=15;function rp(e,t){var n;function i(s){return a(s.originalEvent)}e.on("canvas.focus.changed",function(s){s.focused?e.on("element.mousedown",500,i):e.off("element.mousedown",i)});function r(s){var c=n.start,l=n.button,p=tn(s),u=nt(p,c);if(!n.dragging&&ov(u)>rv&&(n.dragging=!0,l===0&&ip(e),Or("grab")),n.dragging){var d=n.last||n.start;u=nt(p,d),t.scroll({dx:u.x,dy:u.y}),n.last=p}s.preventDefault()}function o(s){H.unbind(document,"mousemove",r),H.unbind(document,"mouseup",o),n=null,np()}function a(s){if(!li(s.target,".djs-draggable")){var c=s.button;if(!(c>=2||s.ctrlKey||s.shiftKey||s.altKey))return n={button:c,start:tn(s)},H.bind(document,"mousemove",r),H.bind(document,"mouseup",o),!0}}this.isActive=function(){return!!n}}rp.$inject=["eventBus","canvas"];function ov(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}const op={__init__:["moveCanvas"],moveCanvas:["type",rp]};function Yo(e){return Math.log(e)/Math.log(10)}function ap(e,t){var n=Yo(e.min),i=Yo(e.max),r=Math.abs(n)+Math.abs(i);return r/t}function av(e,t){return Math.max(e.min,Math.min(e.max,t))}var sv=Math.sign||function(e){return e>=0?1:-1},Ma={min:.2,max:4},sp=10,cv=.1,lv=.75;function pt(e,t,n){e=e||{},this._enabled=!1,this._canvas=n,this._container=n._container,this._handleWheel=nn(this._handleWheel,this),this._totalDelta=0,this._scale=e.scale||lv;var i=this;t.on("canvas.focus.changed",function(r){i._init(r.focused&&e.enabled!==!1)})}pt.$inject=["config.zoomScroll","eventBus","canvas"];pt.prototype.scroll=function(t){this._canvas.scroll(t)};pt.prototype.reset=function(){this._canvas.zoom("fit-viewport")};pt.prototype.zoom=function(t,n){var i=ap(Ma,sp*2);this._totalDelta+=t,Math.abs(this._totalDelta)>cv&&(this._zoom(t,n,i),this._totalDelta=0)};pt.prototype._handleWheel=function(t){if(this._canvas.isFocused()){var n=this._container;t.preventDefault();var i=t.ctrlKey||th()&&t.metaKey,r=t.shiftKey,o=-1*this._scale,a;if(i?o*=t.deltaMode===0?.02:.32:o*=t.deltaMode===0?1:16,i){var s=n.getBoundingClientRect(),c={x:t.clientX-s.left,y:t.clientY-s.top};a=Math.sqrt(Math.pow(t.deltaY,2)+Math.pow(t.deltaX,2))*sv(t.deltaY)*o,this.zoom(a,c)}else r?a={dx:o*t.deltaY,dy:0}:a={dx:o*t.deltaX,dy:o*t.deltaY},this.scroll(a)}};pt.prototype.stepZoom=function(t,n){var i=ap(Ma,sp);this._zoom(t,n,i)};pt.prototype._zoom=function(e,t,n){var i=this._canvas,r=e>0?1:-1,o=Yo(i.zoom()),a=Math.round(o/n)*n;a+=n*r;var s=Math.pow(10,a);i.zoom(av(Ma,s),t)};pt.prototype.toggle=function(t){var n=this._container,i=this._handleWheel,r=this._enabled;return typeof t>"u"&&(t=!r),r!==t&&H[t?"bind":"unbind"](n,"wheel",i,!1),this._enabled=t,t};pt.prototype._init=function(e){this.toggle(e)};const cp={__init__:["zoomScroll"],zoomScroll:["type",pt]};function ii(e){ui.call(this,e)}M(ii,ui);ii.prototype._navigationModules=[tp,op,cp];ii.prototype._modules=[].concat(ui.prototype._modules,ii.prototype._navigationModules);function Co(e){return e&&e[e.length-1]}function pc(e){return e.y}function dc(e){return e.x}var uv={left:dc,center:dc,right:function(e){return e.x+e.width},top:pc,middle:pc,bottom:function(e){return e.y+e.height}};function An(e,t){this._modeling=e,this._rules=t}An.$inject=["modeling","rules"];An.prototype._getOrientationDetails=function(e){var t=["top","bottom","middle"],n="x",i="width";return t.indexOf(e)!==-1&&(n="y",i="height"),{axis:n,dimension:i}};An.prototype._isType=function(e,t){return t.indexOf(e)!==-1};An.prototype._alignmentPosition=function(e,t){var n=this._getOrientationDetails(e),i=n.axis,r=n.dimension,o={},a={},s=!1,c,l,p;function u(d,f){return Math.round((d[i]+f[i]+f[r])/2)}if(this._isType(e,["left","top"]))o[e]=t[0][i];else if(this._isType(e,["right","bottom"]))p=Co(t),o[e]=p[i]+p[r];else if(this._isType(e,["center","middle"])){if(w(t,function(d){var f=d[i]+Math.round(d[r]/2);a[f]?a[f].elements.push(d):a[f]={elements:[d],center:f}}),c=bt(a,function(d){return d.elements.length>1&&(s=!0),d.elements.length}),s)return o[e]=Co(c).center,o;l=t[0],t=bt(t,function(d){return d[i]+d[r]}),p=Co(t),o[e]=u(l,p)}return o};An.prototype.trigger=function(e,t){var n=this._modeling,i,r=U(e,function(c){return!(c.waypoints||c.host||c.labelTarget)});if(i=this._rules.allowed("elements.align",{elements:r}),V(i)&&(r=i),!(r.length<2||!i)){var o=uv[t],a=bt(r,o),s=this._alignmentPosition(t,a);n.alignElements(a,s)}};const pv={__init__:["alignElements"],alignElements:["type",An]},dv=new _a;function kn(e){this._scheduled={},e.on("diagram.destroy",()=>{Object.keys(this._scheduled).forEach(t=>{this.cancel(t)})})}kn.$inject=["eventBus"];kn.prototype.schedule=function(e,t=dv.next()){this.cancel(t);const n=this._schedule(e,t);return this._scheduled[t]=n,n.promise};kn.prototype._schedule=function(e,t){const n=fv();return{executionId:setTimeout(()=>{try{this._scheduled[t]=null;try{n.resolve(e())}catch(r){n.reject(r)}}catch(r){console.error("Scheduler#_schedule execution failed",r)}}),promise:n.promise}};kn.prototype.cancel=function(e){const t=this._scheduled[e];t&&(this._cancel(t),this._scheduled[e]=null)};kn.prototype._cancel=function(e){clearTimeout(e.executionId)};function fv(){const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e}const hv={scheduler:["type",kn]};var vv="djs-element-hidden",zi=".entry",mv=1e3,fc=8,gv=300;function he(e,t,n,i){this._canvas=e,this._elementRegistry=t,this._eventBus=n,this._scheduler=i,this._current=null,this._init()}he.$inject=["canvas","elementRegistry","eventBus","scheduler"];he.prototype._init=function(){var e=this;this._eventBus.on("selection.changed",function(t){var n=t.newSelection,i=n.length?n.length===1?n[0]:n:null;i?e.open(i,!0):e.close()}),this._eventBus.on("elements.changed",function(t){var n=t.elements,i=e._current;if(i){var r=i.target,o=V(r)?r:[r],a=o.filter(function(c){return n.includes(c)});if(a.length){e.close();var s=o.filter(function(c){return e._elementRegistry.get(c.id)});s.length&&e._updateAndOpen(s.length>1?s:s[0])}}}),this._eventBus.on("canvas.viewbox.changed",function(){e._updatePosition()}),this._eventBus.on("element.marker.update",function(t){if(e.isOpen()){var n=t.element,i=e._current,r=V(i.target)?i.target:[i.target];r.includes(n)&&e._updateVisibility()}}),this._container=this._createContainer()};he.prototype._createContainer=function(){var e=be('<div class="djs-context-pad-parent"></div>');return this._canvas.getContainer().appendChild(e),e};he.prototype.registerProvider=function(e,t){t||(t=e,e=mv),this._eventBus.on("contextPad.getProviders",e,function(n){n.providers.push(t)})};he.prototype.getEntries=function(e){var t=this._getProviders(),n=V(e)?"getMultiElementContextPadEntries":"getContextPadEntries",i={};return w(t,function(r){if(Ke(r[n])){var o=r[n](e);Ke(o)?i=o(i):w(o,function(a,s){i[s]=a})}}),i};he.prototype.trigger=function(e,t,n){var i=this,r,o,a=t.delegateTarget||t.target;if(!a)return t.preventDefault();if(r=Me(a,"data-action"),o=t.originalEvent||t,e==="mouseover"){this._timeout=setTimeout(function(){i._mouseout=i.triggerEntry(r,"hover",o,n)},gv);return}else if(e==="mouseout"){clearTimeout(this._timeout),this._mouseout&&(this._mouseout(),this._mouseout=null);return}return this.triggerEntry(r,e,o,n)};he.prototype.triggerEntry=function(e,t,n,i){if(this.isShown()){var r=this._current.target,o=this._current.entries,a=o[e];if(a){var s=a.action;if(this._eventBus.fire("contextPad.trigger",{entry:a,event:n})!==!1){if(Ke(s)){if(t==="click")return s(n,r,i)}else if(s[t])return s[t](n,r,i);n.preventDefault()}}}};he.prototype.open=function(e,t){!t&&this.isOpen(e)||(this.close(),this._updateAndOpen(e))};he.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"contextPad.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};he.prototype._updateAndOpen=function(e){var t=this.getEntries(e),n=this._createHtml(e),i;w(t,function(r,o){var a=r.group||"default",s=be(r.html||'<div class="entry" draggable="true"></div>'),c;Me(s,"data-action",o),c=de("[data-group="+Qn(a)+"]",n),c||(c=be('<div class="group"></div>'),Me(c,"data-group",a),n.appendChild(c)),c.appendChild(s),r.className&&yv(s,r.className),r.title&&Me(s,"title",r.title),r.imageUrl&&(i=be("<img>"),Me(i,"src",r.imageUrl),i.style.width="100%",i.style.height="100%",s.appendChild(i))}),ge(n).add("open"),this._current={entries:t,html:n,target:e},this._updatePosition(),this._updateVisibility(),this._eventBus.fire("contextPad.open",{current:this._current})};he.prototype._createHtml=function(e){var t=this,n=be('<div class="djs-context-pad"></div>');return tt.bind(n,zi,"click",function(i){t.trigger("click",i)}),tt.bind(n,zi,"dragstart",function(i){t.trigger("dragstart",i)}),tt.bind(n,zi,"mouseover",function(i){t.trigger("mouseover",i)}),tt.bind(n,zi,"mouseout",function(i){t.trigger("mouseout",i)}),H.bind(n,"mousedown",function(i){i.stopPropagation()}),this._container.appendChild(n),this._eventBus.fire("contextPad.create",{target:e,pad:n}),n};he.prototype.getPad=function(e){console.warn(new Error("ContextPad#getPad is deprecated and will be removed in future library versions, cf. https://github.com/bpmn-io/diagram-js/pull/888"));let t;return this.isOpen()&&bv(this._current.target,e)?t=this._current.html:t=this._createHtml(e),{html:t}};he.prototype.close=function(){this.isOpen()&&(clearTimeout(this._timeout),this._container.innerHTML="",this._eventBus.fire("contextPad.close",{current:this._current}),this._current=null)};he.prototype.isOpen=function(e){var t=this._current;if(!t)return!1;if(!e)return!0;var n=t.target;return V(e)!==V(n)?!1:V(e)?e.length===n.length&&Tr(e,function(i){return n.includes(i)}):n===e};he.prototype.isShown=function(){return this.isOpen()&&ge(this._current.html).has("open")};he.prototype.show=function(){this.isOpen()&&(ge(this._current.html).add("open"),this._updatePosition(),this._eventBus.fire("contextPad.show",{current:this._current}))};he.prototype.hide=function(){this.isOpen()&&(ge(this._current.html).remove("open"),this._eventBus.fire("contextPad.hide",{current:this._current}))};he.prototype._getPosition=function(e){if(!V(e)&&ee(e)){var t=this._canvas.viewbox(),n=_v(e),i=n.x*t.scale-t.x*t.scale,r=n.y*t.scale-t.y*t.scale;return{left:i+fc*this._canvas.zoom(),top:r}}var o=this._canvas.getContainer(),a=o.getBoundingClientRect(),s=this._getTargetBounds(e);return{left:s.right-a.left+fc*this._canvas.zoom(),top:s.top-a.top}};he.prototype._updatePosition=function(){const e=()=>{if(this.isOpen()){var t=this._current.html,n=this._getPosition(this._current.target);"x"in n&&"y"in n?(t.style.left=n.x+"px",t.style.top=n.y+"px"):["top","right","bottom","left"].forEach(function(i){i in n&&(t.style[i]=n[i]+"px")})}};this._scheduler.schedule(e,"ContextPad#_updatePosition")};he.prototype._updateVisibility=function(){const e=()=>{if(this.isOpen()){var t=this,n=this._current.target,i=V(n)?n:[n],r=i.some(function(o){return t._canvas.hasMarker(o,vv)});r?t.hide():t.show()}};this._scheduler.schedule(e,"ContextPad#_updateVisibility")};he.prototype._getTargetBounds=function(e){var t=this,n=V(e)?e:[e],i=n.map(function(r){return t._canvas.getGraphics(r)});return i.reduce(function(r,o){const a=o.getBoundingClientRect();return r.top=Math.min(r.top,a.top),r.right=Math.max(r.right,a.right),r.bottom=Math.max(r.bottom,a.bottom),r.left=Math.min(r.left,a.left),r.x=r.left,r.y=r.top,r.width=r.right-r.left,r.height=r.bottom-r.top,r},{top:1/0,right:-1/0,bottom:-1/0,left:1/0})};function yv(e,t){var n=ge(e);t=V(t)?t:t.split(/\s+/g),t.forEach(function(i){n.add(i)})}function _v(e){return e.waypoints[e.waypoints.length-1]}function bv(e,t){return e=V(e)?e:[e],t=V(t)?t:[t],e.length===t.length&&Tr(e,function(n){return t.includes(n)})}const lp={__depends__:[ba,hv,Bu],contextPad:["type",he]};var $r,re,up,Jt,hc,pp,dp,fp,Aa,qo,Xo,ri={},hp=[],xv=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Br=Array.isArray;function gt(e,t){for(var n in t)e[n]=t[n];return e}function ka(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function vp(e,t,n){var i,r,o,a={};for(o in t)o=="key"?i=t[o]:o=="ref"?r=t[o]:a[o]=t[o];if(arguments.length>2&&(a.children=arguments.length>3?$r.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)a[o]===void 0&&(a[o]=e.defaultProps[o]);return ur(e,a,i,r,null)}function ur(e,t,n,i,r){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:r??++up,__i:-1,__u:0};return r==null&&re.vnode!=null&&re.vnode(o),o}function jr(e){return e.children}function pr(e,t){this.props=e,this.context=t}function wn(e,t){if(t==null)return e.__?wn(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?wn(e):null}function mp(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return mp(e)}}function vc(e){(!e.__d&&(e.__d=!0)&&Jt.push(e)&&!yr.__r++||hc!=re.debounceRendering)&&((hc=re.debounceRendering)||pp)(yr)}function yr(){for(var e,t,n,i,r,o,a,s=1;Jt.length;)Jt.length>s&&Jt.sort(dp),e=Jt.shift(),s=Jt.length,e.__d&&(n=void 0,i=void 0,r=(i=(t=e).__v).__e,o=[],a=[],t.__P&&((n=gt({},i)).__v=i.__v+1,re.vnode&&re.vnode(n),Ia(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[r]:null,o,r??wn(i),!!(32&i.__u),a),n.__v=i.__v,n.__.__k[n.__i]=n,_p(o,n,a),i.__e=i.__=null,n.__e!=r&&mp(n)));yr.__r=0}function gp(e,t,n,i,r,o,a,s,c,l,p){var u,d,f,h,g,v,_,x=i&&i.__k||hp,y=t.length;for(c=Ev(n,t,x,c,y),u=0;u<y;u++)(f=n.__k[u])!=null&&(d=f.__i==-1?ri:x[f.__i]||ri,f.__i=u,v=Ia(e,f,d,r,o,a,s,c,l,p),h=f.__e,f.ref&&d.ref!=f.ref&&(d.ref&&Na(d.ref,null,f),p.push(f.ref,f.__c||h,f)),g==null&&h!=null&&(g=h),(_=!!(4&f.__u))||d.__k===f.__k?c=yp(f,c,e,_):typeof f.type=="function"&&v!==void 0?c=v:h&&(c=h.nextSibling),f.__u&=-7);return n.__e=g,c}function Ev(e,t,n,i,r){var o,a,s,c,l,p=n.length,u=p,d=0;for(e.__k=new Array(r),o=0;o<r;o++)(a=t[o])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[o]=ur(null,a,null,null,null):Br(a)?a=e.__k[o]=ur(jr,{children:a},null,null,null):a.constructor==null&&a.__b>0?a=e.__k[o]=ur(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[o]=a,c=o+d,a.__=e,a.__b=e.__b+1,(l=a.__i=wv(a,n,c,u))!=-1&&(u--,(s=n[l])&&(s.__u|=2)),s==null||s.__v==null?(l==-1&&(r>p?d--:r<p&&d++),typeof a.type!="function"&&(a.__u|=4)):l!=c&&(l==c-1?d--:l==c+1?d++:(l>c?d--:d++,a.__u|=4))):e.__k[o]=null;if(u)for(o=0;o<p;o++)(s=n[o])!=null&&(2&s.__u)==0&&(s.__e==i&&(i=wn(s)),xp(s,s));return i}function yp(e,t,n,i){var r,o;if(typeof e.type=="function"){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=yp(r[o],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=wn(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function wv(e,t,n,i){var r,o,a,s=e.key,c=e.type,l=t[n],p=l!=null&&(2&l.__u)==0;if(l===null&&s==null||p&&s==l.key&&c==l.type)return n;if(i>(p?1:0)){for(r=n-1,o=n+1;r>=0||o<t.length;)if((l=t[a=r>=0?r--:o++])!=null&&(2&l.__u)==0&&s==l.key&&c==l.type)return a}return-1}function mc(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||xv.test(t)?n:n+"px"}function Fi(e,t,n,i,r){var o,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||mc(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||mc(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(fp,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=Aa,e.addEventListener(t,o?Xo:qo,o)):e.removeEventListener(t,o?Xo:qo,o);else{if(r=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function gc(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Aa++;else if(t.t<n.u)return;return n(re.event?re.event(t):t)}}}function Ia(e,t,n,i,r,o,a,s,c,l){var p,u,d,f,h,g,v,_,x,y,b,E,C,D,A,I,j,q=t.type;if(t.constructor!=null)return null;128&n.__u&&(c=!!(32&n.__u),o=[s=t.__e=n.__e]),(p=re.__b)&&p(t);e:if(typeof q=="function")try{if(_=t.props,x="prototype"in q&&q.prototype.render,y=(p=q.contextType)&&i[p.__c],b=p?y?y.props.value:p.__:i,n.__c?v=(u=t.__c=n.__c).__=u.__E:(x?t.__c=u=new q(_,b):(t.__c=u=new pr(_,b),u.constructor=q,u.render=Cv),y&&y.sub(u),u.state||(u.state={}),u.__n=i,d=u.__d=!0,u.__h=[],u._sb=[]),x&&u.__s==null&&(u.__s=u.state),x&&q.getDerivedStateFromProps!=null&&(u.__s==u.state&&(u.__s=gt({},u.__s)),gt(u.__s,q.getDerivedStateFromProps(_,u.__s))),f=u.props,h=u.state,u.__v=t,d)x&&q.getDerivedStateFromProps==null&&u.componentWillMount!=null&&u.componentWillMount(),x&&u.componentDidMount!=null&&u.__h.push(u.componentDidMount);else{if(x&&q.getDerivedStateFromProps==null&&_!==f&&u.componentWillReceiveProps!=null&&u.componentWillReceiveProps(_,b),t.__v==n.__v||!u.__e&&u.shouldComponentUpdate!=null&&u.shouldComponentUpdate(_,u.__s,b)===!1){for(t.__v!=n.__v&&(u.props=_,u.state=u.__s,u.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(ne){ne&&(ne.__=t)}),E=0;E<u._sb.length;E++)u.__h.push(u._sb[E]);u._sb=[],u.__h.length&&a.push(u);break e}u.componentWillUpdate!=null&&u.componentWillUpdate(_,u.__s,b),x&&u.componentDidUpdate!=null&&u.__h.push(function(){u.componentDidUpdate(f,h,g)})}if(u.context=b,u.props=_,u.__P=e,u.__e=!1,C=re.__r,D=0,x){for(u.state=u.__s,u.__d=!1,C&&C(t),p=u.render(u.props,u.state,u.context),A=0;A<u._sb.length;A++)u.__h.push(u._sb[A]);u._sb=[]}else do u.__d=!1,C&&C(t),p=u.render(u.props,u.state,u.context),u.state=u.__s;while(u.__d&&++D<25);u.state=u.__s,u.getChildContext!=null&&(i=gt(gt({},i),u.getChildContext())),x&&!d&&u.getSnapshotBeforeUpdate!=null&&(g=u.getSnapshotBeforeUpdate(f,h)),I=p,p!=null&&p.type===jr&&p.key==null&&(I=bp(p.props.children)),s=gp(e,Br(I)?I:[I],t,n,i,r,o,a,s,c,l),u.base=t.__e,t.__u&=-161,u.__h.length&&a.push(u),v&&(u.__E=u.__=null)}catch(ne){if(t.__v=null,c||o!=null)if(ne.then){for(t.__u|=c?160:128;s&&s.nodeType==8&&s.nextSibling;)s=s.nextSibling;o[o.indexOf(s)]=null,t.__e=s}else{for(j=o.length;j--;)ka(o[j]);Zo(t)}else t.__e=n.__e,t.__k=n.__k,ne.then||Zo(t);re.__e(ne,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):s=t.__e=Sv(n.__e,t,n,i,r,o,a,c,l);return(p=re.diffed)&&p(t),128&t.__u?void 0:s}function Zo(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Zo)}function _p(e,t,n){for(var i=0;i<n.length;i++)Na(n[i],n[++i],n[++i]);re.__c&&re.__c(t,e),e.some(function(r){try{e=r.__h,r.__h=[],e.some(function(o){o.call(r)})}catch(o){re.__e(o,r.__v)}})}function bp(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Br(e)?e.map(bp):gt({},e)}function Sv(e,t,n,i,r,o,a,s,c){var l,p,u,d,f,h,g,v=n.props||ri,_=t.props,x=t.type;if(x=="svg"?r="http://www.w3.org/2000/svg":x=="math"?r="http://www.w3.org/1998/Math/MathML":r||(r="http://www.w3.org/1999/xhtml"),o!=null){for(l=0;l<o.length;l++)if((f=o[l])&&"setAttribute"in f==!!x&&(x?f.localName==x:f.nodeType==3)){e=f,o[l]=null;break}}if(e==null){if(x==null)return document.createTextNode(_);e=document.createElementNS(r,x,_.is&&_),s&&(re.__m&&re.__m(t,o),s=!1),o=null}if(x==null)v===_||s&&e.data==_||(e.data=_);else{if(o=o&&$r.call(e.childNodes),!s&&o!=null)for(v={},l=0;l<e.attributes.length;l++)v[(f=e.attributes[l]).name]=f.value;for(l in v)if(f=v[l],l!="children"){if(l=="dangerouslySetInnerHTML")u=f;else if(!(l in _)){if(l=="value"&&"defaultValue"in _||l=="checked"&&"defaultChecked"in _)continue;Fi(e,l,null,f,r)}}for(l in _)f=_[l],l=="children"?d=f:l=="dangerouslySetInnerHTML"?p=f:l=="value"?h=f:l=="checked"?g=f:s&&typeof f!="function"||v[l]===f||Fi(e,l,f,v[l],r);if(p)s||u&&(p.__html==u.__html||p.__html==e.innerHTML)||(e.innerHTML=p.__html),t.__k=[];else if(u&&(e.innerHTML=""),gp(t.type=="template"?e.content:e,Br(d)?d:[d],t,n,i,x=="foreignObject"?"http://www.w3.org/1999/xhtml":r,o,a,o?o[0]:n.__k&&wn(n,0),s,c),o!=null)for(l=o.length;l--;)ka(o[l]);s||(l="value",x=="progress"&&h==null?e.removeAttribute("value"):h!=null&&(h!==e[l]||x=="progress"&&!h||x=="option"&&h!=v[l])&&Fi(e,l,h,v[l],r),l="checked",g!=null&&g!=e[l]&&Fi(e,l,g,v[l],r))}return e}function Na(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(r){re.__e(r,n)}}function xp(e,t,n){var i,r;if(re.unmount&&re.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Na(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){re.__e(o,t)}i.base=i.__P=null}if(i=e.__k)for(r=0;r<i.length;r++)i[r]&&xp(i[r],t,n||typeof e.type!="function");n||ka(e.__e),e.__c=e.__=e.__e=void 0}function Cv(e,t,n){return this.constructor(e,n)}function Ep(e,t,n){var i,r,o,a;t==document&&(t=document.documentElement),re.__&&re.__(e,t),r=(i=!1)?null:t.__k,o=[],a=[],Ia(t,e=t.__k=vp(jr,null,[e]),r||ri,ri,t.namespaceURI,r?null:t.firstChild?$r.call(t.childNodes):null,o,r?r.__e:t.firstChild,i,a),_p(o,e,a)}$r=hp.slice,re={__e:function(e,t,n,i){for(var r,o,a;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&o.getDerivedStateFromError!=null&&(r.setState(o.getDerivedStateFromError(e)),a=r.__d),r.componentDidCatch!=null&&(r.componentDidCatch(e,i||{}),a=r.__d),a)return r.__E=r}catch(s){e=s}throw e}},up=0,pr.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=gt({},this.state),typeof e=="function"&&(e=e(gt({},n),this.props)),e&&gt(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),vc(this))},pr.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),vc(this))},pr.prototype.render=jr,Jt=[],pp=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,dp=function(e,t){return e.__v.__b-t.__v.__b},yr.__r=0,fp=/(PointerCapture)$|Capture$/i,Aa=0,qo=gc(!1),Xo=gc(!0);var wp=function(e,t,n,i){var r;t[0]=0;for(var o=1;o<t.length;o++){var a=t[o++],s=t[o]?(t[0]|=a?1:2,n[t[o++]]):t[++o];a===3?i[0]=s:a===4?i[1]=Object.assign(i[1]||{},s):a===5?(i[1]=i[1]||{})[t[++o]]=s:a===6?i[1][t[++o]]+=s+"":a?(r=e.apply(s,wp(e,s,n,["",null])),i.push(r),s[0]?t[0]|=2:(t[o-2]=0,t[o]=r)):i.push(s)}return i},yc=new Map;function Rv(e){var t=yc.get(this);return t||(t=new Map,yc.set(this,t)),(t=wp(this,t.get(e)||(t.set(e,t=(function(n){for(var i,r,o=1,a="",s="",c=[0],l=function(d){o===1&&(d||(a=a.replace(/^\s*\n\s*|\s*\n\s*$/g,"")))?c.push(0,d,a):o===3&&(d||a)?(c.push(3,d,a),o=2):o===2&&a==="..."&&d?c.push(4,d,0):o===2&&a&&!d?c.push(5,0,!0,a):o>=5&&((a||!d&&o===5)&&(c.push(o,0,a,r),o=6),d&&(c.push(o,d,0,r),o=6)),a=""},p=0;p<n.length;p++){p&&(o===1&&l(),l(p));for(var u=0;u<n[p].length;u++)i=n[p][u],o===1?i==="<"?(l(),c=[c],o=3):a+=i:o===4?a==="--"&&i===">"?(o=1,a=""):a=i+a[0]:s?i===s?s="":a+=i:i==='"'||i==="'"?s=i:i===">"?(l(),o=1):o&&(i==="="?(o=5,r=a,a=""):i==="/"&&(o<5||n[p][u+1]===">")?(l(),o===3&&(c=c[0]),o=c,(c=c[0]).push(2,0,o),o=0):i===" "||i==="	"||i===`
`||i==="\r"?(l(),o=2):a+=i),o===3&&a==="!--"&&(o=4,c=c[0])}return l(),c})(e)),t),arguments,[])).length>1?t:t[0]}var le=Rv.bind(vp),Sn,ue,Ro,_c,oi=0,Sp=[],ve=re,bc=ve.__b,xc=ve.__r,Ec=ve.diffed,wc=ve.__c,Sc=ve.unmount,Cc=ve.__;function Hr(e,t){ve.__h&&ve.__h(ue,e,oi||t),oi=0;var n=ue.__H||(ue.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function To(e){return oi=1,Tv(Rp,e)}function Tv(e,t,n){var i=Hr(Sn++,2);if(i.t=e,!i.__c&&(i.__=[Rp(void 0,t),function(s){var c=i.__N?i.__N[0]:i.__[0],l=i.t(c,s);c!==l&&(i.__N=[l,i.__[1]],i.__c.setState({}))}],i.__c=ue,!ue.__f)){var r=function(s,c,l){if(!i.__c.__H)return!0;var p=i.__c.__H.__.filter(function(d){return!!d.__c});if(p.every(function(d){return!d.__N}))return!o||o.call(this,s,c,l);var u=i.__c.props!==s;return p.forEach(function(d){if(d.__N){var f=d.__[0];d.__=d.__N,d.__N=void 0,f!==d.__[0]&&(u=!0)}}),o&&o.call(this,s,c,l)||u};ue.__f=!0;var o=ue.shouldComponentUpdate,a=ue.componentWillUpdate;ue.componentWillUpdate=function(s,c,l){if(this.__e){var p=o;o=void 0,r(s,c,l),o=p}a&&a.call(this,s,c,l)},ue.shouldComponentUpdate=r}return i.__N||i.__}function Jo(e,t){var n=Hr(Sn++,3);!ve.__s&&La(n.__H,t)&&(n.__=e,n.u=t,ue.__H.__h.push(n))}function Qo(e,t){var n=Hr(Sn++,4);!ve.__s&&La(n.__H,t)&&(n.__=e,n.u=t,ue.__h.push(n))}function Cp(e){return oi=5,bn(function(){return{current:e}},[])}function bn(e,t){var n=Hr(Sn++,7);return La(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Hn(e,t){return oi=8,bn(function(){return e},t)}function Pv(){for(var e;e=Sp.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(dr),e.__H.__h.forEach(ea),e.__H.__h=[]}catch(t){e.__H.__h=[],ve.__e(t,e.__v)}}ve.__b=function(e){ue=null,bc&&bc(e)},ve.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Cc&&Cc(e,t)},ve.__r=function(e){xc&&xc(e),Sn=0;var t=(ue=e.__c).__H;t&&(Ro===ue?(t.__h=[],ue.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(dr),t.__h.forEach(ea),t.__h=[],Sn=0)),Ro=ue},ve.diffed=function(e){Ec&&Ec(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(Sp.push(t)!==1&&_c===ve.requestAnimationFrame||((_c=ve.requestAnimationFrame)||Dv)(Pv)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Ro=ue=null},ve.__c=function(e,t){t.some(function(n){try{n.__h.forEach(dr),n.__h=n.__h.filter(function(i){return!i.__||ea(i)})}catch(i){t.some(function(r){r.__h&&(r.__h=[])}),t=[],ve.__e(i,n.__v)}}),wc&&wc(e,t)},ve.unmount=function(e){Sc&&Sc(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{dr(i)}catch(r){t=r}}),n.__H=void 0,t&&ve.__e(t,n.__v))};var Rc=typeof requestAnimationFrame=="function";function Dv(e){var t,n=function(){clearTimeout(i),Rc&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);Rc&&(t=requestAnimationFrame(n))}function dr(e){var t=ue,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),ue=t}function ea(e){var t=ue;e.__c=e.__(),ue=t}function La(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function Rp(e,t){return typeof t=="function"?t(e):t}function Tp(e){var t,n,i="";if(typeof e=="string"||typeof e=="number")i+=e;else if(typeof e=="object")if(Array.isArray(e)){var r=e.length;for(t=0;t<r;t++)e[t]&&(n=Tp(e[t]))&&(i&&(i+=" "),i+=n)}else for(n in e)e[n]&&(i&&(i+=" "),i+=n);return i}function _r(){for(var e,t,n=0,i="",r=arguments.length;n<r;n++)(e=arguments[n])&&(t=Tp(e))&&(i&&(i+=" "),i+=t);return i}function Mv(e){const{headerEntries:t,onSelect:n,selectedEntry:i,setSelectedEntry:r,title:o}=e,a=bn(()=>Av(t),[t]),s=l=>l.action&&!l.disabled,c=(l,p)=>{if(s(p))return n(l,p)};return le`
    <div class="djs-popup-header">
      <h3 class="djs-popup-title" title=${o}>${o}</h3>
      ${a.map(l=>le`
        <ul key=${l.id} class="djs-popup-header-group" data-header-group=${l.id}>

          ${l.entries.map(p=>le`
            <li key=${p.id}>
              <${s(p)?"button":"span"}
                class=${kv(p,p===i)}
                onClick=${u=>c(u,p)}
                title=${p.title||p.label}
                data-id=${p.id}
                aria-disabled=${p.disabled||void 0}
                onMouseEnter=${()=>s(p)&&r(p)}
                onMouseLeave=${()=>s(p)&&r(null)}
                onFocus=${()=>s(p)&&r(p)}
                onBlur=${()=>s(p)&&r(null)}
              >
                ${p.imageUrl&&le`<img class="djs-popup-entry-icon" src=${p.imageUrl} alt="" />`||p.imageHtml&&le`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:p.imageHtml}} />`}
                ${p.label?le`
                  <span class="djs-popup-label">${p.label}</span>
                `:null}
              </${p.action?"button":"span"}>
            </li>
          `)}
        </ul>
      `)}
    </div>
  `}function Av(e){return e.reduce((t,n)=>{const i=n.group||"default",r=t.find(o=>o.id===i);return r?r.entries.push(n):t.push({id:i,entries:[n]}),t},[])}function kv(e,t){return _r("entry",e.className,e.active?"active":"",e.disabled?"disabled":"",t?"selected":"")}function Iv(e){const{entry:t,selected:n,onMouseEnter:i,onMouseLeave:r,onAction:o}=e,a=(s,c)=>{if(!t.disabled)return o(s,t,c)};return le`
    <li
      class=${_r("entry",{selected:n,disabled:t.disabled})}
      data-id=${t.id}
      title=${t.title||t.label}
      aria-disabled=${t.disabled||void 0}
      tabIndex="0"
      onClick=${a}
      onFocus=${i}
      onBlur=${r}
      onMouseEnter=${i}
      onMouseLeave=${r}
      onDragStart=${s=>a(s,"dragstart")}
      draggable=${!0}
    >
      <div class="djs-popup-entry-content">
        <span
          class=${_r("djs-popup-entry-name",t.className)}
        >
          ${t.imageUrl&&le`<img class="djs-popup-entry-icon" src=${t.imageUrl} alt="" />`||t.imageHtml&&le`<div class="djs-popup-entry-icon" dangerouslySetInnerHTML=${{__html:t.imageHtml}} />`}

          ${t.label?le`
            <span class="djs-popup-label">
              ${t.label}
            </span>
          `:null}
        </span>
        ${t.description&&le`
          <span
            class="djs-popup-entry-description"
            title=${t.description}
          >
            ${t.description}
          </span>
        `}
      </div>
      ${t.documentationRef&&le`
        <div class="djs-popup-entry-docs">
          <a
            href="${t.documentationRef}"
            onClick=${s=>s.stopPropagation()}
            title="Open element documentation"
            target="_blank"
            rel="noopener"
          >
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M10.6368 10.6375V5.91761H11.9995V10.6382C11.9995 10.9973 11.8623 11.3141 11.5878 11.5885C11.3134 11.863 10.9966 12.0002 10.6375 12.0002H1.36266C0.982345 12.0002 0.660159 11.8681 0.396102 11.6041C0.132044 11.34 1.52588e-05 11.0178 1.52588e-05 10.6375V1.36267C1.52588e-05 0.98236 0.132044 0.660173 0.396102 0.396116C0.660159 0.132058 0.982345 2.95639e-05 1.36266 2.95639e-05H5.91624V1.36267H1.36266V10.6375H10.6368ZM12 0H7.2794L7.27873 1.36197H9.68701L3.06507 7.98391L4.01541 8.93425L10.6373 2.31231V4.72059H12V0Z" fill="#818798"/>
            </svg>
          </a>
        </div>
      `}
    </li>
  `}function Nv(e){const{selectedEntry:t,setSelectedEntry:n,groupedEntries:i,...r}=e,o=Cp();return Qo(()=>{const a=o.current;if(!a)return;const s=a.querySelector(".selected");s&&Lv(s)},[t]),le`
    <div class="djs-popup-results" ref=${o}>
      ${i.map(a=>le`
        ${a.name&&le`
          <div key=${a.id} class="entry-header" title=${a.name}>
            ${a.name}
          </div>
        `}
        <ul class="djs-popup-group" data-group=${a.id}>
          ${a.entries.map(s=>le`
            <${Iv}
              key=${s.id}
              entry=${s}
              selected=${s===t}
              onMouseEnter=${()=>n(s)}
              onMouseLeave=${()=>n(null)}
              ...${r}
            />
          `)}
        </ul>
      `)}
    </div>
  `}function Lv(e){typeof e.scrollIntoViewIfNeeded=="function"?e.scrollIntoViewIfNeeded():e.scrollIntoView({scrollMode:"if-needed",block:"nearest"})}function Ov(e){const{onClose:t,onSelect:n,className:i,headerEntries:r,position:o,title:a,width:s,scale:c,search:l,emptyPlaceholder:p,searchFn:u,entries:d,onOpened:f,onClosed:h}=e,g=bn(()=>je(l)?d.length>5:!1,[l,d]),[v,_]=To(""),x=Hn((Q,et)=>{if(!g)return Q;if(!et.trim())return Q.filter(({rank:$e=0})=>$e>=0);const Oi=Q.filter(({searchable:$e})=>$e!==!1);return u(Oi,et,{keys:["label","search","description"]}).map(({item:$e})=>$e)},[g]),[y,b]=To(x(d,v)),[E,C]=To(y[0]),D=bn(()=>jv(y),[y]),A=Hn(Q=>{C(Q[0]),b(Q)},[b,C]);Jo(()=>{A(x(d,v))},[v,d]);const I=Hn(Q=>{const et=Bv(D);let $e=et.indexOf(E)+Q;$e<0&&($e=et.length-1),$e>=et.length&&($e=0),C(et[$e])},[D,E,C]),j=Hn(Q=>{if(Q.key==="Enter"&&E)return E.disabled?void 0:n(Q,E);if(Q.key==="ArrowUp")return I(-1),Q.preventDefault();if(Q.key==="ArrowDown")return I(1),Q.preventDefault()},[n,E,I]),q=Hn(Q=>{ju(Q.target,"input")&&_(()=>Q.target.value)},[_]);Jo(()=>(f(),()=>{h()}),[]);const ne=bn(()=>a||r.length>0,[a,r]);return le`
    <${Tc}
      onClose=${t}
      onKeyup=${q}
      onKeydown=${j}
      className=${i}
      position=${o}
      width=${s}
      scale=${c}
    >
      ${ne&&le`
        <${Mv}
          headerEntries=${r}
          onSelect=${n}
          selectedEntry=${E}
          setSelectedEntry=${C}
          title=${a}
        />
      `}
      ${d.length>0&&le`
        <div class="djs-popup-body">

          ${g&&le`
          <div class="djs-popup-search">
            <svg class="djs-popup-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
            </svg>
            <input type="text" spellcheck=${!1} aria-label="${a}" />
          </div>
          `}

          <${Nv}
            groupedEntries=${D}
            selectedEntry=${E}
            setSelectedEntry=${C}
            onAction=${n}
          />
        </div>
      `}
    ${p&&y.length===0&&le`
      <div class="djs-popup-no-results">${Ke(p)?p(v):p}</div>
    `}
    </${Tc}>
  `}function Tc(e){const{onClose:t,onKeydown:n,onKeyup:i,className:r,children:o,position:a}=e,s=Cp();return Qo(()=>{if(typeof a!="function")return;const c=s.current,l=a(c);c.style.left=`${l.x}px`,c.style.top=`${l.y}px`},[s.current,a]),Qo(()=>{const c=s.current;if(!c)return;(c.querySelector("input")||c).focus()},[]),Jo(()=>{const c=p=>{if(p.key==="Escape")return p.preventDefault(),t()},l=p=>{if(!li(p.target,".djs-popup",!0))return t()};return document.documentElement.addEventListener("keydown",c),document.body.addEventListener("click",l),()=>{document.documentElement.removeEventListener("keydown",c),document.body.removeEventListener("click",l)}},[]),le`
    <div
      class=${_r("djs-popup",r)}
      style=${$v(e)}
      onKeydown=${n}
      onKeyup=${i}
      ref=${s}
      tabIndex="-1"
    >
      ${o}
    </div>
  `}function $v(e){return{transform:`scale(${e.scale})`,width:`${e.width}px`,"transform-origin":"top left"}}function Bv(e){const t=[];return e.forEach(n=>{n.entries.forEach(i=>{t.push(i)})}),t}function jv(e){const t=[],n=o=>t.find(a=>o.id===a.id),i=o=>!!n(o),r=o=>typeof o=="string"?{id:o}:o;return e.forEach(o=>{const a=o.group?r(o.group):{id:"default"};i(a)?n(a).entries.push(o):t.push({...a,entries:[o]})}),t}var Hv="data-id",Pp=["contextPad.close","canvas.viewbox.changing","commandStack.changed"],zv=1e3;function oe(e,t,n,i){this._eventBus=t,this._canvas=n,this._search=i,this._current=null;var r=je(e&&e.scale)?e.scale:{min:1,max:1};this._config={scale:r},t.on("diagram.destroy",()=>{this.close()}),t.on("element.changed",o=>{const a=this.isOpen()&&this._current.target;o.element===a&&this.refresh()})}oe.$inject=["config.popupMenu","eventBus","canvas","search"];oe.prototype._render=function(){const{position:e,providerId:t,entries:n,headerEntries:i,emptyPlaceholder:r,options:o}=this._current,a=Object.entries(n).map(([d,f])=>({id:d,...f})),s=Object.entries(i).map(([d,f])=>({id:d,...f})),c=e&&(d=>this._ensureVisible(d,e)),l=this._updateScale(this._current.container);Ep(le`
      <${Ov}
        onClose=${d=>this.close(d)}
        onSelect=${(d,f,h)=>this.trigger(d,f,h)}
        position=${c}
        className=${t}
        entries=${a}
        headerEntries=${s}
        emptyPlaceholder=${r}
        scale=${l}
        onOpened=${this._onOpened.bind(this)}
        onClosed=${this._onClosed.bind(this)}
        searchFn=${this._search}
        ...${{...o}}
      />
    `,this._current.container)};oe.prototype.open=function(e,t,n,i){if(!e)throw new Error("target is missing");if(!t)throw new Error("providers for <"+t+"> not found");if(!n)throw new Error("position is missing");this.isOpen()&&this.close();const{entries:r,headerEntries:o,emptyPlaceholder:a}=this._getContext(e,t);this._current={position:n,providerId:t,target:e,entries:r,headerEntries:o,emptyPlaceholder:a,container:this._createContainer({provider:t}),options:i},this._emit("open"),this._bindAutoClose(),this._render()};oe.prototype.refresh=function(){if(!this.isOpen())return;const{target:e,providerId:t}=this._current,{entries:n,headerEntries:i,emptyPlaceholder:r}=this._getContext(e,t);this._current={...this._current,entries:n,headerEntries:i,emptyPlaceholder:r},this._emit("refresh"),this._render()};oe.prototype._getContext=function(e,t){const n=this._getProviders(t);if(!n||!n.length)throw new Error("provider for <"+t+"> not found");const i=this._getEntries(e,n),r=this._getHeaderEntries(e,n),o=this._getEmptyPlaceholder(n);return{entries:i,headerEntries:r,emptyPlaceholder:o,empty:!(Object.keys(i).length||Object.keys(r).length)}};oe.prototype.close=function(){this.isOpen()&&(this._emit("close"),this.reset(),this._canvas.restoreFocus(),this._current=null)};oe.prototype.reset=function(){const e=this._current.container;Ep(null,e),xn(e)};oe.prototype._emit=function(e,t){this._eventBus.fire(`popupMenu.${e}`,t)};oe.prototype._onOpened=function(){this._emit("opened")};oe.prototype._onClosed=function(){this._emit("closed")};oe.prototype._createContainer=function(e){var t=this._canvas,n=t.getContainer();const i=be(`<div class="djs-popup-parent djs-scrollable" data-popup=${e.provider}></div>`);return n.appendChild(i),i};oe.prototype._bindAutoClose=function(){this._eventBus.once(Pp,this.close,this)};oe.prototype._unbindAutoClose=function(){this._eventBus.off(Pp,this.close,this)};oe.prototype._updateScale=function(){var e=this._canvas.zoom(),t=this._config.scale,n,i,r=e;return t!==!0&&(t===!1?(n=1,i=1):(n=t.min,i=t.max),je(n)&&e<n&&(r=n),je(i)&&e>i&&(r=i)),r};oe.prototype._ensureVisible=function(e,t){var n=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect(),r={},o=t.x,a=t.y;return t.x+i.width>n.width&&(r.x=!0),t.y+i.height>n.height&&(r.y=!0),r.x&&r.y?(o=t.x-i.width,a=t.y-i.height):r.x?(o=t.x-i.width,a=t.y):r.y&&t.y<i.height?(o=t.x,a=10):r.y&&(o=t.x,a=t.y-i.height),t.y<n.top&&(a=t.y+i.height),{x:o,y:a}};oe.prototype.isEmpty=function(e,t){if(!e)throw new Error("target is missing");if(!t)throw new Error("provider ID is missing");const n=this._getProviders(t);return!n||!n.length?!0:this._getContext(e,t).empty};oe.prototype.registerProvider=function(e,t,n){n||(n=t,t=zv),this._eventBus.on("popupMenu.getProviders."+e,t,function(i){i.providers.push(n)})};oe.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"popupMenu.getProviders."+e,providers:[]});return this._eventBus.fire(t),t.providers};oe.prototype._getEntries=function(e,t){var n={};return w(t,function(i){if(!i.getPopupMenuEntries){w(i.getEntries(e),function(o){var a=o.id;if(!a)throw new Error("entry ID is missing");n[a]=Et(o,["id"])});return}var r=i.getPopupMenuEntries(e);Ke(r)?n=r(n):w(r,function(o,a){n[a]=o})}),n};oe.prototype._getHeaderEntries=function(e,t){var n={};return w(t,function(i){if(!i.getPopupMenuHeaderEntries){if(!i.getHeaderEntries)return;w(i.getHeaderEntries(e),function(o){var a=o.id;if(!a)throw new Error("entry ID is missing");n[a]=Et(o,["id"])});return}var r=i.getPopupMenuHeaderEntries(e);Ke(r)?n=r(n):w(r,function(o,a){n[a]=o})}),n};oe.prototype._getEmptyPlaceholder=function(e){const t=e.find(n=>Ke(n.getEmptyPlaceholder));return t&&t.getEmptyPlaceholder()};oe.prototype.isOpen=function(){return!!this._current};oe.prototype.trigger=function(e,t,n="click"){if(e.preventDefault(),!t){let r=li(e.delegateTarget||e.target,".entry",!0),o=Me(r,Hv);t={id:o,...this._getEntry(o)}}const i=t.action;if(this._emit("trigger",{entry:t,event:e})!==!1){if(Ke(i)){if(n==="click")return i(e,t)}else if(i[n])return i[n](e,t)}};oe.prototype._getEntry=function(e){var t=this._current.entries[e]||this._current.headerEntries[e];if(!t)throw new Error("entry not found");return t};function Fv(e,t,n){const{keys:i}=n;if(t=t.trim().toLowerCase(),!t)throw new Error("<pattern> must not be empty");const r=t.trim().toLowerCase().split(/\s+/);return e.flatMap(o=>{const a=Gv(o,r,i);return a?{item:o,tokens:a}:[]}).sort(Vv(i))}function Gv(e,t,n){const{matchedWords:i,tokens:r}=n.reduce((o,a)=>{const s=e[a],{tokens:c,matchedWords:l}=V(s)?s.reduce((p,u)=>{const{tokens:d,matchedWords:f}=Mc(u,t);return{tokens:[...p.tokens,d],matchedWords:{...p.matchedWords,...f}}},{matchedWords:{},tokens:[]}):Mc(s,t);return{tokens:{...o.tokens,[a]:c},matchedWords:{...o.matchedWords,...l}}},{matchedWords:{},tokens:{}});return Object.keys(i).length!==t.length?null:r}function Vv(e){return(t,n)=>{let i=0,r=1;for(const o of e){const a=Uv(t.tokens[o],n.tokens[o]);if(a!==0){i+=a*r,r*=.9;continue}const s=Wv(t.item[o],n.item[o]);if(s!==0){i+=s*r,r*=.9;continue}}return i}}function Uv(e,t){return Pc(t)-Pc(e)}function Pc(e){return e.reduce((t,n)=>t+Dp(n),0)}function Dp(e){if(V(e))return Math.max(...e.map(Dp));const t=Math.log(e.value.length);return e.match?(e.start?e.end?131.9:7.87:e.wordStart?2.19:1)*t:-.07*t}function Dc(e=""){return V(e)?e.join(", "):e}function Wv(e,t){return Dc(e).localeCompare(Dc(t))}function Mc(e,t){if(!e)return{tokens:[],matchedWords:{}};const n=[],i={},r=t.map(Kv),o=[`(?<all>${r.join("\\s+")})`,...r].join("|"),a=new RegExp(o,"ig");let s,c=0;for(;s=a.exec(e);){const[l]=s,p=s.index,u=s.index+l.length,d=p===0,f=u===e.length,h=!!s.groups.all,g=d||/\s/.test(e.charAt(p-1)),v=f||/\s/.test(e.charAt(u));s.index>c&&n.push({value:e.slice(c,s.index),index:c}),n.push({value:l,index:s.index,match:!0,wordStart:g,wordEnd:v,start:d,end:f,all:h});const _=h?t:[l];for(const x of _)i[x.toLowerCase()]=!0;c=s.index+l.length}return c<e.length&&n.push({value:e.slice(c),index:c}),{tokens:n,matchedWords:i}}function Kv(e){return e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}const Mp={search:["value",Fv]},Oa={__depends__:[Mp],__init__:["popupMenu"],popupMenu:["type",oe]};var Ap={align:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2000 2000">
              <line x1="200" y1="150" x2="200" y2="1850" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
              <rect x="500" y="150" width="1300" height="700" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="500" y="1150" width="700" height="700" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,bottom:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="1650" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="350" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="850" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,center:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="900" y1="150" x2="900" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="250" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="500" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,left:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="100" y1="150" x2="100" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="100" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="100" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,right:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="1650" y1="150" x2="1650" y2="1650" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="350" y="150" width="1300" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="850" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,top:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="150" x2="1650" y2="150" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="150" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="150" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`,middle:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
            <line x1="150" y1="900" x2="1650" y2="900" style="stroke:currentColor;stroke-width:100;stroke-linecap:round;"/>
            <rect x="150" y="250" width="600" height="1300" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
            <rect x="1050" y="500" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
          </svg>`},Yv=900;function In(e,t,n,i){e.registerProvider(Yv,this),this._contextPad=e,this._popupMenu=t,this._translate=n,this._canvas=i}In.$inject=["contextPad","popupMenu","translate","canvas"];In.prototype.getMultiElementContextPadEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};In.prototype._isAllowed=function(e){return!this._popupMenu.isEmpty(e,"align-elements")};In.prototype._getEntries=function(){var e=this;return{"align-elements":{group:"align-elements",title:e._translate("Align elements"),html:`<div class="entry">${Ap.align}</div>`,action:{click:function(t,n){var i=e._getMenuPosition(n);S(i,{cursor:{x:t.x,y:t.y}}),e._popupMenu.open(n,"align-elements",i)}}}}};In.prototype._getMenuPosition=function(e){var t=5,n=this._contextPad.getPad(e).html,i=n.getBoundingClientRect(),r={x:i.left,y:i.bottom+t};return r};var qv=["left","center","right","top","middle","bottom"];function hi(e,t,n,i){this._alignElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",this)}hi.$inject=["popupMenu","alignElements","translate","rules"];hi.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};hi.prototype._isAllowed=function(e){return this._rules.allowed("elements.align",{elements:e})};hi.prototype._getEntries=function(e){var t=this._alignElements,n=this._translate,i=this._popupMenu,r={};return w(qv,function(o){r["align-elements-"+o]={group:"align",title:n("Align elements "+o),className:"bjs-align-elements-menu-entry",imageHtml:Ap[o],action:function(){t.trigger(e,o),i.close()}}}),r};function Ye(e){R.call(this,e),this.init()}Ye.$inject=["eventBus"];M(Ye,R);Ye.prototype.addRule=function(e,t,n){var i=this;typeof e=="string"&&(e=[e]),e.forEach(function(r){i.canExecute(r,t,function(o,a,s){return n(o)},!0)})};Ye.prototype.init=function(){};function zr(e){Ye.call(this,e)}zr.$inject=["eventBus"];M(zr,Ye);zr.prototype.init=function(){this.addRule("elements.align",function(e){var t=e.elements,n=U(t,function(i){return!(i.waypoints||i.host||i.labelTarget)});return n=Pr(n),n.length<2?!1:n})};const Xv={__depends__:[pv,lp,Oa],__init__:["alignElementsContextPadProvider","alignElementsMenuProvider","bpmnAlignElements"],alignElementsContextPadProvider:["type",In],alignElementsMenuProvider:["type",hi],bpmnAlignElements:["type",zr]};var Zv=10,kp=50,Jv=250;function $a(e,t,n,i){for(var r;r=Qv(e,n,t);)n=i(t,n,r);return n}function Ba(e){return function(t,n,i){var r={x:n.x,y:n.y};return["x","y"].forEach(function(o){var a=e[o];if(a){var s=o==="x"?"width":"height",c=a.margin,l=a.minDistance;c<0?r[o]=Math.min(i[o]+c-t[s]/2,n[o]-l+c):r[o]=Math.max(i[o]+i[s]+c+t[s]/2,n[o]+l+c)}}),r}}function Qv(e,t,n){var i={x:t.x-n.width/2,y:t.y-n.height/2,width:n.width,height:n.height},r=tm(e);return ie(r,function(o){if(o===n)return!1;var a=Se(o,i,Zv);return a==="intersect"})}function em(e,t){t||(t={});function n(h){return h.source===e?1:-1}var i=t.defaultDistance||kp,r=t.direction||"e",o=t.filter,a=t.getWeight||n,s=t.maxDistance||Jv,c=t.reference||"start";o||(o=rm);function l(h,g){return r==="n"?c==="start"?k(h).top-k(g).bottom:c==="center"?k(h).top-L(g).y:k(h).top-k(g).top:r==="w"?c==="start"?k(h).left-k(g).right:c==="center"?k(h).left-L(g).x:k(h).left-k(g).left:r==="s"?c==="start"?k(g).top-k(h).bottom:c==="center"?L(g).y-k(h).bottom:k(g).bottom-k(h).bottom:c==="start"?k(g).left-k(h).right:c==="center"?L(g).x-k(h).right:k(g).right-k(h).right}var p=e.incoming.filter(o).map(function(h){var g=a(h),v=g<0?l(h.source,e):l(e,h.source);return{id:h.source.id,distance:v,weight:g}}),u=e.outgoing.filter(o).map(function(h){var g=a(h),v=g>0?l(e,h.target):l(h.target,e);return{id:h.target.id,distance:v,weight:g}}),d=p.concat(u).reduce(function(h,g){return h[g.id+"__weight_"+g.weight]=g,h},{}),f=Nt(d,function(h,g){var v=g.distance,_=g.weight;return v<0||v>s||(h[String(v)]||(h[String(v)]=0),h[String(v)]+=1*_,(!h.distance||h[h.distance]<h[String(v)])&&(h.distance=v)),h},{});return f.distance||i}function tm(e){var t=Po(e);return e.host&&(t=t.concat(Po(e.host))),e.attachers&&(t=t.concat(e.attachers.reduce(function(n,i){return n.concat(Po(i))},[]))),t}function Po(e){return im(e).concat(nm(e))}function nm(e){return e.incoming.map(function(t){return t.source})}function im(e){return e.outgoing.map(function(t){return t.target})}function rm(){return!0}var om=100;function Ip(e,t,n){e.on("autoPlace",om,function(i){var r=i.shape,o=i.source;return am(o,r)}),e.on("autoPlace.end",function(i){n.scrollToElement(i.shape)}),this.append=function(i,r,o){e.fire("autoPlace.start",{source:i,shape:r});var a=e.fire("autoPlace",{source:i,shape:r}),s=t.appendShape(i,r,a,i.parent,o);return e.fire("autoPlace.end",{source:i,shape:s}),s}}Ip.$inject=["eventBus","modeling","canvas"];function am(e,t,n){n||(n={});var i=n.defaultDistance||kp,r=L(e),o=k(e);return{x:o.right+i+t.width/2,y:r.y}}function Np(e,t){e.on("autoPlace.end",500,function(n){t.select(n.shape)})}Np.$inject=["eventBus","selection"];const sm={__init__:["autoPlaceSelectionBehavior"],autoPlace:["type",Ip],autoPlaceSelectionBehavior:["type",Np]};function Cn(e,t){for(Dr(t)&&(t=[t]);e=e.parent;)if(z(e,t))return e;return null}function Lp(e,t){var n=Cn(e,"bpmn:Process");if(n)return!0;var i=["bpmn:Participant","bpmn:Lane"];if(n=Cn(e,i),n)return xe(n);if(z(e,i))return xe(e);var r;for(r=P(e);r&&!m(r,"bpmn:Process");r=r.$parent);if(!t)return!0;var o=t.find(function(a){var s=P(a);return s&&s.get("processRef")===r});return o?xe(o):!0}function Op(e,t,n){var i=Lp(e,n);if(m(t,"bpmn:TextAnnotation"))return lm(e,t,i);if(z(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"]))return um(e,t,i);if(m(t,"bpmn:FlowNode"))return cm(e,t,i)}function cm(e,t,n){var i=k(e),r=L(e),o=n?{directionHint:"e",minDistance:80,baseOrientation:"left",boundaryOrientation:"top",start:"top",end:"bottom"}:{directionHint:"s",minDistance:90,baseOrientation:"top",boundaryOrientation:"left",start:"left",end:"right"},a=em(e,{filter:function(f){return m(f,"bpmn:SequenceFlow")},direction:o.directionHint}),s=30,c=o.minDistance,l=o.baseOrientation;m(e,"bpmn:BoundaryEvent")&&(l=Se(e,e.host,-25),l.indexOf(o.boundaryOrientation)!==-1&&(s*=-1));var p=n?{x:i.right+a+t.width/2,y:r.y+Ac(l,c,o)}:{x:r.x+Ac(l,c,o),y:i.bottom+a+t.height/2},u={margin:s,minDistance:c},d=n?{y:u}:{x:u};return $a(e,t,p,Ba(d))}function Ac(e,t,n){return e.includes(n.start)?-1*t:e.includes(n.end)?t:0}function lm(e,t,n){var i=k(e),r=n?{x:i.right+t.width/2,y:i.top-50-t.height/2}:{x:i.right+50+t.width/2,y:i.bottom+t.height/2};ee(e)&&(r=L(e),n?(r.x+=100,r.y-=50):(r.x+=100,r.y+=50));var o={margin:n?-30:30,minDistance:20},a=n?{y:o}:{x:o};return $a(e,t,r,Ba(a))}function um(e,t,n){var i=k(e),r=n?{x:i.right-10+t.width/2,y:i.bottom+40+t.width/2}:{x:i.left-40-t.width/2,y:i.bottom-10+t.height/2},o={margin:30,minDistance:30},a=n?{x:o}:{y:o};return $a(e,t,r,Ba(a))}function $p(e,t){e.on("autoPlace",function(n){var i=n.shape,r=n.source;return Op(r,i,t)})}$p.$inject=["eventBus","elementRegistry"];const ja={__depends__:[sm],__init__:["bpmnAutoPlace"],bpmnAutoPlace:["type",$p]};function wt(e,t,n,i){R.call(this,e),this._elementRegistry=t,this._modeling=n,this._rules=i;var r=this;this.postExecuted(["shape.create"],function(o){var a=o.context,s=a.hints||{},c=a.shape,l=a.parent||a.newParent;s.autoResize!==!1&&r._expand([c],l)}),this.postExecuted(["elements.move"],function(o){var a=o.context,s=xa(Mr(a.closure.topLevel)),c=a.hints,l=c?c.autoResize:!0;if(l!==!1){var p=Ar(s,function(u){return u.parent.id});w(p,function(u,d){V(l)&&(u=u.filter(function(f){return ie(l,yt({id:f.id}))})),r._expand(u,d)})}}),this.postExecuted(["shape.toggleCollapse"],function(o){var a=o.context,s=a.hints,c=a.shape;s&&s.autoResize===!1||c.collapsed||r._expand(c.children||[],c)}),this.postExecuted(["shape.resize"],function(o){var a=o.context,s=a.hints,c=a.shape,l=c.parent;s&&s.autoResize===!1||l&&r._expand([c],l)})}wt.$inject=["eventBus","elementRegistry","modeling","rules"];M(wt,R);wt.prototype._getOptimalBounds=function(e,t){var n=this.getOffset(t),i=this.getPadding(t),r=k(Ae(e)),o=k(t),a={};return r.top-o.top<i.top&&(a.top=r.top-n.top),r.left-o.left<i.left&&(a.left=r.left-n.left),o.right-r.right<i.right&&(a.right=r.right+n.right),o.bottom-r.bottom<i.bottom&&(a.bottom=r.bottom+n.bottom),Ea(S({},o,a))};wt.prototype._expand=function(e,t){typeof t=="string"&&(t=this._elementRegistry.get(t));var n=this._rules.allowed("element.autoResize",{elements:e,target:t});if(n){var i=this._getOptimalBounds(e,t);if(pm(i,t)){var r=dm(ut(t,["x","y","width","height"]),i);this.resize(t,i,{autoResize:r});var o=t.parent;o&&this._expand([t],o)}}};wt.prototype.getOffset=function(e){return{top:60,bottom:60,left:100,right:100}};wt.prototype.getPadding=function(e){return{top:2,bottom:2,left:15,right:15}};wt.prototype.resize=function(e,t,n){this._modeling.resizeShape(e,t,null,n)};function pm(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function dm(e,t){var n="";return e=k(e),t=k(t),e.top>t.top&&(n=n.concat("n")),e.right<t.right&&(n=n.concat("w")),e.bottom<t.bottom&&(n=n.concat("s")),e.left>t.left&&(n=n.concat("e")),n}function Fr(e){e.invoke(wt,this)}Fr.$inject=["injector"];M(Fr,wt);Fr.prototype.resize=function(e,t,n){m(e,"bpmn:Participant")?this._modeling.resizeLane(e,t,null,n):this._modeling.resizeShape(e,t,null,n)};function vi(e){Ye.call(this,e);var t=this;this.addRule("element.autoResize",function(n){return t.canResize(n.elements,n.target)})}vi.$inject=["eventBus"];M(vi,Ye);vi.prototype.canResize=function(e,t){return!1};function Gr(e,t){vi.call(this,e),this._modeling=t}M(Gr,vi);Gr.$inject=["eventBus","modeling"];Gr.prototype.canResize=function(e,t){if(m(t.di,"bpmndi:BPMNPlane")||!m(t,"bpmn:Participant")&&!m(t,"bpmn:Lane")&&!m(t,"bpmn:SubProcess"))return!1;var n=!0;return w(e,function(i){if(m(i,"bpmn:Lane")||F(i)){n=!1;return}}),n};const fm={__init__:["bpmnAutoResize","bpmnAutoResizeProvider"],bpmnAutoResize:["type",Fr],bpmnAutoResizeProvider:["type",Gr]};var kc=1500;function Bp(e,t,n){var i=this,r=n.get("dragging",!1);function o(a){if(!a.hover){var s=a.originalEvent,c=i._findTargetGfx(s),l=c&&e.get(c);c&&l&&(a.stopPropagation(),r.hover({element:l,gfx:c}),r.move(s))}}r&&t.on("drag.start",function(a){t.once("drag.move",kc,function(s){o(s)})}),(function(){var a,s;t.on("element.hover",function(c){a=c.gfx,s=c.element}),t.on("element.hover",kc,function(c){s&&t.fire("element.out",{element:s,gfx:a})}),t.on("element.out",function(){a=null,s=null})})(),this._findTargetGfx=function(a){var s,c;if(a instanceof MouseEvent)return s=tn(a),c=document.elementFromPoint(s.x,s.y),hm(c)}}Bp.$inject=["elementRegistry","eventBus","injector"];function hm(e){return li(e,"svg, .djs-element",!0)}const vm={__init__:["hoverFix"],hoverFix:["type",Bp]};var dn=Math.round,Ic="djs-drag-active";function Yt(e){e.preventDefault()}function mm(e){return typeof TouchEvent<"u"&&e instanceof TouchEvent}function gm(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function jp(e,t,n,i){var r={threshold:5,trapClick:!0},o;function a(y){var b=t.viewbox(),E=t._container.getBoundingClientRect();return{x:b.x+(y.x-E.left)/b.scale,y:b.y+(y.y-E.top)/b.scale}}function s(y,b){b=b||o;var E=e.createEvent(S({},b.payload,b.data,{isTouch:b.isTouch}));return e.fire("drag."+y,E)===!1?!1:e.fire(b.prefix+"."+y,E)}function c(y){var b=y.filter(function(E){return i.get(E.id)});b.length&&n.select(b)}function l(y,b){var E=o.payload,C=o.displacement,D=o.globalStart,A=tn(y),I=nt(A,D),j=o.localStart,q=a(A),ne=nt(q,j);if(!o.active&&(b||gm(I)>o.threshold)){if(S(E,{x:dn(j.x+C.x),y:dn(j.y+C.y),dx:0,dy:0},{originalEvent:y}),s("start")===!1)return v();o.active=!0,o.keepSelection||(E.previousSelection=n.get(),n.select(null)),o.cursor&&Or(o.cursor),t.addMarker(t.getRootElement(),Ic)}So(y),o.active&&(S(E,{x:dn(q.x+C.x),y:dn(q.y+C.y),dx:dn(ne.x),dy:dn(ne.y)},{originalEvent:y}),s("move"))}function p(y){var b,E=!0;o.active&&(y&&(o.payload.originalEvent=y,So(y)),E=s("end")),E===!1&&s("rejected"),b=_(E!==!0),s("ended",b)}function u(y){_e("Escape",y)&&(Yt(y),v())}function d(y){var b;o.active&&(b=ip(e),setTimeout(b,400),Yt(y)),p(y)}function f(y){l(y)}function h(y){var b=o.payload;b.hoverGfx=y.gfx,b.hover=y.element,s("hover")}function g(y){s("out");var b=o.payload;b.hoverGfx=null,b.hover=null}function v(y){var b;if(o){var E=o.active;E&&s("cancel"),b=_(y),E&&s("canceled",b)}}function _(y){var b,E;s("cleanup"),np(),o.trapClick?E=d:E=p,H.unbind(document,"mousemove",l),H.unbind(document,"dragstart",Yt),H.unbind(document,"selectstart",Yt),H.unbind(document,"mousedown",E,!0),H.unbind(document,"mouseup",E,!0),H.unbind(document,"keyup",u),H.unbind(document,"touchstart",f,!0),H.unbind(document,"touchcancel",v,!0),H.unbind(document,"touchmove",l,!0),H.unbind(document,"touchend",p,!0),e.off("element.hover",h),e.off("element.out",g),t.removeMarker(t.getRootElement(),Ic);var C=o.payload.previousSelection;return y!==!1&&C&&!n.get().length&&c(C),b=o,o=null,b}function x(y,b,E,C){o&&v(!1),typeof b=="string"&&(C=E,E=b,b=null),C=S({},r,C||{});var D=C.data||{},A,I,j,q,ne;C.trapClick?q=d:q=p,y?(A=Hu(y)||y,I=tn(y),So(y),A.type==="dragstart"&&Yt(A)):(A=null,I={x:0,y:0}),j=a(I),b||(b=j),ne=mm(A),o=S({prefix:E,data:D,payload:{},globalStart:I,displacement:nt(b,j),localStart:j,isTouch:ne},C),C.manual||(ne?(H.bind(document,"touchstart",f,!0),H.bind(document,"touchcancel",v,!0),H.bind(document,"touchmove",l,!0),H.bind(document,"touchend",p,!0)):(H.bind(document,"mousemove",l),H.bind(document,"dragstart",Yt),H.bind(document,"selectstart",Yt),H.bind(document,"mousedown",q,!0),H.bind(document,"mouseup",q,!0)),H.bind(document,"keyup",u),e.on("element.hover",h),e.on("element.out",g)),s("init"),C.autoActivate&&l(y,!0)}e.on("diagram.destroy",v),this.init=x,this.move=l,this.hover=h,this.out=g,this.end=p,this.cancel=v,this.context=function(){return o},this.setOptions=function(y){S(r,y)}}jp.$inject=["eventBus","canvas","selection","elementRegistry"];const St={__depends__:[vm,it],dragging:["type",jp]};function Nn(e,t,n){this._canvas=n,this._opts=S({scrollThresholdIn:[20,20,20,20],scrollThresholdOut:[0,0,0,0],scrollRepeatTimeout:15,scrollStep:10},e);var i=this;t.on("drag.move",function(r){var o=i._toBorderPoint(r);i.startScroll(o)}),t.on(["drag.cleanup"],function(){i.stopScroll()})}Nn.$inject=["config.autoScroll","eventBus","canvas"];Nn.prototype.startScroll=function(e){var t=this._canvas,n=this._opts,i=this,r=t.getContainer().getBoundingClientRect(),o=[e.x,e.y,r.width-e.x,r.height-e.y];this.stopScroll();for(var a=0,s=0,c=0;c<4;c++)ym(o[c],n.scrollThresholdOut[c],n.scrollThresholdIn[c])&&(c===0?a=n.scrollStep:c==1?s=n.scrollStep:c==2?a=-n.scrollStep:c==3&&(s=-n.scrollStep));(a!==0||s!==0)&&(t.scroll({dx:a,dy:s}),this._scrolling=setTimeout(function(){i.startScroll(e)},n.scrollRepeatTimeout))};function ym(e,t,n){return t<e&&e<n}Nn.prototype.stopScroll=function(){clearTimeout(this._scrolling)};Nn.prototype.setOptions=function(e){this._opts=S({},this._opts,e)};Nn.prototype._toBorderPoint=function(e){var t=this._canvas._container.getBoundingClientRect(),n=tn(e.originalEvent);return{x:n.x-t.left,y:n.y-t.top}};const _m={__depends__:[St],__init__:["autoScroll"],autoScroll:["type",Nn]};function Ha(e){this._commandStack=e.get("commandStack",!1)}Ha.$inject=["injector"];Ha.prototype.allowed=function(e,t){var n=!0,i=this._commandStack;return i&&(n=i.canExecute(e,t)),n===void 0?!0:n};const dt={__init__:["rules"],rules:["type",Ha]};var Gi=Math.round,bm=Math.max;function xm(e,t){var n=e.x,i=e.y;return[["M",n,i],["m",0,-t],["a",t,t,0,1,1,0,2*t],["a",t,t,0,1,1,0,-2*t],["z"]]}function Em(e){var t=[];return e.forEach(function(n,i){t.push([i===0?"M":"L",n.x,n.y])}),t}var Hp=10;function wm(e,t){var n,i;for(n=0;i=e[n];n++)if(zu(i,t)<=Hp)return{point:e[n],bendpoint:!0,index:n};return null}function Sm(e,t){var n=nh(xm(t,Hp),Em(e)),i=n[0],r=n[n.length-1],o;return i?i!==r?i.segment2!==r.segment2?(o=bm(i.segment2,r.segment2)-1,{point:e[o],bendpoint:!0,index:o}):{point:{x:Gi(i.x+r.x)/2,y:Gi(i.y+r.y)/2},index:i.segment2}:{point:{x:Gi(i.x),y:Gi(i.y)},index:i.segment2}:null}function ta(e,t){return wm(e,t)||Sm(e,t)}function zp(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Nc(e){return Math.atan((e[1].y-e[0].y)/(e[1].x-e[0].x))}function Cm(e,t){return t?{x:Math.cos(t)*e.x-Math.sin(t)*e.y,y:Math.sin(t)*e.x+Math.cos(t)*e.y}:e}function Rm(e,t,n){var i=[{n:e[0]-n[0],lambda:t[0]},{n:e[1]-n[1],lambda:t[1]}],r=i[0].n*t[0]+i[1].n*t[1],o=i[0].lambda*t[0]+i[1].lambda*t[1];return-r/o}function za(e,t){var n=t[0],i=t[1],r={x:i.x-n.x,y:i.y-n.y},o=Rm([n.x,n.y],[r.x,r.y],[e.x,e.y]);return{x:n.x+o*r.x,y:n.y+o*r.y}}function Fp(e,t){var n=za(e,t),i={x:n.x-e.x,y:n.y-e.y};return zp(i)}function ai(e,t){return zp({x:e.x-t.x,y:e.y-t.y})}var Gp="djs-bendpoint",Vp="djs-segment-dragger";function Tm(e,t){var n=tn(t),i=e._container.getBoundingClientRect(),r;r={x:i.left,y:i.top};var o=e.viewbox();return{x:o.x+(n.x-r.x)/o.scale,y:o.y+(n.y-r.y)/o.scale}}function na(e,t,n){var i=Tm(e,n),r=ta(t,i);return r}function ia(e,t){var n=W("g");te(n).add(Gp),X(e,n);var i=W("circle");$(i,{cx:0,cy:0,r:4}),te(i).add("djs-visual"),X(n,i);var r=W("circle");return $(r,{cx:0,cy:0,r:10}),te(r).add("djs-hit"),X(n,r),t&&te(n).add(t),n}function Pm(e,t,n,i){var r=W("g");X(e,r);var o=18,a=6,s=11,c=Mm(t,n,i),l=a+s,p=W("rect");$(p,{x:-o/2,y:-a/2,width:o,height:a}),te(p).add("djs-visual"),X(r,p);var u=W("rect");return $(u,{x:-c/2,y:-l/2,width:c,height:l}),te(u).add("djs-hit"),X(r,u),ih(r,i==="v"?90:0),r}function Up(e,t,n){var i=W("g"),r=Go(t,n),o=mt(t,n);return X(e,i),Pm(i,t,n,o),te(i).add(Vp),te(i).add(o==="h"?"horizontal":"vertical"),Te(i,r.x,r.y),i}function ra(e){return Math.abs(Math.round(e*2/3))}function Dm(e,t){var n=Am(e,t);return za(e,n)}function Mm(e,t,n){var i=t.x-e.x,r=t.y-e.y;return ra(n==="h"?i:r)}function Am(e,t){for(var n=t.waypoints,i=1/0,r,o=0;o<n.length-1;o++){var a=n[o],s=n[o+1],c=Fp(e,[a,s]);c<i&&(i=c,r=o)}return[n[r],n[r+1]]}function Wp(e,t,n,i,r){function o(y,b,E){var C=y.index,D=y.point,A,I,j,q,ne,Q;return C<=0||y.bendpoint?!1:(A=b[C-1],I=b[C],j=Go(A,I),q=mt(A,I),ne=Math.abs(D.x-j.x),Q=Math.abs(D.y-j.y),q&&ne<=E&&Q<=E)}function a(y,b){var E=y.waypoints,C,D,A,I;return b.index<=0||b.bendpoint||(C={start:E[b.index-1],end:E[b.index]},D=mt(C.start,C.end),!D)?null:(D==="h"?A=C.end.x-C.start.x:A=C.end.y-C.start.y,I=ra(A)/2,I)}function s(y,b){var E=b.waypoints,C=na(t,E,y),D;if(C)return D=a(b,C),o(C,E,D)?r.start(y,b,C.index):i.start(y,b,C.index,!C.bendpoint),!0}function c(y,b,E){H.bind(y,b,function(C){n.triggerMouseEvent(b,C,E),C.stopPropagation()})}function l(y,b){var E=t.getLayer("overlays"),C=de('.djs-bendpoints[data-element-id="'+Qn(y.id)+'"]',E);return!C&&b&&(C=W("g"),$(C,{"data-element-id":y.id}),te(C).add("djs-bendpoints"),X(E,C),c(C,"mousedown",y),c(C,"click",y),c(C,"dblclick",y)),C}function p(y,b){return de('.djs-segment-dragger[data-segment-idx="'+y+'"]',b)}function u(y,b){b.waypoints.forEach(function(E,C){var D=ia(y);X(y,D),Te(D,E.x,E.y)}),ia(y,"floating")}function d(y,b){for(var E=b.waypoints,C,D,A,I=1;I<E.length;I++)C=E[I-1],D=E[I],mt(C,D)&&(A=Up(y,C,D),$(A,{"data-segment-idx":I}),c(A,"mousemove",b))}function f(y){w(Vo("."+Gp,y),function(b){we(b)})}function h(y){w(Vo("."+Vp,y),function(b){we(b)})}function g(y){var b=l(y);return b||(b=l(y,!0),u(b,y),d(b,y)),b}function v(y){var b=l(y);b&&(h(b),f(b),d(b,y),u(b,y))}function _(y,b){var E=de(".floating",y),C=b.point;E&&Te(E,C.x,C.y)}function x(y,b,E){var C=p(b.index,y),D=E[b.index-1],A=E[b.index],I=b.point,j=Go(D,A),q=mt(D,A),ne,Q;C&&(ne=km(C),Q={x:I.x-j.x,y:I.y-j.y},q==="v"&&(Q={x:Q.y,y:Q.x}),Te(ne,Q.x,Q.y))}e.on("connection.changed",function(y){v(y.element)}),e.on("connection.remove",function(y){var b=l(y.element);b&&we(b)}),e.on("element.marker.update",function(y){var b=y.element,E;b.waypoints&&(E=g(b),y.add?te(E).add(y.marker):te(E).remove(y.marker))}),e.on("element.mousemove",function(y){var b=y.element,E=b.waypoints,C,D;if(E){if(C=l(b,!0),D=na(t,E,y.originalEvent),!D)return;_(C,D),D.bendpoint||x(C,D,E)}}),e.on("element.mousedown",function(y){if(wa(y)){var b=y.originalEvent,E=y.element;if(E.waypoints)return s(b,E)}}),e.on("selection.changed",function(y){var b=y.newSelection,E=b[0];E&&E.waypoints&&g(E)}),e.on("element.hover",function(y){var b=y.element;b.waypoints&&(g(b),n.registerEvent(y.gfx,"mousemove","element.mousemove"))}),e.on("element.out",function(y){n.unregisterEvent(y.gfx,"mousemove","element.mousemove")}),e.on("element.updateId",function(y){var b=y.element,E=y.newId;if(b.waypoints){var C=l(b);C&&$(C,{"data-element-id":E})}}),this.addHandles=g,this.updateHandles=v,this.getBendpointsContainer=l,this.getSegmentDragger=p}Wp.$inject=["eventBus","canvas","interactionEvents","bendpointMove","connectionSegmentMove"];function km(e){return de(".djs-visual",e)}var Lc=Math.round,Xt="reconnectStart",Zt="reconnectEnd",zn="updateWaypoints";function Fa(e,t,n,i,r,o){this._injector=e,this.start=function(a,s,c,l){var p=n.getGraphics(s),u=s.source,d=s.target,f=s.waypoints,h;!l&&c===0?h=Xt:!l&&c===f.length-1?h=Zt:h=zn;var g=h===zn?"connection.updateWaypoints":"connection.reconnect",v=r.allowed(g,{connection:s,source:u,target:d});v===!1&&(v=r.allowed(g,{connection:s,source:d,target:u})),v!==!1&&i.init(a,"bendpoint.move",{data:{connection:s,connectionGfx:p,context:{allowed:v,bendpointIndex:c,connection:s,source:u,target:d,insert:l,type:h}}})},t.on("bendpoint.move.hover",function(a){var s=a.context,c=s.connection,l=c.source,p=c.target,u=a.hover,d=s.type;s.hover=u;var f;if(u){var h=d===zn?"connection.updateWaypoints":"connection.reconnect";if(f=s.allowed=r.allowed(h,{connection:c,source:d===Xt?u:l,target:d===Zt?u:p}),f){s.source=d===Xt?u:l,s.target=d===Zt?u:p;return}f===!1&&(f=s.allowed=r.allowed(h,{connection:c,source:d===Zt?u:p,target:d===Xt?u:l})),f&&(s.source=d===Zt?u:p,s.target=d===Xt?u:l)}}),t.on(["bendpoint.move.out","bendpoint.move.cleanup"],function(a){var s=a.context,c=s.type;s.hover=null,s.source=null,s.target=null,c!==zn&&(s.allowed=!1)}),t.on("bendpoint.move.end",function(a){var s=a.context,c=s.allowed,l=s.bendpointIndex,p=s.connection,u=s.insert,d=p.waypoints.slice(),f=s.source,h=s.target,g=s.type,v=s.hints||{},_={x:Lc(a.x),y:Lc(a.y)};if(!c)return!1;g===zn?(u?d.splice(l,0,_):d[l]=_,v.bendpointMove={insert:u,bendpointIndex:l},d=this.cropWaypoints(p,d),o.updateWaypoints(p,rh(d),v)):(g===Xt?(v.docking="source",br(s)&&(v.docking="target",v.newWaypoints=d.reverse())):g===Zt&&(v.docking="target",br(s)&&(v.docking="source",v.newWaypoints=d.reverse())),o.reconnect(p,f,h,_,v))},this)}Fa.$inject=["injector","eventBus","canvas","dragging","rules","modeling"];Fa.prototype.cropWaypoints=function(e,t){var n=this._injector.get("connectionDocking",!1);if(!n)return t;var i=e.waypoints;return e.waypoints=t,e.waypoints=n.getCroppedWaypoints(e),t=e.waypoints,e.waypoints=i,t};function br(e){var t=e.hover,n=e.source,i=e.target,r=e.type;if(r===Xt)return t&&i&&t===i&&n!==i;if(r===Zt)return t&&n&&t===n&&n!==i}var Im="reconnectStart",Nm="reconnectEnd",Oc="updateWaypoints",Fn="connect-ok",Vi="connect-not-ok",$c="connect-hover",Bc="djs-updating",jc="djs-dragging",Hc=1100;function Kp(e,t,n,i){this._injector=t;var r=t.get("connectionPreview",!1);n.on("bendpoint.move.start",function(o){var a=o.context,s=a.bendpointIndex,c=a.connection,l=a.insert,p=c.waypoints,u=p.slice();a.waypoints=p,l&&u.splice(s,0,{x:o.x,y:o.y}),c.waypoints=u;var d=a.draggerGfx=ia(i.getLayer("overlays"));te(d).add("djs-dragging"),i.addMarker(c,jc),i.addMarker(c,Bc)}),n.on("bendpoint.move.hover",function(o){var a=o.context,s=a.allowed,c=a.hover,l=a.type;if(c){if(i.addMarker(c,$c),l===Oc)return;s?(i.removeMarker(c,Vi),i.addMarker(c,Fn)):s===!1&&(i.removeMarker(c,Fn),i.addMarker(c,Vi))}}),n.on(["bendpoint.move.out","bendpoint.move.cleanup"],Hc,function(o){var a=o.context,s=a.hover,c=a.target;s&&(i.removeMarker(s,$c),i.removeMarker(s,c?Fn:Vi))}),n.on("bendpoint.move.move",function(o){var a=o.context,s=a.allowed,c=a.bendpointIndex,l=a.draggerGfx,p=a.hover,u=a.type,d=a.connection,f=d.source,h=d.target,g=d.waypoints.slice(),v={x:o.x,y:o.y},_=a.hints||{},x={};r&&(_.connectionStart&&(x.connectionStart=_.connectionStart),_.connectionEnd&&(x.connectionEnd=_.connectionEnd),u===Im?br(a)?(x.connectionEnd=x.connectionEnd||v,x.source=h,x.target=p||f,g=g.reverse()):(x.connectionStart=x.connectionStart||v,x.source=p||f,x.target=h):u===Nm?br(a)?(x.connectionStart=x.connectionStart||v,x.source=p||h,x.target=f,g=g.reverse()):(x.connectionEnd=x.connectionEnd||v,x.source=f,x.target=p||h):(x.noCropping=!0,x.noLayout=!0,g[c]=v),u===Oc&&(g=e.cropWaypoints(d,g)),x.waypoints=g,r.drawPreview(a,s,x)),Te(l,o.x,o.y)},this),n.on(["bendpoint.move.end","bendpoint.move.cancel"],Hc,function(o){var a=o.context,s=a.connection,c=a.draggerGfx,l=a.hover,p=a.target,u=a.waypoints;s.waypoints=u,we(c),i.removeMarker(s,Bc),i.removeMarker(s,jc),l&&(i.removeMarker(l,Fn),i.removeMarker(l,p?Fn:Vi)),r&&r.cleanUp(a)})}Kp.$inject=["bendpointMove","injector","eventBus","canvas"];var zc="connect-hover",Fc="djs-updating";function Gc(e,t,n){return Ga(e,t,e[t]+n)}function Ga(e,t,n){return{x:t==="x"?n:e.x,y:t==="y"?n:e.y}}function Lm(e,t,n,i){var r=Math.max(t[i],n[i]),o=Math.min(t[i],n[i]),a=20,s=Math.min(Math.max(o+a,e[i]),r-a);return Ga(t,i,s)}function Yp(e){return e==="x"?"y":"x"}function Vc(e,t,n){var i,r;return e.original?e.original:(i=L(t),r=Yp(n),Ga(e,r,i[r]))}function qp(e,t,n,i,r,o){var a=e.get("connectionDocking",!1);this.start=function(u,d,f){var h,g=n.getGraphics(d),v=f-1,_=f,x=d.waypoints,y=x[v],b=x[_],E=na(n,x,u),C,D,A;C=mt(y,b),C&&(D=C==="v"?"x":"y",v===0&&(y=Vc(y,d.source,D)),_===x.length-1&&(b=Vc(b,d.target,D)),E?A=E.point:A={x:(y.x+b.x)/2,y:(y.y+b.y)/2},h={connection:d,segmentStartIndex:v,segmentEndIndex:_,segmentStart:y,segmentEnd:b,axis:D,dragPosition:A},i.init(u,A,"connectionSegment.move",{cursor:D==="x"?"resize-ew":"resize-ns",data:{connection:d,connectionGfx:g,context:h}}))};function s(u,d){if(!a)return d;var f=u.waypoints,h;return u.waypoints=d,h=a.getCroppedWaypoints(u),u.waypoints=f,h}function c(u){r.update("connection",u.connection,u.connectionGfx)}function l(u,d,f){var h=u.newWaypoints,g=u.segmentStartIndex+d,v=h[g],_=u.segmentEndIndex+d,x=h[_],y=Yp(u.axis),b=Lm(f,v,x,y);Te(u.draggerGfx,b.x,b.y)}function p(u,d){var f=0,h=u.filter(function(g,v){return Fu(u[v-1],u[v+1],g)?(f=v<=d?f-1:f,!1):!0});return{waypoints:h,segmentOffset:f}}t.on("connectionSegment.move.start",function(u){var d=u.context,f=u.connection,h=n.getLayer("overlays");d.originalWaypoints=f.waypoints.slice(),d.draggerGfx=Up(h,d.segmentStart,d.segmentEnd),te(d.draggerGfx).add("djs-dragging"),n.addMarker(f,Fc)}),t.on("connectionSegment.move.move",function(u){var d=u.context,f=d.connection,h=d.segmentStartIndex,g=d.segmentEndIndex,v=d.segmentStart,_=d.segmentEnd,x=d.axis,y=d.originalWaypoints.slice(),b=Gc(v,x,u["d"+x]),E=Gc(_,x,u["d"+x]),C=y.length,D=0;y[h]=b,y[g]=E;var A,I;h<2&&(A=Se(f.source,b),h===1?A==="intersect"&&(y.shift(),y[0]=b,D--):A!=="intersect"&&(y.unshift(v),D++)),g>C-3&&(I=Se(f.target,E),g===C-2?I==="intersect"&&(y.pop(),y[y.length-1]=E):I!=="intersect"&&y.push(_)),d.newWaypoints=f.waypoints=s(f,y),l(d,D,u),d.newSegmentStartIndex=h+D,c(u)}),t.on("connectionSegment.move.hover",function(u){u.context.hover=u.hover,n.addMarker(u.hover,zc)}),t.on(["connectionSegment.move.out","connectionSegment.move.cleanup"],function(u){var d=u.context.hover;d&&n.removeMarker(d,zc)}),t.on("connectionSegment.move.cleanup",function(u){var d=u.context,f=d.connection;d.draggerGfx&&we(d.draggerGfx),n.removeMarker(f,Fc)}),t.on(["connectionSegment.move.cancel","connectionSegment.move.end"],function(u){var d=u.context,f=d.connection;f.waypoints=d.originalWaypoints,c(u)}),t.on("connectionSegment.move.end",function(u){var d=u.context,f=d.connection,h=d.newWaypoints,g=d.newSegmentStartIndex;h=h.map(function(E){return{original:E.original,x:Math.round(E.x),y:Math.round(E.y)}});var v=p(h,g),_=v.waypoints,x=s(f,_),y=v.segmentOffset,b={segmentMove:{segmentStartIndex:d.segmentStartIndex,newSegmentStartIndex:g+y}};o.updateWaypoints(f,x,b)})}qp.$inject=["injector","eventBus","canvas","dragging","graphicsFactory","modeling"];var Om=Math.abs,Uc=Math.round;function $m(e,t,n){n=n===void 0?10:n;var i,r;for(i=0;i<t.length;i++)if(r=t[i],Om(r-e)<=n)return r}function Xp(e){return{x:e.x,y:e.y}}function Zp(e){return{x:e.x+e.width,y:e.y+e.height}}function Ue(e,t){return!e||isNaN(e.x)||isNaN(e.y)?t:{x:Uc(e.x+e.width/2),y:Uc(e.y+e.height/2)}}function Rn(e,t){var n=e.snapped;return n?typeof t=="string"?n[t]:n.x&&n.y:!1}function pe(e,t,n){if(typeof t!="string")throw new Error("axis must be in [x, y]");if(typeof n!="number"&&n!==!1)throw new Error("value must be Number or false");var i,r=e[t],o=e.snapped=e.snapped||{};return n===!1?o[t]=!1:(o[t]=!0,i=n-r,e[t]+=i,e["d"+t]+=i),r}function Jp(e){return e.children||[]}var Bm=Math.abs,Wc=Math.round,Do=10;function Qp(e){function t(o,a){if(V(o)){for(var s=o.length;s--;)if(Bm(o[s]-a)<=Do)return o[s]}else{o=+o;var c=a%o;if(c<Do)return a-c;if(c>o-Do)return a-c+o}return a}function n(o,a){if(o.waypoints)return Dm(a,o);if(o.width)return{x:Wc(o.width/2+o.x),y:Wc(o.height/2+o.y)}}function i(o){var a=o.context,s=a.snapPoints,c=a.connection,l=c.waypoints,p=a.segmentStart,u=a.segmentStartIndex,d=a.segmentEnd,f=a.segmentEndIndex,h=a.axis;if(s)return s;var g=[l[u-1],p,d,l[f+1]];return u<2&&g.unshift(n(c.source,o)),f>l.length-3&&g.unshift(n(c.target,o)),a.snapPoints=s={horizontal:[],vertical:[]},w(g,function(v){v&&(v=v.original||v,h==="y"&&s.horizontal.push(v.y),h==="x"&&s.vertical.push(v.x))}),s}e.on("connectionSegment.move.move",1500,function(o){var a=i(o),s=o.x,c=o.y,l,p;if(a){l=t(a.vertical,s),p=t(a.horizontal,c);var u=s-l,d=c-p;S(o,{dx:o.dx-u,dy:o.dy-d,x:l,y:p}),(u||a.vertical.indexOf(s)!==-1)&&pe(o,"x",l),(d||a.horizontal.indexOf(c)!==-1)&&pe(o,"y",p)}});function r(o){var a=o.snapPoints,s=o.connection.waypoints,c=o.bendpointIndex;if(a)return a;var l=[s[c-1],s[c+1]];return o.snapPoints=a={horizontal:[],vertical:[]},w(l,function(p){p&&(p=p.original||p,a.horizontal.push(p.y),a.vertical.push(p.x))}),a}e.on(["connect.hover","connect.move","connect.end"],1500,function(o){var a=o.context,s=a.hover,c=s&&n(s,o);!ee(s)||!c||!c.x||!c.y||(pe(o,"x",c.x),pe(o,"y",c.y))}),e.on(["bendpoint.move.move","bendpoint.move.end"],1500,function(o){var a=o.context,s=r(a),c=a.hover,l=c&&n(c,o),p=o.x,u=o.y,d,f;if(s){d=t(l?s.vertical.concat([l.x]):s.vertical,p),f=t(l?s.horizontal.concat([l.y]):s.horizontal,u);var h=p-d,g=u-f;S(o,{dx:o.dx-h,dy:o.dy-g,x:o.x-h,y:o.y-g}),(h||s.vertical.indexOf(p)!==-1)&&pe(o,"x",d),(g||s.horizontal.indexOf(u)!==-1)&&pe(o,"y",f)}})}Qp.$inject=["eventBus"];const jm={__depends__:[St,dt],__init__:["bendpoints","bendpointSnapping","bendpointMovePreview"],bendpoints:["type",Wp],bendpointMove:["type",Fa],bendpointMovePreview:["type",Kp],connectionSegmentMove:["type",qp],bendpointSnapping:["type",Qp]};function ed(e,t,n,i){function r(a,s){return i.allowed("connection.create",{source:a,target:s})}function o(a,s){return r(s,a)}e.on("connect.hover",function(a){var s=a.context,c=s.start,l=a.hover,p;if(s.hover=l,p=s.canExecute=r(c,l),!Uo(p)){if(p!==!1){s.source=c,s.target=l;return}p=s.canExecute=o(c,l),!Uo(p)&&p!==!1&&(s.source=l,s.target=c)}}),e.on(["connect.out","connect.cleanup"],function(a){var s=a.context;s.hover=null,s.source=null,s.target=null,s.canExecute=!1}),e.on("connect.end",function(a){var s=a.context,c=s.canExecute,l=s.connectionStart,p={x:a.x,y:a.y},u=s.source,d=s.target;if(!c)return!1;var f=null,h={connectionStart:oa(s)?p:l,connectionEnd:oa(s)?l:p};xt(c)&&(f=c),s.connection=n.connect(u,d,f,h)}),this.start=function(a,s,c,l){xt(c)||(l=c,c=L(s)),t.init(a,"connect",{autoActivate:l,data:{shape:s,context:{start:s,connectionStart:c}}})}}ed.$inject=["eventBus","dragging","modeling","rules"];function oa(e){var t=e.hover,n=e.source,i=e.target;return t&&n&&t===n&&n!==i}var Hm=1100,zm=900,Kc="connect-ok",Yc="connect-not-ok";function td(e,t,n){var i=e.get("connectionPreview",!1);i&&t.on("connect.move",function(r){var o=r.context,a=o.canExecute,s=o.hover,c=o.source,l=o.start,p=o.startPosition,u=o.target,d=o.connectionStart||p,f=o.connectionEnd||{x:r.x,y:r.y},h=d,g=f;oa(o)&&(h=f,g=d),i.drawPreview(o,a,{source:c||l,target:u||s,connectionStart:h,connectionEnd:g})}),t.on("connect.hover",zm,function(r){var o=r.context,a=r.hover,s=o.canExecute;s!==null&&n.addMarker(a,s?Kc:Yc)}),t.on(["connect.out","connect.cleanup"],Hm,function(r){var o=r.hover;o&&(n.removeMarker(o,Kc),n.removeMarker(o,Yc))}),i&&t.on("connect.cleanup",function(r){i.cleanUp(r.context)})}td.$inject=["injector","eventBus","canvas"];const Va={__depends__:[it,dt,St],__init__:["connectPreview"],connect:["type",ed],connectPreview:["type",td]};var Fm="djs-dragger";function Ct(e,t,n,i){this._canvas=t,this._graphicsFactory=n,this._elementFactory=i,this._connectionDocking=e.get("connectionDocking",!1),this._layouter=e.get("layouter",!1)}Ct.$inject=["injector","canvas","graphicsFactory","elementFactory"];Ct.prototype.drawPreview=function(e,t,n){n=n||{};var i=e.connectionPreviewGfx,r=e.getConnection,o=n.source,a=n.target,s=n.waypoints,c=n.connectionStart,l=n.connectionEnd,p=n.noLayout,u=n.noCropping,d=n.noNoop,f,h=this;if(i||(i=e.connectionPreviewGfx=this.createConnectionPreviewGfx()),kr(i),r||(r=e.getConnection=Gm(function(g,v,_){return h.getConnection(g,v,_)})),t&&(f=r(t,o,a)),!f){!d&&this.drawNoopPreview(i,n);return}f.waypoints=s||[],this._layouter&&!p&&(f.waypoints=this._layouter.layoutConnection(f,{source:o,target:a,connectionStart:c,connectionEnd:l,waypoints:n.waypoints||f.waypoints})),(!f.waypoints||!f.waypoints.length)&&(f.waypoints=[o?L(o):c,a?L(a):l]),this._connectionDocking&&(o||a)&&!u&&(f.waypoints=this._connectionDocking.getCroppedWaypoints(f,o,a)),this._graphicsFactory.drawConnection(i,f,{stroke:"var(--element-dragger-color)"})};Ct.prototype.drawNoopPreview=function(e,t){var n=t.source,i=t.target,r=t.connectionStart||L(n),o=t.connectionEnd||L(i),a=this.cropWaypoints(r,o,n,i),s=this.createNoopConnection(a[0],a[1]);X(e,s)};Ct.prototype.cropWaypoints=function(e,t,n,i){var r=this._graphicsFactory,o=n&&r.getShapePath(n),a=i&&r.getShapePath(i),s=r.getConnectionPath({waypoints:[e,t]});return e=n&&ei(o,s,!0)||e,t=i&&ei(a,s,!1)||t,[e,t]};Ct.prototype.cleanUp=function(e){e&&e.connectionPreviewGfx&&we(e.connectionPreviewGfx)};Ct.prototype.getConnection=function(e){var t=Vm(e);return this._elementFactory.createConnection(t)};Ct.prototype.createConnectionPreviewGfx=function(){var e=W("g");return $(e,{pointerEvents:"none"}),te(e).add(Fm),X(this._canvas.getActiveLayer(),e),e};Ct.prototype.createNoopConnection=function(e,t){return Gu([e,t],{stroke:"#333",strokeDasharray:[1],strokeWidth:2,"pointer-events":"none"})};function Gm(e){var t={};return function(n){var i=JSON.stringify(n),r=t[i];return r||(r=t[i]=e.apply(null,arguments)),r}}function Vm(e){return xt(e)?e:{}}const Um={__init__:["connectionPreview"],connectionPreview:["type",Ct]},Wm=new _a("ps");var Km=["marker-start","marker-mid","marker-end"],Ym=["circle","ellipse","line","path","polygon","polyline","path","rect"];function Lt(e,t,n,i){this._elementRegistry=e,this._canvas=n,this._styles=i}Lt.$inject=["elementRegistry","eventBus","canvas","styles"];Lt.prototype.cleanUp=function(){console.warn("PreviewSupport#cleanUp is deprecated and will be removed in future versions. You do not need to manually clean up previews anymore. cf. https://github.com/bpmn-io/diagram-js/pull/906")};Lt.prototype.getGfx=function(e){return this._elementRegistry.getGraphics(e)};Lt.prototype.addDragger=function(e,t,n,i="djs-dragger"){n=n||this.getGfx(e);var r=Vu(n),o=n.getBoundingClientRect();return this._cloneMarkers(_n(r),i),$(r,this._styles.cls(i,[],{x:o.top,y:o.left})),X(t,r),$(r,"data-preview-support-element-id",e.id),r};Lt.prototype.addFrame=function(e,t){var n=W("rect",{class:"djs-resize-overlay",width:e.width,height:e.height,x:e.x,y:e.y});return X(t,n),$(n,"data-preview-support-element-id",e.id),n};Lt.prototype._cloneMarkers=function(e,t="djs-dragger",n=e){var i=this;e.childNodes&&e.childNodes.forEach(r=>{i._cloneMarkers(r,t,n)}),Jm(e)&&Km.forEach(function(r){if($(e,r)){var o=qm(e,r,i._canvas.getContainer());o&&i._cloneMarker(n,e,o,r,t)}})};Lt.prototype._cloneMarker=function(e,t,n,i,r="djs-dragger"){var o=[n.id,r,Wm.next()].join("-"),a=de("marker#"+n.id,e);e=e||this._canvas._svg;var s=a||Vu(n);s.id=o,te(s).add(r);var c=de(":scope > defs",e);c||(c=W("defs"),X(e,c)),X(c,s);var l=Zm(s.id);$(t,i,l)};function qm(e,t,n){var i=Xm($(e,t));return de("marker#"+i,n||document)}function Xm(e){return e.match(/url\(['"]?#([^'"]*)['"]?\)/)[1]}function Zm(e){return"url(#"+e+")"}function Jm(e){return Ym.indexOf(e.nodeName)!==-1}const Ln={__init__:["previewSupport"],previewSupport:["type",Lt]},Ui="complex-preview";class nd{constructor(t,n,i){this._canvas=t,this._graphicsFactory=n,this._previewSupport=i,this._markers=[]}create(t){this.cleanUp();const{created:n=[],moved:i=[],removed:r=[],resized:o=[]}=t,a=this._canvas.getLayer(Ui);n.filter(s=>!Qm(s)).forEach(s=>{let c;ee(s)?(c=this._graphicsFactory._createContainer("connection",W("g")),this._graphicsFactory.drawConnection(_n(c),s)):(c=this._graphicsFactory._createContainer("shape",W("g")),this._graphicsFactory.drawShape(_n(c),s),Te(c,s.x,s.y)),this._previewSupport.addDragger(s,a,c)}),i.forEach(({element:s,delta:c})=>{this._previewSupport.addDragger(s,a,void 0,"djs-dragging"),this._canvas.addMarker(s,"djs-element-hidden"),this._markers.push([s,"djs-element-hidden"]);const l=this._previewSupport.addDragger(s,a);ee(s)?Te(l,c.x,c.y):Te(l,s.x+c.x,s.y+c.y)}),r.forEach(s=>{this._previewSupport.addDragger(s,a,void 0,"djs-dragging"),this._canvas.addMarker(s,"djs-element-hidden"),this._markers.push([s,"djs-element-hidden"])}),o.forEach(({shape:s,bounds:c})=>{this._canvas.addMarker(s,"djs-hidden"),this._markers.push([s,"djs-hidden"]),this._previewSupport.addDragger(s,a,void 0,"djs-dragging");const l=this._graphicsFactory._createContainer("shape",W("g"));this._graphicsFactory.drawShape(_n(l),s,{width:c.width,height:c.height}),Te(l,c.x,c.y),this._previewSupport.addDragger(s,a,l)})}cleanUp(){kr(this._canvas.getLayer(Ui)),this._markers.forEach(([t,n])=>this._canvas.removeMarker(t,n)),this._markers=[]}show(){this._canvas.showLayer(Ui)}hide(){this._canvas.hideLayer(Ui)}}nd.$inject=["canvas","graphicsFactory","previewSupport"];function Qm(e){return e.hidden}const eg={__depends__:[Ln],__init__:["complexPreview"],complexPreview:["type",nd]};var Ua=["top","bottom","left","right"],Wi=10;function Wa(e,t){R.call(this,e),this.postExecuted(["connection.create","connection.layout","connection.updateWaypoints"],function(r){var o=r.context,a=o.connection,s=a.source,c=a.target,l=o.hints||{};l.createElementsBehavior!==!1&&(n(s),n(c))}),this.postExecuted(["label.create"],function(r){var o=r.context,a=o.shape,s=o.hints||{};s.createElementsBehavior!==!1&&n(a.labelTarget)}),this.postExecuted(["elements.create"],function(r){var o=r.context,a=o.elements,s=o.hints||{};s.createElementsBehavior!==!1&&a.forEach(function(c){n(c)})});function n(r){if(Ir(r)&&!ee(r)){var o=ig(r);o&&i(r,o)}}function i(r,o){var a=L(r),s=r.label,c=L(s);if(s.parent){var l=k(r),p;switch(o){case"top":p={x:a.x,y:l.top-Wi-s.height/2};break;case"left":p={x:l.left-Wi-s.width/2,y:a.y};break;case"bottom":p={x:a.x,y:l.bottom+Wi+s.height/2};break;case"right":p={x:l.right+Wi+s.width/2,y:a.y};break}var u=nt(p,c);t.moveShape(s,u)}}}M(Wa,R);Wa.$inject=["eventBus","modeling"];function tg(e){var t=e.host,n=L(e),i=Se(n,t),r;i.indexOf("-")>=0?r=i.split("-"):r=[i];var o=Ua.filter(function(a){return r.indexOf(a)===-1});return o}function ng(e){var t=L(e),n=[].concat(e.incoming.map(function(i){return i.waypoints[i.waypoints.length-2]}),e.outgoing.map(function(i){return i.waypoints[1]})).map(function(i){return id(t,i)});return n}function ig(e){var t=L(e.label),n=L(e),i=id(n,t);if(rg(i)){var r=ng(e);if(e.host){var o=tg(e);r=r.concat(o)}var a=Ua.filter(function(s){return r.indexOf(s)===-1});if(a.indexOf(i)===-1)return a[0]}}function id(e,t){return Se(t,e,5)}function rg(e){return Ua.indexOf(e)!==-1}function Ka(e){R.call(this,e),this.preExecute("shape.append",function(t){var n=t.source,i=t.shape;t.position||(m(i,"bpmn:TextAnnotation")?t.position={x:n.x+n.width/2+75,y:n.y-50-i.height/2}:t.position={x:n.x+n.width+80+i.width/2,y:n.y+n.height/2})},!0)}M(Ka,R);Ka.$inject=["eventBus"];function Ya(e,t){e.invoke(R,this),this.postExecute("shape.move",function(n){var i=n.newParent,r=n.shape,o=U(r.incoming.concat(r.outgoing),function(a){return m(a,"bpmn:Association")});w(o,function(a){t.moveConnection(a,{x:0,y:0},i)})},!0)}M(Ya,R);Ya.$inject=["injector","modeling"];var qc=500;function Vr(e,t){t.invoke(R,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",qc,function(i){var r=i.elements;r=r.filter(function(o){var a=o.host;return Xc(o,a)}),r.length===1&&r.map(function(o){return r.indexOf(o)}).forEach(function(o){var a=r[o];i.elements[o]=n._replaceShape(r[o],a)})},!0),this.preExecute("elements.move",qc,function(i){var r=i.shapes,o=i.newHost;if(r.length===1){var a=r[0];Xc(a,o)&&(i.shapes=[n._replaceShape(a,o)])}},!0)}Vr.$inject=["bpmnReplace","injector"];M(Vr,R);Vr.prototype._replaceShape=function(e,t){var n=og(e),i={type:"bpmn:BoundaryEvent",host:t};return n&&(i.eventDefinitionType=n.$type),this._bpmnReplace.replaceElement(e,i,{layoutConnection:!1})};function og(e){var t=P(e),n=t.eventDefinitions;return n&&n[0]}function Xc(e,t){return!F(e)&&z(e,["bpmn:IntermediateThrowEvent","bpmn:IntermediateCatchEvent"])&&!!t}function qa(e,t){R.call(this,e);function n(i){return U(i.attachers,function(r){return m(r,"bpmn:BoundaryEvent")})}this.postExecute("connection.create",function(i){var r=i.context.source,o=i.context.target,a=n(o);m(r,"bpmn:EventBasedGateway")&&m(o,"bpmn:ReceiveTask")&&a.length>0&&t.removeElements(a)}),this.postExecute("connection.reconnect",function(i){var r=i.context.oldSource,o=i.context.newSource;m(r,"bpmn:Gateway")&&m(o,"bpmn:EventBasedGateway")&&w(o.outgoing,function(a){var s=a.target,c=n(s);m(s,"bpmn:ReceiveTask")&&c.length>0&&t.removeElements(c)})})}qa.$inject=["eventBus","modeling"];M(qa,R);function Xa(e,t,n){R.call(this,e),this.preExecute("shape.replace",s,!0),this.postExecuted("shape.replace",c,!0),this.preExecute("connection.create",r,!0),this.postExecuted("connection.delete",i,!0),this.postExecuted("connection.reconnect",o,!0),this.postExecuted("element.updateProperties",a,!0);function i(v){const _=v.source,x=v.target;fn(_)&&Gn(x)&&p(x)}function r(v){const _=v.connection,x=v.source,y=v.target;fn(x)&&Ki(y)&&(l(y),d(x,[_]))}function o(v){const _=v.newTarget,x=v.oldSource,y=v.oldTarget;if(y!==_){const b=x;Gn(y)&&p(y),fn(b)&&Ki(_)&&l(_)}}function a(v){const{element:_}=v;Gn(_)?(u(_),f(_)):Ki(_)&&h(_)}function s(v){const{newData:_,oldShape:x}=v;if(fn(v.oldShape)&&_.eventDefinitionType!=="bpmn:CompensateEventDefinition"||_.type!=="bpmn:BoundaryEvent"){const y=x.outgoing.find(({target:b})=>Gn(b));y&&y.target&&(v._connectionTarget=y.target)}else if(!fn(v.oldShape)&&_.eventDefinitionType==="bpmn:CompensateEventDefinition"&&_.type==="bpmn:BoundaryEvent"){const y=x.outgoing.find(({target:b})=>Ki(b));y&&y.target&&(v._connectionTarget=y.target),g(x)}}function c(v){const{_connectionTarget:_,newShape:x}=v;_&&t.connect(x,_)}function l(v){t.updateProperties(v,{isForCompensation:!0})}function p(v){t.updateProperties(v,{isForCompensation:void 0})}function u(v){for(const _ of v.incoming)n.canConnect(_.source,v)||t.removeConnection(_);for(const _ of v.outgoing)n.canConnect(v,_.target)||t.removeConnection(_)}function d(v,_){v.outgoing.filter(b=>m(b,"bpmn:Association")).filter(b=>Gn(b.target)&&!_.includes(b)).forEach(b=>t.removeConnection(b))}function f(v){const _=v.attachers.slice();_.length&&t.removeElements(_)}function h(v){const _=v.incoming.filter(x=>fn(x.source));t.removeElements(_)}function g(v){const _=v.outgoing.filter(x=>m(x,"bpmn:SequenceFlow"));t.removeElements(_)}}M(Xa,R);Xa.$inject=["eventBus","modeling","bpmnRules"];function Gn(e){const t=P(e);return t&&t.get("isForCompensation")}function fn(e){return e&&m(e,"bpmn:BoundaryEvent")&&Sa(e,"bpmn:CompensateEventDefinition")}function Ki(e){return e&&m(e,"bpmn:Activity")&&!Pe(e)}function Za(e){e.invoke(R,this),this.preExecute("shape.create",1500,function(t){var n=t.context,i=n.parent,r=n.shape;m(i,"bpmn:Lane")&&!m(r,"bpmn:Lane")&&(n.parent=Cn(i,"bpmn:Participant"))})}Za.$inject=["injector"];M(Za,R);function Ja(e,t){R.call(this,e),this.preExecute("shape.create",function(n){var i=n.context,r=i.shape;if(m(r,"bpmn:DataObjectReference")&&r.type!=="label"){var o=t.create("bpmn:DataObject");o.isCollection=r.businessObject.dataObjectRef?.isCollection||!1,r.businessObject.dataObjectRef=o}})}Ja.$inject=["eventBus","bpmnFactory"];M(Ja,R);var aa=20,sa=20,rd=30,Yi=2e3;function Qa(e,t,n){R.call(this,t),t.on(["create.start","shape.move.start"],Yi,function(r){var o=r.context,a=o.shape,s=e.getRootElement();if(!(!m(a,"bpmn:Participant")||!m(s,"bpmn:Process")||!s.children.length)){var c=s.children.filter(function(u){return!m(u,"bpmn:Group")&&!F(u)&&!ee(u)});if(c.length){var l=Ae(c),p=ag(a,l);S(a,p),o.createConstraints=sg(a,l)}}}),t.on("create.start",Yi,function(r){var o=r.context,a=o.shape,s=e.getRootElement(),c=e.getGraphics(s);function l(p){p.element=s,p.gfx=c}m(a,"bpmn:Participant")&&m(s,"bpmn:Process")&&(t.on("element.hover",Yi,l),t.once("create.cleanup",function(){t.off("element.hover",l)}))});function i(){var r=e.getRootElement();return m(r,"bpmn:Collaboration")?r:n.makeCollaboration()}this.preExecute("elements.create",Yi,function(r){var o=r.elements,a=r.parent,s=cg(o),c;s&&m(a,"bpmn:Process")&&(r.parent=i(),c=r.hints=r.hints||{},c.participant=s,c.process=a,c.processRef=P(s).get("processRef"))},!0),this.preExecute("shape.create",function(r){var o=r.parent,a=r.shape;m(a,"bpmn:Participant")&&m(o,"bpmn:Process")&&(r.parent=i(),r.process=o,r.processRef=P(a).get("processRef"))},!0),this.execute("shape.create",function(r){var o=r.hints||{},a=r.process||o.process,s=r.shape,c=o.participant;a&&(!c||s===c)&&P(s).set("processRef",P(a))},!0),this.revert("shape.create",function(r){var o=r.hints||{},a=r.process||o.process,s=r.processRef||o.processRef,c=r.shape,l=o.participant;a&&(!l||c===l)&&P(c).set("processRef",s)},!0),this.postExecute("shape.create",function(r){var o=r.hints||{},a=r.process||r.hints.process,s=r.shape,c=o.participant;if(a){var l=a.children.slice();c?s===c&&n.moveElements(l,{x:0,y:0},c):n.moveElements(l,{x:0,y:0},s)}},!0)}Qa.$inject=["canvas","eventBus","modeling"];M(Qa,R);function ag(e,t){t={width:t.width+aa*2+rd,height:t.height+sa*2};var n=Math.max(e.width,t.width),i=Math.max(e.height,t.height);return{x:-n/2,y:-i/2,width:n,height:i}}function sg(e,t){return t=k(t),{bottom:t.top+e.height/2-sa,left:t.right-e.width/2+aa,top:t.bottom-e.height/2+sa,right:t.left+e.width/2-aa-rd}}function cg(e){return ie(e,function(t){return m(t,"bpmn:Participant")})}var Zc="__targetRef_placeholder";function es(e,t){R.call(this,e),this.executed(["connection.create","connection.delete","connection.move","connection.reconnect"],Jc(o)),this.reverted(["connection.create","connection.delete","connection.move","connection.reconnect"],Jc(o));function n(a,s,c){var l=a.get("dataInputAssociations");return ie(l,function(p){return p!==c&&p.targetRef===s})}function i(a,s){var c=a.get("properties"),l=ie(c,function(p){return p.name===Zc});return!l&&s&&(l=t.create("bpmn:Property",{name:Zc}),ye(c,l)),l}function r(a,s){var c=i(a);c&&(n(a,c,s)||me(a.get("properties"),c))}function o(a){var s=a.context,c=s.connection,l=c.businessObject,p=c.target,u=p&&p.businessObject,d=s.newTarget,f=d&&d.businessObject,h=s.oldTarget||s.target,g=h&&h.businessObject,v=c.businessObject,_;g&&g!==u&&r(g,l),f&&f!==u&&r(f,l),u?(_=i(u,!0),v.targetRef=_):v.targetRef=null}}es.$inject=["eventBus","bpmnFactory"];M(es,R);function Jc(e){return function(t){var n=t.context,i=n.connection;if(m(i,"bpmn:DataInputAssociation"))return e(t)}}function Ur(e){this._bpmnUpdater=e}Ur.$inject=["bpmnUpdater"];Ur.prototype.execute=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.newSemanticParent,r=e.newDiParent;return e.oldSemanticParent=t.$parent,e.oldDiParent=n.$parent,this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};Ur.prototype.revert=function(e){var t=e.dataStoreBo,n=e.dataStoreDi,i=e.oldSemanticParent,r=e.oldDiParent;return this._bpmnUpdater.updateSemanticParent(t,i),this._bpmnUpdater.updateDiParent(n,r),[]};function ts(e,t,n,i){R.call(this,i),t.registerHandler("dataStore.updateContainment",Ur);function r(){return n.filter(function(s){return m(s,"bpmn:Participant")&&P(s).processRef})[0]}function o(s){return s.children.filter(function(c){return m(c,"bpmn:DataStoreReference")&&!c.labelTarget})}function a(s,c){var l=s.businessObject||s;if(c=c||r(),c){var p=c.businessObject||c;t.execute("dataStore.updateContainment",{dataStoreBo:l,dataStoreDi:Z(s),newSemanticParent:p.processRef||p,newDiParent:Z(c)})}}this.preExecute("shape.create",function(s){var c=s.context,l=c.shape;m(l,"bpmn:DataStoreReference")&&l.type!=="label"&&(c.hints||(c.hints={}),c.hints.autoResize=!1)}),this.preExecute("elements.move",function(s){var c=s.context,l=c.shapes,p=l.filter(function(u){return m(u,"bpmn:DataStoreReference")});p.length&&(c.hints||(c.hints={}),c.hints.autoResize=l.filter(function(u){return!m(u,"bpmn:DataStoreReference")}))}),this.postExecute("shape.create",function(s){var c=s.context,l=c.shape,p=l.parent;m(l,"bpmn:DataStoreReference")&&l.type!=="label"&&m(p,"bpmn:Collaboration")&&a(l)}),this.postExecute("shape.move",function(s){var c=s.context,l=c.shape,p=c.oldParent,u=l.parent;if(!m(p,"bpmn:Collaboration")&&m(l,"bpmn:DataStoreReference")&&l.type!=="label"&&m(u,"bpmn:Collaboration")){var d=m(p,"bpmn:Participant")?p:ug(p,"bpmn:Participant");a(l,d)}}),this.postExecute("shape.delete",function(s){var c=s.context,l=c.shape,p=e.getRootElement();z(l,["bpmn:Participant","bpmn:SubProcess"])&&m(p,"bpmn:Collaboration")&&o(p).filter(function(u){return lg(u,l)}).forEach(function(u){a(u)})}),this.postExecute("canvas.updateRoot",function(s){var c=s.context,l=c.oldRoot,p=c.newRoot,u=o(l);u.forEach(function(d){m(p,"bpmn:Process")&&a(d,p)})})}ts.$inject=["canvas","commandStack","elementRegistry","eventBus"];M(ts,R);function lg(e,t){for(var n=e.businessObject||e,i=t.businessObject||t;n.$parent;){if(n.$parent===i.processRef||i)return!0;n=n.$parent}return!1}function ug(e,t){for(;e.parent;){if(m(e.parent,t))return e.parent;e=e.parent}}var xr=Math.max,Er=Math.min,pg=20;function od(e,t){return{top:e.top-t.top,right:e.right-t.right,bottom:e.bottom-t.bottom,left:e.left-t.left}}function dg(e,t,n){var i=n.x,r=n.y,o={x:e.x,y:e.y,width:e.width,height:e.height};return t.indexOf("n")!==-1?(o.y=e.y+r,o.height=e.height-r):t.indexOf("s")!==-1&&(o.height=e.height+r),t.indexOf("e")!==-1?o.width=e.width+i:t.indexOf("w")!==-1&&(o.x=e.x+i,o.width=e.width-i),o}function fg(e,t){return{x:e.x+(t.left||0),y:e.y+(t.top||0),width:e.width-(t.left||0)+(t.right||0),height:e.height-(t.top||0)+(t.bottom||0)}}function qi(e,t,n){var i=t[e],r=n.min&&n.min[e],o=n.max&&n.max[e];return G(r)&&(i=(/top|left/.test(e)?Er:xr)(i,r)),G(o)&&(i=(/top|left/.test(e)?xr:Er)(i,o)),i}function hg(e,t){if(!t)return e;var n=k(e);return Ea({top:qi("top",n,t),right:qi("right",n,t),bottom:qi("bottom",n,t),left:qi("left",n,t)})}function vg(e,t,n,i){var r=k(t),o={top:/n/.test(e)?r.bottom-n.height:r.top,left:/w/.test(e)?r.right-n.width:r.left,bottom:/s/.test(e)?r.top+n.height:r.bottom,right:/e/.test(e)?r.left+n.width:r.right},a=i?k(i):o,s={top:Er(o.top,a.top),left:Er(o.left,a.left),bottom:xr(o.bottom,a.bottom),right:xr(o.right,a.right)};return Ea(s)}function Vn(e,t){return typeof e<"u"?e:pg}function mg(e,t){var n,i,r,o;return typeof t=="object"?(n=Vn(t.left),i=Vn(t.right),r=Vn(t.top),o=Vn(t.bottom)):n=i=r=o=Vn(t),{x:e.x-n,y:e.y-r,width:e.width+n+i,height:e.height+r+o}}function gg(e){return!(e.waypoints||e.type==="label")}function ad(e,t){var n;if(e.length===void 0?n=U(e.children,gg):n=e,n.length)return mg(Ae(n),t)}var Pt=Math.abs;function yg(e,t){return od(k(t),k(e))}var _g=["bpmn:Participant","bpmn:Process","bpmn:SubProcess"],Ge=30;function Wr(e,t){return t=t||[],e.children.filter(function(n){m(n,"bpmn:Lane")&&(Wr(n,t),t.push(n))}),t}function Ot(e){return e.children.filter(function(t){return m(t,"bpmn:Lane")})}function Ve(e){return Cn(e,_g)||e}function bg(e,t){var n=Ve(e),i=m(n,"bpmn:Process")?[]:[n],r=Wr(n,i),o=k(e),a=k(t),s=yg(e,t),c=[],l=xe(e);return r.forEach(function(p){if(p!==e){var u=l?0:s.top,d=l?s.right:0,f=l?0:s.bottom,h=l?s.left:0,g=k(p);s.top&&(Pt(g.bottom-o.top)<10&&(f=a.top-g.bottom),Pt(g.top-o.top)<5&&(u=a.top-g.top)),s.left&&(Pt(g.right-o.left)<10&&(d=a.left-g.right),Pt(g.left-o.left)<5&&(h=a.left-g.left)),s.bottom&&(Pt(g.top-o.bottom)<10&&(u=a.bottom-g.top),Pt(g.bottom-o.bottom)<5&&(f=a.bottom-g.bottom)),s.right&&(Pt(g.left-o.right)<10&&(h=a.right-g.left),Pt(g.right-o.right)<5&&(d=a.right-g.right)),(u||d||f||h)&&c.push({shape:p,newBounds:fg(p,{top:u,right:d,bottom:f,left:h})})}}),c}var xg=500;function ns(e,t){R.call(this,e);function n(i,r){var o=xe(i),a=Ot(r),s=[],c=[],l=[],p=[];if(Nr(a,function(v){return o?v.y>i.y?c.push(v):s.push(v):v.x>i.x?p.push(v):l.push(v),v.children}),!!a.length){var u;o?c.length&&s.length?u=i.height/2:u=i.height:p.length&&l.length?u=i.width/2:u=i.width;var d,f,h,g;s.length&&(d=t.calculateAdjustments(s,"y",u,i.y-10),t.makeSpace(d.movingShapes,d.resizingShapes,{x:0,y:u},"s")),c.length&&(f=t.calculateAdjustments(c,"y",-u,i.y+i.height+10),t.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:-u},"n")),l.length&&(h=t.calculateAdjustments(l,"x",u,i.x-10),t.makeSpace(h.movingShapes,h.resizingShapes,{x:u,y:0},"e")),p.length&&(g=t.calculateAdjustments(p,"x",-u,i.x+i.width+10),t.makeSpace(g.movingShapes,g.resizingShapes,{x:-u,y:0},"w"))}}this.postExecuted("shape.delete",xg,function(i){var r=i.context,o=r.hints,a=r.shape,s=r.oldParent;m(a,"bpmn:Lane")&&(o&&o.nested||n(a,s))})}ns.$inject=["eventBus","spaceTool"];M(ns,R);var Qc=500;function Kr(e,t){t.invoke(R,this),this._bpmnReplace=e;var n=this;this.postExecuted("elements.create",Qc,function(i){var r=i.elements;r.filter(function(o){var a=o.host;return el(o,a)}).map(function(o){return r.indexOf(o)}).forEach(function(o){i.elements[o]=n._replaceShape(r[o])})},!0),this.preExecute("elements.move",Qc,function(i){var r=i.shapes,o=i.newHost;r.forEach(function(a,s){var c=a.host;el(a,wg(r,c)?c:o)&&(r[s]=n._replaceShape(a))})},!0)}Kr.$inject=["bpmnReplace","injector"];M(Kr,R);Kr.prototype._replaceShape=function(e){var t=Eg(e),n;return t?n={type:"bpmn:IntermediateCatchEvent",eventDefinitionType:t.$type}:n={type:"bpmn:IntermediateThrowEvent"},this._bpmnReplace.replaceElement(e,n,{layoutConnection:!1})};function Eg(e){var t=P(e),n=t.eventDefinitions;return n&&n[0]}function el(e,t){return!F(e)&&m(e,"bpmn:BoundaryEvent")&&!t}function wg(e,t){return e.indexOf(t)!==-1}function is(e,t,n){R.call(this,e);function i(r,o,a){var s=o.waypoints,c,l,p,u,d,f,h,g=r.outgoing.slice(),v=r.incoming.slice(),_;G(a.width)?_=L(a):_=a;var x=ta(s,_);if(x){if(c=s.slice(0,x.index),l=s.slice(x.index+(x.bendpoint?1:0)),!c.length||!l.length)return;p=x.bendpoint?s[x.index]:_,(c.length===1||!tl(r,c[c.length-1]))&&c.push(nl(p)),(l.length===1||!tl(r,l[0]))&&l.unshift(nl(p))}u=o.source,d=o.target,t.canConnect(u,r,o)&&(n.reconnectEnd(o,r,c||_),f=o),t.canConnect(r,d,o)&&(f?h=n.connect(r,d,{type:o.type,waypoints:l}):(n.reconnectStart(o,r,l||_),h=o));var y=[].concat(f&&U(v,function(b){return b.source===f.source})||[],h&&U(g,function(b){return b.target===h.target})||[]);y.length&&n.removeElements(y)}this.preExecute("elements.move",function(r){var o=r.newParent,a=r.shapes,s=r.delta,c=a[0];if(!(!c||!o)){o&&o.waypoints&&(r.newParent=o=o.parent);var l=L(c),p={x:l.x+s.x,y:l.y+s.y},u=ie(o.children,function(d){var f=t.canInsert(a,d);return f&&ta(d.waypoints,p)});u&&(r.targetFlow=u,r.position=p)}},!0),this.postExecuted("elements.move",function(r){var o=r.shapes,a=r.targetFlow,s=r.position;a&&i(o[0],a,s)},!0),this.preExecute("shape.create",function(r){var o=r.parent,a=r.shape;t.canInsert(a,o)&&(r.targetFlow=o,r.parent=o.parent)},!0),this.postExecuted("shape.create",function(r){var o=r.shape,a=r.targetFlow,s=r.position;a&&i(o,a,s)},!0)}M(is,R);is.$inject=["eventBus","bpmnRules","modeling"];function tl(e,t){var n=t.x,i=t.y;return n>=e.x&&n<=e.x+e.width&&i>=e.y&&i<=e.y+e.height}function nl(e){return S({},e)}function rs(e,t){R.call(this,e),this.preExecuted("connection.create",function(n){var i=n.context,r=i.connection,o=i.source,a=i.target,s=i.hints;if(!(s&&s.createElementsBehavior===!1)&&hn(r)){var c=[];m(o,"bpmn:EventBasedGateway")?c=a.incoming.filter(l=>l!==r&&hn(l)):c=a.incoming.filter(l=>l!==r&&hn(l)&&m(l.source,"bpmn:EventBasedGateway")),c.forEach(function(l){t.removeConnection(l)})}}),this.preExecuted("shape.replace",function(n){var i=n.context,r=i.newShape;if(m(r,"bpmn:EventBasedGateway")){var o=r.outgoing.filter(hn).reduce(function(a,s){return a.includes(s.target)?a:a.concat(s.target)},[]);o.forEach(function(a){a.incoming.filter(hn).forEach(function(s){const c=a.incoming.filter(hn).filter(function(l){return l.source===r});(s.source!==r||c.length>1)&&t.removeConnection(s)})})}})}rs.$inject=["eventBus","modeling"];M(rs,R);function hn(e){return m(e,"bpmn:SequenceFlow")}var Xi=1500,il=2e3;function sd(e,t,n){t.on(["create.hover","create.move","create.out","create.end","shape.move.hover","shape.move.move","shape.move.out","shape.move.end"],Xi,function(i){var r=i.context,o=r.shape||i.shape,a=i.hover;m(a,"bpmn:Lane")&&!z(o,["bpmn:Lane","bpmn:Participant"])&&(i.hover=Ve(a),i.hoverGfx=e.getGraphics(i.hover));var s=n.getRootElement();a!==s&&(o.labelTarget||z(o,["bpmn:Group","bpmn:TextAnnotation"]))&&(i.hover=s,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.hover","connect.out","connect.end","connect.cleanup","global-connect.hover","global-connect.out","global-connect.end","global-connect.cleanup"],Xi,function(i){var r=i.hover;m(r,"bpmn:Lane")&&(i.hover=Ve(r)||r,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["bendpoint.move.hover"],Xi,function(i){var r=i.context,o=i.hover,a=r.type;m(o,"bpmn:Lane")&&/reconnect/.test(a)&&(i.hover=Ve(o)||o,i.hoverGfx=e.getGraphics(i.hover))}),t.on(["connect.start"],Xi,function(i){var r=i.context,o=r.start;m(o,"bpmn:Lane")&&(r.start=Ve(o)||o)}),t.on("shape.move.start",il,function(i){var r=i.shape;m(r,"bpmn:Lane")&&(i.shape=Ve(r)||r)}),t.on("spaceTool.move",il,function(i){var r=i.hover;r&&m(r,"bpmn:Lane")&&(i.hover=Ve(r))})}sd.$inject=["elementRegistry","eventBus","canvas"];function Sg(e){return e.create("bpmn:Category")}function Cg(e){return e.create("bpmn:CategoryValue")}function Rg(e,t,n){return ye(t.get("categoryValue"),e),e.$parent=t,ye(n.get("rootElements"),t),t.$parent=n,e}function Tg(e){var t=e.$parent;return t&&(me(t.get("categoryValue"),e),e.$parent=null),e}function Pg(e){var t=e.$parent;return t&&(me(t.get("rootElements"),e),e.$parent=null),e}var rl=770;function os(e,t,n,i,r,o){r.invoke(R,this);function a(){return n.filter(function(h){return m(h,"bpmn:Group")})}function s(h,g){return h.some(function(v){var _=P(v),x=_.categoryValueRef&&_.categoryValueRef.$parent;return x===g})}function c(h,g){return h.some(function(v){var _=P(v);return _.categoryValueRef===g})}function l(h,g,v){var _=a().filter(function(x){return x.businessObject!==v});g&&!s(_,g)&&Pg(g),h&&!c(_,h)&&Tg(h)}function p(h,g){return Rg(h,g,t.getDefinitions())}function u(h,g){var v=P(h),_=v.categoryValueRef;_||(_=v.categoryValueRef=g.categoryValue=g.categoryValue||Cg(e));var x=_.$parent;x||(x=_.$parent=g.category=g.category||Sg(e)),p(_,x,t.getDefinitions())}function d(h,g){var v=g.category,_=g.categoryValue,x=P(h);_?(x.categoryValueRef=null,l(_,v,x)):l(null,x.categoryValueRef.$parent,x)}this.execute("label.create",function(h){var g=h.context,v=g.labelTarget;m(v,"bpmn:Group")&&u(v,g)}),this.revert("label.create",function(h){var g=h.context,v=g.labelTarget;m(v,"bpmn:Group")&&d(v,g)}),this.execute("shape.delete",function(h){var g=h.context,v=g.shape,_=P(v);if(!(!m(v,"bpmn:Group")||v.labelTarget)){var x=g.categoryValue=_.categoryValueRef,y;x&&(y=g.category=x.$parent,l(x,y,_),_.categoryValueRef=null)}}),this.reverted("shape.delete",function(h){var g=h.context,v=g.shape;if(!(!m(v,"bpmn:Group")||v.labelTarget)){var _=g.category,x=g.categoryValue,y=P(v);x&&(y.categoryValueRef=x,p(x,_))}}),this.execute("shape.create",function(h){var g=h.context,v=g.shape;!m(v,"bpmn:Group")||v.labelTarget||P(v).categoryValueRef&&u(v,g)}),this.reverted("shape.create",function(h){var g=h.context,v=g.shape;!m(v,"bpmn:Group")||v.labelTarget||P(v).categoryValueRef&&d(v,g)});function f(h,g){var v=e.create(h.$type);return o.copyElement(h,v,null,g)}i.on("copyPaste.copyElement",rl,function(h){var g=h.descriptor,v=h.element;if(!(!m(v,"bpmn:Group")||v.labelTarget)){var _=P(v);if(_.categoryValueRef){var x=_.categoryValueRef;g.categoryValue=f(x,!0),x.$parent&&(g.category=f(x.$parent,!0))}}}),i.on("copyPaste.pasteElement",rl,function(h){var g=h.descriptor,v=g.businessObject,_=g.categoryValue,x=g.category;_&&(_=v.categoryValueRef=f(_)),x&&(_.$parent=f(x)),delete g.category,delete g.categoryValue})}os.$inject=["bpmnFactory","bpmnjs","elementRegistry","eventBus","injector","moddleCopy"];M(os,R);function ca(e,t,n,i){var r,o,a,s,c;return r=(i.y-n.y)*(t.x-e.x)-(i.x-n.x)*(t.y-e.y),r==0?null:(o=e.y-n.y,a=e.x-n.x,c=(i.x-n.x)*o-(i.y-n.y)*a,s=c/r,{x:Math.round(e.x+s*(t.x-e.x)),y:Math.round(e.y+s*(t.y-e.y))})}function cd(e){function t(i,r,o){var a={x:o.x,y:o.y-50},s={x:o.x-50,y:o.y},c=ca(i,r,o,a),l=ca(i,r,o,s),p;c&&l?ol(c,o)>ol(l,o)?p=l:p=c:p=c||l,i.original=p}function n(i){var r=i.waypoints;t(r[0],r[1],L(i.source)),t(r[r.length-1],r[r.length-2],L(i.target))}e.on("bpmnElement.added",function(i){var r=i.element;r.waypoints&&n(r)})}cd.$inject=["eventBus"];function ol(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function as(e){R.call(this,e);var t=["bpmn:Participant","bpmn:Lane"];this.executed(["shape.move","shape.create","shape.resize"],function(n){var i=n.context.shape,r=P(i),o=Z(i);if(z(r,t)){var a=o.get("isHorizontal");a===void 0&&(a=!0),o.set("isHorizontal",a)}})}as.$inject=["eventBus"];M(as,R);var ld=Math.sqrt,ud=Math.min,Dg=Math.max,al=Math.abs;function sl(e){return Math.pow(e,2)}function Un(e,t){return ld(sl(e.x-t.x)+sl(e.y-t.y))}function Mg(e,t){var n=0,i,r,o,a,s,c,l,p,u,d,f;for(n=0;n<t.length-1;n++){if(i=t[n],r=t[n+1],ll(i,r)?l=[i]:(o=Un(e,i),a=Un(e,r),c=ud(o,a),l=Ag(i,r,e,c)),l.length<1)throw new Error("expected between [1, 2] circle -> line intersections");l.length===1&&(p={type:"bendpoint",position:l[0],segmentIndex:n,bendpointIndex:ll(i,l[0])?n:n+1}),l.length===2&&(s=Ig(l[0],l[1]),p={type:"segment",position:s,segmentIndex:n,relativeLocation:Un(i,s)/Un(i,r)}),u=Un(p.position,e),(!f||d>u)&&(f=p,d=u)}return f}function Ag(e,t,n,i){var r=t.x-e.x,o=t.y-e.y,a=n.x-e.x,s=n.y-e.y,c=r*r+o*o,l=r*a+o*s,p=a*a+s*s-i*i,u=l/c,d=p/c,f=u*u-d;if(f<0&&f>-1e-6&&(f=0),f<0)return[];var h=ld(f),g=-u+h,v=-u-h,_={x:e.x-r*g,y:e.y-o*g};if(f===0)return[_];var x={x:e.x-r*v,y:e.y-o*v};return[_,x].filter(function(y){return kg(y,e,t)})}function kg(e,t,n){return cl(e.x,t.x,n.x)&&cl(e.y,t.y,n.y)}function cl(e,t,n){return e>=ud(t,n)-wr&&e<=Dg(t,n)+wr}function Ig(e,t){return{x:(e.x+t.x)/2,y:(e.y+t.y)/2}}var wr=.1;function ll(e,t){return al(e.x-t.x)<=wr&&al(e.y-t.y)<=wr}function Ng(e,t,n,i){var r=n.segmentIndex,o=t.length-e.length;if(i.segmentMove){var a=i.segmentMove.segmentStartIndex,s=i.segmentMove.newSegmentStartIndex;return r===a?s:r>=s?r+o<s?s:r+o:r}if(i.bendpointMove){var c=i.bendpointMove.insert,l=i.bendpointMove.bendpointIndex,p;if(o===0)return r;if(r>=l&&(p=c?r+1:r-1),r<l&&(p=r,c&&n.type!=="bendpoint"&&l-1===r)){var u=dd(t,l);u<n.relativeLocation&&p++}return p}return o===0?r:i.connectionStart&&r===0?0:i.connectionEnd&&r===e.length-2?t.length-2:Math.floor((t.length-2)/2)}function pd(e,t,n,i){var r=0,o=0,a={point:e,delta:{x:0,y:0}},s=Mg(e,n),c=s.segmentIndex,l=Ng(n,t,s,i);if(l<0||l>t.length-2||l===null)return a;var p=ul(n,c),u=ul(t,l),d=s.position,f=Og(p,d),h=Lg(p,u);if(s.type==="bendpoint"){var g=t.length-n.length,v=s.bendpointIndex,_=n[v];if(t.indexOf(_)!==-1)return a;if(g===0){var x=t[v];return r=x.x-s.position.x,o=x.y-s.position.y,{delta:{x:r,y:o},point:{x:e.x+r,y:e.y+o}}}g<0&&v!==0&&v<n.length-1&&(f=dd(n,v))}var y={x:(u[1].x-u[0].x)*f+u[0].x,y:(u[1].y-u[0].y)*f+u[0].y},b=Cm({x:e.x-d.x,y:e.y-d.y},h);return r=y.x+b.x-e.x,o=y.y+b.y-e.y,{point:ti(y),delta:ti({x:r,y:o})}}function dd(e,t){var n=ai(e[t-1],e[t]),i=ai(e[t],e[t+1]),r=n/(n+i);return r}function Lg(e,t){var n=Nc(e),i=Nc(t);return i-n}function ul(e,t){return[e[t],e[t+1]]}function Og(e,t){var n=ai(e[0],e[1]),i=ai(e[0],t);return n===0?0:i/n}function $g(e,t,n,i){var r=L(e);return pd(r,t,n,i).delta}function mi(e,t,n){var i=Xn(t),r=Xn(n),o=nt(e,i),a={x:o.x*(n.width/t.width),y:o.y*(n.height/t.height)};return ti({x:r.x+a.x,y:r.y+a.y})}function pl(e,t,n){var i=Xn(e),r=Xn(t),o=Xn(n),a=nt(e,i),s=nt(i,r),c=Bg(i,t,n);if(c)return c;var l={x:s.x*(n.width/t.width),y:s.y*(n.height/t.height)},p={x:o.x+l.x,y:o.y+l.y};return ti({x:p.x+a.x-e.x,y:p.y+a.y-e.y})}function Bg(e,t,n){var i=k(t),r=k(n);if(jg(i,r))return null;var o=Se(t,e),a,s,c;if(o==="top")a={x:0,y:r.bottom-i.bottom};else if(o==="bottom")a={x:0,y:r.top-i.top};else if(o==="right")a={x:r.left-i.left,y:0};else if(o==="left")a={x:r.right-i.right,y:0};else return null;return s={x:e.x+a.x,y:e.y+a.y},c=Se(n,s),c!==o?null:a}function jg(e,t){return Hg(e,t)||zg(e,t)}function Hg(e,t){return e.right!==t.right&&e.left!==t.left}function zg(e,t){return e.top!==t.top&&e.bottom!==t.bottom}var dl="name",fl="text";function ss(e,t,n,i){R.call(this,e),this.postExecute("element.updateProperties",r),this.postExecute("element.updateModdleProperties",a=>{P(a.context.element)===a.context.moddleElement&&r(a)});function r(a){var s=a.context,c=s.element,l=s.properties;if(dl in l&&t.updateLabel(c,l[dl]),fl in l&&m(c,"bpmn:TextAnnotation")){var p=i.getTextAnnotationBounds({x:c.x,y:c.y,width:c.width,height:c.height},l[fl]||"");t.updateLabel(c,l.text,p)}}this.postExecute(["shape.create","connection.create"],function(a){var s=a.context,c=s.hints||{};if(c.createElementsBehavior!==!1){var l=s.shape||s.connection;F(l)||!En(l)||rn(l)&&t.updateLabel(l,rn(l))}}),this.postExecute("shape.delete",function(a){var s=a.context,c=s.labelTarget,l=s.hints||{};c&&l.unsetLabel!==!1&&t.updateLabel(c,null,null,{removeShape:!1})});function o(a){var s=a.context,c=s.connection,l=c.label,p=S({},s.hints),u=s.newWaypoints||c.waypoints,d=s.oldWaypoints;return typeof p.startChanged>"u"&&(p.startChanged=!!p.connectionStart),typeof p.endChanged>"u"&&(p.endChanged=!!p.connectionEnd),$g(l,u,d,p)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(a){var s=a.context,c=s.hints||{};if(c.labelBehavior!==!1){var l=s.connection,p=l.label,u;!p||!p.parent||(u=o(a),t.moveShape(p,u))}}),this.postExecute(["shape.replace"],function(a){var s=a.context,c=s.newShape,l=s.oldShape,p=P(c);p&&En(p)&&l.label&&c.label&&(c.label.x=l.label.x,c.label.y=l.label.y)}),this.postExecute("shape.resize",function(a){var s=a.context,c=s.shape,l=s.newBounds,p=s.oldBounds;if(Ir(c)){var u=c.label,d=L(u),f=Vg(p),h=Gg(d,f),g=Fg(h,p,l);t.moveShape(u,g)}})}M(ss,R);ss.$inject=["eventBus","modeling","bpmnFactory","textRenderer"];function Fg(e,t,n){var i=mi(e,t,n);return ti(nt(i,e))}function Gg(e,t){if(t.length){var n=Ug(e,t);return za(e,n)}}function Vg(e){return[[{x:e.x,y:e.y},{x:e.x+(e.width||0),y:e.y}],[{x:e.x+(e.width||0),y:e.y},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y+(e.height||0)},{x:e.x+(e.width||0),y:e.y+(e.height||0)}],[{x:e.x,y:e.y},{x:e.x,y:e.y+(e.height||0)}]]}function Ug(e,t){var n=t.map(function(r){return{line:r,distance:Fp(e,r)}}),i=bt(n,"distance");return i[0].line}function Wg(e,t,n,i){return pd(e,t,n,i).point}function cs(e,t){R.call(this,e);function n(i,r){var o=i.context,a=o.connection,s=S({},o.hints),c=o.newWaypoints||a.waypoints,l=o.oldWaypoints;return typeof s.startChanged>"u"&&(s.startChanged=!!s.connectionStart),typeof s.endChanged>"u"&&(s.endChanged=!!s.connectionEnd),Wg(r,c,l,s)}this.postExecute(["connection.layout","connection.updateWaypoints"],function(i){var r=i.context,o=r.connection,a=o.outgoing,s=o.incoming;s.forEach(function(c){var l=c.waypoints[c.waypoints.length-1],p=n(i,l),u=[].concat(c.waypoints.slice(0,-1),[p]);t.updateWaypoints(c,u)}),a.forEach(function(c){var l=c.waypoints[0],p=n(i,l),u=[].concat([p],c.waypoints.slice(1));t.updateWaypoints(c,u)})}),this.postExecute(["connection.move"],function(i){var r=i.context,o=r.connection,a=o.outgoing,s=o.incoming,c=r.delta;s.forEach(function(l){var p=l.waypoints[l.waypoints.length-1],u={x:p.x+c.x,y:p.y+c.y},d=[].concat(l.waypoints.slice(0,-1),[u]);t.updateWaypoints(l,d)}),a.forEach(function(l){var p=l.waypoints[0],u={x:p.x+c.x,y:p.y+c.y},d=[].concat([u],l.waypoints.slice(1));t.updateWaypoints(l,d)})})}M(cs,R);cs.$inject=["eventBus","modeling"];function Yr(e,t,n){var i=Xr(e),r=hd(i,t),o=i[0];return r.length?r[r.length-1]:mi(o.original||o,n,t)}function qr(e,t,n){var i=Xr(e),r=hd(i,t),o=i[i.length-1];return r.length?r[0]:mi(o.original||o,n,t)}function ls(e,t,n){var i=Xr(e),r=fd(t,n),o=i[0];return mi(o.original||o,r,t)}function us(e,t,n){var i=Xr(e),r=fd(t,n),o=i[i.length-1];return mi(o.original||o,r,t)}function fd(e,t){return{x:e.x-t.x,y:e.y-t.y,width:e.width,height:e.height}}function Xr(e){var t=e.waypoints;if(!t.length)throw new Error("connection#"+e.id+": no waypoints");return t}function hd(e,t){var n=He(e,Yg);return U(n,function(i){return Kg(i,t)})}function Kg(e,t){return Se(t,e,1)==="intersect"}function Yg(e){return e.original||e}function ps(e,t){R.call(this,e),this.postExecute("shape.replace",function(n){var i=n.oldShape,r=n.newShape;if(qg(i,r)){var o=Xg(i);o.incoming.forEach(function(a){var s=qr(a,r,i);t.reconnectEnd(a,r,s)}),o.outgoing.forEach(function(a){var s=Yr(a,r,i);t.reconnectStart(a,r,s)})}},!0)}ps.$inject=["eventBus","modeling"];M(ps,R);function qg(e,t){return m(e,"bpmn:Participant")&&Y(e)&&m(t,"bpmn:Participant")&&!Y(t)}function Xg(e){var t=pi([e],!1),n=[],i=[];return t.forEach(function(r){r!==e&&(r.incoming.forEach(function(o){m(o,"bpmn:MessageFlow")&&n.push(o)}),r.outgoing.forEach(function(o){m(o,"bpmn:MessageFlow")&&i.push(o)}))},[]),{incoming:n,outgoing:i}}const Zg=["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:EscalationEventDefinition","bpmn:ConditionalEventDefinition","bpmn:SignalEventDefinition"];function vd(e){const t=P(e);if(!m(t,"bpmn:BoundaryEvent")&&!(m(t,"bpmn:StartEvent")&&Pe(t.$parent)))return!1;const n=t.get("eventDefinitions");return!n||!n.length?!1:Zg.some(i=>m(n[0],i))}function md(e){return m(e,"bpmn:BoundaryEvent")?"cancelActivity":"isInterrupting"}function ds(e,t){e.invoke(R,this),this.postExecuted("shape.replace",function(n){const i=n.context.oldShape,r=n.context.newShape,o=n.context.hints;if(!vd(r))return;const a=md(r);if(o.targetElement&&o.targetElement[a]!==void 0)return;const c=P(i).get(a),l=P(r).get(a);c!==l&&t.updateProperties(r,{[a]:c})})}ds.$inject=["injector","modeling"];M(ds,R);function fs(e,t){R.call(this,e),this.preExecute("shape.resize",function(n){var i=n.shape,r=Z(i),o=r&&r.get("label"),a=o&&o.get("bounds");a&&t.updateModdleProperties(i,o,{bounds:void 0})},!0)}M(fs,R);fs.$inject=["eventBus","modeling"];function hs(e,t,n){R.call(this,e),this.preExecute("shape.delete",function(i){var r=i.context.shape;if(!(r.incoming.length!==1||r.outgoing.length!==1)){var o=r.incoming[0],a=r.outgoing[0];if(!(!m(o,"bpmn:SequenceFlow")||!m(a,"bpmn:SequenceFlow"))&&t.canConnect(o.source,a.target,o)){var s=Jg(o.waypoints,a.waypoints);n.reconnectEnd(o,a.target,s)}}})}M(hs,R);hs.$inject=["eventBus","bpmnRules","modeling"];function vn(e){return e.original||e}function Jg(e,t){var n=ca(vn(e[e.length-2]),vn(e[e.length-1]),vn(t[1]),vn(t[0]));return n?[].concat(e.slice(0,e.length-1),[n],t.slice(1)):[vn(e[0]),vn(t[t.length-1])]}function vs(e,t){R.call(this,e),this.preExecute("shape.delete",function(n){var i=n.shape,r=i.parent;m(i,"bpmn:Participant")&&(n.collaborationRoot=r)},!0),this.postExecute("shape.delete",function(n){var i=n.collaborationRoot;if(i&&!i.businessObject.participants.length){var r=t.makeProcess(),o=i.children.slice();t.moveElements(o,{x:0,y:0},r)}},!0)}vs.$inject=["eventBus","modeling"];M(vs,R);function ms(e,t,n,i){R.call(this,e);var r=i.get("dragging",!1);function o(c){var l=c.source,p=c.target,u=c.parent;if(u){var d,f;m(c,"bpmn:SequenceFlow")&&(n.canConnectSequenceFlow(l,p)||(f=!0),n.canConnectMessageFlow(l,p)&&(d="bpmn:MessageFlow")),m(c,"bpmn:MessageFlow")&&(n.canConnectMessageFlow(l,p)||(f=!0),n.canConnectSequenceFlow(l,p)&&(d="bpmn:SequenceFlow")),f&&t.removeConnection(c),d&&t.connect(l,p,{type:d,waypoints:c.waypoints.slice()})}}function a(c){var l=c.context,p=l.connection,u=l.newSource||p.source,d=l.newTarget||p.target,f,h;f=n.canConnect(u,d),!(!f||f.type===p.type)&&(h=t.connect(u,d,{type:f.type,associationDirection:f.associationDirection,waypoints:p.waypoints.slice()}),p.parent&&t.removeConnection(p),l.connection=h,r&&s(p,h))}function s(c,l){var p=r.context(),u=p&&p.payload.previousSelection,d;!u||!u.length||(d=u.indexOf(c),d!==-1&&u.splice(d,1,l))}this.postExecuted("elements.move",function(c){var l=c.closure,p=l.allConnections;w(p,o)},!0),this.preExecute("connection.reconnect",a),this.postExecuted("element.updateProperties",function(c){var l=c.context,p=l.properties,u=l.element,d=u.businessObject,f;p.default&&(f=ie(u.outgoing,yt({id:u.businessObject.default.id})),f&&t.updateProperties(f,{conditionExpression:void 0})),p.conditionExpression&&d.sourceRef.default===d&&t.updateProperties(u.source,{default:void 0})})}M(ms,R);ms.$inject=["eventBus","modeling","bpmnRules","injector"];function Zr(e,t,n,i,r,o){i.invoke(R,this),this._bpmnReplace=e,this._elementRegistry=n,this._selection=o,this.postExecuted(["elements.create"],500,function(a){var s=a.context,c=s.parent,l=s.elements,p=Nt(l,function(u,d){var f=t.canReplace([d],d.host||d.parent||c);return f?u.concat(f.replacements):u},[]);p.length&&this._replaceElements(l,p)},this),this.postExecuted(["elements.move"],500,function(a){var s=a.context,c=s.newParent,l=s.newHost,p=[];w(s.closure.topLevel,function(d){Pe(d)?p=p.concat(d.children):p=p.concat(d)}),p.length===1&&l&&(c=l);var u=t.canReplace(p,c);u&&this._replaceElements(p,u.replacements,l)},this),this.postExecute(["shape.replace"],1500,function(a){var s=a.context,c=s.oldShape,l=s.newShape,p=c.attachers,u;p&&p.length&&(u=t.canReplace(p,l),this._replaceElements(p,u.replacements))},this),this.postExecuted(["shape.replace"],1500,function(a){var s=a.context,c=s.oldShape,l=s.newShape;r.unclaimId(c.businessObject.id,c.businessObject),r.updateProperties(l,{id:c.id})})}M(Zr,R);Zr.prototype._replaceElements=function(e,t){var n=this._elementRegistry,i=this._bpmnReplace,r=this._selection;w(t,function(o){var a={type:o.newElementType},s=n.get(o.oldElementId),c=e.indexOf(s);e[c]=i.replaceElement(s,a,{select:!1})}),t&&r.select(e)};Zr.$inject=["bpmnReplace","bpmnRules","elementRegistry","injector","modeling","selection"];var Qg=1500,ey={width:140,height:120},gs={width:300,height:60},ys={width:60,height:300},fr={width:300,height:150},hr={width:150,height:300},gd={width:140,height:120},yd={width:50,height:30};function _d(e){e.on("resize.start",Qg,function(t){var n=t.context,i=n.shape,r=n.direction,o=n.balanced;(m(i,"bpmn:Lane")||m(i,"bpmn:Participant"))&&(n.resizeConstraints=oy(i,r,o)),m(i,"bpmn:SubProcess")&&Y(i)&&(n.minDimensions=gd),m(i,"bpmn:TextAnnotation")&&(n.minDimensions=yd)})}_d.$inject=["eventBus"];var Dt=Math.abs,ty=Math.min,ny=Math.max;function bd(e,t,n,i){var r=e[t];e[t]=r===void 0?n:i(n,r)}function mn(e,t,n){return bd(e,t,n,ty)}function gn(e,t,n){return bd(e,t,n,ny)}var iy={top:20,left:50,right:20,bottom:20},ry={top:50,left:20,right:20,bottom:20};function oy(e,t,n){var i=Ve(e),r=!0,o=!0,a=Wr(i,[i]),s=k(e),c={},l={},p=xe(e),u=p?gs:ys;/n/.test(t)?l.top=s.bottom-u.height:/e/.test(t)?l.right=s.left+u.width:/s/.test(t)?l.bottom=s.top+u.height:/w/.test(t)&&(l.left=s.right-u.width),a.forEach(function(h){var g=k(h);p?(g.top<s.top-10&&(r=!1),g.bottom>s.bottom+10&&(o=!1)):(g.left<s.left-10&&(r=!1),g.right>s.right+10&&(o=!1)),/n/.test(t)&&(n&&Dt(s.top-g.bottom)<10&&gn(c,"top",g.top+u.height),Dt(s.top-g.top)<5&&mn(l,"top",g.bottom-u.height)),/e/.test(t)&&(n&&Dt(s.right-g.left)<10&&mn(c,"right",g.right-u.width),Dt(s.right-g.right)<5&&gn(l,"right",g.left+u.width)),/s/.test(t)&&(n&&Dt(s.bottom-g.top)<10&&mn(c,"bottom",g.bottom-u.height),Dt(s.bottom-g.bottom)<5&&gn(l,"bottom",g.top+u.height)),/w/.test(t)&&(n&&Dt(s.left-g.right)<10&&gn(c,"left",g.left+u.width),Dt(s.left-g.left)<5&&mn(l,"left",g.right-u.width))});var d=i.children.filter(function(h){return!h.hidden&&!h.waypoints&&(m(h,"bpmn:FlowElement")||m(h,"bpmn:Artifact"))}),f=p?iy:ry;return d.forEach(function(h){var g=k(h);/n/.test(t)&&(!p||r)&&mn(l,"top",g.top-f.top),/e/.test(t)&&(p||o)&&gn(l,"right",g.right+f.right),/s/.test(t)&&(!p||o)&&gn(l,"bottom",g.bottom+f.bottom),/w/.test(t)&&(p||r)&&mn(l,"left",g.left-f.left)}),{min:l,max:c}}var hl=1001;function xd(e,t){e.on("resize.start",hl+500,function(n){var i=n.context,r=i.shape;(m(r,"bpmn:Lane")||m(r,"bpmn:Participant"))&&(i.balanced=!ni(n))}),e.on("resize.end",hl,function(n){var i=n.context,r=i.shape,o=i.canExecute,a=i.newBounds;if(m(r,"bpmn:Lane")||m(r,"bpmn:Participant"))return o&&(a=Uu(a),t.resizeLane(r,a,i.balanced)),!1})}xd.$inject=["eventBus","modeling"];var ay=500;function _s(e,t,n,i,r){n.invoke(R,this);function o(p){return z(p,["bpmn:ReceiveTask","bpmn:SendTask"])||sy(p,["bpmn:ErrorEventDefinition","bpmn:EscalationEventDefinition","bpmn:MessageEventDefinition","bpmn:SignalEventDefinition"])}function a(p){var u=e.getDefinitions(),d=u.get("rootElements");return!!ie(d,yt({id:p.id}))}function s(p){if(m(p,"bpmn:ErrorEventDefinition"))return"errorRef";if(m(p,"bpmn:EscalationEventDefinition"))return"escalationRef";if(m(p,"bpmn:MessageEventDefinition"))return"messageRef";if(m(p,"bpmn:SignalEventDefinition"))return"signalRef"}function c(p){if(z(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.get("messageRef");var u=p.get("eventDefinitions"),d=u[0];return d.get(s(d))}function l(p,u){if(z(p,["bpmn:ReceiveTask","bpmn:SendTask"]))return p.set("messageRef",u);var d=p.get("eventDefinitions"),f=d[0];return f.set(s(f),u)}this.executed(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.shape||p.element;if(o(u)){var d=P(u),f=c(d),h;f&&!a(f)&&(h=e.getDefinitions().get("rootElements"),ye(h,f),p.addedRootElement=f)}},!0),this.reverted(["shape.create","element.updateProperties","element.updateModdleProperties"],function(p){var u=p.addedRootElement;if(u){var d=e.getDefinitions().get("rootElements");me(d,u)}},!0),t.on("copyPaste.copyElement",function(p){var u=p.descriptor,d=p.element;if(!(d.labelTarget||!o(d))){var f=P(d),h=c(f);h&&(u.referencedRootElement=h)}}),t.on("copyPaste.pasteElement",ay,function(p){var u=p.descriptor,d=u.businessObject,f=u.referencedRootElement;f&&(a(f)||(f=i.copyElement(f,r.create(f.$type))),l(d,f),delete u.referencedRootElement)})}_s.$inject=["bpmnjs","eventBus","injector","moddleCopy","bpmnFactory"];M(_s,R);function sy(e,t){return V(t)||(t=[t]),di(t,function(n){return Sa(e,n)})}var Ed=Math.max;function wd(e){e.on("spaceTool.getMinDimensions",function(t){var n=t.shapes,i=t.axis,r=t.start,o={};return w(n,function(a){var s=a.id;m(a,"bpmn:Participant")&&(o[s]=ly(a,i,r)),m(a,"bpmn:Lane")&&(o[s]=xe(a)?gs:ys),m(a,"bpmn:SubProcess")&&Y(a)&&(o[s]=gd),m(a,"bpmn:TextAnnotation")&&(o[s]=yd),m(a,"bpmn:Group")&&(o[s]=ey)}),o})}wd.$inject=["eventBus"];function cy(e){return e==="x"}function ly(e,t,n){var i=xe(e);if(!dy(e))return i?fr:hr;var r=cy(t),o={};return r?i?o=fr:o={width:py(e,n,r),height:hr.height}:i?o={width:fr.width,height:uy(e,n,r)}:o=hr,o}function uy(e,t,n){var i;return i=fy(e,t,n),Ed(fr.height,i)}function py(e,t,n){var i;return i=hy(e,t,n),Ed(hr.width,i)}function dy(e){return!!Ot(e).length}function fy(e,t,n){var i=Ot(e),r;return r=bs(i,t,n),e.height-r.height+gs.height}function hy(e,t,n){var i=Ot(e),r;return r=bs(i,t,n),e.width-r.width+ys.width}function bs(e,t,n){var i,r,o;for(i=0;i<e.length;i++)if(r=e[i],!n&&t>=r.y&&t<=r.y+r.height||n&&t>=r.x&&t<=r.x+r.width)return o=Ot(r),o.length?bs(o,t,n):r}var vl=400,vy=600,ml={x:180,y:160};function $t(e,t,n,i,r,o,a){R.call(this,t),this._canvas=e,this._eventBus=t,this._modeling=n,this._elementFactory=i,this._bpmnFactory=r,this._bpmnjs=o,this._elementRegistry=a;var s=this;function c(u){return m(u,"bpmn:SubProcess")&&!Y(u)}function l(u){var d=u.shape,f=u.newRootElement,h=P(d);f=s._addDiagram(f||h),u.newRootElement=e.addRootElement(f)}function p(u){var d=u.shape,f=P(d);s._removeDiagram(f);var h=u.newRootElement=a.get(yn(f));e.removeRootElement(h)}this.executed("shape.create",function(u){var d=u.shape;c(d)&&l(u)},!0),this.postExecuted("shape.create",function(u){var d=u.shape,f=u.newRootElement;!f||!d.children||(s._showRecursively(d.children),s._moveChildrenToShape(d,f))},!0),this.reverted("shape.create",function(u){var d=u.shape;c(d)&&p(u)},!0),this.preExecuted("shape.delete",function(u){var d=u.shape;if(c(d)){var f=a.get(yn(d));f&&n.removeElements(f.children.slice())}},!0),this.executed("shape.delete",function(u){var d=u.shape;c(d)&&p(u)},!0),this.reverted("shape.delete",function(u){var d=u.shape;c(d)&&l(u)},!0),this.preExecuted("shape.replace",function(u){var d=u.oldShape,f=u.newShape;!c(d)||!c(f)||(u.oldRoot=e.removeRootElement(yn(d)))},!0),this.postExecuted("shape.replace",function(u){var d=u.newShape,f=u.oldRoot,h=e.findRoot(yn(d));if(!(!f||!h)){var g=f.children;n.moveElements(g,{x:0,y:0},h)}},!0),this.executed("element.updateProperties",function(u){var d=u.element;if(m(d,"bpmn:SubProcess")){var f=u.properties,h=u.oldProperties,g=h.id,v=f.id;if(g!==v){if(lr(d)){a.updateId(d,Kt(v)),a.updateId(g,v);return}var _=a.get(Kt(g));_&&a.updateId(Kt(g),Kt(v))}}},!0),this.reverted("element.updateProperties",function(u){var d=u.element;if(m(d,"bpmn:SubProcess")){var f=u.properties,h=u.oldProperties,g=h.id,v=f.id;if(g!==v){if(lr(d)){a.updateId(d,Kt(g)),a.updateId(v,g);return}var _=a.get(Kt(v));_&&a.updateId(_,Kt(g))}}},!0),t.on("element.changed",function(u){var d=u.element;if(lr(d)){var f=d,h=a.get(sc(f));!h||h===f||t.fire("element.changed",{element:h})}}),this.executed("shape.toggleCollapse",vl,function(u){var d=u.shape;m(d,"bpmn:SubProcess")&&(Y(d)?p(u):(l(u),s._showRecursively(d.children)))},!0),this.reverted("shape.toggleCollapse",vl,function(u){var d=u.shape;m(d,"bpmn:SubProcess")&&(Y(d)?p(u):(l(u),s._showRecursively(d.children)))},!0),this.postExecuted("shape.toggleCollapse",vy,function(u){var d=u.shape;if(m(d,"bpmn:SubProcess")){var f=u.newRootElement;f&&(Y(d)?s._moveChildrenToShape(f,d):s._moveChildrenToShape(d,f))}},!0),t.on("copyPaste.createTree",function(u){var d=u.element,f=u.children;if(c(d)){var h=yn(d),g=a.get(h);g&&f.push.apply(f,g.children)}}),t.on("copyPaste.copyElement",function(u){var d=u.descriptor,f=u.element,h=u.elements,g=f.parent,v=m(Z(g),"bpmndi:BPMNPlane");if(v){var _=sc(g),x=ie(h,function(y){return y.id===_});x&&(d.parent=x.id)}}),t.on("copyPaste.pasteElement",function(u){var d=u.descriptor;d.parent&&(c(d.parent)||d.parent.hidden)&&(d.hidden=!0)})}M($t,R);$t.prototype._moveChildrenToShape=function(e,t){var n=this._modeling,i=e.children,r;if(i){i=i.concat(i.reduce(function(l,p){return p.label&&p.label.parent!==e?l.concat(p.label):l},[]));var o=i.filter(function(l){return!l.hidden});if(!o.length){n.moveElements(i,{x:0,y:0},t,{autoResize:!1});return}var a=Ae(o);if(!t.x)r={x:ml.x-a.x,y:ml.y-a.y};else{var s=L(t),c=L(a);r={x:s.x-c.x,y:s.y-c.y}}n.moveElements(i,r,t,{autoResize:!1})}};$t.prototype._showRecursively=function(e,t){var n=this,i=[];return e.forEach(function(r){r.hidden=!!t,i=i.concat(r),r.children&&(i=i.concat(n._showRecursively(r.children,r.collapsed||t)))}),i};$t.prototype._addDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams;return e.businessObject||(e=this._createNewDiagram(e)),n.push(e.di.$parent),e};$t.prototype._createNewDiagram=function(e){var t=this._bpmnFactory,n=this._elementFactory,i=t.create("bpmndi:BPMNPlane",{bpmnElement:e}),r=t.create("bpmndi:BPMNDiagram",{plane:i});i.$parent=r;var o=n.createRoot({id:yn(e),type:e.$type,di:i,businessObject:e,collapsed:!0});return o};$t.prototype._removeDiagram=function(e){var t=this._bpmnjs,n=t.getDefinitions().diagrams,i=ie(n,function(r){return r.plane.bpmnElement.id===e.id});return n.splice(n.indexOf(i),1),i};$t.$inject=["canvas","eventBus","modeling","elementFactory","bpmnFactory","bpmnjs","elementRegistry"];function xs(e,t){e.invoke(R,this),this.postExecuted("shape.replace",function(n){var i=n.context.oldShape,r=n.context.newShape;if(!(!m(r,"bpmn:SubProcess")||m(r,"bpmn:AdHocSubProcess")||!(m(i,"bpmn:Task")||m(i,"bpmn:CallActivity"))||!Y(r))){var o=my(r);t.createShape({type:"bpmn:StartEvent"},o,r)}})}xs.$inject=["injector","modeling"];M(xs,R);function my(e){return{x:e.x+e.width/6,y:e.y+e.height/2}}function Es(e){R.call(this,e),this.preExecute("connection.create",function(t){const{target:n}=t;m(n,"bpmn:TextAnnotation")&&(t.parent=n.parent)},!0),this.preExecute(["shape.create","shape.resize","elements.move"],function(t){const n=t.shapes||[t.shape];n.length===1&&m(n[0],"bpmn:TextAnnotation")&&(t.hints=t.hints||{},t.hints.autoResize=!1)},!0)}M(Es,R);Es.$inject=["eventBus"];function ws(e,t){R.call(this,e),this.postExecuted("shape.toggleCollapse",1500,function(n){var i=n.shape;if(Y(i))return;var r=pi(i);r.forEach(function(a){var s=a.incoming.slice(),c=a.outgoing.slice();w(s,function(l){o(l,!0)}),w(c,function(l){o(l,!1)})});function o(a,s){r.indexOf(a.source)!==-1&&r.indexOf(a.target)!==-1||(s?t.reconnectEnd(a,i,L(i)):t.reconnectStart(a,i,L(i)))}},!0)}M(ws,R);ws.$inject=["eventBus","modeling"];var Mo=500;function Ss(e,t,n){R.call(this,e);function i(a){a.length&&a.forEach(function(s){s.type==="label"&&!s.businessObject.name&&(s.hidden=!0)})}function r(a,s){var c=a.children,l=s,p,u;return p=gy(c).concat([a]),u=ad(p),u?(l.width=Math.max(u.width,l.width),l.height=Math.max(u.height,l.height),l.x=u.x+(u.width-l.width)/2,l.y=u.y+(u.height-l.height)/2):(l.x=a.x+(a.width-l.width)/2,l.y=a.y+(a.height-l.height)/2),l}function o(a,s){return{x:a.x+(a.width-s.width)/2,y:a.y+(a.height-s.height)/2,width:s.width,height:s.height}}this.executed(["shape.toggleCollapse"],Mo,function(a){var s=a.context,c=s.shape;m(c,"bpmn:SubProcess")&&(c.collapsed?Z(c).isExpanded=!1:(i(c.children),Z(c).isExpanded=!0))}),this.reverted(["shape.toggleCollapse"],Mo,function(a){var s=a.context,c=s.shape;c.collapsed?Z(c).isExpanded=!1:Z(c).isExpanded=!0}),this.postExecuted(["shape.toggleCollapse"],Mo,function(a){var s=a.context.shape,c=t.getDefaultSize(s),l;s.collapsed?l=o(s,c):l=r(s,c),n.resizeShape(s,l,null,{autoResize:s.collapsed?!1:"nwse"})})}M(Ss,R);Ss.$inject=["eventBus","elementFactory","modeling"];function gy(e){return e.filter(function(t){return!t.hidden})}function Cs(e,t,n,i){t.invoke(R,this),this.preExecute("shape.delete",function(r){var o=r.context,a=o.shape,s=a.businessObject;F(a)||(m(a,"bpmn:Participant")&&Y(a)&&n.ids.unclaim(s.processRef.id),i.unclaimId(s.id,s))}),this.preExecute("connection.delete",function(r){var o=r.context,a=o.connection,s=a.businessObject;i.unclaimId(s.id,s)}),this.preExecute("canvas.updateRoot",function(){var r=e.getRootElement(),o=r.businessObject;m(r,"bpmn:Collaboration")&&n.ids.unclaim(o.id)})}M(Cs,R);Cs.$inject=["canvas","injector","moddle","modeling"];function Rs(e,t){R.call(this,e),this.preExecute("connection.delete",function(n){var i=n.context,r=i.connection,o=r.source;yy(r,o)&&t.updateProperties(o,{default:null})})}M(Rs,R);Rs.$inject=["eventBus","modeling"];function yy(e,t){if(!m(e,"bpmn:SequenceFlow"))return!1;var n=P(t),i=P(e);return n.get("default")===i}var _y=500,by=5e3;function Ts(e,t){R.call(this,e);var n;function i(){return n=n||new xy,n.enter(),n}function r(){if(!n)throw new Error("out of bounds release");return n}function o(){if(!n)throw new Error("out of bounds release");var s=n.leave();return s&&(t.updateLaneRefs(n.flowNodes,n.lanes),n=null),s}var a=["spaceTool","lane.add","lane.resize","lane.split","elements.create","elements.delete","elements.move","shape.create","shape.delete","shape.move","shape.resize"];this.preExecute(a,by,function(s){i()}),this.postExecuted(a,_y,function(s){o()}),this.preExecute(["shape.create","shape.move","shape.delete","shape.resize"],function(s){var c=s.context,l=c.shape,p=r();l.labelTarget||(m(l,"bpmn:Lane")&&p.addLane(l),m(l,"bpmn:FlowNode")&&p.addFlowNode(l))})}Ts.$inject=["eventBus","modeling"];M(Ts,R);function xy(){this.flowNodes=[],this.lanes=[],this.counter=0,this.addLane=function(e){this.lanes.push(e)},this.addFlowNode=function(e){this.flowNodes.push(e)},this.enter=function(){this.counter++},this.leave=function(){return this.counter--,!this.counter}}function Ps(e,t){R.call(this,e),this.postExecuted("elements.create",function(n){const i=n.context,r=i.elements;for(const o of r)Ey(o)&&!Sy(o)&&t.updateProperties(o,{isForCompensation:void 0})})}M(Ps,R);Ps.$inject=["eventBus","modeling"];function Ey(e){const t=P(e);return t&&t.isForCompensation}function wy(e){return e&&m(e,"bpmn:BoundaryEvent")&&Sa(e,"bpmn:CompensateEventDefinition")}function Sy(e){return e.incoming.filter(n=>wy(n.source)).length>0}const Cy={__init__:["adaptiveLabelPositioningBehavior","appendBehavior","associationBehavior","attachEventBehavior","boundaryEventBehavior","compensateBoundaryEventBehaviour","createBehavior","createDataObjectBehavior","createParticipantBehavior","dataInputAssociationBehavior","dataStoreBehavior","deleteLaneBehavior","detachEventBehavior","dropOnFlowBehavior","eventBasedGatewayBehavior","fixHoverBehavior","groupBehavior","importDockingFix","isHorizontalFix","labelBehavior","layoutConnectionBehavior","messageFlowBehavior","nonInterruptingBehavior","removeElementBehavior","removeEmbeddedLabelBoundsBehavior","removeParticipantBehavior","replaceConnectionBehavior","replaceElementBehaviour","resizeBehavior","resizeLaneBehavior","rootElementReferenceBehavior","spaceToolBehavior","subProcessPlaneBehavior","subProcessStartEventBehavior","textAnnotationBehavior","toggleCollapseConnectionBehaviour","toggleElementCollapseBehaviour","unclaimIdBehavior","updateFlowNodeRefsBehavior","unsetDefaultFlowBehavior","setCompensationActivityAfterPasteBehavior"],adaptiveLabelPositioningBehavior:["type",Wa],appendBehavior:["type",Ka],associationBehavior:["type",Ya],attachEventBehavior:["type",Vr],boundaryEventBehavior:["type",qa],compensateBoundaryEventBehaviour:["type",Xa],createBehavior:["type",Za],createDataObjectBehavior:["type",Ja],createParticipantBehavior:["type",Qa],dataInputAssociationBehavior:["type",es],dataStoreBehavior:["type",ts],deleteLaneBehavior:["type",ns],detachEventBehavior:["type",Kr],dropOnFlowBehavior:["type",is],eventBasedGatewayBehavior:["type",rs],fixHoverBehavior:["type",sd],groupBehavior:["type",os],importDockingFix:["type",cd],isHorizontalFix:["type",as],labelBehavior:["type",ss],layoutConnectionBehavior:["type",cs],messageFlowBehavior:["type",ps],nonInterruptingBehavior:["type",ds],removeElementBehavior:["type",hs],removeEmbeddedLabelBoundsBehavior:["type",fs],removeParticipantBehavior:["type",vs],replaceConnectionBehavior:["type",ms],replaceElementBehaviour:["type",Zr],resizeBehavior:["type",_d],resizeLaneBehavior:["type",xd],rootElementReferenceBehavior:["type",_s],spaceToolBehavior:["type",wd],subProcessPlaneBehavior:["type",$t],subProcessStartEventBehavior:["type",xs],textAnnotationBehavior:["type",Es],toggleCollapseConnectionBehaviour:["type",ws],toggleElementCollapseBehaviour:["type",Ss],unclaimIdBehavior:["type",Cs],unsetDefaultFlowBehavior:["type",Rs],updateFlowNodeRefsBehavior:["type",Ts],setCompensationActivityAfterPasteBehavior:["type",Ps]};function Sd(e,t){var n=Se(e,t,-15);return n!=="intersect"?n:null}function Ee(e){Ye.call(this,e)}M(Ee,Ye);Ee.$inject=["eventBus"];Ee.prototype.init=function(){this.addRule("connection.start",function(e){var t=e.source;return Ry(t)}),this.addRule("connection.create",function(e){var t=e.source,n=e.target,i=e.hints||{},r=i.targetParent,o=i.targetAttach;if(o)return!1;r&&(n.parent=r);try{return vr(t,n)}finally{r&&(n.parent=null)}}),this.addRule("connection.reconnect",function(e){var t=e.connection,n=e.source,i=e.target;return vr(n,i,t)}),this.addRule("connection.updateWaypoints",function(e){return{type:e.connection.type}}),this.addRule("shape.resize",function(e){var t=e.shape,n=e.newBounds;return Id(t,n)}),this.addRule("elements.create",function(e){var t=e.elements,n=e.position,i=e.target;return ee(i)&&!Sr(t,i)?!1:Tr(t,function(r){return ee(r)?vr(r.source,r.target,r):r.host?Zn(r,r.host,null,n):da(r,i,null)})}),this.addRule("elements.move",function(e){var t=e.target,n=e.shapes,i=e.position;return Zn(n,t,null,i)||Ad(n,t,i)||kd(n,t)||Sr(n,t)}),this.addRule("shape.create",function(e){return da(e.shape,e.target,e.source,e.position)}),this.addRule("shape.attach",function(e){return Zn(e.shape,e.target,null,e.position)}),this.addRule("element.copy",function(e){var t=e.element,n=e.elements;return Bd(n,t)})};Ee.prototype.canConnectMessageFlow=Od;Ee.prototype.canConnectSequenceFlow=$d;Ee.prototype.canConnectDataAssociation=Ms;Ee.prototype.canConnectAssociation=Nd;Ee.prototype.canConnectCompensationAssociation=Ld;Ee.prototype.canMove=kd;Ee.prototype.canAttach=Zn;Ee.prototype.canReplace=Ad;Ee.prototype.canDrop=Tn;Ee.prototype.canInsert=Sr;Ee.prototype.canCreate=da;Ee.prototype.canConnect=vr;Ee.prototype.canResize=Id;Ee.prototype.canCopy=Bd;function Ry(e){return la(e)?null:z(e,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference","bpmn:Group","bpmn:TextAnnotation"])}function la(e){return!e||F(e)}function Ty(e,t){return e===t}function gl(e){do{if(m(e,"bpmn:Process"))return P(e);if(m(e,"bpmn:Participant"))return P(e).processRef||P(e)}while(e=e.parent)}function ua(e){return m(e,"bpmn:TextAnnotation")}function Ds(e){return m(e,"bpmn:Group")&&!e.labelTarget}function Cd(e){return m(e,"bpmn:BoundaryEvent")&&ct(e,"bpmn:CompensateEventDefinition")}function Jr(e){return P(e).isForCompensation}function Py(e,t){var n=gl(e),i=gl(t);return n===i}function Dy(e){return m(e,"bpmn:InteractionNode")&&!m(e,"bpmn:BoundaryEvent")&&(!m(e,"bpmn:Event")||m(e,"bpmn:ThrowEvent")&&Td(e,"bpmn:MessageEventDefinition"))}function My(e){return m(e,"bpmn:InteractionNode")&&!Jr(e)&&(!m(e,"bpmn:Event")||m(e,"bpmn:CatchEvent")&&Td(e,"bpmn:MessageEventDefinition"))&&!(m(e,"bpmn:BoundaryEvent")&&!ct(e,"bpmn:MessageEventDefinition"))}function yl(e){for(var t=e;t=t.parent;){if(m(t,"bpmn:FlowElementsContainer"))return P(t);if(m(t,"bpmn:Participant"))return P(t).processRef}return null}function Rd(e,t){var n=yl(e),i=yl(t);return n===i}function ct(e,t){var n=P(e);return!!ie(n.eventDefinitions||[],function(i){return m(i,t)})}function Td(e,t){var n=P(e);return(n.eventDefinitions||[]).every(function(i){return m(i,t)})}function Ay(e){return m(e,"bpmn:FlowNode")&&!m(e,"bpmn:EndEvent")&&!Pe(e)&&!(m(e,"bpmn:IntermediateThrowEvent")&&ct(e,"bpmn:LinkEventDefinition"))&&!Cd(e)&&!Jr(e)}function ky(e){return m(e,"bpmn:FlowNode")&&!m(e,"bpmn:StartEvent")&&!m(e,"bpmn:BoundaryEvent")&&!Pe(e)&&!(m(e,"bpmn:IntermediateCatchEvent")&&ct(e,"bpmn:LinkEventDefinition"))&&!Jr(e)}function Iy(e){return m(e,"bpmn:ReceiveTask")||m(e,"bpmn:IntermediateCatchEvent")&&(ct(e,"bpmn:MessageEventDefinition")||ct(e,"bpmn:TimerEventDefinition")||ct(e,"bpmn:ConditionalEventDefinition")||ct(e,"bpmn:SignalEventDefinition"))}function Ny(e){for(var t=[];e;)e=e.parent,e&&t.push(e);return t}function pa(e,t){var n=Ny(t);return n.indexOf(e)!==-1}function vr(e,t,n){if(la(e)||la(t))return null;if(!m(n,"bpmn:DataAssociation")){if(Od(e,t))return{type:"bpmn:MessageFlow"};if($d(e,t))return{type:"bpmn:SequenceFlow"}}var i=Ms(e,t);return i||(Ld(e,t)?{type:"bpmn:Association",associationDirection:"One"}:Nd(e,t)?{type:"bpmn:Association",associationDirection:"None"}:!1)}function Tn(e,t){return F(e)||Ds(e)?!0:m(t,"bpmn:Participant")&&!Y(t)?!1:m(e,"bpmn:Participant")?m(t,"bpmn:Process")||m(t,"bpmn:Collaboration"):z(e,["bpmn:DataInput","bpmn:DataOutput"])&&e.parent?t===e.parent:m(e,"bpmn:Lane")?m(t,"bpmn:Participant")||m(t,"bpmn:Lane"):m(e,"bpmn:BoundaryEvent")&&!Ly(e)?!1:m(e,"bpmn:FlowElement")&&!m(e,"bpmn:DataStoreReference")?m(t,"bpmn:FlowElementsContainer")?Y(t):z(t,["bpmn:Participant","bpmn:Lane"]):m(e,"bpmn:DataStoreReference")&&m(t,"bpmn:Collaboration")?di(P(t).get("participants"),function(n){return!!n.get("processRef")}):z(e,["bpmn:Artifact","bpmn:DataAssociation","bpmn:DataStoreReference"])?z(t,["bpmn:Collaboration","bpmn:Lane","bpmn:Participant","bpmn:Process","bpmn:SubProcess"]):m(e,"bpmn:MessageFlow")?m(t,"bpmn:Collaboration")||e.source.parent==t||e.target.parent==t:!1}function Ly(e){return P(e).cancelActivity&&(Pd(e)||Dd(e))}function Oy(e){return!F(e)&&m(e,"bpmn:BoundaryEvent")}function $y(e){return m(e,"bpmn:Lane")}function By(e){return Oy(e)||m(e,"bpmn:IntermediateThrowEvent")&&Pd(e)?!0:m(e,"bpmn:IntermediateCatchEvent")&&Dd(e)}function Pd(e){var t=P(e);return t&&!(t.eventDefinitions&&t.eventDefinitions.length)}function Dd(e){return Md(e,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])}function Md(e,t){return t.some(function(n){return ct(e,n)})}function jy(e){return m(e,"bpmn:ReceiveTask")&&ie(e.incoming,function(t){return m(t.source,"bpmn:EventBasedGateway")})}function Zn(e,t,n,i){if(Array.isArray(e)||(e=[e]),e.length!==1)return!1;var r=e[0];return F(r)||!By(r)||Pe(t)||!m(t,"bpmn:Activity")||Jr(t)||i&&!Sd(i,t)||jy(t)?!1:"attach"}function Ad(e,t,n){if(!t)return!1;var i={replacements:[]};return w(e,function(r){Pe(t)||m(r,"bpmn:StartEvent")&&r.type!=="label"&&Tn(r,t)&&(oh(r)||i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),(ah(r)||sh(r)||ch(r))&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"}),Md(r,["bpmn:MessageEventDefinition","bpmn:TimerEventDefinition","bpmn:SignalEventDefinition","bpmn:ConditionalEventDefinition"])&&m(t,"bpmn:SubProcess")&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:StartEvent"})),m(t,"bpmn:Transaction")||ct(r,"bpmn:CancelEventDefinition")&&r.type!=="label"&&(m(r,"bpmn:EndEvent")&&Tn(r,t)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:EndEvent"}),m(r,"bpmn:BoundaryEvent")&&Zn(r,t,null,n)&&i.replacements.push({oldElementId:r.id,newElementType:"bpmn:BoundaryEvent"}))}),i.replacements.length?i:!1}function kd(e,t){return di(e,$y)?!1:t?e.every(function(n){return Tn(n,t)}):!0}function da(e,t,n,i){return t?F(e)||Ds(e)?!0:Ty(n,t)||n&&pa(n,t)?!1:Tn(e,t)||Sr(e,t):!1}function Id(e,t){return m(e,"bpmn:SubProcess")?Y(e)&&(!t||t.width>=100&&t.height>=80):!!(m(e,"bpmn:Lane")||m(e,"bpmn:Participant")||ua(e)||Ds(e))}function Hy(e,t){var n=ua(e),i=ua(t);return(n||i)&&n!==i}function Nd(e,t){return pa(t,e)||pa(e,t)?!1:Hy(e,t)?!0:!!Ms(e,t)}function Ld(e,t){return Rd(e,t)&&Cd(e)&&m(t,"bpmn:Activity")&&!Fy(t,e)&&!Pe(t)}function Od(e,t){return _l(e)&&!_l(t)?!1:Dy(e)&&My(t)&&!Py(e,t)}function $d(e,t){return Ay(e)&&ky(t)&&Rd(e,t)&&!(m(e,"bpmn:EventBasedGateway")&&!Iy(t))}function Ms(e,t){return z(e,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&z(t,["bpmn:Activity","bpmn:ThrowEvent"])?{type:"bpmn:DataInputAssociation"}:z(t,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&z(e,["bpmn:Activity","bpmn:CatchEvent"])?{type:"bpmn:DataOutputAssociation"}:!1}function Sr(e,t,n){if(!t)return!1;if(Array.isArray(e)){if(e.length!==1)return!1;e=e[0]}return t.source===e||t.target===e?!1:z(t,["bpmn:SequenceFlow","bpmn:MessageFlow"])&&!F(t)&&m(e,"bpmn:FlowNode")&&!m(e,"bpmn:BoundaryEvent")&&Tn(e,t.parent)}function zy(e,t){return e&&t&&e.indexOf(t)!==-1}function Bd(e,t){return F(t)?!0:!(m(t,"bpmn:Lane")&&!zy(e,t.parent))}function _l(e){return Cn(e,"bpmn:Process")||Cn(e,"bpmn:Collaboration")}function Fy(e,t){return e.attachers.includes(t)}const Gy={__depends__:[dt],__init__:["bpmnRules"],bpmnRules:["type",Ee]};var Vy=2e3;function jd(e,t){e.on("saveXML.start",Vy,n);function n(){var i=t.getRootElements();w(i,function(r){var o=Z(r),a,s;a=pi([r],!1),a=U(a,function(c){return c!==r&&!c.labelTarget}),s=He(a,Z),o.set("planeElement",s)})}}jd.$inject=["eventBus","canvas"];const Uy={__init__:["bpmnDiOrdering"],bpmnDiOrdering:["type",jd]};function Qr(e){R.call(this,e);var t=this;this.preExecute(["shape.create","connection.create"],function(n){var i=n.context,r=i.shape||i.connection,o=i.parent,a=t.getOrdering(r,o);a&&(a.parent!==void 0&&(i.parent=a.parent),i.parentIndex=a.index)}),this.preExecute(["shape.move","connection.move"],function(n){var i=n.context,r=i.shape||i.connection,o=i.newParent||r.parent,a=t.getOrdering(r,o);a&&(a.parent!==void 0&&(i.newParent=a.parent),i.newParentIndex=a.index)})}Qr.prototype.getOrdering=function(e,t){return null};M(Qr,R);function As(e,t){Qr.call(this,e);var n=[{type:"bpmn:SubProcess",order:{level:6}},{type:"bpmn:SequenceFlow",order:{level:9,containers:["bpmn:Participant","bpmn:FlowElementsContainer"]}},{type:"bpmn:DataAssociation",order:{level:9,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:TextAnnotation",order:{level:9}},{type:"bpmn:MessageFlow",order:{level:9,containers:["bpmn:Collaboration"]}},{type:"bpmn:Association",order:{level:6,containers:["bpmn:Participant","bpmn:FlowElementsContainer","bpmn:Collaboration"]}},{type:"bpmn:BoundaryEvent",order:{level:8}},{type:"bpmn:Group",order:{level:10,containers:["bpmn:Collaboration","bpmn:FlowElementsContainer"]}},{type:"bpmn:FlowElement",order:{level:5}},{type:"bpmn:Participant",order:{level:-2}},{type:"bpmn:Lane",order:{level:-1}}];function i(a){if(a.labelTarget)return{level:10};var s=ie(n,function(c){return z(a,[c.type])});return s&&s.order||{level:1}}function r(a){var s=a.order;if(s||(a.order=s=i(a)),!s)throw new Error(`no order for <${a.id}>`);return s}function o(a,s,c){for(var l=s;l&&!z(l,c);)l=l.parent;if(!l)throw new Error(`no parent for <${a.id}> in <${s&&s.id}>`);return l}this.getOrdering=function(a,s){if(a.labelTarget||m(a,"bpmn:TextAnnotation"))return{parent:t.findRoot(s)||t.getRootElement(),index:-1};var c=r(a);c.containers&&(s=o(a,s,c.containers));var l=s.children.indexOf(a),p=lh(s.children,function(u){return!a.labelTarget&&u.labelTarget?!1:c.level<r(u).level});return p!==-1&&l!==-1&&l<p&&(p-=1),{index:p,parent:s}}}As.$inject=["eventBus","canvas"];M(As,Qr);const Wy={__init__:["bpmnOrderingProvider"],bpmnOrderingProvider:["type",As]};function gi(){}gi.prototype.get=function(){return this._data};gi.prototype.set=function(e){this._data=e};gi.prototype.clear=function(){var e=this._data;return delete this._data,e};gi.prototype.isEmpty=function(){return!this._data};const Ky={clipboard:["type",gi]};var Yy="drop-ok",bl="drop-not-ok",xl="attach-ok",El="new-parent",wl="create",qy=2e3;function Hd(e,t,n,i,r){function o(c,l,p,u,d){if(!l)return!1;c=U(c,function(x){var y=x.labelTarget;return!x.parent&&!(F(x)&&c.indexOf(y)!==-1)});var f=ie(c,function(x){return!ee(x)}),h=!1,g=!1,v=!1;Cl(c)&&(h=r.allowed("shape.attach",{position:p,shape:f,target:l})),h||(Cl(c)?v=r.allowed("shape.create",{position:p,shape:f,source:u,target:l}):v=r.allowed("elements.create",{elements:c,position:p,target:l}));var _=d.connectionTarget;return v||h?(f&&u&&(g=r.allowed("connection.create",{source:_===u?f:u,target:_===u?u:f,hints:{targetParent:l,targetAttach:h}})),{attach:h,connect:g}):v===null||h===null?null:!1}function a(c,l){[xl,Yy,bl,El].forEach(function(p){p===l?e.addMarker(c,p):e.removeMarker(c,p)})}n.on(["create.move","create.hover"],function(c){var l=c.context,p=l.elements,u=c.hover,d=l.source,f=l.hints||{};if(!u){l.canExecute=!1,l.target=null;return}Sl(c);var h={x:c.x,y:c.y},g=l.canExecute=u&&o(p,u,h,d,f);u&&g!==null&&(l.target=u,g&&g.attach?a(u,xl):a(u,g?El:bl))}),n.on(["create.end","create.out","create.cleanup"],function(c){var l=c.hover;l&&a(l,null)}),n.on("create.end",function(c){var l=c.context,p=l.source,u=l.shape,d=l.elements,f=l.target,h=l.canExecute,g=h&&h.attach,v=h&&h.connect,_=l.hints||{};if(h===!1||!f)return!1;Sl(c);var x={x:c.x,y:c.y};v?u=i.appendShape(p,u,x,f,{attach:g,connection:v===!0?{}:v,connectionTarget:_.connectionTarget}):(d=i.createElements(d,x,f,S({},_,{attach:g})),u=ie(d,function(y){return!ee(y)})),S(l,{elements:d,shape:u}),S(c,{elements:d,shape:u})});function s(){var c=t.context();c&&c.prefix===wl&&t.cancel()}n.on("create.init",function(){n.on("elements.changed",s),n.once(["create.cancel","create.end"],qy,function(){n.off("elements.changed",s)})}),this.start=function(c,l,p){V(l)||(l=[l]);var u=ie(l,function(h){return!ee(h)});if(u){p=S({elements:l,hints:{},shape:u},p||{}),w(l,function(h){G(h.x)||(h.x=0),G(h.y)||(h.y=0)});var d=U(l,function(h){return!h.hidden}),f=Ae(d);w(l,function(h){ee(h)&&(h.waypoints=He(h.waypoints,function(g){return{x:g.x-f.x-f.width/2,y:g.y-f.y-f.height/2}})),S(h,{x:h.x-f.x-f.width/2,y:h.y-f.y-f.height/2})}),t.init(c,wl,{cursor:"grabbing",autoActivate:!0,data:{shape:u,elements:l,context:p}})}}}Hd.$inject=["canvas","dragging","eventBus","modeling","rules"];function Sl(e){var t=e.context,n=t.createConstraints;n&&(n.left&&(e.x=Math.max(e.x,n.left)),n.right&&(e.x=Math.min(e.x,n.right)),n.top&&(e.y=Math.max(e.y,n.top)),n.bottom&&(e.y=Math.min(e.y,n.bottom)))}function Cl(e){return e&&e.length===1&&!ee(e[0])}var Xy=750;function zd(e,t,n,i,r){function o(a){var s=W("g");$(s,r.cls("djs-drag-group",["no-events"]));var c=W("g");return a.forEach(function(l){var p;l.hidden||(l.waypoints?(p=n._createContainer("connection",c),n.drawConnection(_n(p),l)):(p=n._createContainer("shape",c),n.drawShape(_n(p),l),Te(p,l.x,l.y)),i.addDragger(l,s,p))}),s}t.on("create.move",Xy,function(a){var s=a.hover,c=a.context,l=c.elements,p=c.dragGroup;p||(p=c.dragGroup=o(l));var u;s?(p.parentNode||(u=e.getActiveLayer(),X(u,p)),Te(p,a.x,a.y)):we(p)}),t.on("create.cleanup",function(a){var s=a.context,c=s.dragGroup;c&&we(c)})}zd.$inject=["canvas","eventBus","graphicsFactory","previewSupport","styles"];const eo={__depends__:[St,Ln,dt,it],__init__:["create","createPreview"],create:["type",Hd],createPreview:["type",zd]};function ks(e){var t=this;this._lastMoveEvent=null;function n(i){t._lastMoveEvent=i}e.on("canvas.init",function(i){var r=t._svg=i.svg;r.addEventListener("mousemove",n)}),e.on("canvas.destroy",function(){t._lastMouseEvent=null,t._svg.removeEventListener("mousemove",n)})}ks.$inject=["eventBus"];ks.prototype.getLastMoveEvent=function(){return this._lastMoveEvent||Zy(0,0)};function Zy(e,t){var n=document.createEvent("MouseEvent"),i=e,r=t,o=e,a=t;return n.initMouseEvent&&n.initMouseEvent("mousemove",!0,!0,window,0,i,r,o,a,!1,!1,!1,!1,0,null),n}const yi={__init__:["mouse"],mouse:["type",ks]};function rt(e,t,n,i,r,o,a,s){this._canvas=e,this._create=t,this._clipboard=n,this._elementFactory=i,this._eventBus=r,this._modeling=o,this._mouse=a,this._rules=s,r.on("copyPaste.copyElement",function(c){var l=c.descriptor,p=c.element,u=c.elements;l.priority=1,l.id=p.id;var d=ie(u,function(f){return f===p.parent});d&&(l.parent=p.parent.id),Jy(p)&&(l.priority=2,l.host=p.host.id),ee(p)&&(l.priority=3,l.source=p.source.id,l.target=p.target.id,l.waypoints=Qy(p)),F(p)&&(l.priority=4,l.labelTarget=p.labelTarget.id),w(["x","y","width","height"],function(f){G(p[f])&&(l[f]=p[f])}),l.hidden=p.hidden,l.collapsed=p.collapsed}),r.on("copyPaste.pasteElements",function(c){var l=c.hints;S(l,{createElementsBehavior:!1})})}rt.$inject=["canvas","create","clipboard","elementFactory","eventBus","modeling","mouse","rules"];rt.prototype.copy=function(e){var t,n;return V(e)||(e=e?[e]:[]),t=this._eventBus.fire("copyPaste.canCopyElements",{elements:e}),t===!1?n={}:n=this.createTree(V(t)?t:e),this._clipboard.set(n),this._eventBus.fire("copyPaste.elementsCopied",{elements:e,tree:n}),n};rt.prototype.paste=function(e){var t=this._clipboard.get();if(!this._clipboard.isEmpty()){var n=e&&e.hints||{};this._eventBus.fire("copyPaste.pasteElements",{hints:n});var i=this._createElements(t);if(e&&e.element&&e.point)return this._paste(i,e.element,e.point,n);this._create.start(this._mouse.getLastMoveEvent(),i,{hints:n||{}})}};rt.prototype._paste=function(e,t,n,i){w(e,function(o){G(o.x)||(o.x=0),G(o.y)||(o.y=0)});var r=Ae(e);return w(e,function(o){ee(o)&&(o.waypoints=He(o.waypoints,function(a){return{x:a.x-r.x-r.width/2,y:a.y-r.y-r.height/2}})),S(o,{x:o.x-r.x-r.width/2,y:o.y-r.y-r.height/2})}),this._modeling.createElements(e,n,t,S({},i))};rt.prototype._createElements=function(e){var t=this,n=this._eventBus,i={},r=[];return w(e,function(o,a){o=bt(o,"priority"),w(o,function(s){var c=S({},Et(s,["priority"]));i[s.parent]?c.parent=i[s.parent]:delete c.parent,n.fire("copyPaste.pasteElement",{cache:i,descriptor:c});var l;if(ee(c)){c.source=i[s.source],c.target=i[s.target],l=i[s.id]=t.createConnection(c),r.push(l);return}if(F(c)){c.labelTarget=i[c.labelTarget],l=i[s.id]=t.createLabel(c),r.push(l);return}c.host&&(c.host=i[c.host]),l=i[s.id]=t.createShape(c),r.push(l)})}),r};rt.prototype.createConnection=function(e){var t=this._elementFactory.createConnection(Et(e,["id"]));return t};rt.prototype.createLabel=function(e){var t=this._elementFactory.createLabel(Et(e,["id"]));return t};rt.prototype.createShape=function(e){var t=this._elementFactory.createShape(Et(e,["id"]));return t};rt.prototype.hasRelations=function(e,t){var n,i,r;return!(ee(e)&&(i=ie(t,yt({id:e.source.id})),r=ie(t,yt({id:e.target.id})),!i||!r)||F(e)&&(n=ie(t,yt({id:e.labelTarget.id})),!n))};rt.prototype.createTree=function(e){var t=this._rules,n=this,i={},r=[],o=Pr(e);function a(l,p){return t.allowed("element.copy",{element:l,elements:p})}function s(l,p){var u=ie(r,function(d){return l===d.element});if(!u){r.push({element:l,depth:p});return}u.depth<p&&(r=c(u,r),r.push({element:u.element,depth:p}))}function c(l,p){var u=p.indexOf(l);return u!==-1&&p.splice(u,1),p}return Nr(o,function(l,p,u){if(F(l))return;w(l.labels,function(h){s(h,u)});function d(h){h&&h.length&&w(h,function(g){w(g.labels,function(v){s(v,u)}),s(g,u)})}w([l.attachers,l.incoming,l.outgoing],d),s(l,u);var f=[];return l.children&&(f=l.children.slice()),n._eventBus.fire("copyPaste.createTree",{element:l,children:f}),f}),e=He(r,function(l){return l.element}),r=He(r,function(l){return l.descriptor={},n._eventBus.fire("copyPaste.copyElement",{descriptor:l.descriptor,element:l.element,elements:e}),l}),r=bt(r,function(l){return l.descriptor.priority}),e=He(r,function(l){return l.element}),w(r,function(l){var p=l.depth;if(!n.hasRelations(l.element,e)){Tl(l.element,e);return}if(!a(l.element,e)){Tl(l.element,e);return}i[p]||(i[p]=[]),i[p].push(l.descriptor)}),i};function Jy(e){return!!e.host}function Qy(e){return He(e.waypoints,function(t){return t=Rl(t),t.original&&(t.original=Rl(t.original)),t})}function Rl(e){return S({},e)}function Tl(e,t){var n=t.indexOf(e);return n===-1?t:t.splice(n,1)}const e_={__depends__:[Ky,eo,yi,dt],__init__:["copyPaste"],copyPaste:["type",rt]};function Ao(e,t,n){V(n)||(n=[n]),w(n,function(i){Wu(e[i])||(t[i]=e[i])})}var ko=750;function Fd(e,t,n){function i(c,l){var p=e.create(c.$type);return n.copyElement(c,p,null,l)}t.on("copyPaste.copyElement",ko,function(c){var l=c.descriptor,p=c.element,u=P(p);if(F(p))return l;var d=l.businessObject=i(u,!0),f=l.di=i(Z(p),!0);f.bpmnElement=d,Ao(d,l,"name"),Ao(f,l,"isExpanded"),u.default&&(l.default=u.default.id)});var r="-bpmn-js-refs";function o(c){return c[r]=c[r]||{}}function a(c,l){c[r]=l}function s(c,l,p){var u=P(c);return c.default&&(p[c.default]={element:u,property:"default"}),c.host&&(P(c).attachedToRef=P(l[c.host])),Et(p,Nt(p,function(d,f,h){var g=f.element,v=f.property;return h===c.id&&(g.set(v,u),d.push(c.id)),d},[]))}t.on("copyPaste.pasteElement",function(c){var l=c.cache,p=c.descriptor,u=p.businessObject,d=p.di;if(F(p)){p.businessObject=P(l[p.labelTarget]),p.di=Z(l[p.labelTarget]);return}u=p.businessObject=i(u),d=p.di=i(d),d.bpmnElement=u,Ao(p,u,["isExpanded","name"]),p.type=u.$type}),t.on("copyPaste.copyElement",ko,function(c){var l=c.descriptor,p=c.element;if(m(p,"bpmn:Participant")){var u=P(p);u.processRef&&(l.processRef=i(u.processRef,!0))}}),t.on("copyPaste.pasteElement",function(c){var l=c.descriptor,p=l.processRef;p&&(l.processRef=i(p))}),t.on("copyPaste.pasteElement",ko,function(c){var l=c.cache,p=c.descriptor;a(l,s(p,l,o(l)))})}Fd.$inject=["bpmnFactory","eventBus","moddleCopy"];const t_=["artifacts","dataInputAssociations","dataOutputAssociations","default","flowElements","lanes","incoming","outgoing","categoryValue"],n_=["errorRef","escalationRef","messageRef","signalRef","dataObjectRef"];function _i(e,t,n){this._bpmnFactory=t,this._eventBus=e,this._moddle=n,e.on("moddleCopy.canCopyProperties",i=>{const{propertyNames:r}=i;if(!(!r||!r.length))return bt(r,o=>o==="extensionElements")}),e.on("moddleCopy.canCopyProperty",i=>{const{parent:r,property:o,propertyName:a}=i,s=xt(r)&&r.$descriptor;if(a&&n_.includes(a))return o;if(a&&t_.includes(a)||a&&s&&!ie(s.properties,yt({name:a})))return!1}),e.on("moddleCopy.canSetCopiedProperty",i=>{const{property:r}=i;if(m(r,"bpmn:ExtensionElements")&&(!r.values||!r.values.length))return!1})}_i.$inject=["eventBus","bpmnFactory","moddle"];_i.prototype.copyElement=function(e,t,n,i=!1){n&&!V(n)&&(n=[n]),n=n||fa(e.$descriptor);const r=this._eventBus.fire("moddleCopy.canCopyProperties",{propertyNames:n,sourceElement:e,targetElement:t,clone:i});return r===!1||(V(r)&&(n=r),w(n,o=>{let a;kt(e,o)&&(a=e.get(o));const s=this.copyProperty(a,t,o,i);!je(s)||this._eventBus.fire("moddleCopy.canSetCopiedProperty",{parent:t,property:s,propertyName:o})===!1||t.set(o,s)})),t};_i.prototype.copyProperty=function(e,t,n,i=!1){let r=this._eventBus.fire("moddleCopy.canCopyProperty",{parent:t,property:e,propertyName:n,clone:i});if(r===!1)return;if(r)return xt(r)&&r.$type&&!r.$parent&&(r.$parent=t),r;const o=this._moddle.getPropertyDescriptor(t,n);if(!o.isReference)return o.isId?e&&this._copyId(e,t,i):V(e)?Nt(e,(a,s)=>{const c=this.copyProperty(s,t,n,i);return c?a.concat(c):a},[]):xt(e)&&e.$type?this._moddle.getElementDescriptor(e).isGeneric?void 0:(r=this._bpmnFactory.create(e.$type),r.$parent=t,r=this.copyElement(e,r,null,i),r):e};_i.prototype._copyId=function(e,t,n=!1){if(n)return e;if(!this._moddle.ids.assigned(e))return this._moddle.ids.claim(e,t),e};function fa(e,t){return Nt(e.properties,(n,i)=>t&&i.default?n:n.concat(i.name),[])}const Gd={__depends__:[e_],__init__:["bpmnCopyPaste","moddleCopy"],bpmnCopyPaste:["type",Fd],moddleCopy:["type",_i]};var Pl=Math.round;function Is(e,t){this._modeling=e,this._eventBus=t}Is.$inject=["modeling","eventBus"];Is.prototype.replaceElement=function(e,t,n){if(e.waypoints)return null;var i=this._modeling,r=this._eventBus;r.fire("replace.start",{element:e,attrs:t,hints:n});var o=t.width||e.width,a=t.height||e.height,s=t.x||e.x,c=t.y||e.y,l=Pl(s+o/2),p=Pl(c+a/2),u=i.replaceShape(e,S({},t,{x:l,y:p,width:o,height:a}),n);return r.fire("replace.end",{element:e,newElement:u,hints:n}),u};function Vd(e,t){t.on("replace.end",500,function(n){const{newElement:i,hints:r={}}=n;r.select!==!1&&e.select(i)})}Vd.$inject=["selection","eventBus"];const i_={__init__:["replace","replaceSelectionBehavior"],replaceSelectionBehavior:["type",Vd],replace:["type",Is]};function r_(e,t,n){V(n)||(n=[n]),w(n,function(i){Wu(e[i])||(t[i]=e[i])})}var o_=["cancelActivity","instantiate","eventGatewayType","triggeredByEvent","isInterrupting"];function a_(e,t){var n=e&&kt(e,"collapsed")?e.collapsed:!Y(e),i;return t&&(kt(t,"collapsed")||kt(t,"isExpanded"))?i=kt(t,"collapsed")?t.collapsed:!t.isExpanded:i=n,n!==i}function Ud(e,t,n,i,r,o){function a(s,c,l){l=l||{};var p=c.type,u=s.businessObject;if(Zi(u)&&(p==="bpmn:SubProcess"||p==="bpmn:AdHocSubProcess")&&a_(s,c))return i.toggleCollapse(s),s;var d=e.create(p),f={type:p,businessObject:d};f.di={},p==="bpmn:ExclusiveGateway"&&(f.di.isMarkerVisible=!0),r_(s.di,f.di,["fill","stroke","background-color","border-color","color"]);var h=fa(u.$descriptor),g=fa(d.$descriptor,!0),v=s_(h,g);S(d,ut(c,o_));var _=U(v,function(b){return b==="eventDefinitions"?Dl(s,c.eventDefinitionType):b==="loopCharacteristics"?!Pe(d):kt(d,b)||b==="processRef"&&c.isExpanded===!1||b==="triggeredByEvent"?!1:b==="isForCompensation"?!Pe(d):!0});if(d=n.copyElement(u,d,_),c.eventDefinitionType&&(Dl(d,c.eventDefinitionType)||(f.eventDefinitionType=c.eventDefinitionType,f.eventDefinitionAttrs=c.eventDefinitionAttrs)),m(u,"bpmn:Activity")){if(Zi(u))f.isExpanded=Y(s);else if(c&&kt(c,"isExpanded")){f.isExpanded=c.isExpanded;var x=t.getDefaultSize(d,{isExpanded:f.isExpanded});f.width=x.width,f.height=x.height,f.x=s.x-(f.width-s.width)/2,f.y=s.y-(f.height-s.height)/2}Y(s)&&!m(u,"bpmn:Task")&&f.isExpanded&&(f.width=s.width,f.height=s.height)}if(Zi(u)&&!Zi(d)&&(l.moveChildren=!1),m(u,"bpmn:Participant")){c.isExpanded===!0?d.processRef=e.create("bpmn:Process"):l.moveChildren=!1;var y=xe(s);Z(s).isHorizontal||(Z(f).isHorizontal=y),f.width=y?s.width:t.getDefaultSize(f).width,f.height=y?t.getDefaultSize(f).height:s.height}return o.allowed("shape.resize",{shape:d})||(f.height=t.getDefaultSize(f).height,f.width=t.getDefaultSize(f).width),d.name=u.name,z(u,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&z(d,["bpmn:ExclusiveGateway","bpmn:InclusiveGateway","bpmn:Activity"])&&(d.default=u.default),c.host&&!m(u,"bpmn:BoundaryEvent")&&m(d,"bpmn:BoundaryEvent")&&(f.host=c.host),(f.type==="bpmn:DataStoreReference"||f.type==="bpmn:DataObjectReference")&&(f.x=s.x+(s.width-f.width)/2),r.replaceElement(s,f,{...l,targetElement:c})}this.replaceElement=a}Ud.$inject=["bpmnFactory","elementFactory","moddleCopy","modeling","replace","rules"];function Zi(e){return m(e,"bpmn:SubProcess")}function Dl(e,t){var n=P(e);return t&&n.get("eventDefinitions").some(function(i){return m(i,t)})}function s_(e,t){return e.filter(function(n){return t.includes(n)})}const Wd={__depends__:[Gd,i_,it],bpmnReplace:["type",Ud]};var c_=250;function on(e){this._eventBus=e,this._tools=[],this._active=null}on.$inject=["eventBus"];on.prototype.registerTool=function(e,t){var n=this._tools;if(!t)throw new Error(`A tool has to be registered with it's "events"`);n.push(e),this.bindEvents(e,t)};on.prototype.isActive=function(e){return e&&this._active===e};on.prototype.length=function(e){return this._tools.length};on.prototype.setActive=function(e){var t=this._eventBus;this._active!==e&&(this._active=e,t.fire("tool-manager.update",{tool:e}))};on.prototype.bindEvents=function(e,t){var n=this._eventBus,i=[];n.on(t.tool+".init",function(r){var o=r.context;if(!o.reactivate&&this.isActive(e)){this.setActive(null);return}this.setActive(e)},this),w(t,function(r){i.push(r+".ended"),i.push(r+".canceled")}),n.on(i,c_,function(r){this._active&&(l_(r)||this.setActive(null))},this)};function l_(e){var t=e.originalEvent&&e.originalEvent.target;return t&&li(t,'.group[data-group="tools"]')}const to={__depends__:[St],__init__:["toolManager"],toolManager:["type",on]};function u_(e,t){if(e==="x"){if(t>0)return"e";if(t<0)return"w"}if(e==="y"){if(t>0)return"s";if(t<0)return"n"}return null}function p_(e,t){var n=[];return w(e.concat(t),function(i){var r=i.incoming,o=i.outgoing;w(r.concat(o),function(a){var s=a.source,c=a.target;(Wn(e,s)||Wn(e,c)||Wn(t,s)||Wn(t,c))&&(Wn(n,a)||n.push(a))})}),n}function Wn(e,t){return e.indexOf(t)!==-1}function d_(e,t,n){var i=e.x,r=e.y,o=e.width,a=e.height,s=n.x,c=n.y;switch(t){case"n":return{x:i,y:r+c,width:o,height:a-c};case"s":return{x:i,y:r,width:o,height:a+c};case"w":return{x:i+s,y:r,width:o-s,height:a};case"e":return{x:i,y:r,width:o+s,height:a};default:throw new Error("unknown direction: "+t)}}var Io=Math.abs,f_=Math.round,vt={x:"width",y:"height"},Kd="crosshair",Mt={n:"top",w:"left",s:"bottom",e:"right"},h_=1500,Ji={n:"s",w:"e",s:"n",e:"w"},Qi=20;function qe(e,t,n,i,r,o,a){this._canvas=e,this._dragging=t,this._eventBus=n,this._modeling=i,this._rules=r,this._toolManager=o,this._mouse=a;var s=this;o.registerTool("space",{tool:"spaceTool.selection",dragging:"spaceTool"}),n.on("spaceTool.selection.end",function(c){n.once("spaceTool.selection.ended",function(){s.activateMakeSpace(c.originalEvent)})}),n.on("spaceTool.move",h_,function(c){var l=c.context,p=l.initialized;p||(p=l.initialized=s.init(c,l)),p&&Al(c)}),n.on("spaceTool.end",function(c){var l=c.context,p=l.axis,u=l.direction,d=l.movingShapes,f=l.resizingShapes,h=l.start;if(l.initialized){Al(c);var g={x:0,y:0};g[p]=f_(c["d"+p]),s.makeSpace(d,f,g,u,h),n.once("spaceTool.ended",function(v){s.activateSelection(v.originalEvent,!0,!0)})}})}qe.$inject=["canvas","dragging","eventBus","modeling","rules","toolManager","mouse"];qe.prototype.activateSelection=function(e,t,n){this._dragging.init(e,"spaceTool.selection",{autoActivate:t,cursor:Kd,data:{context:{reactivate:n}},trapClick:!1})};qe.prototype.activateMakeSpace=function(e){this._dragging.init(e,"spaceTool",{autoActivate:!0,cursor:Kd,data:{context:{}}})};qe.prototype.makeSpace=function(e,t,n,i,r){return this._modeling.createSpace(e,t,n,i,r)};qe.prototype.init=function(e,t){var n=Io(e.dx)>Io(e.dy)?"x":"y",i=e["d"+n],r=e[n]-i;if(Io(i)<5)return!1;i<0&&(i*=-1),ni(e)&&(i*=-1);var o=u_(n,i),a=this._canvas.getRootElement();!Wo(e)&&e.hover&&(a=e.hover);var s=[...pi(a,!0),...a.attachers||[]],c=this.calculateAdjustments(s,n,i,r),l=this._eventBus.fire("spaceTool.getMinDimensions",{axis:n,direction:o,shapes:c.resizingShapes,start:r}),p=v_(c,n,o,r,l);return S(t,c,{axis:n,direction:o,spaceToolConstraints:p,start:r}),Or("resize-"+(n==="x"?"ew":"ns")),!0};qe.prototype.calculateAdjustments=function(e,t,n,i){var r=this._rules,o=[],a=[],s=[],c=[];function l(d){o.includes(d)||o.push(d);var f=d.label;f&&!o.includes(f)&&o.push(f)}function p(d){a.includes(d)||a.push(d)}w(e,function(d){if(!(!d.parent||F(d))){if(ee(d)){c.push(d);return}var f=d[t],h=f+d[vt[t]];if(m_(d)&&(n>0&&L(d)[t]>i||n<0&&L(d)[t]<i)){s.push(d);return}if(n>0&&f>i||n<0&&h<i){l(d);return}if(f<i&&h>i&&r.allowed("shape.resize",{shape:d})){p(d);return}}}),w(o,function(d){var f=d.attachers;f&&w(f,function(h){l(h)})});var u=o.concat(a);return w(s,function(d){var f=d.host;Qt(u,f)&&l(d)}),u=o.concat(a),w(c,function(d){var f=d.source,h=d.target,g=d.label;Qt(u,f)&&Qt(u,h)&&g&&l(g)}),{movingShapes:o,resizingShapes:a}};qe.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};qe.prototype.isActive=function(){var e=this._dragging.context();return e?/^spaceTool/.test(e.prefix):!1};function Ml(e){return{top:e.top-Qi,right:e.right+Qi,bottom:e.bottom+Qi,left:e.left-Qi}}function Al(e){var t=e.context,n=t.spaceToolConstraints;if(n){var i,r;G(n.left)&&(i=Math.max(e.x,n.left),e.dx=e.dx+i-e.x,e.x=i),G(n.right)&&(i=Math.min(e.x,n.right),e.dx=e.dx+i-e.x,e.x=i),G(n.top)&&(r=Math.max(e.y,n.top),e.dy=e.dy+r-e.y,e.y=r),G(n.bottom)&&(r=Math.min(e.y,n.bottom),e.dy=e.dy+r-e.y,e.y=r)}}function v_(e,t,n,i,r){var o=e.movingShapes,a=e.resizingShapes;if(a.length){var s={},c,l;return w(a,function(p){var u=p.attachers,d=p.children,f=k(p),h=U(d,function(j){return!ee(j)&&!F(j)&&!Qt(o,j)&&!Qt(a,j)}),g=U(d,function(j){return!ee(j)&&!F(j)&&Qt(o,j)}),v,_,x,y=[],b=[],E,C,D,A;h.length&&(_=Ml(k(Ae(h))),v=i-f[Mt[n]]+_[Mt[n]],n==="n"?s.bottom=l=G(l)?Math.min(l,v):v:n==="w"?s.right=l=G(l)?Math.min(l,v):v:n==="s"?s.top=c=G(c)?Math.max(c,v):v:n==="e"&&(s.left=c=G(c)?Math.max(c,v):v)),g.length&&(x=Ml(k(Ae(g))),v=i-x[Mt[Ji[n]]]+f[Mt[Ji[n]]],n==="n"?s.bottom=l=G(l)?Math.min(l,v):v:n==="w"?s.right=l=G(l)?Math.min(l,v):v:n==="s"?s.top=c=G(c)?Math.max(c,v):v:n==="e"&&(s.left=c=G(c)?Math.max(c,v):v)),u&&u.length&&(u.forEach(function(j){Qt(o,j)?y.push(j):b.push(j)}),y.length&&(E=k(Ae(y.map(L))),C=f[Mt[Ji[n]]]-(E[Mt[Ji[n]]]-i)),b.length&&(D=k(Ae(b.map(L))),A=D[Mt[n]]-(f[Mt[n]]-i)),n==="n"?(v=Math.min(C||1/0,A||1/0),s.bottom=l=G(l)?Math.min(l,v):v):n==="w"?(v=Math.min(C||1/0,A||1/0),s.right=l=G(l)?Math.min(l,v):v):n==="s"?(v=Math.max(C||-1/0,A||-1/0),s.top=c=G(c)?Math.max(c,v):v):n==="e"&&(v=Math.max(C||-1/0,A||-1/0),s.left=c=G(c)?Math.max(c,v):v));var I=r&&r[p.id];I&&(n==="n"?(v=i+p[vt[t]]-I[vt[t]],s.bottom=l=G(l)?Math.min(l,v):v):n==="w"?(v=i+p[vt[t]]-I[vt[t]],s.right=l=G(l)?Math.min(l,v):v):n==="s"?(v=i-p[vt[t]]+I[vt[t]],s.top=c=G(c)?Math.max(c,v):v):n==="e"&&(v=i-p[vt[t]]+I[vt[t]],s.left=c=G(c)?Math.max(c,v):v))}),s}}function Qt(e,t){return e.indexOf(t)!==-1}function m_(e){return!!e.host}var No="djs-dragging",kl="djs-resizing",g_=250,er=Math.max;function Yd(e,t,n,i,r){function o(a,s){w(a,function(c){r.addDragger(c,s),n.addMarker(c,No)})}e.on("spaceTool.selection.start",function(a){var s=n.getLayer("space"),c=a.context,l={x:"M 0,-10000 L 0,10000",y:"M -10000,0 L 10000,0"},p=W("g");$(p,i.cls("djs-crosshair-group",["no-events"])),X(s,p);var u=W("path");$(u,"d",l.x),te(u).add("djs-crosshair"),X(p,u);var d=W("path");$(d,"d",l.y),te(d).add("djs-crosshair"),X(p,d),c.crosshairGroup=p}),e.on("spaceTool.selection.move",function(a){var s=a.context.crosshairGroup;Te(s,a.x,a.y)}),e.on("spaceTool.selection.cleanup",function(a){var s=a.context,c=s.crosshairGroup;c&&we(c)}),e.on("spaceTool.move",g_,function(a){var s=a.context,c=s.line,l=s.axis,p=s.movingShapes,u=s.resizingShapes;if(s.initialized){if(!s.dragGroup){var d=n.getLayer("space");c=W("path"),$(c,"d","M0,0 L0,0"),te(c).add("djs-crosshair"),X(d,c),s.line=c;var f=W("g");$(f,i.cls("djs-drag-group",["no-events"])),X(n.getActiveLayer(),f),o(p,f);var h=s.movingConnections=t.filter(function(b){var E=!1;w(p,function(I){w(I.outgoing,function(j){b===j&&(E=!0)})});var C=!1;w(p,function(I){w(I.incoming,function(j){b===j&&(C=!0)})});var D=!1;w(u,function(I){w(I.outgoing,function(j){b===j&&(D=!0)})});var A=!1;return w(u,function(I){w(I.incoming,function(j){b===j&&(A=!0)})}),ee(b)&&(E||D)&&(C||A)});o(h,f),s.dragGroup=f}if(!s.frameGroup){var g=W("g");$(g,i.cls("djs-frame-group",["no-events"])),X(n.getActiveLayer(),g);var v=[];w(u,function(b){var E=r.addFrame(b,g),C=E.getBBox();v.push({element:E,initialBounds:C}),n.addMarker(b,kl)}),s.frameGroup=g,s.frames=v}var _={x:"M"+a.x+", -10000 L"+a.x+", 10000",y:"M -10000, "+a.y+" L 10000, "+a.y};$(c,{d:_[l]});var x={x:"y",y:"x"},y={x:a.dx,y:a.dy};y[x[s.axis]]=0,Te(s.dragGroup,y.x,y.y),w(s.frames,function(b){var E=b.element,C=b.initialBounds,D,A;s.direction==="e"?$(E,{width:er(C.width+y.x,5)}):(D=er(C.width-y.x,5),$(E,{width:D,x:C.x+C.width-D})),s.direction==="s"?$(E,{height:er(C.height+y.y,5)}):(A=er(C.height-y.y,5),$(E,{height:A,y:C.y+C.height-A}))})}}),e.on("spaceTool.cleanup",function(a){var s=a.context,c=s.movingShapes,l=s.movingConnections,p=s.resizingShapes,u=s.line,d=s.dragGroup,f=s.frameGroup;w(c,function(h){n.removeMarker(h,No)}),w(l,function(h){n.removeMarker(h,No)}),d&&(we(u),we(d)),w(p,function(h){n.removeMarker(h,kl)}),f&&we(f)})}Yd.$inject=["eventBus","elementRegistry","canvas","styles","previewSupport"];const y_={__init__:["spaceToolPreview"],__depends__:[St,dt,to,Ln,yi],spaceTool:["type",qe],spaceToolPreview:["type",Yd]};function no(e,t){e.invoke(qe,this),this._canvas=t}no.$inject=["injector","canvas"];M(no,qe);no.prototype.calculateAdjustments=function(e,t,n,i){var r=this._canvas.getRootElement(),o=e[0]===r?null:e[0],a=[];o&&(a=Mr(Ku(r.children.filter(l=>m(l,"bpmn:Artifact")),Ae(o))));const s=[...e,...a];var c=qe.prototype.calculateAdjustments.call(this,s,t,n,i);return c.resizingShapes=c.resizingShapes.filter(function(l){return!(m(l,"bpmn:TextAnnotation")||__(l)&&(t==="y"&&xe(l)||t==="x"&&!xe(l)))}),c};function __(e){return m(e,"bpmn:Participant")&&!P(e).processRef}const qd={__depends__:[y_],spaceTool:["type",no]};function ae(e,t){this._handlerMap={},this._stack=[],this._stackIdx=-1,this._currentExecution={actions:[],dirty:[],trigger:null},this._injector=t,this._eventBus=e,this._uid=1,e.on(["diagram.destroy","diagram.clear"],function(){this.clear(!1)},this)}ae.$inject=["eventBus","injector"];ae.prototype.execute=function(e,t){if(!e)throw new Error("command required");this._currentExecution.trigger="execute";const n={command:e,context:t};this._pushAction(n),this._internalExecute(n),this._popAction()};ae.prototype.canExecute=function(e,t){const n={command:e,context:t},i=this._getHandler(e);let r=this._fire(e,"canExecute",n);if(r===void 0){if(!i)return!1;i.canExecute&&(r=i.canExecute(t))}return r};ae.prototype.clear=function(e){this._stack.length=0,this._stackIdx=-1,e!==!1&&this._fire("changed",{trigger:"clear"})};ae.prototype.undo=function(){let e=this._getUndoAction(),t;if(e){for(this._currentExecution.trigger="undo",this._pushAction(e);e&&(this._internalUndo(e),t=this._getUndoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};ae.prototype.redo=function(){let e=this._getRedoAction(),t;if(e){for(this._currentExecution.trigger="redo",this._pushAction(e);e&&(this._internalExecute(e,!0),t=this._getRedoAction(),!(!t||t.id!==e.id));)e=t;this._popAction()}};ae.prototype.register=function(e,t){this._setHandler(e,t)};ae.prototype.registerHandler=function(e,t){if(!e||!t)throw new Error("command and handlerCls must be defined");const n=this._injector.instantiate(t);this.register(e,n)};ae.prototype.canUndo=function(){return!!this._getUndoAction()};ae.prototype.canRedo=function(){return!!this._getRedoAction()};ae.prototype._getRedoAction=function(){return this._stack[this._stackIdx+1]};ae.prototype._getUndoAction=function(){return this._stack[this._stackIdx]};ae.prototype._internalUndo=function(e){const t=e.command,n=e.context,i=this._getHandler(t);this._atomicDo(()=>{this._fire(t,"revert",e),i.revert&&this._markDirty(i.revert(n)),this._revertedAction(e),this._fire(t,"reverted",e)})};ae.prototype._fire=function(e,t,n){arguments.length<3&&(n=t,t=null);const i=t?[e+"."+t,t]:[e];let r;n=this._eventBus.createEvent(n);for(const o of i)if(r=this._eventBus.fire("commandStack."+o,n),n.cancelBubble)break;return r};ae.prototype._createId=function(){return this._uid++};ae.prototype._atomicDo=function(e){const t=this._currentExecution;t.atomic=!0;try{e()}finally{t.atomic=!1}};ae.prototype._internalExecute=function(e,t){const n=e.command,i=e.context,r=this._getHandler(n);if(!r)throw new Error("no command handler registered for <"+n+">");this._pushAction(e),t||(this._fire(n,"preExecute",e),r.preExecute&&r.preExecute(i),this._fire(n,"preExecuted",e)),this._atomicDo(()=>{this._fire(n,"execute",e),r.execute&&this._markDirty(r.execute(i)),this._executedAction(e,t),this._fire(n,"executed",e)}),t||(this._fire(n,"postExecute",e),r.postExecute&&r.postExecute(i),this._fire(n,"postExecuted",e)),this._popAction()};ae.prototype._pushAction=function(e){const t=this._currentExecution,n=t.actions,i=n[0];if(t.atomic)throw new Error("illegal invocation in <execute> or <revert> phase (action: "+e.command+")");e.id||(e.id=i&&i.id||this._createId()),n.push(e)};ae.prototype._popAction=function(){const e=this._currentExecution,t=e.trigger,n=e.actions,i=e.dirty;n.pop(),n.length||(this._eventBus.fire("elements.changed",{elements:uh("id",i.reverse())}),i.length=0,this._fire("changed",{trigger:t}),e.trigger=null)};ae.prototype._markDirty=function(e){const t=this._currentExecution;e&&(e=V(e)?e:[e],t.dirty=t.dirty.concat(e))};ae.prototype._executedAction=function(e,t){const n=++this._stackIdx;t||this._stack.splice(n,this._stack.length,e)};ae.prototype._revertedAction=function(e){this._stackIdx--};ae.prototype._getHandler=function(e){return this._handlerMap[e]};ae.prototype._setHandler=function(e,t){if(!e||!t)throw new Error("command and handler required");if(this._handlerMap[e])throw new Error("overriding handler for command <"+e+">");this._handlerMap[e]=t};const b_={commandStack:["type",ae]};function It(e,t){if(typeof t!="function")throw new Error("removeFn iterator must be a function");if(e){for(var n;n=e[0];)t(n);return e}}var x_=250,Il=1400;function Ns(e,t,n){R.call(this,t);var i=e.get("movePreview",!1);t.on("shape.move.start",Il,function(r){var o=r.context,a=o.shapes,s=o.validatedShapes;o.shapes=Nl(a),o.validatedShapes=Nl(s)}),i&&t.on("shape.move.start",x_,function(r){var o=r.context,a=o.shapes,s=[];w(a,function(c){w(c.labels,function(l){!l.hidden&&o.shapes.indexOf(l)===-1&&s.push(l),c.labelTarget&&s.push(c)})}),w(s,function(c){i.makeDraggable(o,c,!0)})}),this.preExecuted("elements.move",Il,function(r){var o=r.context,a=o.closure,s=a.enclosedElements,c=[];w(s,function(l){w(l.labels,function(p){s[p.id]||c.push(p)})}),a.addAll(c)}),this.preExecute(["connection.delete","shape.delete"],function(r){var o=r.context,a=o.connection||o.shape;It(a.labels,function(s){n.removeShape(s,{nested:!0})})}),this.execute("shape.delete",function(r){var o=r.context,a=o.shape,s=a.labelTarget;s&&(o.labelTargetIndex=Ca(s.labels,a),o.labelTarget=s,a.labelTarget=null)}),this.revert("shape.delete",function(r){var o=r.context,a=o.shape,s=o.labelTarget,c=o.labelTargetIndex;s&&(ye(s.labels,a,c),a.labelTarget=s)})}M(Ns,R);Ns.$inject=["injector","eventBus","modeling"];function Nl(e){return U(e,function(t){return e.indexOf(t.labelTarget)===-1})}const E_={__init__:["labelSupport"],labelSupport:["type",Ns]};var w_=251,Ll=1401,Ol="attach-ok";function Ls(e,t,n,i,r){R.call(this,t);var o=e.get("movePreview",!1);t.on("shape.move.start",Ll,function(a){var s=a.context,c=s.shapes,l=s.validatedShapes;s.shapes=S_(c),s.validatedShapes=C_(l)}),o&&t.on("shape.move.start",w_,function(a){var s=a.context,c=s.shapes,l=ha(c);w(l,function(p){o.makeDraggable(s,p,!0),w(p.labels,function(u){o.makeDraggable(s,u,!0)})})}),o&&t.on("shape.move.start",function(a){var s=a.context,c=s.shapes;if(c.length===1){var l=c[0],p=l.host;p&&(n.addMarker(p,Ol),t.once(["shape.move.out","shape.move.cleanup"],function(){n.removeMarker(p,Ol)}))}}),this.preExecuted("elements.move",Ll,function(a){var s=a.context,c=s.closure,l=s.shapes,p=ha(l);w(p,function(u){c.add(u,c.topLevel[u.host.id])})}),this.postExecuted("elements.move",function(a){var s=a.context,c=s.shapes,l=s.newHost,p;l&&c.length!==1||(l?p=c:p=U(c,function(u){var d=u.host;return R_(u)&&!T_(c,d)}),w(p,function(u){r.updateAttachment(u,l)}))}),this.postExecuted("elements.move",function(a){var s=a.context.shapes;w(s,function(c){w(c.attachers,function(l){w(l.outgoing.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)}),w(l.incoming.slice(),function(p){var u=i.allowed("connection.reconnect",{connection:p,source:p.source,target:p.target});u||r.removeConnection(p)})})})}),this.postExecute("shape.create",function(a){var s=a.context,c=s.shape,l=s.host;l&&r.updateAttachment(c,l)}),this.postExecute("shape.replace",function(a){var s=a.context,c=s.oldShape,l=s.newShape;It(c.attachers,function(p){var u=i.allowed("elements.move",{target:l,shapes:[p]});u==="attach"?r.updateAttachment(p,l):r.removeShape(p)}),l.attachers.length&&w(l.attachers,function(p){var u=pl(p,c,l);r.moveShape(p,u,p.parent)})}),this.postExecute("shape.resize",function(a){var s=a.context,c=s.shape,l=s.oldBounds,p=s.newBounds,u=c.attachers,d=s.hints||{};d.attachSupport!==!1&&w(u,function(f){var h=pl(f,l,p);r.moveShape(f,h,f.parent),w(f.labels,function(g){r.moveShape(g,h,g.parent)})})}),this.preExecute("shape.delete",function(a){var s=a.context.shape;It(s.attachers,function(c){r.removeShape(c)}),s.host&&r.updateAttachment(s,null)})}M(Ls,R);Ls.$inject=["injector","eventBus","canvas","rules","modeling"];function ha(e){return xa(He(e,function(t){return t.attachers||[]}))}function S_(e){var t=ha(e);return ph("id",e,t)}function C_(e){var t=Ar(e,"id");return U(e,function(n){for(;n;){if(n.host&&t[n.host.id])return!1;n=n.parent}return!0})}function R_(e){return!!e.host}function T_(e,t){return e.indexOf(t)!==-1}const P_={__depends__:[dt],__init__:["attachSupport"],attachSupport:["type",Ls]};function Xe(e){this._model=e}Xe.$inject=["moddle"];Xe.prototype._needsId=function(e){return z(e,["bpmn:RootElement","bpmn:FlowElement","bpmn:MessageFlow","bpmn:DataAssociation","bpmn:Artifact","bpmn:Participant","bpmn:Lane","bpmn:LaneSet","bpmn:Process","bpmn:Collaboration","bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane","bpmn:Property","bpmn:CategoryValue"])};Xe.prototype._ensureId=function(e){if(e.id){this._model.ids.claim(e.id,e);return}var t;m(e,"bpmn:Activity")?t="Activity":m(e,"bpmn:Event")?t="Event":m(e,"bpmn:Gateway")?t="Gateway":z(e,["bpmn:SequenceFlow","bpmn:MessageFlow"])?t="Flow":t=(e.$type||"").replace(/^[^:]*:/g,""),t+="_",!e.id&&this._needsId(e)&&(e.id=this._model.ids.nextPrefixed(t,e))};Xe.prototype.create=function(e,t){var n=this._model.create(e,t||{});return this._ensureId(n),n};Xe.prototype.createDiLabel=function(){return this.create("bpmndi:BPMNLabel",{bounds:this.createDiBounds()})};Xe.prototype.createDiShape=function(e,t){return this.create("bpmndi:BPMNShape",S({bpmnElement:e,bounds:this.createDiBounds()},t))};Xe.prototype.createDiBounds=function(e){return this.create("dc:Bounds",e)};Xe.prototype.createDiWaypoints=function(e){var t=this;return He(e,function(n){return t.createDiWaypoint(n)})};Xe.prototype.createDiWaypoint=function(e){return this.create("dc:Point",ut(e,["x","y"]))};Xe.prototype.createDiEdge=function(e,t){return this.create("bpmndi:BPMNEdge",S({bpmnElement:e,waypoint:this.createDiWaypoints([])},t))};Xe.prototype.createDiPlane=function(e,t){return this.create("bpmndi:BPMNPlane",S({bpmnElement:e},t))};function Oe(e,t,n){R.call(this,e),this._bpmnFactory=t;var i=this;function r(f){var h=f.context,g=h.hints||{},v;!h.cropped&&g.createElementsBehavior!==!1&&(v=h.connection,v.waypoints=n.getCroppedWaypoints(v),h.cropped=!0)}this.executed(["connection.layout","connection.create"],r),this.reverted(["connection.layout"],function(f){delete f.context.cropped});function o(f){var h=f.context;i.updateParent(h.shape||h.connection,h.oldParent)}function a(f){var h=f.context,g=h.shape||h.connection,v=h.parent||h.newParent;i.updateParent(g,v)}this.executed(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Le(o)),this.reverted(["shape.move","shape.create","shape.delete","connection.create","connection.move","connection.delete"],Le(a));function s(f){var h=f.context,g=h.oldRoot,v=g.children;w(v,function(_){m(_,"bpmn:BaseElement")&&i.updateParent(_)})}this.executed(["canvas.updateRoot"],s),this.reverted(["canvas.updateRoot"],s);function c(f){var h=f.context.shape;m(h,"bpmn:BaseElement")&&i.updateBounds(h)}this.executed(["shape.move","shape.create","shape.resize"],Le(function(f){f.context.shape.type!=="label"&&c(f)})),this.reverted(["shape.move","shape.create","shape.resize"],Le(function(f){f.context.shape.type!=="label"&&c(f)})),e.on("shape.changed",function(f){f.element.type==="label"&&c({context:{shape:f.element}})});function l(f){i.updateConnection(f.context)}this.executed(["connection.create","connection.move","connection.delete","connection.reconnect"],Le(l)),this.reverted(["connection.create","connection.move","connection.delete","connection.reconnect"],Le(l));function p(f){i.updateConnectionWaypoints(f.context.connection)}this.executed(["connection.layout","connection.move","connection.updateWaypoints"],Le(p)),this.reverted(["connection.layout","connection.move","connection.updateWaypoints"],Le(p)),this.executed("connection.reconnect",Le(function(f){var h=f.context,g=h.connection,v=h.oldSource,_=h.newSource,x=P(g),y=P(v),b=P(_);x.conditionExpression&&!z(b,["bpmn:Activity","bpmn:ExclusiveGateway","bpmn:InclusiveGateway"])&&(h.oldConditionExpression=x.conditionExpression,delete x.conditionExpression),v!==_&&y.default===x&&(h.oldDefault=y.default,delete y.default)})),this.reverted("connection.reconnect",Le(function(f){var h=f.context,g=h.connection,v=h.oldSource,_=h.newSource,x=P(g),y=P(v),b=P(_);h.oldConditionExpression&&(x.conditionExpression=h.oldConditionExpression),h.oldDefault&&(y.default=h.oldDefault,delete b.default)}));function u(f){i.updateAttachment(f.context)}this.executed(["element.updateAttachment"],Le(u)),this.reverted(["element.updateAttachment"],Le(u)),this.executed("element.updateLabel",Le(d)),this.reverted("element.updateLabel",Le(d));function d(f){const{element:h}=f.context,g=rn(h),v=Z(h),_=v&&v.get("label");En(h)||lr(h)||(g&&!_?v.set("label",t.create("bpmndi:BPMNLabel")):!g&&_&&v.set("label",void 0))}}M(Oe,R);Oe.$inject=["eventBus","bpmnFactory","connectionDocking"];Oe.prototype.updateAttachment=function(e){var t=e.shape,n=t.businessObject,i=t.host;n.attachedToRef=i&&i.businessObject};Oe.prototype.updateParent=function(e,t){if(!F(e)&&!(m(e,"bpmn:DataStoreReference")&&e.parent&&m(e.parent,"bpmn:Collaboration"))){var n=e.parent,i=e.businessObject,r=Z(e),o=n&&n.businessObject,a=Z(n);m(e,"bpmn:FlowNode")&&this.updateFlowNodeRefs(i,o,t&&t.businessObject),m(e,"bpmn:DataOutputAssociation")&&(e.source?o=e.source.businessObject:o=null),m(e,"bpmn:DataInputAssociation")&&(e.target?o=e.target.businessObject:o=null),this.updateSemanticParent(i,o),m(e,"bpmn:DataObjectReference")&&i.dataObjectRef&&this.updateSemanticParent(i.dataObjectRef,o),this.updateDiParent(r,a)}};Oe.prototype.updateBounds=function(e){var t=Z(e),n=M_(e);if(n){var i=nt(n,t.get("bounds"));S(n,{x:e.x+i.x,y:e.y+i.y})}var r=F(e)?this._getLabel(t):t,o=r.bounds;o||(o=this._bpmnFactory.createDiBounds(),r.set("bounds",o)),S(o,{x:e.x,y:e.y,width:e.width,height:e.height})};Oe.prototype.updateFlowNodeRefs=function(e,t,n){if(n!==t){var i,r;m(n,"bpmn:Lane")&&(i=n.get("flowNodeRef"),me(i,e)),m(t,"bpmn:Lane")&&(r=t.get("flowNodeRef"),ye(r,e))}};Oe.prototype.updateDiConnection=function(e,t,n){var i=Z(e),r=Z(t),o=Z(n);i.sourceElement&&i.sourceElement.bpmnElement!==P(t)&&(i.sourceElement=t&&r),i.targetElement&&i.targetElement.bpmnElement!==P(n)&&(i.targetElement=n&&o)};Oe.prototype.updateDiParent=function(e,t){if(t&&!m(t,"bpmndi:BPMNPlane")&&(t=t.$parent),e.$parent!==t){var n=(t||e.$parent).get("planeElement");t?(n.push(e),e.$parent=t):(me(n,e),e.$parent=null)}};function D_(e){for(;e&&!m(e,"bpmn:Definitions");)e=e.$parent;return e}Oe.prototype.getLaneSet=function(e){var t,n;return m(e,"bpmn:Lane")?(t=e.childLaneSet,t||(t=this._bpmnFactory.create("bpmn:LaneSet"),e.childLaneSet=t,t.$parent=e),t):(m(e,"bpmn:Participant")&&(e=e.processRef),n=e.get("laneSets"),t=n[0],t||(t=this._bpmnFactory.create("bpmn:LaneSet"),t.$parent=e,n.push(t)),t)};Oe.prototype.updateSemanticParent=function(e,t,n){var i;if(e.$parent!==t&&!((m(e,"bpmn:DataInput")||m(e,"bpmn:DataOutput"))&&(m(t,"bpmn:Participant")&&"processRef"in t&&(t=t.processRef),"ioSpecification"in t&&t.ioSpecification===e.$parent))){if(m(e,"bpmn:Lane"))t&&(t=this.getLaneSet(t)),i="lanes";else if(m(e,"bpmn:FlowElement")){if(t){if(m(t,"bpmn:Participant"))t=t.processRef;else if(m(t,"bpmn:Lane"))do t=t.$parent.$parent;while(m(t,"bpmn:Lane"))}i="flowElements"}else if(m(e,"bpmn:Artifact")){for(;t&&!m(t,"bpmn:Process")&&!m(t,"bpmn:SubProcess")&&!m(t,"bpmn:Collaboration");)if(m(t,"bpmn:Participant")){t=t.processRef;break}else t=t.$parent;i="artifacts"}else if(m(e,"bpmn:MessageFlow"))i="messageFlows";else if(m(e,"bpmn:Participant")){i="participants";var r=e.processRef,o;r&&(o=D_(e.$parent||t),e.$parent&&(me(o.get("rootElements"),r),r.$parent=null),t&&(ye(o.get("rootElements"),r),r.$parent=o))}else m(e,"bpmn:DataOutputAssociation")?i="dataOutputAssociations":m(e,"bpmn:DataInputAssociation")&&(i="dataInputAssociations");if(!i)throw new Error(`no parent for <${e.id}> in <${t.id}>`);var a;if(e.$parent&&(a=e.$parent.get(i),me(a,e)),t?(a=t.get(i),a.push(e),e.$parent=t):e.$parent=null,n){var s=n.get(i);me(a,e),t&&(s||(s=[],t.set(i,s)),s.push(e))}}};Oe.prototype.updateConnectionWaypoints=function(e){var t=Z(e);t.set("waypoint",this._bpmnFactory.createDiWaypoints(e.waypoints))};Oe.prototype.updateConnection=function(e){var t=e.connection,n=P(t),i=t.source,r=P(i),o=t.target,a=P(t.target),s;if(m(n,"bpmn:DataAssociation"))m(n,"bpmn:DataInputAssociation")?(n.get("sourceRef")[0]=r,s=e.parent||e.newParent||a,this.updateSemanticParent(n,a,s)):m(n,"bpmn:DataOutputAssociation")&&(s=e.parent||e.newParent||r,this.updateSemanticParent(n,r,s),n.targetRef=a);else{var c=m(n,"bpmn:SequenceFlow");n.sourceRef!==r&&(c&&(me(n.sourceRef&&n.sourceRef.get("outgoing"),n),r&&r.get("outgoing")&&r.get("outgoing").push(n)),n.sourceRef=r),n.targetRef!==a&&(c&&(me(n.targetRef&&n.targetRef.get("incoming"),n),a&&a.get("incoming")&&a.get("incoming").push(n)),n.targetRef=a)}this.updateConnectionWaypoints(t),this.updateDiConnection(t,i,o)};Oe.prototype._getLabel=function(e){return e.label||(e.label=this._bpmnFactory.createDiLabel()),e.label};function Le(e){return function(t){var n=t.context,i=n.shape||n.connection||n.element;m(i,"bpmn:BaseElement")&&e(t)}}function M_(e){if(m(e,"bpmn:Activity")){var t=Z(e);if(t){var n=t.get("label");if(n)return n.get("bounds")}}}function Bt(e,t){Ra.call(this),this._bpmnFactory=e,this._moddle=t}M(Bt,Ra);Bt.$inject=["bpmnFactory","moddle"];Bt.prototype._baseCreate=Ra.prototype.create;Bt.prototype.create=function(e,t){if(e==="label"){var n=t.di||this._bpmnFactory.createDiLabel();return this._baseCreate(e,S({type:"label",di:n},dh,t))}return this.createElement(e,t)};Bt.prototype.createElement=function(e,t){t=S({},t||{});var n,i=t.businessObject,r=t.di;if(!i){if(!t.type)throw new Error("no shape type specified");i=this._bpmnFactory.create(t.type),fh(i)}if(!k_(r)){var o=S({},r||{},{id:i.id+"_di"});e==="root"?r=this._bpmnFactory.createDiPlane(i,o):e==="connection"?r=this._bpmnFactory.createDiEdge(i,o):r=this._bpmnFactory.createDiShape(i,o)}m(i,"bpmn:Group")&&(t=S({isFrame:!0},t)),t=A_(i,t,["processRef","isInterrupting","associationDirection","isForCompensation"]),t.isExpanded&&(t=va(r,t,"isExpanded")),z(i,["bpmn:Lane","bpmn:Participant"])&&(t=va(r,t,"isHorizontal")),m(i,"bpmn:SubProcess")&&(t.collapsed=!Y(i,r)),m(i,"bpmn:ExclusiveGateway")&&(kt(r,"isMarkerVisible")?r.isMarkerVisible===void 0&&(r.isMarkerVisible=!1):r.isMarkerVisible=!0),je(t.triggeredByEvent)&&(i.triggeredByEvent=t.triggeredByEvent,delete t.triggeredByEvent),je(t.cancelActivity)&&(i.cancelActivity=t.cancelActivity,delete t.cancelActivity);var a,s;return t.eventDefinitionType&&(a=i.get("eventDefinitions")||[],s=this._bpmnFactory.create(t.eventDefinitionType,t.eventDefinitionAttrs),t.eventDefinitionType==="bpmn:ConditionalEventDefinition"&&(s.condition=this._bpmnFactory.create("bpmn:FormalExpression")),a.push(s),s.$parent=i,i.eventDefinitions=a,delete t.eventDefinitionType),n=this.getDefaultSize(i,r),t=S({id:i.id},n,t,{businessObject:i,di:r}),this._baseCreate(e,t)};Bt.prototype.getDefaultSize=function(e,t){var n=P(e);if(t=t||Z(e),m(n,"bpmn:SubProcess"))return Y(n,t)?{width:350,height:200}:{width:100,height:80};if(m(n,"bpmn:Task"))return{width:100,height:80};if(m(n,"bpmn:Gateway"))return{width:50,height:50};if(m(n,"bpmn:Event"))return{width:36,height:36};if(m(n,"bpmn:Participant")){var i=t.isHorizontal===void 0||t.isHorizontal===!0;return Y(n,t)?i?{width:600,height:250}:{width:250,height:600}:i?{width:400,height:60}:{width:60,height:400}}return m(n,"bpmn:Lane")?{width:400,height:100}:m(n,"bpmn:DataObjectReference")?{width:36,height:50}:m(n,"bpmn:DataStoreReference")?{width:50,height:50}:m(n,"bpmn:TextAnnotation")?{width:100,height:30}:m(n,"bpmn:Group")?{width:300,height:300}:{width:100,height:80}};Bt.prototype.createParticipantShape=function(e){return xt(e)||(e={isExpanded:e}),e=S({type:"bpmn:Participant"},e||{}),e.isExpanded!==!1&&(e.processRef=this._bpmnFactory.create("bpmn:Process")),this.createShape(e)};function A_(e,t,n){return w(n,function(i){t=va(e,t,i)}),t}function va(e,t,n){return t[n]===void 0?t:(e[n]=t[n],Et(t,[n]))}function k_(e){return z(e,["bpmndi:BPMNShape","bpmndi:BPMNEdge","bpmndi:BPMNDiagram","bpmndi:BPMNPlane"])}function io(e,t){this._modeling=e,this._canvas=t}io.$inject=["modeling","canvas"];io.prototype.preExecute=function(e){var t=this._modeling,n=e.elements,i=e.alignment;w(n,function(r){var o={x:0,y:0};je(i.left)?o.x=i.left-r.x:je(i.right)?o.x=i.right-r.width-r.x:je(i.center)?o.x=i.center-Math.round(r.width/2)-r.x:je(i.top)?o.y=i.top-r.y:je(i.bottom)?o.y=i.bottom-r.height-r.y:je(i.middle)&&(o.y=i.middle-Math.round(r.height/2)-r.y),t.moveElements([r],o,r.parent)})};io.prototype.postExecute=function(e){};function ro(e){this._modeling=e}ro.$inject=["modeling"];ro.prototype.preExecute=function(e){var t=e.source;if(!t)throw new Error("source required");var n=e.target||t.parent,i=e.shape,r=e.hints||{};i=e.shape=this._modeling.createShape(i,e.position,n,{attach:r.attach}),e.shape=i};ro.prototype.postExecute=function(e){var t=e.hints||{};I_(e.source,e.shape)||(t.connectionTarget===e.source?this._modeling.connect(e.shape,e.source,e.connection):this._modeling.connect(e.source,e.shape,e.connection))};function I_(e,t){return di(e.outgoing,function(n){return n.target===t})}function oo(e,t){this._canvas=e,this._layouter=t}oo.$inject=["canvas","layouter"];oo.prototype.execute=function(e){var t=e.connection,n=e.source,i=e.target,r=e.parent,o=e.parentIndex,a=e.hints;if(!n||!i)throw new Error("source and target required");if(!r)throw new Error("parent required");return t.source=n,t.target=i,t.waypoints||(t.waypoints=this._layouter.layoutConnection(t,a)),this._canvas.addConnection(t,r,o),t};oo.prototype.revert=function(e){var t=e.connection;return this._canvas.removeConnection(t),t.source=null,t.target=null,t};var tr=Math.round;function Os(e){this._modeling=e}Os.$inject=["modeling"];Os.prototype.preExecute=function(e){var t=e.elements,n=e.parent,i=e.parentIndex,r=e.position,o=e.hints,a=this._modeling;w(t,function(u){G(u.x)||(u.x=0),G(u.y)||(u.y=0)});var s=U(t,function(u){return!u.hidden}),c=Ae(s);w(t,function(u){ee(u)&&(u.waypoints=He(u.waypoints,function(d){return{x:tr(d.x-c.x-c.width/2+r.x),y:tr(d.y-c.y-c.height/2+r.y)}})),S(u,{x:tr(u.x-c.x-c.width/2+r.x),y:tr(u.y-c.y-c.height/2+r.y)})});var l=Pr(t),p={};w(t,function(u){if(ee(u)){p[u.id]=G(i)?a.createConnection(p[u.source.id],p[u.target.id],i,u,u.parent||n,o):a.createConnection(p[u.source.id],p[u.target.id],u,u.parent||n,o);return}var d=S({},o);l.indexOf(u)===-1&&(d.autoResize=!1),F(u)&&(d=Et(d,["attach"])),p[u.id]=G(i)?a.createShape(u,ut(u,["x","y","width","height"]),u.parent||n,i,d):a.createShape(u,ut(u,["x","y","width","height"]),u.parent||n,d)}),e.elements=Mr(p)};var $l=Math.round;function jt(e){this._canvas=e}jt.$inject=["canvas"];jt.prototype.execute=function(e){var t=e.shape,n=e.position,i=e.parent,r=e.parentIndex;if(!i)throw new Error("parent required");if(!n)throw new Error("position required");return n.width!==void 0?S(t,n):S(t,{x:n.x-$l(t.width/2),y:n.y-$l(t.height/2)}),this._canvas.addShape(t,i,r),t};jt.prototype.revert=function(e){var t=e.shape;return this._canvas.removeShape(t),t};function bi(e){jt.call(this,e)}M(bi,jt);bi.$inject=["canvas"];var N_=jt.prototype.execute;bi.prototype.execute=function(e){var t=e.shape;return O_(t),t.labelTarget=e.labelTarget,N_.call(this,e)};var L_=jt.prototype.revert;bi.prototype.revert=function(e){return e.shape.labelTarget=null,L_.call(this,e)};function O_(e){["width","height"].forEach(function(t){typeof e[t]>"u"&&(e[t]=0)})}function xi(e,t){this._canvas=e,this._modeling=t}xi.$inject=["canvas","modeling"];xi.prototype.preExecute=function(e){var t=this._modeling,n=e.connection;It(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),It(n.outgoing,function(i){t.removeConnection(i,{nested:!0})})};xi.prototype.execute=function(e){var t=e.connection,n=t.parent;return e.parent=n,e.parentIndex=Ca(n.children,t),e.source=t.source,e.target=t.target,this._canvas.removeConnection(t),t.source=null,t.target=null,t};xi.prototype.revert=function(e){var t=e.connection,n=e.parent,i=e.parentIndex;return t.source=e.source,t.target=e.target,ye(n.children,t,i),this._canvas.addConnection(t,n),t};function $s(e,t){this._modeling=e,this._elementRegistry=t}$s.$inject=["modeling","elementRegistry"];$s.prototype.postExecute=function(e){var t=this._modeling,n=this._elementRegistry,i=e.elements;w(i,function(r){n.get(r.id)&&(r.waypoints?t.removeConnection(r):t.removeShape(r))})};function Ei(e,t){this._canvas=e,this._modeling=t}Ei.$inject=["canvas","modeling"];Ei.prototype.preExecute=function(e){var t=this._modeling,n=e.shape;It(n.incoming,function(i){t.removeConnection(i,{nested:!0})}),It(n.outgoing,function(i){t.removeConnection(i,{nested:!0})}),It(n.children,function(i){ee(i)?t.removeConnection(i,{nested:!0}):t.removeShape(i,{nested:!0})})};Ei.prototype.execute=function(e){var t=this._canvas,n=e.shape,i=n.parent;return e.oldParent=i,e.oldParentIndex=Ca(i.children,n),t.removeShape(n),n};Ei.prototype.revert=function(e){var t=this._canvas,n=e.shape,i=e.oldParent,r=e.oldParentIndex;return ye(i.children,n,r),t.addShape(n,i),n};function ao(e){this._modeling=e}ao.$inject=["modeling"];var Bl={x:"y",y:"x"};ao.prototype.preExecute=function(e){var t=this._modeling,n=e.groups,i=e.axis,r=e.dimension;function o(v,_){v.range.min=Math.min(_[i],v.range.min),v.range.max=Math.max(_[i]+_[r],v.range.max)}function a(v){return v[i]+v[r]/2}function s(v){return v.length-1}function c(v){return v.max-v.min}function l(v,_){var x={y:0};x[i]=v-a(_),x[i]&&(x[Bl[i]]=0,t.moveElements([_],x,_.parent))}var p=n[0],u=s(n),d=n[u],f,h,g=0;w(n,function(v,_){var x,y,b;if(v.elements.length<2){_&&_!==n.length-1&&(o(v,v.elements[0]),g+=c(v.range));return}x=bt(v.elements,i),y=x[0],_===u&&(y=x[s(x)]),b=a(y),v.range=null,w(x,function(E){if(l(b,E),v.range===null){v.range={min:E[i],max:E[i]+E[r]};return}o(v,E)}),_&&_!==n.length-1&&(g+=c(v.range))}),h=Math.abs(d.range.min-p.range.max),f=Math.round((h-g)/(n.length-1)),!(f<n.length-1)&&w(n,function(v,_){var x={},y;v===p||v===d||(y=n[_-1],v.range.max=0,w(v.elements,function(b,E){x[Bl[i]]=0,x[i]=y.range.max-b[i]+f,v.range.min!==b[i]&&(x[i]+=b[i]-v.range.min),x[i]&&t.moveElements([b],x,b.parent),v.range.max=Math.max(b[i]+b[r],E?v.range.max:0)}))})};ao.prototype.postExecute=function(e){};function so(e,t){this._layouter=e,this._canvas=t}so.$inject=["layouter","canvas"];so.prototype.execute=function(e){var t=e.connection,n=t.waypoints;return S(e,{oldWaypoints:n}),t.waypoints=this._layouter.layoutConnection(t,e.hints),t};so.prototype.revert=function(e){var t=e.connection;return t.waypoints=e.oldWaypoints,t};function Bs(){}Bs.prototype.execute=function(e){var t=e.connection,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldParent=o,e.oldParentIndex=me(o.children,t),ye(i.children,t,r),t.parent=i,w(t.waypoints,function(a){a.x+=n.x,a.y+=n.y,a.original&&(a.original.x+=n.x,a.original.y+=n.y)}),t};Bs.prototype.revert=function(e){var t=e.connection,n=t.parent,i=e.oldParent,r=e.oldParentIndex,o=e.delta;return me(n.children,t),ye(i.children,t,r),t.parent=i,w(t.waypoints,function(a){a.x-=o.x,a.y-=o.y,a.original&&(a.original.x-=o.x,a.original.y-=o.y)}),t};function js(){this.allShapes={},this.allConnections={},this.enclosedElements={},this.enclosedConnections={},this.topLevel={}}js.prototype.add=function(e,t){return this.addAll([e],t)};js.prototype.addAll=function(e,t){var n=hh(e,!!t,this);return S(this,n),this};function wi(e){this._modeling=e}wi.prototype.moveRecursive=function(e,t,n){return e?this.moveClosure(this.getClosure(e),t,n):[]};wi.prototype.moveClosure=function(e,t,n,i,r){var o=this._modeling,a=e.allShapes,s=e.allConnections,c=e.enclosedConnections,l=e.topLevel,p=!1;r&&r.parent===n&&(p=!0),w(a,function(u){o.moveShape(u,t,l[u.id]&&!p&&n,{recurse:!1,layout:!1})}),w(s,function(u){var d=!!a[u.source.id],f=!!a[u.target.id];c[u.id]&&d&&f?o.moveConnection(u,t,l[u.id]&&!p&&n):o.layoutConnection(u,{connectionStart:d&&ls(u,u.source,t),connectionEnd:f&&us(u,u.target,t)})})};wi.prototype.getClosure=function(e){return new js().addAll(e,!0)};function co(e){this._helper=new wi(e)}co.$inject=["modeling"];co.prototype.preExecute=function(e){e.closure=this._helper.getClosure(e.shapes)};co.prototype.postExecute=function(e){var t=e.hints,n;t&&t.primaryShape&&(n=t.primaryShape,t.oldParent=n.parent),this._helper.moveClosure(e.closure,e.delta,e.newParent,e.newHost,n)};function an(e){this._modeling=e,this._helper=new wi(e)}an.$inject=["modeling"];an.prototype.execute=function(e){var t=e.shape,n=e.delta,i=e.newParent||t.parent,r=e.newParentIndex,o=t.parent;return e.oldBounds=ut(t,["x","y","width","height"]),e.oldParent=o,e.oldParentIndex=me(o.children,t),ye(i.children,t,r),S(t,{parent:i,x:t.x+n.x,y:t.y+n.y}),t};an.prototype.postExecute=function(e){var t=e.shape,n=e.delta,i=e.hints,r=this._modeling;i.layout!==!1&&(w(t.incoming,function(o){r.layoutConnection(o,{connectionEnd:us(o,t,n)})}),w(t.outgoing,function(o){r.layoutConnection(o,{connectionStart:ls(o,t,n)})})),i.recurse!==!1&&this.moveChildren(e)};an.prototype.revert=function(e){var t=e.shape,n=e.oldParent,i=e.oldParentIndex,r=e.delta;return ye(n.children,t,i),S(t,{parent:n,x:t.x-r.x,y:t.y-r.y}),t};an.prototype.moveChildren=function(e){var t=e.delta,n=e.shape;this._helper.moveRecursive(n.children,t,null)};an.prototype.getNewParent=function(e){return e.newParent||e.shape.parent};function Si(e){this._modeling=e}Si.$inject=["modeling"];Si.prototype.execute=function(e){var t=e.newSource,n=e.newTarget,i=e.connection,r=e.dockingOrPoints;if(!t&&!n)throw new Error("newSource or newTarget required");return V(r)&&(e.oldWaypoints=i.waypoints,i.waypoints=r),t&&(e.oldSource=i.source,i.source=t),n&&(e.oldTarget=i.target,i.target=n),i};Si.prototype.postExecute=function(e){var t=e.connection,n=e.newSource,i=e.newTarget,r=e.dockingOrPoints,o=e.hints||{},a={};o.connectionStart&&(a.connectionStart=o.connectionStart),o.connectionEnd&&(a.connectionEnd=o.connectionEnd),o.layoutConnection!==!1&&(n&&(!i||o.docking==="source")&&(a.connectionStart=a.connectionStart||jl(V(r)?r[0]:r)),i&&(!n||o.docking==="target")&&(a.connectionEnd=a.connectionEnd||jl(V(r)?r[r.length-1]:r)),o.newWaypoints&&(a.waypoints=o.newWaypoints),this._modeling.layoutConnection(t,a))};Si.prototype.revert=function(e){var t=e.oldSource,n=e.oldTarget,i=e.oldWaypoints,r=e.connection;return t&&(r.source=t),n&&(r.target=n),i&&(r.waypoints=i),r};function jl(e){return e.original||e}function Rt(e,t){this._modeling=e,this._rules=t}Rt.$inject=["modeling","rules"];Rt.prototype.preExecute=function(e){var t=this,n=this._modeling,i=this._rules,r=e.oldShape,o=e.newData,a=e.hints||{},s;function c(h,g,v){return i.allowed("connection.reconnect",{connection:v,source:h,target:g})}var l={x:o.x,y:o.y},p={x:r.x,y:r.y,width:r.width,height:r.height};s=e.newShape=e.newShape||t.createShape(o,l,r.parent,a),r.host&&n.updateAttachment(s,r.host);var u;a.moveChildren!==!1&&(u=r.children.slice(),n.moveElements(u,{x:0,y:0},s,a));var d=r.incoming.slice(),f=r.outgoing.slice();w(d,function(h){var g=h.source,v=c(g,s,h);v&&t.reconnectEnd(h,s,qr(h,s,p),a)}),w(f,function(h){var g=h.target,v=c(s,g,h);v&&t.reconnectStart(h,s,Yr(h,s,p),a)})};Rt.prototype.postExecute=function(e){var t=e.oldShape;this._modeling.removeShape(t)};Rt.prototype.execute=function(e){};Rt.prototype.revert=function(e){};Rt.prototype.createShape=function(e,t,n,i){return this._modeling.createShape(e,t,n,i)};Rt.prototype.reconnectStart=function(e,t,n,i){this._modeling.reconnectStart(e,t,n,i)};Rt.prototype.reconnectEnd=function(e,t,n,i){this._modeling.reconnectEnd(e,t,n,i)};function Ci(e){this._modeling=e}Ci.$inject=["modeling"];Ci.prototype.execute=function(e){var t=e.shape,n=e.newBounds,i=e.minBounds;if(n.x===void 0||n.y===void 0||n.width===void 0||n.height===void 0)throw new Error("newBounds must have {x, y, width, height} properties");if(i&&(n.width<i.width||n.height<i.height))throw new Error("width and height cannot be less than minimum height and width");if(!i&&n.width<10||n.height<10)throw new Error("width and height cannot be less than 10px");return e.oldBounds={width:t.width,height:t.height,x:t.x,y:t.y},S(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};Ci.prototype.postExecute=function(e){var t=this._modeling,n=e.shape,i=e.oldBounds,r=e.hints||{};r.layout!==!1&&(w(n.incoming,function(o){t.layoutConnection(o,{connectionEnd:qr(o,n,i)})}),w(n.outgoing,function(o){t.layoutConnection(o,{connectionStart:Yr(o,n,i)})}))};Ci.prototype.revert=function(e){var t=e.shape,n=e.oldBounds;return S(t,{width:n.width,height:n.height,x:n.x,y:n.y}),t};function Ht(e){this._modeling=e}Ht.$inject=["modeling"];Ht.prototype.preExecute=function(e){var t=e.delta,n=e.direction,i=e.movingShapes,r=e.resizingShapes,o=e.start,a={};this.moveShapes(i,t),w(r,function(s){a[s.id]=B_(s)}),this.resizeShapes(r,t,n),this.updateConnectionWaypoints(p_(i,r),t,n,o,i,r,a)};Ht.prototype.execute=function(){};Ht.prototype.revert=function(){};Ht.prototype.moveShapes=function(e,t){var n=this;w(e,function(i){n._modeling.moveShape(i,t,null,{autoResize:!1,layout:!1,recurse:!1})})};Ht.prototype.resizeShapes=function(e,t,n){var i=this;w(e,function(r){var o=d_(r,n,t);i._modeling.resizeShape(r,o,null,{attachSupport:!1,autoResize:!1,layout:!1})})};Ht.prototype.updateConnectionWaypoints=function(e,t,n,i,r,o,a){var s=this,c=r.concat(o);w(e,function(l){var p=l.source,u=l.target,d=$_(l),f=Xd(n),h={};At(c,p)&&At(c,u)?(d=He(d,function(g){return zl(g,i,n)&&(g[f]=g[f]+t[f]),g.original&&zl(g.original,i,n)&&(g.original[f]=g.original[f]+t[f]),g}),s._modeling.updateWaypoints(l,d,{labelBehavior:!1})):(At(c,p)||At(c,u))&&(At(r,p)?h.connectionStart=ls(l,p,t):At(r,u)?h.connectionEnd=us(l,u,t):At(o,p)?h.connectionStart=Yr(l,p,a[p.id]):At(o,u)&&(h.connectionEnd=qr(l,u,a[u.id])),s._modeling.layoutConnection(l,h))})};function Hl(e){return S({},e)}function $_(e){return He(e.waypoints,function(t){return t=Hl(t),t.original&&(t.original=Hl(t.original)),t})}function Xd(e){switch(e){case"n":return"y";case"w":return"x";case"s":return"y";case"e":return"x"}}function zl(e,t,n){var i=Xd(n);if(/e|s/.test(n))return e[i]>t;if(/n|w/.test(n))return e[i]<t}function At(e,t){return e.indexOf(t)!==-1}function B_(e){return{x:e.x,y:e.y,height:e.height,width:e.width}}function lo(e){this._modeling=e}lo.$inject=["modeling"];lo.prototype.execute=function(e){var t=e.shape,n=t.children;e.oldChildrenVisibility=Zd(n),t.collapsed=!t.collapsed;var i=Jd(n,t.collapsed);return[t].concat(i)};lo.prototype.revert=function(e){var t=e.shape,n=e.oldChildrenVisibility,i=t.children,r=Qd(i,n);return t.collapsed=!t.collapsed,[t].concat(r)};function Zd(e){var t={};return w(e,function(n){t[n.id]=n.hidden,n.children&&(t=S({},t,Zd(n.children)))}),t}function Jd(e,t){var n=[];return w(e,function(i){i.hidden=t,n=n.concat(i),i.children&&(n=n.concat(Jd(i.children,i.collapsed||t)))}),n}function Qd(e,t){var n=[];return w(e,function(i){i.hidden=t[i.id],n=n.concat(i),i.children&&(n=n.concat(Qd(i.children,t)))}),n}function uo(e){this._modeling=e}uo.$inject=["modeling"];uo.prototype.execute=function(e){var t=e.shape,n=e.newHost,i=t.host;return e.oldHost=i,e.attacherIdx=ef(i,t),tf(n,t),t.host=n,t};uo.prototype.revert=function(e){var t=e.shape,n=e.newHost,i=e.oldHost,r=e.attacherIdx;return t.host=i,ef(n,t),tf(i,t,r),t};function ef(e,t){return me(e&&e.attachers,t)}function tf(e,t,n){if(e){var i=e.attachers;i||(e.attachers=i=[]),ye(i,t,n)}}function Hs(){}Hs.prototype.execute=function(e){var t=e.connection,n=e.newWaypoints;return e.oldWaypoints=t.waypoints,t.waypoints=n,t};Hs.prototype.revert=function(e){var t=e.connection,n=e.oldWaypoints;return t.waypoints=n,t};function J(e,t,n){this._eventBus=e,this._elementFactory=t,this._commandStack=n;var i=this;e.on("diagram.init",function(){i.registerHandlers(n)})}J.$inject=["eventBus","elementFactory","commandStack"];J.prototype.getHandlers=function(){return{"shape.append":ro,"shape.create":jt,"shape.delete":Ei,"shape.move":an,"shape.resize":Ci,"shape.replace":Rt,"shape.toggleCollapse":lo,spaceTool:Ht,"label.create":bi,"connection.create":oo,"connection.delete":xi,"connection.move":Bs,"connection.layout":so,"connection.updateWaypoints":Hs,"connection.reconnect":Si,"elements.create":Os,"elements.move":co,"elements.delete":$s,"elements.distribute":ao,"elements.align":io,"element.updateAttachment":uo}};J.prototype.registerHandlers=function(e){w(this.getHandlers(),function(t,n){e.registerHandler(n,t)})};J.prototype.moveShape=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=null);var o={shape:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("shape.move",o)};J.prototype.updateAttachment=function(e,t){var n={shape:e,newHost:t};this._commandStack.execute("element.updateAttachment",n)};J.prototype.moveElements=function(e,t,n,i){i=i||{};var r=i.attach,o=n,a;r===!0?(a=n,o=n.parent):r===!1&&(a=null);var s={shapes:e,delta:t,newParent:o,newHost:a,hints:i};this._commandStack.execute("elements.move",s)};J.prototype.moveConnection=function(e,t,n,i,r){typeof i=="object"&&(r=i,i=void 0);var o={connection:e,delta:t,newParent:n,newParentIndex:i,hints:r||{}};this._commandStack.execute("connection.move",o)};J.prototype.layoutConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.layout",n)};J.prototype.createConnection=function(e,t,n,i,r,o){typeof n=="object"&&(o=r,r=i,i=n,n=void 0),i=this._create("connection",i);var a={source:e,target:t,parent:r,parentIndex:n,connection:i,hints:o};return this._commandStack.execute("connection.create",a),a.connection};J.prototype.createShape=function(e,t,n,i,r){typeof i!="number"&&(r=i,i=void 0),r=r||{};var o=r.attach,a,s;e=this._create("shape",e),o?(a=n.parent,s=n):a=n;var c={position:t,shape:e,parent:a,parentIndex:i,host:s,hints:r};return this._commandStack.execute("shape.create",c),c.shape};J.prototype.createElements=function(e,t,n,i,r){V(e)||(e=[e]),typeof i!="number"&&(r=i,i=void 0),r=r||{};var o={position:t,elements:e,parent:n,parentIndex:i,hints:r};return this._commandStack.execute("elements.create",o),o.elements};J.prototype.createLabel=function(e,t,n,i){n=this._create("label",n);var r={labelTarget:e,position:t,parent:i||e.parent,shape:n};return this._commandStack.execute("label.create",r),r.shape};J.prototype.appendShape=function(e,t,n,i,r){r=r||{},t=this._create("shape",t);var o={source:e,position:n,target:i,shape:t,connection:r.connection,connectionParent:r.connectionParent,hints:r};return this._commandStack.execute("shape.append",o),o.shape};J.prototype.removeElements=function(e){var t={elements:e};this._commandStack.execute("elements.delete",t)};J.prototype.distributeElements=function(e,t,n){var i={groups:e,axis:t,dimension:n};this._commandStack.execute("elements.distribute",i)};J.prototype.removeShape=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.delete",n)};J.prototype.removeConnection=function(e,t){var n={connection:e,hints:t||{}};this._commandStack.execute("connection.delete",n)};J.prototype.replaceShape=function(e,t,n){var i={oldShape:e,newData:t,hints:n||{}};return this._commandStack.execute("shape.replace",i),i.newShape};J.prototype.alignElements=function(e,t){var n={elements:e,alignment:t};this._commandStack.execute("elements.align",n)};J.prototype.resizeShape=function(e,t,n,i){var r={shape:e,newBounds:t,minBounds:n,hints:i};this._commandStack.execute("shape.resize",r)};J.prototype.createSpace=function(e,t,n,i,r){var o={delta:n,direction:i,movingShapes:e,resizingShapes:t,start:r};this._commandStack.execute("spaceTool",o)};J.prototype.updateWaypoints=function(e,t,n){var i={connection:e,newWaypoints:t,hints:n||{}};this._commandStack.execute("connection.updateWaypoints",i)};J.prototype.reconnect=function(e,t,n,i,r){var o={connection:e,newSource:t,newTarget:n,dockingOrPoints:i,hints:r||{}};this._commandStack.execute("connection.reconnect",o)};J.prototype.reconnectStart=function(e,t,n,i){i||(i={}),this.reconnect(e,t,e.target,n,S(i,{docking:"source"}))};J.prototype.reconnectEnd=function(e,t,n,i){i||(i={}),this.reconnect(e,e.source,t,n,S(i,{docking:"target"}))};J.prototype.connect=function(e,t,n,i){return this.createConnection(e,t,n||{},e.parent,i)};J.prototype._create=function(e,t){return vh(t)?t:this._elementFactory.create(e,t)};J.prototype.toggleCollapse=function(e,t){var n={shape:e,hints:t||{}};this._commandStack.execute("shape.toggleCollapse",n)};function Ri(e){this._elementRegistry=e}Ri.$inject=["elementRegistry"];Ri.prototype.execute=function(e){var t=e.element,n=e.moddleElement,i=e.properties;if(!n)throw new Error("<moddleElement> required");var r=e.changed||this._getVisualReferences(n).concat(t),o=e.oldProperties||j_(n,Ko(i));return nf(n,i),e.oldProperties=o,e.changed=r,r};Ri.prototype.revert=function(e){var t=e.oldProperties,n=e.moddleElement,i=e.changed;return nf(n,t),i};Ri.prototype._getVisualReferences=function(e){var t=this._elementRegistry;return m(e,"bpmn:DataObject")?H_(e,t):[]};function j_(e,t){return Nt(t,function(n,i){return n[i]=e.get(i),n},{})}function nf(e,t){w(t,function(n,i){e.set(i,n)})}function H_(e,t){return t.filter(function(n){return m(n,"bpmn:DataObjectReference")&&P(n).dataObjectRef===e})}var Kn="default",_t="id",rf="di",z_={width:0,height:0};function Ti(e,t,n,i){this._elementRegistry=e,this._moddle=t,this._modeling=n,this._textRenderer=i}Ti.$inject=["elementRegistry","moddle","modeling","textRenderer"];Ti.prototype.execute=function(e){var t=e.element,n=[t];if(!t)throw new Error("element required");var i=this._elementRegistry,r=this._moddle.ids,o=t.businessObject,a=W_(e.properties),s=e.oldProperties||F_(t,a);return of(a,o)&&(r.unclaim(o[_t]),i.updateId(t,a[_t]),r.claim(a[_t],o)),Kn in a&&(a[Kn]&&n.push(i.get(a[Kn].id)),o[Kn]&&n.push(i.get(o[Kn].id))),af(t,a),e.oldProperties=s,e.changed=n,n};Ti.prototype.postExecute=function(e){var t=e.element,n=t.label,i=n&&P(n).name;if(i){var r=this._textRenderer.getExternalLabelBounds(n,i);this._modeling.resizeShape(n,r,z_)}};Ti.prototype.revert=function(e){var t=e.element,n=e.properties,i=e.oldProperties,r=t.businessObject,o=this._elementRegistry,a=this._moddle.ids;return af(t,i),of(n,r)&&(a.unclaim(n[_t]),o.updateId(t,i[_t]),a.claim(i[_t],r)),e.changed};function of(e,t){return _t in e&&e[_t]!==t[_t]}function F_(e,t){var n=Ko(t),i=e.businessObject,r=Z(e);return Nt(n,function(o,a){return a!==rf?o[a]=i.get(a):o[a]=G_(r,Ko(t.di)),o},{})}function G_(e,t){return Nt(t,function(n,i){return n[i]=e&&e.get(i),n},{})}function af(e,t){var n=e.businessObject,i=Z(e);w(t,function(r,o){o!==rf?n.set(o,r):i&&V_(i,r)})}function V_(e,t){w(t,function(n,i){e.set(i,n)})}var U_=["default"];function W_(e){var t=S({},e);return U_.forEach(function(n){n in e&&(t[n]=P(t[n]))}),t}function po(e,t){this._canvas=e,this._modeling=t}po.$inject=["canvas","modeling"];po.prototype.execute=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=t.getRootElement(),o=r.businessObject,a=o.$parent,s=Z(r);return t.setRootElement(n),t.removeRootElement(r),ye(a.rootElements,i),i.$parent=a,me(a.rootElements,o),o.$parent=null,r.di=null,s.bpmnElement=i,n.di=s,e.oldRoot=r,[]};po.prototype.revert=function(e){var t=this._canvas,n=e.newRoot,i=n.businessObject,r=e.oldRoot,o=r.businessObject,a=i.$parent,s=Z(n);return t.setRootElement(r),t.removeRootElement(n),me(a.rootElements,i),i.$parent=null,ye(a.rootElements,o),o.$parent=a,n.di=null,s.bpmnElement=o,r.di=s,[]};function zs(e,t){this._modeling=e,this._spaceTool=t}zs.$inject=["modeling","spaceTool"];zs.prototype.preExecute=function(e){var t=this._spaceTool,n=this._modeling,i=e.shape,r=e.location,o=Ve(i),a=o===i,s=a?i:i.parent,c=Ot(s),l=xe(i);if(l?r==="left"?r="top":r==="right"&&(r="bottom"):r==="top"?r="left":r==="bottom"&&(r="right"),!c.length){var p=l?{x:i.x+Ge,y:i.y,width:i.width-Ge,height:i.height}:{x:i.x,y:i.y+Ge,width:i.width,height:i.height-Ge};n.createShape({type:"bpmn:Lane",isHorizontal:l},p,s)}var u=[];Nr(o,function(b){return u.push(b),b.label&&u.push(b.label),b===i?[]:U(b.children,function(E){return E!==i})});var d,f,h,g,v;r==="top"?(d=-120,f=i.y,h=f+10,g="n",v="y"):r==="left"?(d=-120,f=i.x,h=f+10,g="w",v="x"):r==="bottom"?(d=120,f=i.y+i.height,h=f-10,g="s",v="y"):r==="right"&&(d=120,f=i.x+i.width,h=f-10,g="e",v="x");var _=t.calculateAdjustments(u,v,d,h),x=l?{x:0,y:d}:{x:d,y:0};t.makeSpace(_.movingShapes,_.resizingShapes,x,g,h);var y=l?{x:i.x+(a?Ge:0),y:f-(r==="top"?120:0),width:i.width-(a?Ge:0),height:120}:{x:f-(r==="left"?120:0),y:i.y+(a?Ge:0),width:120,height:i.height-(a?Ge:0)};e.newLane=n.createShape({type:"bpmn:Lane",isHorizontal:l},y,s)};function Fs(e){this._modeling=e}Fs.$inject=["modeling"];Fs.prototype.preExecute=function(e){var t=this._modeling,n=e.shape,i=e.count,r=Ot(n),o=r.length;if(o>i)throw new Error(`more than <${i}> child lanes`);var a=xe(n),s=a?n.height:n.width,c=Math.round(s/i),l,p,u,d;for(d=0;d<i;d++)d===i-1?l=s-c*d:l=c,p=a?{x:n.x+Ge,y:n.y+d*c,width:n.width-Ge,height:l}:{x:n.x+d*c,y:n.y+Ge,width:l,height:n.height-Ge},d<o?t.resizeShape(r[d],p):(u={type:"bpmn:Lane",isHorizontal:a},t.createShape(u,p,n))};function Pi(e,t){this._modeling=e,this._spaceTool=t}Pi.$inject=["modeling","spaceTool"];Pi.prototype.preExecute=function(e){var t=e.shape,n=e.newBounds,i=e.balanced;i!==!1?this.resizeBalanced(t,n):this.resizeSpace(t,n)};Pi.prototype.resizeBalanced=function(e,t){var n=this._modeling,i=bg(e,t);n.resizeShape(e,t),i.forEach(function(r){n.resizeShape(r.shape,r.newBounds)})};Pi.prototype.resizeSpace=function(e,t){var n=this._spaceTool,i=k(e),r=k(t),o=od(r,i),a=Ve(e),s=[],c=[];Nr(a,function(h){return s.push(h),(m(h,"bpmn:Lane")||m(h,"bpmn:Participant"))&&c.push(h),h.children});var l,p,u,d,f;(o.bottom||o.top)&&(l=o.bottom||o.top,p=e.y+(o.bottom?e.height:0)+(o.bottom?-10:10),u=o.bottom?"s":"n",d=o.top>0||o.bottom<0?-l:l,f=n.calculateAdjustments(s,"y",d,p),n.makeSpace(f.movingShapes,f.resizingShapes,{x:0,y:l},u)),(o.left||o.right)&&(l=o.right||o.left,p=e.x+(o.right?e.width:0)+(o.right?-10:100),u=o.right?"e":"w",d=o.left>0||o.right<0?-l:l,f=n.calculateAdjustments(c,"x",d,p),n.makeSpace(f.movingShapes,f.resizingShapes,{x:l,y:0},u))};var si="flowNodeRef",Gs="lanes";function Di(e){this._elementRegistry=e}Di.$inject=["elementRegistry"];Di.prototype._computeUpdates=function(e,t){var n=[],i=[],r={},o=[];function a(p,u){var d=k(u),f={x:p.x+p.width/2,y:p.y+p.height/2};return f.x>d.left&&f.x<d.right&&f.y>d.top&&f.y<d.bottom}function s(p){n.indexOf(p)===-1&&(o.push(p),n.push(p))}function c(p){var u=Ve(p);return r[u.id]||(r[u.id]=Wr(u)),r[u.id]}function l(p){if(!p.parent)return[];var u=c(p);return u.filter(function(d){return a(p,d)}).map(function(d){return d.businessObject})}return t.forEach(function(p){var u=Ve(p);if(!(!u||n.indexOf(u)!==-1)){var d=u.children.filter(function(f){return m(f,"bpmn:FlowNode")});d.forEach(s),n.push(u)}}),e.forEach(s),o.forEach(function(p){var u=p.businessObject,d=u.get(Gs),f=d.slice(),h=l(p);i.push({flowNode:u,remove:f,add:h})}),t.forEach(function(p){var u=p.businessObject;p.parent||u.get(si).forEach(function(d){i.push({flowNode:d,remove:[u],add:[]})})}),i};Di.prototype.execute=function(e){var t=e.updates;return t||(t=e.updates=this._computeUpdates(e.flowNodeShapes,e.laneShapes)),t.forEach(function(n){var i=n.flowNode,r=i.get(Gs);n.remove.forEach(function(o){me(r,o),me(o.get(si),i)}),n.add.forEach(function(o){ye(r,o),ye(o.get(si),i)})}),[]};Di.prototype.revert=function(e){var t=e.updates;return t.forEach(function(n){var i=n.flowNode,r=i.get(Gs);n.add.forEach(function(o){me(r,o),me(o.get(si),i)}),n.remove.forEach(function(o){ye(r,o),ye(o.get(si),i)})}),[]};function fo(e){this._moddle=e}fo.$inject=["moddle"];fo.prototype.execute=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.claim(n,i):t.unclaim(n),[]};fo.prototype.revert=function(e){var t=this._moddle.ids,n=e.id,i=e.element,r=e.claiming;return r?t.unclaim(n):t.claim(n,i),[]};var K_={fill:void 0,stroke:void 0};function Vs(e){this._commandStack=e,this._normalizeColor=function(t){if(t){if(Dr(t)){var n=Y_(t);if(n)return n}throw new Error(`invalid color value: ${t}`)}}}Vs.$inject=["commandStack"];Vs.prototype.postExecute=function(e){var t=e.elements,n=e.colors||K_,i=this,r={};"fill"in n&&S(r,{"background-color":this._normalizeColor(n.fill)}),"stroke"in n&&S(r,{"border-color":this._normalizeColor(n.stroke)}),w(t,function(o){var a=ee(o)?ut(r,["border-color"]):r,s=Z(o);if(q_(a),F(o))i._commandStack.execute("element.updateModdleProperties",{element:o,moddleElement:s.label,properties:{color:r["border-color"]}});else{if(!z(s,["bpmndi:BPMNEdge","bpmndi:BPMNShape"]))return;i._commandStack.execute("element.updateProperties",{element:o,properties:{di:a}})}})};function Y_(e){var t=document.createElement("canvas").getContext("2d");return t.fillStyle="transparent",t.fillStyle=e,/^#[0-9a-fA-F]{6}$/.test(t.fillStyle)?t.fillStyle:null}function q_(e){"border-color"in e&&(e.stroke=e["border-color"]),"background-color"in e&&(e.fill=e["background-color"])}var X_={width:0,height:0};function sf(e,t,n){function i(c,l){var p=c.label||c,u=c.labelTarget||c;return mh(p,l),[p,u]}function r(c){var l=c.element,p=l.businessObject,u=c.newLabel;if(!F(l)&&En(l)&&!Ir(l)&&!Fl(u)){var d=7,f=Yu(l);f={x:f.x,y:f.y+d},e.createLabel(l,f,{id:p.id+"_label",businessObject:p,di:l.di})}}function o(c){return c.oldLabel=rn(c.element),i(c.element,c.newLabel)}function a(c){return i(c.element,c.oldLabel)}function s(c){var l=c.element,p=l.label||l,u=c.newLabel,d=c.newBounds,f=c.hints||{};if(!(!F(p)&&!m(p,"bpmn:TextAnnotation"))){if(F(p)&&Fl(u)){f.removeShape!==!1&&e.removeShape(p,{unsetLabel:!1});return}var h=rn(l);typeof d>"u"&&(d=t.getExternalLabelBounds(p,h)),d&&e.resizeShape(p,d,X_)}}this.preExecute=r,this.execute=o,this.revert=a,this.postExecute=s}sf.$inject=["modeling","textRenderer","bpmnFactory"];function Fl(e){return!e||!e.trim()}function Ce(e,t,n,i){J.call(this,e,t,n),this._bpmnRules=i}M(Ce,J);Ce.$inject=["eventBus","elementFactory","commandStack","bpmnRules"];Ce.prototype.getHandlers=function(){var e=J.prototype.getHandlers.call(this);return e["element.updateModdleProperties"]=Ri,e["element.updateProperties"]=Ti,e["canvas.updateRoot"]=po,e["lane.add"]=zs,e["lane.resize"]=Pi,e["lane.split"]=Fs,e["lane.updateRefs"]=Di,e["id.updateClaim"]=fo,e["element.setColor"]=Vs,e["element.updateLabel"]=sf,e};Ce.prototype.updateLabel=function(e,t,n,i){this._commandStack.execute("element.updateLabel",{element:e,newLabel:t,newBounds:n,hints:i||{}})};Ce.prototype.connect=function(e,t,n,i){var r=this._bpmnRules;if(n||(n=r.canConnect(e,t)),!!n)return this.createConnection(e,t,n,e.parent,i)};Ce.prototype.updateModdleProperties=function(e,t,n){this._commandStack.execute("element.updateModdleProperties",{element:e,moddleElement:t,properties:n})};Ce.prototype.updateProperties=function(e,t){this._commandStack.execute("element.updateProperties",{element:e,properties:t})};Ce.prototype.resizeLane=function(e,t,n){this._commandStack.execute("lane.resize",{shape:e,newBounds:t,balanced:n})};Ce.prototype.addLane=function(e,t){var n={shape:e,location:t};return this._commandStack.execute("lane.add",n),n.newLane};Ce.prototype.splitLane=function(e,t){this._commandStack.execute("lane.split",{shape:e,count:t})};Ce.prototype.makeCollaboration=function(){var e=this._create("root",{type:"bpmn:Collaboration"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};Ce.prototype.makeProcess=function(){var e=this._create("root",{type:"bpmn:Process"}),t={newRoot:e};return this._commandStack.execute("canvas.updateRoot",t),e};Ce.prototype.updateLaneRefs=function(e,t){this._commandStack.execute("lane.updateRefs",{flowNodeShapes:e,laneShapes:t})};Ce.prototype.claimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t,claiming:!0})};Ce.prototype.unclaimId=function(e,t){this._commandStack.execute("id.updateClaim",{id:e,element:t})};Ce.prototype.setColor=function(e,t){e.length||(e=[e]),this._commandStack.execute("element.setColor",{elements:e,colors:t})};function cf(){}cf.prototype.layoutConnection=function(e,t){return t=t||{},[t.connectionStart||L(t.source||e.source),t.connectionEnd||L(t.target||e.target)]};var nr=20,Z_=5,Cr=Math.round,Gl=20,J_={"h:h":20,"v:v":20,"h:v":-10,"v:h":-10};function Q_(e,t){return!{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/./,v:/./}[t].test(e)}function eb(e,t){return{t:/top/,r:/right/,b:/bottom/,l:/left/,h:/left|right/,v:/top|bottom/}[e].test(t)}function lf(e,t,n){var i=Se(t,e,Z_),r=n.split(":")[0],o=Cr((t.x-e.x)/2+e.x),a=Cr((t.y-e.y)/2+e.y),s,c,l=eb(r,i),p=/h|r|l/.test(r),u=!1,d=!1;return l?(s=p?{x:o,y:e.y}:{x:e.x,y:a},c=p?"h:h":"v:v"):(u=Q_(i,r),c=p?"h:v":"v:h",u?p?(d=a===e.y,s={x:e.x+nr*(/l/.test(r)?-1:1),y:d?a+nr:a}):(d=o===e.x,s={x:d?o+nr:o,y:e.y+nr*(/t/.test(r)?-1:1)}):s={x:o,y:a}),{waypoints:Us(e,s,c).concat(s),directions:c,turnNextDirections:d}}function tb(e,t,n){return lf(e,t,n)}function nb(e,t,n){var i=lf(t,e,Vl(n));return{waypoints:i.waypoints.slice().reverse(),directions:Vl(i.directions),turnNextDirections:i.turnNextDirections}}function ib(e,t){var n=e.directions.split(":")[1],i=t.directions.split(":")[0];e.turnNextDirections&&(n=n=="h"?"v":"h"),t.turnNextDirections&&(i=i=="h"?"v":"h");var r=n+":"+i,o=Us(e.waypoints[e.waypoints.length-1],t.waypoints[0],r);return{waypoints:o,directions:r}}function Vl(e){return e.split(":").reverse().join(":")}function rb(e,t,n){var i=Cr((t.x-e.x)/2+e.x),r=Cr((t.y-e.y)/2+e.y);if(n==="h:v")return[{x:t.x,y:e.y}];if(n==="v:h")return[{x:e.x,y:t.y}];if(n==="h:h")return[{x:i,y:e.y},{x:i,y:t.y}];if(n==="v:v")return[{x:e.x,y:r},{x:t.x,y:r}];throw new Error("invalid directions: can only handle varians of [hv]:[hv]")}function Us(e,t,n){if(n=n||"h:h",!fb(n))throw new Error("unknown directions: <"+n+">: must be specified as <start>:<end> with start/end in { h,v,t,r,b,l }");if(uf(n)){var i=tb(e,t,n),r=nb(e,t,n),o=ib(i,r);return[].concat(i.waypoints,o.waypoints,r.waypoints)}return rb(e,t,n)}function ob(e,t,n){var i=Us(e,t,n);return i.unshift(e),i.push(t),pf(i)}function ab(e,t,n,i,r){var o=r&&r.preferredLayouts||[],a=gh(o,"straight")[0]||"h:h",s=J_[a]||0,c=Se(e,t,s),l=db(c,a);n=n||L(e),i=i||L(t);var p=l.split(":"),u=Wl(n,e,p[0],hb(c)),d=Wl(i,t,p[1],c);return ob(u,d,l)}function sb(e,t,n,i,r,o){V(n)&&(r=n,o=i,n=L(e),i=L(t)),o=S({preferredLayouts:[]},o),r=r||[];var a=o.preferredLayouts,s=a.indexOf("straight")!==-1,c;return c=s&&lb(e,t,n,i,o),c||(c=o.connectionEnd&&pb(t,e,i,r),c)||(c=o.connectionStart&&ub(e,t,n,r),c)?c:!o.connectionStart&&!o.connectionEnd&&r&&r.length?r:ab(e,t,n,i,o)}function cb(e,t,n){return e>=t&&e<=n}function Ul(e,t,n){var i={x:"width",y:"height"};return cb(t[e],n[e],n[e]+n[i[e]])}function lb(e,t,n,i,r){var o={},a,s;return s=Se(e,t),/^(top|bottom|left|right)$/.test(s)?(/top|bottom/.test(s)&&(a="x"),/left|right/.test(s)&&(a="y"),r.preserveDocking==="target"?Ul(a,i,e)?(o[a]=i[a],[{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y,original:{x:o.x!==void 0?o.x:n.x,y:o.y!==void 0?o.y:n.y}},{x:i.x,y:i.y}]):null:Ul(a,n,t)?(o[a]=n[a],[{x:n.x,y:n.y},{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y,original:{x:o.x!==void 0?o.x:i.x,y:o.y!==void 0?o.y:i.y}}]):null):null}function ub(e,t,n,i){return Ws(e,t,n,i)}function pb(e,t,n,i){var r=i.slice().reverse();return r=Ws(e,t,n,r),r?r.reverse():null}function Ws(e,t,n,i){function r(p){return p.length<3?!0:p.length>4?!1:!!ie(p,function(u,d){var f=p[d-1];return f&&zu(u,f)<3})}function o(p,u,d){var f=mt(u,p);switch(f){case"v":return{x:d.x,y:p.y};case"h":return{x:p.x,y:d.y}}return{x:p.x,y:p.y}}function a(p,u,d){var f;for(f=p.length-2;f!==0;f--)if(cc(p[f],u,Gl)||cc(p[f],d,Gl))return p.slice(f);return p}if(r(i))return null;var s=i[0],c=i.slice(),l;return c[0]=n,c[1]=o(c[1],s,n),l=a(c,e,t),l!==c&&(c=Ws(e,t,n,l)),c&&mt(c)?null:c}function db(e,t){if(uf(t))return t;switch(e){case"intersect":return"t:t";case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return t}}function fb(e){return e&&/^h|v|t|r|b|l:h|v|t|r|b|l$/.test(e)}function uf(e){return e&&/t|r|b|l/.test(e)}function hb(e){return{top:"bottom",bottom:"top",left:"right",right:"left","top-left":"bottom-right","bottom-right":"top-left","top-right":"bottom-left","bottom-left":"top-right"}[e]}function Wl(e,t,n,i){if(n==="h"&&(n=/left/.test(i)?"l":"r"),n==="v"&&(n=/top/.test(i)?"t":"b"),n==="t")return{original:e,x:e.x,y:t.y};if(n==="r")return{original:e,x:t.x+t.width,y:e.y};if(n==="b")return{original:e,x:e.x,y:t.y+t.height};if(n==="l")return{original:e,x:t.x,y:e.y};throw new Error("unexpected dockingDirection: <"+n+">")}function pf(e){return e.reduce(function(t,n,i){var r=t[t.length-1],o=e[i+1];return Fu(r,o,n,0)||t.push(n),t},[])}var vb=-10,mb=40,gb={default:["h:h"],fromGateway:["v:h"],toGateway:["h:v"],loop:{fromTop:["t:r"],fromRight:["r:b"],fromLeft:["l:t"],fromBottom:["b:l"]},boundaryLoop:{alternateHorizontalSide:"b",alternateVerticalSide:"l",default:"v"},messageFlow:["straight","v:v"],subProcess:["straight","h:h"],isHorizontal:!0},yb={default:["v:v"],fromGateway:["h:v"],toGateway:["v:h"],loop:{fromTop:["t:l"],fromRight:["r:t"],fromLeft:["l:b"],fromBottom:["b:r"]},boundaryLoop:{alternateHorizontalSide:"t",alternateVerticalSide:"r",default:"h"},messageFlow:["straight","h:h"],subProcess:["straight","v:v"],isHorizontal:!1},Ks={top:"bottom","top-right":"bottom-left","top-left":"bottom-right",right:"left",bottom:"top","bottom-right":"top-left","bottom-left":"top-right",left:"right"},qn={top:"t",right:"r",bottom:"b",left:"l"};function ho(e){this._elementRegistry=e}M(ho,cf);ho.prototype.layoutConnection=function(e,t){t||(t={});var n=t.source||e.source,i=t.target||e.target,r=t.waypoints||e.waypoints,o=t.connectionStart,a=t.connectionEnd,s=this._elementRegistry,c,l;if(o||(o=Kl(r&&r[0],n)),a||(a=Kl(r&&r[r.length-1],i)),(m(e,"bpmn:Association")||m(e,"bpmn:DataAssociation"))&&r&&!Yl(n,i))return[].concat([o],r.slice(1,-1),[a]);var p=Lp(n,s)?gb:yb;return m(e,"bpmn:MessageFlow")?c=bb(n,i,p):(m(e,"bpmn:SequenceFlow")||Yl(n,i))&&(n===i?c={preferredLayouts:Rb(n,e,p)}:m(n,"bpmn:BoundaryEvent")?c={preferredLayouts:Tb(n,i,a,p)}:ci(n)||ci(i)?c={preferredLayouts:p.subProcess,preserveDocking:Eb(n)}:m(n,"bpmn:Gateway")?c={preferredLayouts:p.fromGateway}:m(i,"bpmn:Gateway")?c={preferredLayouts:p.toGateway}:c={preferredLayouts:p.default}),c&&(c=S(c,t),l=pf(sb(n,i,o,a,r,c))),l||[o,a]};function _b(e){var t=e.host;return Se(L(e),t,vb)}function bb(e,t,n){return{preferredLayouts:n.messageFlow,preserveDocking:xb(e,t)}}function xb(e,t){return m(t,"bpmn:Participant")?"source":m(e,"bpmn:Participant")?"target":ci(t)?"source":ci(e)||m(t,"bpmn:Event")?"target":m(e,"bpmn:Event")?"source":null}function Eb(e){return ci(e)?"target":"source"}function Kl(e,t){return e?e.original||e:L(t)}function Yl(e,t){return m(t,"bpmn:Activity")&&m(e,"bpmn:BoundaryEvent")&&t.businessObject.isForCompensation}function ci(e){return m(e,"bpmn:SubProcess")&&Y(e)}function en(e,t){return e===t}function wb(e,t){return t.indexOf(e)!==-1}function Pn(e){var t=/right|left/.exec(e);return t&&t[0]}function Dn(e){var t=/top|bottom/.exec(e);return t&&t[0]}function ql(e,t){return Ks[e]===t}function Sb(e,t){var n=Pn(e),i=Ks[n];return t.indexOf(i)!==-1}function Cb(e,t){var n=Dn(e),i=Ks[n];return t.indexOf(i)!==-1}function df(e){return e==="right"||e==="left"}function Rb(e,t,n){var i=t.waypoints,r=i&&i.length&&Se(i[0],e);return r==="top"?n.loop.fromTop:r==="right"?n.loop.fromRight:r==="left"?n.loop.fromLeft:n.loop.fromBottom}function Tb(e,t,n,i){var r=L(e),o=L(t),a=_b(e),s,c,l=en(e.host,t),p=wb(a,["top","right","bottom","left"]),u=Se(o,r,{x:e.width/2+t.width/2,y:e.height/2+t.height/2});return l?Pb(a,p,e,t,n,i):(s=Db(a,u,p,i.isHorizontal),c=Mb(a,u,p,i.isHorizontal),[s+":"+c])}function Pb(e,t,n,i,r,o){var a=t?e:o.isHorizontal?Dn(e):Pn(e),s=qn[a],c;return t?df(e)?c=Xl("y",n,i,r)?"h":o.boundaryLoop.alternateHorizontalSide:c=Xl("x",n,i,r)?"v":o.boundaryLoop.alternateVerticalSide:c=o.boundaryLoop.default,[s+":"+c]}function Xl(e,t,n,i){var r=mb;return!(Lo(e,i,n,r)||Lo(e,i,{x:n.x+n.width,y:n.y+n.height},r)||Lo(e,i,L(t),r))}function Lo(e,t,n,i){return Math.abs(t[e]-n[e])<i}function Db(e,t,n,i){if(n)return qn[e];var r=Dn(e),o=Pn(e),a=Dn(t),s=Pn(t);if(i){if(en(r,a)||ql(o,s))return qn[r]}else if(en(o,s)||ql(r,a))return qn[o];return qn[i?o:r]}function Mb(e,t,n,i){return n?df(e)?Sb(e,t)||en(e,t)?"h":"v":Cb(e,t)||en(e,t)?"v":"h":i?en(Dn(e),Dn(t))?"h":"v":en(Pn(e),Pn(t))?"v":"h"}ho.$inject=["elementRegistry"];function Zl(e){return S({original:e.point.original||e.point},e.actual)}function zt(e,t){this._elementRegistry=e,this._graphicsFactory=t}zt.$inject=["elementRegistry","graphicsFactory"];zt.prototype.getCroppedWaypoints=function(e,t,n){t=t||e.source,n=n||e.target;var i=this.getDockingPoint(e,t,!0),r=this.getDockingPoint(e,n),o=e.waypoints.slice(i.idx+1,r.idx);return o.unshift(Zl(i)),o.push(Zl(r)),o};zt.prototype.getDockingPoint=function(e,t,n){var i=e.waypoints,r,o,a;return r=n?0:i.length-1,o=i[r],a=this._getIntersection(t,e,n),{point:o,actual:a||o,idx:r}};zt.prototype._getIntersection=function(e,t,n){var i=this._getShapePath(e),r=this._getConnectionPath(t);return ei(i,r,n)};zt.prototype._getConnectionPath=function(e){return this._graphicsFactory.getConnectionPath(e)};zt.prototype._getShapePath=function(e){return this._graphicsFactory.getShapePath(e)};zt.prototype._getGfx=function(e){return this._elementRegistry.getGraphics(e)};const ff={__init__:["modeling","bpmnUpdater"],__depends__:[Cy,Gy,Uy,Wy,Wd,b_,E_,P_,it,qu,qd],bpmnFactory:["type",Xe],bpmnUpdater:["type",Oe],elementFactory:["type",Bt],modeling:["type",Ce],layouter:["type",ho],connectionDocking:["type",zt]},Jl=Math.round;function vo(e,t,n,i,r,o){this._complexPreview=e,this._connectionDocking=t,this._elementFactory=n,this._eventBus=i,this._layouter=r,this._rules=o}vo.prototype.create=function(e,t,n){const i=this._complexPreview,r=this._connectionDocking,o=this._elementFactory,a=this._eventBus,s=this._layouter,c=this._rules,l=o.createShape(S({type:t},n)),p=a.fire("autoPlace",{source:e,shape:l});if(!p)return;S(l,{x:p.x-Jl(l.width/2),y:p.y-Jl(l.height/2)});const u=c.allowed("connection.create",{source:e,target:l,hints:{targetParent:e.parent}});let d=null;u&&(d=o.createConnection(u),d.waypoints=s.layoutConnection(d,{source:e,target:l}),d.waypoints=r.getCroppedWaypoints(d,e,l)),i.create({created:[l,d].filter(f=>!Uo(f))})};vo.prototype.cleanUp=function(){this._complexPreview.cleanUp()};vo.$inject=["complexPreview","connectionDocking","elementFactory","eventBus","layouter","rules"];const Ab={__depends__:[ja,eg,ff],__init__:["appendPreview"],appendPreview:["type",vo]};var Ql=Math.min,eu=Math.max;function Oo(e){e.preventDefault()}function Jn(e){e.stopPropagation()}function kb(e){return e.nodeType===Node.TEXT_NODE}function Ib(e){return[].slice.call(e)}function ot(e){this.container=e.container,this.parent=be('<div class="djs-direct-editing-parent"><div class="djs-direct-editing-content" contenteditable="true"></div></div>'),this.content=de("[contenteditable]",this.parent),this.keyHandler=e.keyHandler||function(){},this.resizeHandler=e.resizeHandler||function(){},this.autoResize=nn(this.autoResize,this),this.handlePaste=nn(this.handlePaste,this)}ot.prototype.create=function(e,t,n,i){var r=this,o=this.parent,a=this.content,s=this.container;i=this.options=i||{},t=this.style=t||{};var c=ut(t,["width","height","maxWidth","maxHeight","minWidth","minHeight","left","top","backgroundColor","position","overflow","border","wordWrap","textAlign","outline","transform"]);S(o.style,{width:e.width+"px",height:e.height+"px",maxWidth:e.maxWidth+"px",maxHeight:e.maxHeight+"px",minWidth:e.minWidth+"px",minHeight:e.minHeight+"px",left:e.x+"px",top:e.y+"px",backgroundColor:"#ffffff",position:"absolute",overflow:"visible",border:"1px solid #ccc",boxSizing:"border-box",wordWrap:"normal",textAlign:"center",outline:"none"},c);var l=ut(t,["fontFamily","fontSize","fontWeight","lineHeight","padding","paddingTop","paddingRight","paddingBottom","paddingLeft"]);return S(a.style,{boxSizing:"border-box",width:"100%",outline:"none",wordWrap:"break-word"},l),i.centerVertically&&S(a.style,{position:"absolute",top:"50%",transform:"translate(0, -50%)"},l),a.innerText=n,H.bind(a,"keydown",this.keyHandler),H.bind(a,"mousedown",Jn),H.bind(a,"paste",r.handlePaste),i.autoResize&&H.bind(a,"input",this.autoResize),i.resizable&&this.resizable(t),s.appendChild(o),this.setSelection(a.lastChild,a.lastChild&&a.lastChild.length),o};ot.prototype.handlePaste=function(e){var t=this.options,n=this.style;e.preventDefault();var i;if(e.clipboardData?i=e.clipboardData.getData("text/plain"):i=window.clipboardData.getData("Text"),this.insertText(i),t.autoResize){var r=this.autoResize(n);r&&this.resizeHandler(r)}};ot.prototype.insertText=function(e){e=Nb(e);var t=document.execCommand("insertText",!1,e);t||this._insertTextIE(e)};ot.prototype._insertTextIE=function(e){var t=this.getSelection(),n=t.startContainer,i=t.endContainer,r=t.startOffset,o=t.endOffset,a=t.commonAncestorContainer,s=Ib(a.childNodes),c,l;if(kb(a)){var p=n.textContent;n.textContent=p.substring(0,r)+e+p.substring(o),c=n,l=r+e.length}else if(n===this.content&&i===this.content){var u=document.createTextNode(e);this.content.insertBefore(u,s[r]),c=u,l=u.textContent.length}else{var d=s.indexOf(n),f=s.indexOf(i);s.forEach(function(h,g){g===d?h.textContent=n.textContent.substring(0,r)+e+i.textContent.substring(o):g>d&&g<=f&&xn(h)}),c=n,l=r+e.length}c&&l!==void 0&&setTimeout(function(){self.setSelection(c,l)})};ot.prototype.autoResize=function(){var e=this.parent,t=this.content,n=parseInt(this.style.fontSize)||12;if(t.scrollHeight>e.offsetHeight||t.scrollHeight<e.offsetHeight-n){var i=e.getBoundingClientRect(),r=t.scrollHeight;e.style.height=r+"px",this.resizeHandler({width:i.width,height:i.height,dx:0,dy:r-i.height})}};ot.prototype.resizable=function(){var e=this,t=this.parent,n=this.resizeHandle,i=parseInt(this.style.minWidth)||0,r=parseInt(this.style.minHeight)||0,o=parseInt(this.style.maxWidth)||1/0,a=parseInt(this.style.maxHeight)||1/0;if(!n){n=this.resizeHandle=be('<div class="djs-direct-editing-resize-handle"></div>');var s,c,l,p,u=function(h){Oo(h),Jn(h),s=h.clientX,c=h.clientY;var g=t.getBoundingClientRect();l=g.width,p=g.height,H.bind(document,"mousemove",d),H.bind(document,"mouseup",f)},d=function(h){Oo(h),Jn(h);var g=Ql(eu(l+h.clientX-s,i),o),v=Ql(eu(p+h.clientY-c,r),a);t.style.width=g+"px",t.style.height=v+"px",e.resizeHandler({width:l,height:p,dx:h.clientX-s,dy:h.clientY-c})},f=function(h){Oo(h),Jn(h),H.unbind(document,"mousemove",d,!1),H.unbind(document,"mouseup",f,!1)};H.bind(n,"mousedown",u)}S(n.style,{position:"absolute",bottom:"0px",right:"0px",cursor:"nwse-resize",width:"0",height:"0",borderTop:(parseInt(this.style.fontSize)/4||3)+"px solid transparent",borderRight:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderBottom:(parseInt(this.style.fontSize)/4||3)+"px solid #ccc",borderLeft:(parseInt(this.style.fontSize)/4||3)+"px solid transparent"}),t.appendChild(n)};ot.prototype.destroy=function(){var e=this.parent,t=this.content,n=this.resizeHandle;t.innerText="",e.removeAttribute("style"),t.removeAttribute("style"),H.unbind(t,"keydown",this.keyHandler),H.unbind(t,"mousedown",Jn),H.unbind(t,"input",this.autoResize),H.unbind(t,"paste",this.handlePaste),n&&(n.removeAttribute("style"),xn(n)),xn(e)};ot.prototype.getValue=function(){return this.content.innerText.trim()};ot.prototype.getSelection=function(){var e=window.getSelection(),t=e.getRangeAt(0);return t};ot.prototype.setSelection=function(e,t){var n=document.createRange();e===null?n.selectNodeContents(this.content):(n.setStart(e,t),n.setEnd(e,t));var i=window.getSelection();i.removeAllRanges(),i.addRange(n)};function Nb(e){return e.replace(/\r\n|\r|\n/g,`
`)}function Ze(e,t){this._eventBus=e,this._canvas=t,this._providers=[],this._textbox=new ot({container:t.getContainer(),keyHandler:nn(this._handleKey,this),resizeHandler:nn(this._handleResize,this)})}Ze.$inject=["eventBus","canvas"];Ze.prototype.registerProvider=function(e){this._providers.push(e)};Ze.prototype.isActive=function(e){return!!(this._active&&(!e||this._active.element===e))};Ze.prototype.cancel=function(){this._active&&(this._fire("cancel"),this.close())};Ze.prototype._fire=function(e,t){this._eventBus.fire("directEditing."+e,t||{active:this._active})};Ze.prototype.close=function(){this._textbox.destroy(),this._fire("deactivate"),this._active=null,this.resizable=void 0,this._canvas.restoreFocus&&this._canvas.restoreFocus()};Ze.prototype.complete=function(){var e=this._active;if(e){var t,n=e.context.bounds,i=this.$textbox.getBoundingClientRect(),r=this.getValue(),o=e.context.text;(r!==o||i.height!==n.height||i.width!==n.width)&&(t=this._textbox.container.getBoundingClientRect(),e.provider.update(e.element,r,e.context.text,{x:i.left-t.left,y:i.top-t.top,width:i.width,height:i.height})),this._fire("complete"),this.close()}};Ze.prototype.getValue=function(){return this._textbox.getValue()};Ze.prototype._handleKey=function(e){e.stopPropagation();var t=e.keyCode||e.charCode;if(t===27)return e.preventDefault(),this.cancel();if(t===13&&!e.shiftKey)return e.preventDefault(),this.complete()};Ze.prototype._handleResize=function(e){this._fire("resize",e)};Ze.prototype.activate=function(e){this.isActive()&&this.cancel();var t,n=ie(this._providers,function(i){return(t=i.activate(e))?i:null});return t&&(this.$textbox=this._textbox.create(t.bounds,t.style,t.text,t.options),this._active={element:e,context:t,provider:n},t.options&&t.options.resizable&&(this.resizable=!0),this._fire("activate")),!!t};const hf={__depends__:[ba],__init__:["directEditing"],directEditing:["type",Ze]};function Lb(e){return function(t){var n=t.target,i=P(e),r=i.eventDefinitions&&i.eventDefinitions[0],o=i.$type===n.type,a=(r&&r.$type)===n.eventDefinitionType,s=!!n.triggeredByEvent==!!i.triggeredByEvent,c=n.isExpanded===void 0||n.isExpanded===Y(e);return!o||!a||!s||!c}}var Ob=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],$b=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throwing",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}}],Bb=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Link intermediate catch event",actionName:"replace-with-link-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-link",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Link intermediate throw event",actionName:"replace-with-link-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-link",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:LinkEventDefinition",eventDefinitionAttrs:{name:""}}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],jb=[{label:"Start event",actionName:"replace-with-none-start",className:"bpmn-icon-start-event-none",target:{type:"bpmn:StartEvent"}},{label:"Intermediate throw event",actionName:"replace-with-none-intermediate-throw",className:"bpmn-icon-intermediate-event-none",target:{type:"bpmn:IntermediateThrowEvent"}},{label:"End event",actionName:"replace-with-none-end",className:"bpmn-icon-end-event-none",target:{type:"bpmn:EndEvent"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Cancel end event",actionName:"replace-with-cancel-end",className:"bpmn-icon-end-event-cancel",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CancelEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Terminate end event",actionName:"replace-with-terminate-end",className:"bpmn-icon-end-event-terminate",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:TerminateEventDefinition"}}],Hb=[{label:"Exclusive gateway",actionName:"replace-with-exclusive-gateway",className:"bpmn-icon-gateway-xor",target:{type:"bpmn:ExclusiveGateway"}},{label:"Parallel gateway",actionName:"replace-with-parallel-gateway",className:"bpmn-icon-gateway-parallel",target:{type:"bpmn:ParallelGateway"}},{label:"Inclusive gateway",actionName:"replace-with-inclusive-gateway",className:"bpmn-icon-gateway-or",target:{type:"bpmn:InclusiveGateway"}},{label:"Complex gateway",actionName:"replace-with-complex-gateway",className:"bpmn-icon-gateway-complex",target:{type:"bpmn:ComplexGateway"}},{label:"Event-based gateway",actionName:"replace-with-event-based-gateway",className:"bpmn-icon-gateway-eventbased",target:{type:"bpmn:EventBasedGateway",instantiate:!1,eventGatewayType:"Exclusive"}}],zb=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Ad-hoc sub-process",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}}],Fb=[{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}},{label:"Ad-hoc sub-process (collapsed)",actionName:"replace-with-collapsed-ad-hoc-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:AdHocSubProcess",isExpanded:!1}}],vf=[{label:"Transaction",actionName:"replace-with-transaction",className:"bpmn-icon-transaction",target:{type:"bpmn:Transaction",isExpanded:!0}},{label:"Sub-process",actionName:"replace-with-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Ad-hoc sub-process",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}},{label:"Event sub-process",actionName:"replace-with-event-subprocess",className:"bpmn-icon-event-subprocess-expanded",target:{type:"bpmn:SubProcess",triggeredByEvent:!0,isExpanded:!0}}],Gb=vf,tu=[{label:"Task",actionName:"replace-with-task",className:"bpmn-icon-task",target:{type:"bpmn:Task"}},{label:"User task",actionName:"replace-with-user-task",className:"bpmn-icon-user",target:{type:"bpmn:UserTask"}},{label:"Service task",actionName:"replace-with-service-task",className:"bpmn-icon-service",target:{type:"bpmn:ServiceTask"}},{label:"Send task",actionName:"replace-with-send-task",className:"bpmn-icon-send",target:{type:"bpmn:SendTask"}},{label:"Receive task",actionName:"replace-with-receive-task",className:"bpmn-icon-receive",target:{type:"bpmn:ReceiveTask"}},{label:"Manual task",actionName:"replace-with-manual-task",className:"bpmn-icon-manual",target:{type:"bpmn:ManualTask"}},{label:"Business rule task",actionName:"replace-with-rule-task",className:"bpmn-icon-business-rule",target:{type:"bpmn:BusinessRuleTask"}},{label:"Script task",actionName:"replace-with-script-task",className:"bpmn-icon-script",target:{type:"bpmn:ScriptTask"}},{label:"Call activity",actionName:"replace-with-call-activity",className:"bpmn-icon-call-activity",target:{type:"bpmn:CallActivity"}},{label:"Sub-process (collapsed)",actionName:"replace-with-collapsed-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:SubProcess",isExpanded:!1}},{label:"Sub-process (expanded)",actionName:"replace-with-expanded-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:SubProcess",isExpanded:!0}},{label:"Ad-hoc sub-process (collapsed)",actionName:"replace-with-collapsed-ad-hoc-subprocess",className:"bpmn-icon-subprocess-collapsed",target:{type:"bpmn:AdHocSubProcess",isExpanded:!1}},{label:"Ad-hoc sub-process (expanded)",actionName:"replace-with-ad-hoc-subprocess",className:"bpmn-icon-subprocess-expanded",target:{type:"bpmn:AdHocSubProcess",isExpanded:!0}}],Vb=[{label:"Data store reference",actionName:"replace-with-data-store-reference",className:"bpmn-icon-data-store",target:{type:"bpmn:DataStoreReference"}}],Ub=[{label:"Data object reference",actionName:"replace-with-data-object-reference",className:"bpmn-icon-data-object",target:{type:"bpmn:DataObjectReference"}}],Wb=[{label:"Message boundary event",actionName:"replace-with-message-boundary",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!0}},{label:"Timer boundary event",actionName:"replace-with-timer-boundary",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!0}},{label:"Escalation boundary event",actionName:"replace-with-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!0}},{label:"Conditional boundary event",actionName:"replace-with-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!0}},{label:"Error boundary event",actionName:"replace-with-error-boundary",className:"bpmn-icon-intermediate-event-catch-error",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",cancelActivity:!0}},{label:"Cancel boundary event",actionName:"replace-with-cancel-boundary",className:"bpmn-icon-intermediate-event-catch-cancel",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CancelEventDefinition",cancelActivity:!0}},{label:"Signal boundary event",actionName:"replace-with-signal-boundary",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!0}},{label:"Compensation boundary event",actionName:"replace-with-compensation-boundary",className:"bpmn-icon-intermediate-event-catch-compensation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",cancelActivity:!0}},{label:"Message boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-message-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-message",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:MessageEventDefinition",cancelActivity:!1}},{label:"Timer boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-timer",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:TimerEventDefinition",cancelActivity:!1}},{label:"Escalation boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-escalation",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",cancelActivity:!1}},{label:"Conditional boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-condition",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",cancelActivity:!1}},{label:"Signal boundary event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-boundary",className:"bpmn-icon-intermediate-event-catch-non-interrupting-signal",target:{type:"bpmn:BoundaryEvent",eventDefinitionType:"bpmn:SignalEventDefinition",cancelActivity:!1}}],Kb=[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!0}},{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!0}},{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!0}},{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!0}},{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition",isInterrupting:!0}},{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!0}},{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition",isInterrupting:!0}},{label:"Message start event (non-interrupting)",actionName:"replace-with-non-interrupting-message-start",className:"bpmn-icon-start-event-non-interrupting-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition",isInterrupting:!1}},{label:"Timer start event (non-interrupting)",actionName:"replace-with-non-interrupting-timer-start",className:"bpmn-icon-start-event-non-interrupting-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition",isInterrupting:!1}},{label:"Conditional start event (non-interrupting)",actionName:"replace-with-non-interrupting-conditional-start",className:"bpmn-icon-start-event-non-interrupting-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition",isInterrupting:!1}},{label:"Signal start event (non-interrupting)",actionName:"replace-with-non-interrupting-signal-start",className:"bpmn-icon-start-event-non-interrupting-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition",isInterrupting:!1}},{label:"Escalation start event (non-interrupting)",actionName:"replace-with-non-interrupting-escalation-start",className:"bpmn-icon-start-event-non-interrupting-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition",isInterrupting:!1}}],Yb=[{label:"Sequence flow",actionName:"replace-with-sequence-flow",className:"bpmn-icon-connection"},{label:"Default flow",actionName:"replace-with-default-flow",className:"bpmn-icon-default-flow"},{label:"Conditional flow",actionName:"replace-with-conditional-flow",className:"bpmn-icon-conditional-flow"}],qb=[{label:"Expanded pool/participant",actionName:"replace-with-expanded-pool",className:"bpmn-icon-participant",target:{type:"bpmn:Participant",isExpanded:!0}},{label:function(e){var t="Empty pool/participant";return e.children&&e.children.length&&(t+=" (removes content)"),t},actionName:"replace-with-collapsed-pool",className:"bpmn-icon-lane",target:{type:"bpmn:Participant",isExpanded:!1}}],Xb={"bpmn:MessageEventDefinition":[{label:"Message start event",actionName:"replace-with-message-start",className:"bpmn-icon-start-event-message",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate catch event",actionName:"replace-with-message-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-message",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message intermediate throw event",actionName:"replace-with-message-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-message",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}},{label:"Message end event",actionName:"replace-with-message-end",className:"bpmn-icon-end-event-message",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:MessageEventDefinition"}}],"bpmn:TimerEventDefinition":[{label:"Timer start event",actionName:"replace-with-timer-start",className:"bpmn-icon-start-event-timer",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}},{label:"Timer intermediate catch event",actionName:"replace-with-timer-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-timer",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:TimerEventDefinition"}}],"bpmn:ConditionalEventDefinition":[{label:"Conditional start event",actionName:"replace-with-conditional-start",className:"bpmn-icon-start-event-condition",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}},{label:"Conditional intermediate catch event",actionName:"replace-with-conditional-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-condition",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:ConditionalEventDefinition"}}],"bpmn:SignalEventDefinition":[{label:"Signal start event",actionName:"replace-with-signal-start",className:"bpmn-icon-start-event-signal",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate catch event",actionName:"replace-with-signal-intermediate-catch",className:"bpmn-icon-intermediate-event-catch-signal",target:{type:"bpmn:IntermediateCatchEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal intermediate throw event",actionName:"replace-with-signal-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-signal",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}},{label:"Signal end event",actionName:"replace-with-signal-end",className:"bpmn-icon-end-event-signal",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:SignalEventDefinition"}}],"bpmn:ErrorEventDefinition":[{label:"Error start event",actionName:"replace-with-error-start",className:"bpmn-icon-start-event-error",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}},{label:"Error end event",actionName:"replace-with-error-end",className:"bpmn-icon-end-event-error",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:ErrorEventDefinition"}}],"bpmn:EscalationEventDefinition":[{label:"Escalation start event",actionName:"replace-with-escalation-start",className:"bpmn-icon-start-event-escalation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Escalation intermediate throw event",actionName:"replace-with-escalation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-escalation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}},{label:"Escalation end event",actionName:"replace-with-escalation-end",className:"bpmn-icon-end-event-escalation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:EscalationEventDefinition"}}],"bpmn:CompensateEventDefinition":[{label:"Compensation start event",actionName:"replace-with-compensation-start",className:"bpmn-icon-start-event-compensation",target:{type:"bpmn:StartEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Compensation intermediate throw event",actionName:"replace-with-compensation-intermediate-throw",className:"bpmn-icon-intermediate-event-throw-compensation",target:{type:"bpmn:IntermediateThrowEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}},{label:"Compensation end event",actionName:"replace-with-compensation-end",className:"bpmn-icon-end-event-compensation",target:{type:"bpmn:EndEvent",eventDefinitionType:"bpmn:CompensateEventDefinition"}}]};const nu={"start-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
    <g transform="translate(0 995.64)">
      <path d="m1899 28.357c21.545 567.43-598.38 1023.5-1133.6 835.92-548.09-147.21-801.57-873.95-463.59-1330 302.62-480.3 1071.7-507.54 1407.6-49.847 122.14 153.12 190.07 348.07 189.59 543.91z" fill="none" stroke="currentColor" stroke-dasharray="418.310422, 361.2328165" stroke-linecap="round" stroke-width="100"/>
    </g>
  </svg>`,"intermediate-event-non-interrupting":`
  <svg viewBox="0 0 2048 2048" xmlns="http://www.w3.org/2000/svg">
     <g transform="translate(0 995.64)" fill="none" stroke="currentColor" stroke-linecap="round">
        <circle cx="1024" cy="28.357" r="875" stroke-dasharray="418.310422, 361.2328165" stroke-width="100"/>
        <circle cx="1024" cy="28.357" r="685" stroke-dasharray="348.31044857,261.23283643" stroke-dashoffset="500" stroke-width="100"/>
     </g>
  </svg>`};function Je(e,t,n,i,r,o,a,s){this._bpmnFactory=e,this._popupMenu=t,this._modeling=n,this._moddle=i,this._bpmnReplace=r,this._rules=o,this._translate=a,this._moddleCopy=s,this._register()}Je.$inject=["bpmnFactory","popupMenu","modeling","moddle","bpmnReplace","rules","translate","moddleCopy"];Je.prototype._register=function(){this._popupMenu.registerProvider("bpmn-replace",this)};Je.prototype.getPopupMenuEntries=function(e){var t=e.businessObject,n=this._rules,i=[],r,o=[];if(V(e)||!n.allowed("shape.replace",{element:e}))return{};var a=Lb(e);return m(t,"bpmn:DataObjectReference")?this._createEntries(e,Vb):m(t,"bpmn:DataStoreReference")&&!m(e.parent,"bpmn:Collaboration")?this._createEntries(e,Ub):(m(t,"bpmn:Event")&&!m(t,"bpmn:BoundaryEvent")&&(r=t.get("eventDefinitions")[0]?.$type,i=Xb[r]||[],!Pe(t.$parent)&&m(t.$parent,"bpmn:SubProcess")&&(i=U(i,function(s){return s.target.type!=="bpmn:StartEvent"}))),m(t,"bpmn:StartEvent")&&!m(t.$parent,"bpmn:SubProcess")?(o=U(Ob.concat(i),a),this._createEntries(e,o)):m(t,"bpmn:Participant")?(o=U(qb,function(s){return Y(e)!==s.target.isExpanded}),this._createEntries(e,o)):m(t,"bpmn:StartEvent")&&Pe(t.$parent)?(o=U(Kb.concat(i),function(s){var c=s.target,l=c.isInterrupting!==!1,p=t.isInterrupting===l;return a(s)||!a(s)&&!p}),this._createEntries(e,o)):m(t,"bpmn:StartEvent")&&!Pe(t.$parent)&&m(t.$parent,"bpmn:SubProcess")?(o=U($b.concat(i),a),this._createEntries(e,o)):m(t,"bpmn:EndEvent")?(o=U(jb.concat(i),function(s){var c=s.target;return c.eventDefinitionType=="bpmn:CancelEventDefinition"&&!m(t.$parent,"bpmn:Transaction")?!1:a(s)}),this._createEntries(e,o)):m(t,"bpmn:BoundaryEvent")?(o=U(Wb,function(s){var c=s.target;if(c.eventDefinitionType=="bpmn:CancelEventDefinition"&&!m(t.attachedToRef,"bpmn:Transaction"))return!1;var l=c.cancelActivity!==!1,p=t.cancelActivity==l;return a(s)||!a(s)&&!p}),this._createEntries(e,o)):m(t,"bpmn:IntermediateCatchEvent")||m(t,"bpmn:IntermediateThrowEvent")?(o=U(Bb.concat(i),a),this._createEntries(e,o)):m(t,"bpmn:Gateway")?(o=U(Hb,a),this._createEntries(e,o)):m(t,"bpmn:Transaction")?(o=U(vf,a),this._createEntries(e,o)):Pe(t)&&Y(e)?(o=U(Gb,a),this._createEntries(e,o)):m(t,"bpmn:AdHocSubProcess")&&Y(e)?(o=U(Fb,a),this._createEntries(e,o)):m(t,"bpmn:SubProcess")&&Y(e)?(o=U(zb,a),this._createEntries(e,o)):m(t,"bpmn:SubProcess")&&!Y(e)?(o=U(tu,function(s){var c=s.target.type===e.type,l=s.target.isExpanded===!0;return c===l}),this._createEntries(e,o)):m(t,"bpmn:SequenceFlow")?this._createSequenceFlowEntries(e,Yb):m(t,"bpmn:FlowNode")?(o=U(tu,a),this._createEntries(e,o)):{})};Je.prototype.getPopupMenuHeaderEntries=function(e){var t={};return m(e,"bpmn:Activity")&&!Pe(e)&&(t={...t,...this._getLoopCharacteristicsHeaderEntries(e)}),m(e,"bpmn:DataObjectReference")&&(t={...t,...this._getCollectionHeaderEntries(e)}),m(e,"bpmn:Participant")&&(t={...t,...this._getParticipantMultiplicityHeaderEntries(e)}),vd(e)&&(t={...t,...this._getNonInterruptingHeaderEntries(e)}),t};Je.prototype._createEntries=function(e,t){var n={},i=this;return w(t,function(r){n[r.actionName]=i._createEntry(r,e)}),n};Je.prototype._createSequenceFlowEntries=function(e,t){var n=P(e),i={},r=this._modeling,o=this._moddle,a=this;return w(t,function(s){switch(s.actionName){case"replace-with-default-flow":n.sourceRef.default!==n&&(m(n.sourceRef,"bpmn:ExclusiveGateway")||m(n.sourceRef,"bpmn:InclusiveGateway")||m(n.sourceRef,"bpmn:ComplexGateway")||m(n.sourceRef,"bpmn:Activity"))&&(i={...i,[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e.source,{default:n})})});break;case"replace-with-conditional-flow":!n.conditionExpression&&m(n.sourceRef,"bpmn:Activity")&&(i={...i,[s.actionName]:a._createEntry(s,e,function(){var c=o.create("bpmn:FormalExpression",{body:""});r.updateProperties(e,{conditionExpression:c})})});break;default:m(n.sourceRef,"bpmn:Activity")&&n.conditionExpression&&(i={...i,[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e,{conditionExpression:void 0})})}),(m(n.sourceRef,"bpmn:ExclusiveGateway")||m(n.sourceRef,"bpmn:InclusiveGateway")||m(n.sourceRef,"bpmn:ComplexGateway")||m(n.sourceRef,"bpmn:Activity"))&&n.sourceRef.default===n&&(i={...i,[s.actionName]:a._createEntry(s,e,function(){r.updateProperties(e.source,{default:void 0})})})}}),i};Je.prototype._createEntry=function(e,t,n){var i=this._translate,r=this._bpmnReplace.replaceElement,o=function(){return r(t,e.target)},a=e.label;return a&&typeof a=="function"&&(a=a(t)),n=n||o,{label:i(a),className:e.className,action:n}};Je.prototype._getLoopCharacteristicsHeaderEntries=function(e){var t=this,n=this._translate;function i(l,p){if(p.active){t._modeling.updateProperties(e,{loopCharacteristics:void 0});return}var u=e.businessObject.get("loopCharacteristics");u&&m(u,p.options.loopCharacteristics)?t._modeling.updateModdleProperties(e,u,{isSequential:p.options.isSequential}):(u=t._moddle.create(p.options.loopCharacteristics,{isSequential:p.options.isSequential}),t._modeling.updateProperties(e,{loopCharacteristics:u}))}var r=P(e),o=r.loopCharacteristics,a,s,c;return o&&(a=o.isSequential,s=o.isSequential===void 0,c=o.isSequential!==void 0&&!o.isSequential),{"toggle-parallel-mi":{className:"bpmn-icon-parallel-mi-marker",title:n("Parallel multi-instance"),active:c,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!1}},"toggle-sequential-mi":{className:"bpmn-icon-sequential-mi-marker",title:n("Sequential multi-instance"),active:a,action:i,options:{loopCharacteristics:"bpmn:MultiInstanceLoopCharacteristics",isSequential:!0}},"toggle-loop":{className:"bpmn-icon-loop-marker",title:n("Loop"),active:s,action:i,options:{loopCharacteristics:"bpmn:StandardLoopCharacteristics"}}}};Je.prototype._getCollectionHeaderEntries=function(e){var t=this,n=this._translate,i=e.businessObject.dataObjectRef;if(!i)return{};function r(a,s){t._modeling.updateModdleProperties(e,i,{isCollection:!s.active})}var o=i.isCollection;return{"toggle-is-collection":{className:"bpmn-icon-parallel-mi-marker",title:n("Collection"),active:o,action:r}}};Je.prototype._getParticipantMultiplicityHeaderEntries=function(e){var t=this,n=this._bpmnFactory,i=this._translate;function r(a,s){var c=s.active,l;c||(l=n.create("bpmn:ParticipantMultiplicity")),t._modeling.updateProperties(e,{participantMultiplicity:l})}var o=e.businessObject.participantMultiplicity;return{"toggle-participant-multiplicity":{className:"bpmn-icon-parallel-mi-marker",title:i("Participant multiplicity"),active:!!o,action:r}}};Je.prototype._getNonInterruptingHeaderEntries=function(e){const t=this._translate,n=P(e),i=this,r=md(e),o=m(e,"bpmn:BoundaryEvent")?nu["intermediate-event-non-interrupting"]:nu["start-event-non-interrupting"],a=!n[r];return{"toggle-non-interrupting":{imageHtml:o,title:t("Toggle non-interrupting"),active:a,action:function(){i._modeling.updateProperties(e,{[r]:!!a})}}}};const Zb={__depends__:[Oa,Wd,ja],__init__:["replaceMenuProvider"],replaceMenuProvider:["type",Je]};function Mi(e,t,n,i,r,o,a,s,c,l,p,u,d){e=e||{},i.registerProvider(this),this._contextPad=i,this._modeling=r,this._elementFactory=o,this._connect=a,this._create=s,this._popupMenu=c,this._canvas=l,this._rules=p,this._translate=u,this._eventBus=n,this._appendPreview=d,e.autoPlace!==!1&&(this._autoPlace=t.get("autoPlace",!1)),n.on("create.end",250,function(f){var h=f.context,g=h.shape;if(!(!ni(f)||!i.isOpen(g))){var v=i.getEntries(g);v.replace&&v.replace.action.click(f,g)}}),n.on("contextPad.close",function(){d.cleanUp()})}Mi.$inject=["config.contextPad","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","appendPreview"];Mi.prototype.getMultiElementContextPadEntries=function(e){var t=this._modeling,n={};return this._isDeleteAllowed(e)&&S(n,{delete:{group:"edit",className:"bpmn-icon-trash",title:this._translate("Delete"),action:{click:function(i,r){t.removeElements(r.slice())}}}}),n};Mi.prototype._isDeleteAllowed=function(e){var t=this._rules.allowed("elements.delete",{elements:e});return V(t)?Tr(e,n=>t.includes(n)):t};Mi.prototype.getContextPadEntries=function(e){var t=this._contextPad,n=this._modeling,i=this._elementFactory,r=this._connect,o=this._create,a=this._popupMenu,s=this._autoPlace,c=this._translate,l=this._appendPreview,p={};if(e.type==="label")return this._isDeleteAllowed([e])&&S(p,h()),p;var u=e.businessObject;function d(y,b){r.start(y,b)}function f(y,b){n.removeElements([b])}function h(){return{delete:{group:"edit",className:"bpmn-icon-trash",title:c("Delete"),action:{click:f}}}}function g(y){var b=5,E=t.getPad(y).html,C=E.getBoundingClientRect(),D={x:C.left,y:C.bottom+b};return D}function v(y,b,E,C){function D(j,q){var ne=i.createShape(S({type:y},C));o.start(j,ne,{source:q})}var A=s?function(j,q){var ne=i.createShape(S({type:y},C));s.append(q,ne)}:D,I=s?function(j,q){return l.create(q,y,C),()=>{l.cleanUp()}}:null;return{group:"model",className:b,title:E,action:{dragstart:D,click:A,hover:I}}}function _(y){return function(b,E){n.splitLane(E,y),t.open(E,!0)}}if(z(u,["bpmn:Lane","bpmn:Participant"])&&Y(e)){var x=Ot(e);S(p,{"lane-insert-above":{group:"lane-insert-above",className:"bpmn-icon-lane-insert-above",title:c("Add lane above"),action:{click:function(y,b){n.addLane(b,"top")}}}}),x.length<2&&((xe(e)?e.height>=120:e.width>=120)&&S(p,{"lane-divide-two":{group:"lane-divide",className:"bpmn-icon-lane-divide-two",title:c("Divide into two lanes"),action:{click:_(2)}}}),(xe(e)?e.height>=180:e.width>=180)&&S(p,{"lane-divide-three":{group:"lane-divide",className:"bpmn-icon-lane-divide-three",title:c("Divide into three lanes"),action:{click:_(3)}}})),S(p,{"lane-insert-below":{group:"lane-insert-below",className:"bpmn-icon-lane-insert-below",title:c("Add lane below"),action:{click:function(y,b){n.addLane(b,"bottom")}}}})}return m(u,"bpmn:FlowNode")&&(m(u,"bpmn:EventBasedGateway")?S(p,{"append.receive-task":v("bpmn:ReceiveTask","bpmn-icon-receive-task",c("Append receive task")),"append.message-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-message",c("Append message intermediate catch event"),{eventDefinitionType:"bpmn:MessageEventDefinition"}),"append.timer-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-timer",c("Append timer intermediate catch event"),{eventDefinitionType:"bpmn:TimerEventDefinition"}),"append.condition-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-condition",c("Append conditional intermediate catch event"),{eventDefinitionType:"bpmn:ConditionalEventDefinition"}),"append.signal-intermediate-event":v("bpmn:IntermediateCatchEvent","bpmn-icon-intermediate-event-catch-signal",c("Append signal intermediate catch event"),{eventDefinitionType:"bpmn:SignalEventDefinition"})}):iu(u,"bpmn:BoundaryEvent","bpmn:CompensateEventDefinition")?S(p,{"append.compensation-activity":v("bpmn:Task","bpmn-icon-task",c("Append compensation activity"),{isForCompensation:!0})}):!m(u,"bpmn:EndEvent")&&!u.isForCompensation&&!iu(u,"bpmn:IntermediateThrowEvent","bpmn:LinkEventDefinition")&&!Pe(u)&&S(p,{"append.end-event":v("bpmn:EndEvent","bpmn-icon-end-event-none",c("Append end event")),"append.gateway":v("bpmn:ExclusiveGateway","bpmn-icon-gateway-none",c("Append gateway")),"append.append-task":v("bpmn:Task","bpmn-icon-task",c("Append task")),"append.intermediate-event":v("bpmn:IntermediateThrowEvent","bpmn-icon-intermediate-event-none",c("Append intermediate/boundary event"))})),a.isEmpty(e,"bpmn-replace")||S(p,{replace:{group:"edit",className:"bpmn-icon-screw-wrench",title:c("Change element"),action:{click:function(y,b){var E=S(g(b),{cursor:{x:y.x,y:y.y}});a.open(b,"bpmn-replace",E,{title:c("Change element"),width:300,search:!0})}}}}),m(u,"bpmn:SequenceFlow")&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation"))}),m(u,"bpmn:MessageFlow")&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation"))}),z(u,["bpmn:FlowNode","bpmn:InteractionNode","bpmn:DataObjectReference","bpmn:DataStoreReference"])&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation")),connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect to other element"),action:{click:d,dragstart:d}}}),m(u,"bpmn:TextAnnotation")&&S(p,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect using association"),action:{click:d,dragstart:d}}}),z(u,["bpmn:DataObjectReference","bpmn:DataStoreReference"])&&S(p,{connect:{group:"connect",className:"bpmn-icon-connection-multi",title:c("Connect using data input association"),action:{click:d,dragstart:d}}}),m(u,"bpmn:Group")&&S(p,{"append.text-annotation":v("bpmn:TextAnnotation","bpmn-icon-text-annotation",c("Add text annotation"))}),this._isDeleteAllowed([e])&&S(p,h()),p};function iu(e,t,n){var i=e.$instanceOf(t),r=!1,o=e.eventDefinitions||[];return w(o,function(a){a.$type===n&&(r=!0)}),i&&r}const Jb={__depends__:[Ab,hf,lp,it,Va,eo,Zb],__init__:["contextPadProvider"],contextPadProvider:["type",Mi]};var Qb={horizontal:["x","width"],vertical:["y","height"]},ru=5;function Tt(e,t){this._modeling=e,this._filters=[],this.registerFilter(function(n){var i=t.allowed("elements.distribute",{elements:n});return V(i)?i:i?n:[]})}Tt.$inject=["modeling","rules"];Tt.prototype.registerFilter=function(e){if(typeof e!="function")throw new Error("the filter has to be a function");this._filters.push(e)};Tt.prototype.trigger=function(e,t){var n=this._modeling,i,r;if(!(e.length<3)&&(this._setOrientation(t),r=this._filterElements(e),i=this._createGroups(r),!(i.length<=2)))return n.distributeElements(i,this._axis,this._dimension),i};Tt.prototype._filterElements=function(e){var t=this._filters,n=this._axis,i=this._dimension,r=[].concat(e);return t.length?(w(t,function(o){r=o(r,n,i)}),r):e};Tt.prototype._createGroups=function(e){var t=[],n=this,i=this._axis,r=this._dimension;if(!i)throw new Error('must have a defined "axis" and "dimension"');var o=bt(e,i);return w(o,function(a,s){var c=n._findRange(a,i,r),l,p=t[t.length-1];p&&n._hasIntersection(p.range,c)?t[t.length-1].elements.push(a):(l={range:c,elements:[a]},t.push(l))}),t};Tt.prototype._setOrientation=function(e){var t=Qb[e];this._axis=t[0],this._dimension=t[1]};Tt.prototype._hasIntersection=function(e,t){return Math.max(e.min,e.max)>=Math.min(t.min,t.max)&&Math.min(e.min,e.max)<=Math.max(t.min,t.max)};Tt.prototype._findRange=function(e){var t=e[this._axis],n=e[this._dimension];return{min:t+ru,max:t+n-ru}};const ex={__init__:["distributeElements"],distributeElements:["type",Tt]};function mo(e){Ye.call(this,e)}mo.$inject=["eventBus"];M(mo,Ye);mo.prototype.init=function(){this.addRule("elements.distribute",function(e){var t=e.elements;return t=U(t,function(n){var i=z(n,["bpmn:Association","bpmn:BoundaryEvent","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:Lane","bpmn:MessageFlow","bpmn:SequenceFlow","bpmn:TextAnnotation"]);return!(n.labelTarget||i)}),t=Pr(t),t.length<3?!1:t})};var ou={horizontal:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
                <polyline points="450 400 450 150 1350 150 1350 400" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
                <rect x="150" y="450" width="600" height="1200" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
                <rect x="1050" y="450" width="600" height="800" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
              </svg>`,vertical:`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1800 1800">
              <polyline points="400 1350 150 1350 150 450 400 450" style="fill:none;stroke:currentColor;stroke-width:100;stroke-linejoin:round;"/>
              <rect x="450" y="150" width="1200" height="600" rx="1" style="fill:none;stroke:currentColor;stroke-width:100;"></rect>
              <rect x="450" y="1050" width="800" height="600" rx="1" style="fill:currentColor;stroke:currentColor;stroke-width:100;opacity:.5;"></rect>
            </svg>`},tx=900;function Ai(e,t,n,i){this._distributeElements=t,this._translate=n,this._popupMenu=e,this._rules=i,e.registerProvider("align-elements",tx,this)}Ai.$inject=["popupMenu","distributeElements","translate","rules"];Ai.prototype.getPopupMenuEntries=function(e){var t={};return this._isAllowed(e)&&S(t,this._getEntries(e)),t};Ai.prototype._isAllowed=function(e){return this._rules.allowed("elements.distribute",{elements:e})};Ai.prototype._getEntries=function(e){var t=this._distributeElements,n=this._translate,i=this._popupMenu,r={"distribute-elements-horizontal":{group:"distribute",title:n("Distribute elements horizontally"),className:"bjs-align-elements-menu-entry",imageHtml:ou.horizontal,action:function(o,a){t.trigger(e,"horizontal"),i.close()}},"distribute-elements-vertical":{group:"distribute",title:n("Distribute elements vertically"),imageHtml:ou.vertical,action:function(o,a){t.trigger(e,"vertical"),i.close()}}};return r};const nx={__depends__:[Oa,ex],__init__:["bpmnDistributeElements","distributeElementsMenuProvider"],bpmnDistributeElements:["type",mo],distributeElementsMenuProvider:["type",Ai]};var mf="is not a registered action",ix="is already registered";function Qe(e,t){this._actions={};var n=this;e.on("diagram.init",function(){n._registerDefaultActions(t),e.fire("editorActions.init",{editorActions:n})})}Qe.$inject=["eventBus","injector"];Qe.prototype._registerDefaultActions=function(e){var t=e.get("commandStack",!1),n=e.get("modeling",!1),i=e.get("selection",!1),r=e.get("zoomScroll",!1),o=e.get("copyPaste",!1),a=e.get("canvas",!1),s=e.get("rules",!1),c=e.get("keyboardMove",!1),l=e.get("keyboardMoveSelection",!1);t&&(this.register("undo",function(){t.undo()}),this.register("redo",function(){t.redo()})),o&&i&&this.register("copy",function(){var p=i.get();if(p.length)return o.copy(p)}),o&&this.register("paste",function(){o.paste()}),r&&this.register("stepZoom",function(p){r.stepZoom(p.value)}),a&&this.register("zoom",function(p){a.zoom(p.value)}),n&&i&&s&&this.register("removeSelection",function(){var p=i.get();if(p.length){var u=s.allowed("elements.delete",{elements:p}),d;u!==!1&&(V(u)?d=u:d=p,d.length&&n.removeElements(d.slice()))}}),c&&this.register("moveCanvas",function(p){c.moveCanvas(p)}),l&&this.register("moveSelection",function(p){l.moveSelection(p.direction,p.accelerated)})};Qe.prototype.trigger=function(e,t){if(!this._actions[e])throw Ys(e,mf);return this._actions[e](t)};Qe.prototype.register=function(e,t){var n=this;if(typeof e=="string")return this._registerAction(e,t);w(e,function(i,r){n._registerAction(r,i)})};Qe.prototype._registerAction=function(e,t){if(this.isRegistered(e))throw Ys(e,ix);this._actions[e]=t};Qe.prototype.unregister=function(e){if(!this.isRegistered(e))throw Ys(e,mf);this._actions[e]=void 0};Qe.prototype.getActions=function(){return Object.keys(this._actions)};Qe.prototype.isRegistered=function(e){return!!this._actions[e]};function Ys(e,t){return new Error(e+" "+t)}const rx={__init__:["editorActions"],editorActions:["type",Qe]};function go(e){e.invoke(Qe,this)}M(go,Qe);go.$inject=["injector"];go.prototype._registerDefaultActions=function(e){Qe.prototype._registerDefaultActions.call(this,e);var t=e.get("canvas",!1),n=e.get("elementRegistry",!1),i=e.get("selection",!1),r=e.get("spaceTool",!1),o=e.get("lassoTool",!1),a=e.get("handTool",!1),s=e.get("globalConnect",!1),c=e.get("distributeElements",!1),l=e.get("alignElements",!1),p=e.get("directEditing",!1),u=e.get("searchPad",!1),d=e.get("modeling",!1),f=e.get("contextPad",!1);t&&n&&i&&this._registerAction("selectElements",function(){var h=t.getRootElement(),g=n.filter(function(v){return v!==h});return i.select(g),g}),r&&this._registerAction("spaceTool",function(){r.toggle()}),o&&this._registerAction("lassoTool",function(){o.toggle()}),a&&this._registerAction("handTool",function(){a.toggle()}),s&&this._registerAction("globalConnectTool",function(){s.toggle()}),i&&c&&this._registerAction("distributeElements",function(h){var g=i.get(),v=h.type;g.length&&c.trigger(g,v)}),i&&l&&this._registerAction("alignElements",function(h){var g=i.get(),v=[],_=h.type;g.length&&(v=U(g,function(x){return!m(x,"bpmn:Lane")}),l.trigger(v,_))}),i&&d&&this._registerAction("setColor",function(h){var g=i.get();g.length&&d.setColor(g,h)}),i&&p&&this._registerAction("directEditing",function(){var h=i.get();h.length&&p.activate(h[0])}),u&&this._registerAction("find",function(){u.toggle()}),t&&d&&this._registerAction("moveToOrigin",function(){var h=t.getRootElement(),g,v;m(h,"bpmn:Collaboration")?v=n.filter(function(_){return m(_.parent,"bpmn:Collaboration")}):v=n.filter(function(_){return _!==h&&!m(_.parent,"bpmn:SubProcess")}),g=Ae(v),d.moveElements(v,{x:-g.x,y:-g.y},h)}),i&&f&&this._registerAction("replaceElement",function(h){f.triggerEntry("replace","click",h)})};const ox={__depends__:[rx],editorActions:["type",go]};function gf(e){e.on(["create.init","shape.move.init"],function(t){var n=t.context,i=t.shape;z(i,["bpmn:Participant","bpmn:SubProcess","bpmn:TextAnnotation"])&&(n.gridSnappingContext||(n.gridSnappingContext={}),n.gridSnappingContext.snapLocation="top-left")})}gf.$inject=["eventBus"];var mr=10;function $o(e,t,n){return n||(n="round"),Math[n](e/t)*t}var ax=1200,sx=800;function Ft(e,t,n){var i=!n||n.active!==!1;this._eventBus=t;var r=this;t.on("diagram.init",sx,function(){r.setActive(i)}),t.on(["create.move","create.end","bendpoint.move.move","bendpoint.move.end","connect.move","connect.end","connectionSegment.move.move","connectionSegment.move.end","resize.move","resize.end","shape.move.move","shape.move.end"],ax,function(o){var a=o.originalEvent;if(!(!r.active||a&&We(a))){var s=o.context,c=s.gridSnappingContext;c||(c=s.gridSnappingContext={}),["x","y"].forEach(function(l){var p={},u=lx(o,l,e);u&&(p.offset=u);var d=cx(o,l);d&&S(p,d),Rn(o,l)||r.snapEvent(o,l,p)})}})}Ft.prototype.snapEvent=function(e,t,n){var i=this.snapValue(e[t],n);pe(e,t,i)};Ft.prototype.getGridSpacing=function(){return mr};Ft.prototype.snapValue=function(e,t){var n=0;t&&t.offset&&(n=t.offset),e+=n,e=$o(e,mr);var i,r;return t&&t.min&&(i=t.min,G(i)&&(i=$o(i+n,mr,"ceil"),e=Math.max(e,i))),t&&t.max&&(r=t.max,G(r)&&(r=$o(r+n,mr,"floor"),e=Math.min(e,r))),e-=n,e};Ft.prototype.isActive=function(){return this.active};Ft.prototype.setActive=function(e){this.active=e,this._eventBus.fire("gridSnapping.toggle",{active:e})};Ft.prototype.toggleActive=function(){this.setActive(!this.active)};Ft.$inject=["elementRegistry","eventBus","config.gridSnapping"];function cx(e,t){var n=e.context,i=n.createConstraints,r=n.resizeConstraints||{},o=n.gridSnappingContext,a=o.snapConstraints;if(a&&a[t])return a[t];a||(a=o.snapConstraints={}),a[t]||(a[t]={});var s=n.direction;i&&(gr(t)?(a.x.min=i.left,a.x.max=i.right):(a.y.min=i.top,a.y.max=i.bottom));var c=r.min,l=r.max;return c&&(gr(t)?su(s)?a.x.max=c.left:a.x.min=c.right:au(s)?a.y.max=c.top:a.y.min=c.bottom),l&&(gr(t)?su(s)?a.x.min=l.left:a.x.max=l.right:au(s)?a.y.min=l.top:a.y.max=l.bottom),a[t]}function lx(e,t,n){var i=e.context,r=e.shape,o=i.gridSnappingContext,a=o.snapLocation,s=o.snapOffset;return s&&G(s[t])||(s||(s=o.snapOffset={}),G(s[t])||(s[t]=0),!r)||(n.get(r.id)||(gr(t)?s[t]+=r[t]+r.width/2:s[t]+=r[t]+r.height/2),!a)||(t==="x"?/left/.test(a)?s[t]-=r.width/2:/right/.test(a)&&(s[t]+=r.width/2):/top/.test(a)?s[t]-=r.height/2:/bottom/.test(a)&&(s[t]+=r.height/2)),s[t]}function gr(e){return e==="x"}function au(e){return e.indexOf("n")!==-1}function su(e){return e.indexOf("w")!==-1}function sn(e,t){R.call(this,e),this._gridSnapping=t;var n=this;this.preExecute("shape.resize",function(i){var r=i.context,o=r.hints||{},a=o.autoResize;if(a){var s=r.shape,c=r.newBounds;Dr(a)?r.newBounds=n.snapComplex(c,a):r.newBounds=n.snapSimple(s,c)}})}sn.$inject=["eventBus","gridSnapping","modeling"];M(sn,R);sn.prototype.snapSimple=function(e,t){var n=this._gridSnapping;return t.width=n.snapValue(t.width,{min:t.width}),t.height=n.snapValue(t.height,{min:t.height}),t.x=e.x+e.width/2-t.width/2,t.y=e.y+e.height/2-t.height/2,t};sn.prototype.snapComplex=function(e,t){return/w|e/.test(t)&&(e=this.snapHorizontally(e,t)),/n|s/.test(t)&&(e=this.snapVertically(e,t)),e};sn.prototype.snapHorizontally=function(e,t){var n=this._gridSnapping,i=/w/.test(t),r=/e/.test(t),o={};return o.width=n.snapValue(e.width,{min:e.width}),r&&(i?(o.x=n.snapValue(e.x,{max:e.x}),o.width+=n.snapValue(e.x-o.x,{min:e.x-o.x})):e.x=e.x+e.width-o.width),S(e,o),e};sn.prototype.snapVertically=function(e,t){var n=this._gridSnapping,i=/n/.test(t),r=/s/.test(t),o={};return o.height=n.snapValue(e.height,{min:e.height}),i&&(r?(o.y=n.snapValue(e.y,{max:e.y}),o.height+=n.snapValue(e.y-o.y,{min:e.y-o.y})):e.y=e.y+e.height-o.height),S(e,o),e};var ux=2e3;function yf(e,t){e.on(["spaceTool.move","spaceTool.end"],ux,function(n){var i=n.context;if(i.initialized){var r=i.axis,o;r==="x"?(o=t.snapValue(n.dx),n.x=n.x+o-n.dx,n.dx=o):(o=t.snapValue(n.dy),n.y=n.y+o-n.dy,n.dy=o)}})}yf.$inject=["eventBus","gridSnapping"];const px={__init__:["gridSnappingResizeBehavior","gridSnappingSpaceToolBehavior"],gridSnappingResizeBehavior:["type",sn],gridSnappingSpaceToolBehavior:["type",yf]},dx={__depends__:[px],__init__:["gridSnapping"],gridSnapping:["type",Ft]};var fx=2e3;function _f(e,t,n){e.on("autoPlace",fx,function(i){var r=i.source,o=L(r),a=i.shape,s=Op(r,a,n);return["x","y"].forEach(function(c){var l={};s[c]!==o[c]&&(s[c]>o[c]?l.min=s[c]:l.max=s[c],m(a,"bpmn:TextAnnotation")&&(hx(c)?l.offset=-a.width/2:l.offset=-a.height/2),s[c]=t.snapValue(s[c],l))}),s})}_f.$inject=["eventBus","gridSnapping","elementRegistry"];function hx(e){return e==="x"}var vx=1750;function bf(e,t,n){t.on(["create.start","shape.move.start"],vx,function(i){var r=i.context,o=r.shape,a=e.getRootElement();if(!(!m(o,"bpmn:Participant")||!m(a,"bpmn:Process")||!a.children.length)){var s=r.createConstraints;s&&(o.width=n.snapValue(o.width,{min:o.width}),o.height=n.snapValue(o.height,{min:o.height}))}})}bf.$inject=["canvas","eventBus","gridSnapping"];var mx=3e3;function yo(e,t,n){R.call(this,e),this._gridSnapping=t;var i=this;this.postExecuted(["connection.create","connection.layout"],mx,function(r){var o=r.context,a=o.connection,s=o.hints||{},c=a.waypoints;s.connectionStart||s.connectionEnd||s.createElementsBehavior===!1||gx(c)&&n.updateWaypoints(a,i.snapMiddleSegments(c))})}yo.$inject=["eventBus","gridSnapping","modeling"];M(yo,R);yo.prototype.snapMiddleSegments=function(e){var t=this._gridSnapping,n;e=e.slice();for(var i=1;i<e.length-2;i++)n=bx(t,e[i],e[i+1]),e[i]=n[0],e[i+1]=n[1];return e};function gx(e){return e.length>3}function yx(e){return e==="h"}function _x(e){return e==="v"}function bx(e,t,n){var i=mt(t,n),r={};return yx(i)&&(r.y=e.snapValue(t.y)),_x(i)&&(r.x=e.snapValue(t.x)),("x"in r||"y"in r)&&(t=S({},t,r),n=S({},n,r)),[t,n]}const xx={__init__:["gridSnappingAutoPlaceBehavior","gridSnappingParticipantBehavior","gridSnappingLayoutConnectionBehavior"],gridSnappingAutoPlaceBehavior:["type",_f],gridSnappingParticipantBehavior:["type",bf],gridSnappingLayoutConnectionBehavior:["type",yo]},Ex={__depends__:[dx,xx],__init__:["bpmnGridSnapping"],bpmnGridSnapping:["type",gf]};var wx=30,xf=30;function ki(e,t){this._interactionEvents=t;var n=this;e.on(["interactionEvents.createHit","interactionEvents.updateHit"],function(i){var r=i.element,o=i.gfx;if(m(r,"bpmn:Lane"))return n._createParticipantHit(r,o);if(m(r,"bpmn:Participant"))return Y(r)?n._createParticipantHit(r,o):n._createDefaultHit(r,o);if(m(r,"bpmn:SubProcess"))return Y(r)?n._createSubProcessHit(r,o):n._createDefaultHit(r,o)})}ki.$inject=["eventBus","interactionEvents"];ki.prototype._createDefaultHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createDefaultHit(e,t),!0};ki.prototype._createParticipantHit=function(e,t){this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height});var n=xe(e)?{width:wx,height:e.height}:{width:e.width,height:xf};return this._interactionEvents.createBoxHit(t,"all",n),!0};ki.prototype._createSubProcessHit=function(e,t){return this._interactionEvents.removeHits(t),this._interactionEvents.createBoxHit(t,"no-move",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"click-stroke",{width:e.width,height:e.height}),this._interactionEvents.createBoxHit(t,"all",{width:e.width,height:xf}),!0};const Sx={__init__:["bpmnInteractionEvents"],bpmnInteractionEvents:["type",ki]};function _o(e){e.invoke(Mn,this)}M(_o,Mn);_o.$inject=["injector"];_o.prototype.registerBindings=function(e,t){Mn.prototype.registerBindings.call(this,e,t);function n(i,r){t.isRegistered(i)&&e.addListener(r)}n("selectElements",function(i){var r=i.keyEvent;if(e.isKey(["a","A"],r)&&e.isCmd(r))return t.trigger("selectElements"),!0}),n("find",function(i){var r=i.keyEvent;if(e.isKey(["f","F"],r)&&e.isCmd(r))return t.trigger("find"),!0}),n("spaceTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["s","S"],r))return t.trigger("spaceTool"),!0}),n("lassoTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["l","L"],r))return t.trigger("lassoTool"),!0}),n("handTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["h","H"],r))return t.trigger("handTool"),!0}),n("globalConnectTool",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["c","C"],r))return t.trigger("globalConnectTool"),!0}),n("directEditing",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["e","E"],r))return t.trigger("directEditing"),!0}),n("replaceElement",function(i){var r=i.keyEvent;if(!e.hasModifier(r)&&e.isKey(["r","R"],r))return t.trigger("replaceElement",r),!0})};const Cx={__depends__:[Da],__init__:["keyboardBindings"],keyboardBindings:["type",_o]};var Rx={moveSpeed:1,moveSpeedAccelerated:10},Tx=1500,cu="left",lu="up",uu="right",pu="down",Px={ArrowLeft:cu,Left:cu,ArrowUp:lu,Up:lu,ArrowRight:uu,Right:uu,ArrowDown:pu,Down:pu},Dx={left:function(e){return{x:-e,y:0}},up:function(e){return{x:0,y:-e}},right:function(e){return{x:e,y:0}},down:function(e){return{x:0,y:e}}};function Ef(e,t,n,i,r){var o=this;this._config=S({},Rx,e||{}),t.addListener(Tx,function(a){var s=a.keyEvent,c=Px[s.key];if(c&&!t.isCmd(s)){var l=t.isShift(s);return o.moveSelection(c,l),!0}}),this.moveSelection=function(a,s){var c=r.get();if(c.length){var l=this._config[s?"moveSpeedAccelerated":"moveSpeed"],p=Dx[a](l),u=i.allowed("elements.move",{shapes:c});u&&n.moveElements(c,p)}}}Ef.$inject=["config.keyboardMoveSelection","keyboard","modeling","rules","selection"];const Mx={__depends__:[Da,it],__init__:["keyboardMoveSelection"],keyboardMoveSelection:["type",Ef]};var du=10;function Ii(e,t,n,i){this._dragging=i,this._rules=t;var r=this;function o(c,l){var p=c.shape,u=c.direction,d=c.resizeConstraints,f;c.delta=l,f=dg(p,u,l),c.newBounds=hg(f,d),c.canExecute=r.canResize(c)}function a(c){var l=c.resizeConstraints,p=c.minBounds;l===void 0&&(p===void 0&&(p=r.computeMinResizeBox(c)),c.resizeConstraints={min:k(p)})}function s(c){var l=c.shape,p=c.canExecute,u=c.newBounds;if(p){if(u=Uu(u),!Ax(l,u))return;n.resizeShape(l,u)}}e.on("resize.start",function(c){a(c.context)}),e.on("resize.move",function(c){var l={x:c.dx,y:c.dy};o(c.context,l)}),e.on("resize.end",function(c){s(c.context)})}Ii.prototype.canResize=function(e){var t=this._rules,n=ut(e,["newBounds","shape","delta","direction"]);return t.allowed("shape.resize",n)};Ii.prototype.activate=function(e,t,n){var i=this._dragging,r,o;if(typeof n=="string"&&(n={direction:n}),r=S({shape:t},n),o=r.direction,!o)throw new Error("must provide a direction (n|w|s|e|nw|se|ne|sw)");i.init(e,wf(t,o),"resize",{autoActivate:!0,cursor:kx(o),data:{shape:t,context:r}})};Ii.prototype.computeMinResizeBox=function(e){var t=e.shape,n=e.direction,i,r;return i=e.minDimensions||{width:du,height:du},r=ad(t,e.childrenBoxPadding),vg(n,t,i,r)};Ii.$inject=["eventBus","rules","modeling","dragging"];function Ax(e,t){return e.x!==t.x||e.y!==t.y||e.width!==t.width||e.height!==t.height}function wf(e,t){var n=L(e),i=k(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function kx(e){var t="resize-";return e==="n"||e==="s"?t+"ns":e==="e"||e==="w"?t+"ew":e==="nw"||e==="se"?t+"nwse":t+"nesw"}var fu="djs-resizing",hu="resize-not-ok",Ix=500;function Sf(e,t,n){function i(o){var a=o.shape,s=o.newBounds,c=o.frame;c||(c=o.frame=n.addFrame(a,t.getActiveLayer()),t.addMarker(a,fu)),s.width>5&&$(c,{x:s.x,width:s.width}),s.height>5&&$(c,{y:s.y,height:s.height}),o.canExecute?te(c).remove(hu):te(c).add(hu)}function r(o){var a=o.shape,s=o.frame;s&&we(o.frame),t.removeMarker(a,fu)}e.on("resize.move",Ix,function(o){i(o.context)}),e.on("resize.cleanup",function(o){r(o.context)})}Sf.$inject=["eventBus","canvas","previewSupport"];var ir=-6,rr=8,or=20,Yn="djs-resizer",Nx=["n","w","s","e","nw","ne","se","sw"];function Gt(e,t,n,i){this._resize=i,this._canvas=t;var r=this;e.on("selection.changed",function(o){var a=o.newSelection;r.removeResizers(),a.length===1&&w(a,nn(r.addResizer,r))}),e.on("shape.changed",function(o){var a=o.element;n.isSelected(a)&&(r.removeResizers(),r.addResizer(a))})}Gt.prototype.makeDraggable=function(e,t,n){var i=this._resize;function r(o){wa(o)&&i.activate(o,e,n)}H.bind(t,"mousedown",r),H.bind(t,"touchstart",r)};Gt.prototype._createResizer=function(e,t,n,i){var r=this._getResizersParent(),o=Lx(i),a=W("g");te(a).add(Yn),te(a).add(Yn+"-"+e.id),te(a).add(Yn+"-"+i),X(r,a);var s=W("rect");$(s,{x:-rr/2+o.x,y:-rr/2+o.y,width:rr,height:rr}),te(s).add(Yn+"-visual"),X(a,s);var c=W("rect");return $(c,{x:-or/2+o.x,y:-or/2+o.y,width:or,height:or}),te(c).add(Yn+"-hit"),X(a,c),yh(a,t,n),a};Gt.prototype.createResizer=function(e,t){var n=wf(e,t),i=this._createResizer(e,n.x,n.y,t);this.makeDraggable(e,i,t)};Gt.prototype.addResizer=function(e){var t=this;ee(e)||!this._resize.canResize({shape:e})||w(Nx,function(n){t.createResizer(e,n)})};Gt.prototype.removeResizers=function(){var e=this._getResizersParent();kr(e)};Gt.prototype._getResizersParent=function(){return this._canvas.getLayer("resizers")};Gt.$inject=["eventBus","canvas","selection","resize"];function Lx(e){var t={x:0,y:0};return e.indexOf("e")!==-1?t.x=-ir:e.indexOf("w")!==-1&&(t.x=ir),e.indexOf("s")!==-1?t.y=-ir:e.indexOf("n")!==-1&&(t.y=ir),t}const Cf={__depends__:[dt,St,Ln],__init__:["resize","resizePreview","resizeHandles"],resize:["type",Ii],resizePreview:["type",Sf],resizeHandles:["type",Gt]};var Ox=2e3;function Ni(e,t,n,i,r,o,a){this._bpmnFactory=t,this._canvas=n,this._modeling=r,this._textRenderer=a,i.registerProvider(this),e.on("element.dblclick",function(c){s(c.element,!0)}),e.on(["autoPlace.start","canvas.viewbox.changing","drag.init","element.mousedown","popupMenu.open","root.set","selection.changed"],function(){i.isActive()&&i.complete()}),e.on(["shape.remove","connection.remove"],Ox,function(c){i.isActive(c.element)&&i.cancel()}),e.on(["commandStack.changed"],function(c){i.isActive()&&i.cancel()}),e.on("directEditing.activate",function(c){o.removeResizers()}),e.on("create.end",500,function(c){var l=c.context,p=l.shape,u=c.context.canExecute,d=c.isTouch;d||u&&(l.hints&&l.hints.createElementsBehavior===!1||s(p))}),e.on("autoPlace.end",500,function(c){s(c.shape)});function s(c,l){(l||z(c,["bpmn:Task","bpmn:TextAnnotation","bpmn:Participant"])||qs(c))&&i.activate(c)}}Ni.$inject=["eventBus","bpmnFactory","canvas","directEditing","modeling","resizeHandles","textRenderer"];Ni.prototype.activate=function(e){var t=rn(e);if(t!==void 0){var n={text:t},i=this.getEditingBBox(e);S(n,i);var r={},o=n.style||{};return S(o,{backgroundColor:null,border:null}),(z(e,["bpmn:Task","bpmn:Participant","bpmn:Lane","bpmn:CallActivity"])||qs(e))&&S(r,{centerVertically:!0}),En(e)&&(S(r,{autoResize:!0}),S(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),m(e,"bpmn:TextAnnotation")&&(S(r,{resizable:!0,autoResize:!0}),S(o,{backgroundColor:"#ffffff",border:"1px solid #ccc"})),S(n,{options:r,style:o}),n}};Ni.prototype.getEditingBBox=function(e){var t=this._canvas,n=e.label||e,i=t.getAbsoluteBBox(n),r={x:i.x+i.width/2,y:i.y+i.height/2},o={x:i.x,y:i.y},a=t.zoom(),s=this._textRenderer.getDefaultStyle(),c=this._textRenderer.getExternalStyle(),l=c.fontSize*a,p=c.lineHeight,u=s.fontSize*a,d=s.lineHeight,f={fontFamily:this._textRenderer.getDefaultStyle().fontFamily,fontWeight:this._textRenderer.getDefaultStyle().fontWeight};if(m(e,"bpmn:Lane")||jx(e)){var h=xe(e),g=h?{width:i.height,height:30*a,x:i.x-i.height/2+15*a,y:r.y-30*a/2}:{width:i.width,height:30*a};S(o,g),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px",transform:h?"rotate(-90deg)":null})}if(Bx(e)){var v=xe(e),_=v?{width:i.width,height:i.height}:{width:i.height,height:i.width,x:r.x-i.height/2,y:r.y-i.width/2};S(o,_),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px",transform:v?null:"rotate(-90deg)"})}(z(e,["bpmn:Task","bpmn:CallActivity"])||qs(e))&&(S(o,{width:i.width,height:i.height}),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px"})),$x(e)&&(S(o,{width:i.width,x:i.x}),S(f,{fontSize:u+"px",lineHeight:d,paddingTop:7*a+"px",paddingBottom:7*a+"px",paddingLeft:5*a+"px",paddingRight:5*a+"px"}));var x=90*a,y=7*a,b=4*a;if(n.labelTarget&&(S(o,{width:x,height:i.height+y+b,x:r.x-x/2,y:i.y-y}),S(f,{fontSize:l+"px",lineHeight:p,paddingTop:y+"px",paddingBottom:b+"px"})),En(n)&&!Ir(n)&&!F(n)){var E=Yu(e),C=t.getAbsoluteBBox({x:E.x,y:E.y,width:0,height:0}),D=l+y+b;S(o,{width:x,height:D,x:C.x-x/2,y:C.y-D/2}),S(f,{fontSize:l+"px",lineHeight:p,paddingTop:y+"px",paddingBottom:b+"px"})}return m(e,"bpmn:TextAnnotation")&&(S(o,{width:i.width,height:i.height,minWidth:30*a,minHeight:10*a}),S(f,{textAlign:"left",paddingTop:5*a+"px",paddingBottom:7*a+"px",paddingLeft:7*a+"px",paddingRight:5*a+"px",fontSize:u+"px",lineHeight:d})),{bounds:o,style:f}};Ni.prototype.update=function(e,t,n,i){var r,o;m(e,"bpmn:TextAnnotation")&&(o=this._canvas.getAbsoluteBBox(e),r={x:e.x,y:e.y,width:e.width/o.width*i.width,height:e.height/o.height*i.height}),Hx(t)&&(t=null),this._modeling.updateLabel(e,t,r)};function qs(e){return m(e,"bpmn:SubProcess")&&!Y(e)}function $x(e){return m(e,"bpmn:SubProcess")&&Y(e)}function Bx(e){return m(e,"bpmn:Participant")&&!Y(e)}function jx(e){return m(e,"bpmn:Participant")&&Y(e)}function Hx(e){return!e||!e.trim()}var vu="djs-element-hidden",mu="djs-label-hidden";function Rf(e,t,n){var i=this,r=t.getDefaultLayer(),o,a,s;e.on("directEditing.activate",function(c){var l=c.active;if(o=l.element.label||l.element,m(o,"bpmn:TextAnnotation")){a=t.getAbsoluteBBox(o),s=W("g");var p=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:o.height,position:{mx:0,my:0}}),u=i.path=W("path");$(u,{d:p,strokeWidth:2,stroke:zx(o)}),X(s,u),X(r,s),Te(s,o.x,o.y)}m(o,"bpmn:TextAnnotation")||o.labelTarget?t.addMarker(o,vu):(m(o,"bpmn:Task")||m(o,"bpmn:CallActivity")||m(o,"bpmn:SubProcess")||m(o,"bpmn:Participant")||m(o,"bpmn:Lane"))&&t.addMarker(o,mu)}),e.on("directEditing.resize",function(c){if(m(o,"bpmn:TextAnnotation")){var l=c.height,p=c.dy,u=Math.max(o.height/a.height*(l+p),0),d=n.getScaledPath("TEXT_ANNOTATION",{xScaleFactor:1,yScaleFactor:1,containerWidth:o.width,containerHeight:u,position:{mx:0,my:0}});$(i.path,{d})}}),e.on(["directEditing.complete","directEditing.cancel"],function(c){var l=c.active;l&&(t.removeMarker(l.element.label||l.element,vu),t.removeMarker(o,mu)),o=void 0,a=void 0,s&&(we(s),s=void 0)})}Rf.$inject=["eventBus","canvas","pathMap"];function zx(e,t){var n=Z(e);return n.get("stroke")||t||"black"}const Fx={__depends__:[qu,Cf,hf],__init__:["labelEditingProvider","labelEditingPreview"],labelEditingProvider:["type",Ni],labelEditingPreview:["type",Rf]};var Gx=500,Vx=1e3;function cn(e,t){this._eventBus=e,this.offset=5;var n=t.cls("djs-outline",["no-fill"]),i=this;function r(o){var a=W("rect");return $(a,S({x:0,y:0,rx:4,width:100,height:100},n)),a}e.on(["shape.added","shape.changed"],Gx,function(o){var a=o.element,s=o.gfx,c=de(".djs-outline",s);c||(c=i.getOutline(a)||r(),X(s,c)),i.updateShapeOutline(c,a)}),e.on(["connection.added","connection.changed"],function(o){var a=o.element,s=o.gfx,c=de(".djs-outline",s);c||(c=r(),X(s,c)),i.updateConnectionOutline(c,a)})}cn.prototype.updateShapeOutline=function(e,t){var n=!1,i=this._getProviders();i.length&&w(i,function(r){n=n||r.updateOutline(t,e)}),n||$(e,{x:-this.offset,y:-this.offset,width:t.width+this.offset*2,height:t.height+this.offset*2})};cn.prototype.updateConnectionOutline=function(e,t){var n=Ae(t);$(e,{x:n.x-this.offset,y:n.y-this.offset,width:n.width+this.offset*2,height:n.height+this.offset*2})};cn.prototype.registerProvider=function(e,t){t||(t=e,e=Vx),this._eventBus.on("outline.getProviders",e,function(n){n.providers.push(t)})};cn.prototype._getProviders=function(){var e=this._eventBus.createEvent({type:"outline.getProviders",providers:[]});return this._eventBus.fire(e),e.providers};cn.prototype.getOutline=function(e){var t,n=this._getProviders();return w(n,function(i){Ke(i.getOutline)&&(t=t||i.getOutline(e))}),t};cn.$inject=["eventBus","styles","elementRegistry"];var ar=6;function Xs(e,t,n){this._canvas=t;var i=this;e.on("element.changed",function(r){n.isSelected(r.element)&&i._updateMultiSelectionOutline(n.get())}),e.on("selection.changed",function(r){var o=r.newSelection;i._updateMultiSelectionOutline(o)})}Xs.prototype._updateMultiSelectionOutline=function(e){var t=this._canvas.getLayer("selectionOutline");kr(t);var n=e.length>1,i=this._canvas.getContainer();if(te(i)[n?"add":"remove"]("djs-multi-select"),!!n){var r=Ux(Ae(e)),o=W("rect");$(o,S({rx:3},r)),te(o).add("djs-selection-outline"),X(t,o)}};Xs.$inject=["eventBus","canvas","selection"];function Ux(e){return{x:e.x-ar,y:e.y-ar,width:e.width+ar*2,height:e.height+ar*2}}const Zs={__depends__:[it],__init__:["outline","multiSelectionOutline"],outline:["type",cn],multiSelectionOutline:["type",Xs]},gu=["bpmn:Event","bpmn:SequenceFlow","bpmn:Gateway"],yu={class:"bjs-label-link",stroke:"var(--element-selected-outline-secondary-stroke-color)",strokeDasharray:"5, 5"},Wx=15,sr=2;function Tf(e,t,n,i,r){const o=t.getLayer("overlays");e.on(["selection.changed","shape.changed"],function(){s()}),e.on("selection.changed",function({newSelection:u}){const d=u.filter(f=>z(f,gu));if(d.length===1){const f=d[0];F(f)?a(f,f.labelTarget,u):f.labels?.length&&a(f.labels[0],f,u)}if(d.length===2){const f=d.find(F),h=d.find(g=>g.labels?.includes(f));f&&h&&a(f,h,u)}}),e.on("shape.changed",function({element:u}){!z(u,gu)||!p(u)||(F(u)?a(u,u.labelTarget,r.get()):u.labels?.length&&a(u.labels[0],u,r.get()))});function a(u,d,f=[]){const h=Gu([L(d),L(u)],yu),g=h.getAttribute("d"),_=f.includes(u)?c(u):l(u),x=ei(_,g);if(!x)return;const b=f.includes(d)?c(d):l(d),E=ei(b,g)||L(d);ai(E,x)<Wx||(_h(h,[E,x]),X(o,h))}function s(){Vo(`.${yu.class}`,o).forEach(we)}function c(u){const d=i.getOutline(u),f=i.offset;if(!d)return l(u);if(d.x){const h={x:u.x+qt(d,"x")-sr,y:u.y+qt(d,"y")-sr,width:qt(d,"width")+sr*2,height:qt(d,"height")+sr*2};return bh(h,qt(d,"rx"))}if(d.cx){const h={x:u.x-f,y:u.y-f,width:qt(d,"r")*2,height:qt(d,"r")*2};return xh(h)}}function l(u){return n.getShapePath(u)}function p(u){return r.get().includes(u)}}Tf.$inject=["eventBus","canvas","graphicsFactory","outline","selection"];function qt(e,t){return parseFloat($(e,t)||0)}const Kx={__depends__:[it,Zs],__init__:["labelLink"],labelLink:["type",Tf]};var Yx=new _a("tt");function qx(e){var t=be('<div class="djs-tooltip-container" />');return Ta(t,{position:"absolute",width:"0",height:"0"}),e.insertBefore(t,e.firstChild),t}function Xx(e,t,n){Ta(e,{left:t+"px",top:n+"px"})}function Js(e,t){e.style.display=t===!1?"none":""}var Pf="djs-tooltip",Bo="."+Pf;function ke(e,t){this._eventBus=e,this._canvas=t,this._ids=Yx,this._tooltipDefaults={show:{minZoom:.7,maxZoom:5}},this._tooltips={},this._tooltipRoot=qx(t.getContainer());var n=this;tt.bind(this._tooltipRoot,Bo,"mousedown",function(i){i.stopPropagation()}),tt.bind(this._tooltipRoot,Bo,"mouseover",function(i){n.trigger("mouseover",i)}),tt.bind(this._tooltipRoot,Bo,"mouseout",function(i){n.trigger("mouseout",i)}),this._init()}ke.$inject=["eventBus","canvas"];ke.prototype.add=function(e){if(!e.position)throw new Error("must specifiy tooltip position");if(!e.html)throw new Error("must specifiy tooltip html");var t=this._ids.next();return e=S({},this._tooltipDefaults,e,{id:t}),this._addTooltip(e),e.timeout&&this.setTimeout(e),t};ke.prototype.trigger=function(e,t){var n=t.delegateTarget||t.target,i=this.get(Me(n,"data-tooltip-id"));i&&(e==="mouseover"&&i.timeout&&this.clearTimeout(i),e==="mouseout"&&i.timeout&&(i.timeout=1e3,this.setTimeout(i)))};ke.prototype.get=function(e){return typeof e!="string"&&(e=e.id),this._tooltips[e]};ke.prototype.clearTimeout=function(e){if(e=this.get(e),!!e){var t=e.removeTimer;t&&(clearTimeout(t),e.removeTimer=null)}};ke.prototype.setTimeout=function(e){if(e=this.get(e),!!e){this.clearTimeout(e);var t=this;e.removeTimer=setTimeout(function(){t.remove(e)},e.timeout)}};ke.prototype.remove=function(e){var t=this.get(e);t&&(xn(t.html),xn(t.htmlContainer),delete t.htmlContainer,delete this._tooltips[t.id])};ke.prototype.show=function(){Js(this._tooltipRoot)};ke.prototype.hide=function(){Js(this._tooltipRoot,!1)};ke.prototype._updateRoot=function(e){var t=e.scale||1,n=e.scale||1,i="matrix("+t+",0,0,"+n+","+-1*e.x*t+","+-1*e.y*n+")";this._tooltipRoot.style.transform=i,this._tooltipRoot.style["-ms-transform"]=i};ke.prototype._addTooltip=function(e){var t=e.id,n=e.html,i,r=this._tooltipRoot;n.get&&n.constructor.prototype.jquery&&(n=n.get(0)),Dr(n)&&(n=be(n)),i=be('<div data-tooltip-id="'+t+'" class="'+Pf+'">'),Ta(i,{position:"absolute"}),i.appendChild(n),e.type&&ge(i).add("djs-tooltip-"+e.type),e.className&&ge(i).add(e.className),e.htmlContainer=i,r.appendChild(i),this._tooltips[t]=e,this._updateTooltip(e)};ke.prototype._updateTooltip=function(e){var t=e.position,n=e.htmlContainer;Xx(n,t.x,t.y)};ke.prototype._updateTooltipVisibilty=function(e){w(this._tooltips,function(t){var n=t.show,i=t.htmlContainer,r=!0;n&&((n.minZoom>e.scale||n.maxZoom<e.scale)&&(r=!1),Js(i,r))})};ke.prototype._init=function(){var e=this;function t(n){e._updateRoot(n),e._updateTooltipVisibilty(n),e.show()}this._eventBus.on("canvas.viewbox.changing",function(n){e.hide()}),this._eventBus.on("canvas.viewbox.changed",function(n){t(n.viewbox)})};const Zx={__init__:["tooltips"],tooltips:["type",ke]};var Jx="flow elements must be children of pools/participants",Qx="Data object must be placed within a pool/participant.";function Df(e,t,n){function i(r,o,a){t.add({position:{x:r.x+5,y:r.y+5},type:"error",timeout:2e3,html:"<div>"+o+"</div>"})}e.on(["shape.move.rejected","create.rejected"],function(r){var o=r.context,a=o.shape,s=o.target;m(s,"bpmn:Collaboration")&&(m(a,"bpmn:FlowNode")?i(r,n(Jx)):m(a,"bpmn:DataObjectReference")&&i(r,n(Qx)))})}Df.$inject=["eventBus","tooltips","translate"];const eE={__depends__:[Zx],__init__:["modelingFeedback"],modelingFeedback:["type",Df]};var tE=500,nE=1250,iE=1500,Rr=Math.round;function rE(e){return{x:e.x+Rr(e.width/2),y:e.y+Rr(e.height/2)}}function Mf(e,t,n,i,r){function o(s,c,l,p){return r.allowed("elements.move",{shapes:s,delta:c,position:l,target:p})}e.on("shape.move.start",iE,function(s){var c=s.context,l=s.shape,p=i.get().slice();p.indexOf(l)===-1&&(p=[l]),p=oE(p),S(c,{shapes:p,validatedShapes:p,shape:l})}),e.on("shape.move.start",nE,function(s){var c=s.context,l=c.validatedShapes,p;if(p=c.canExecute=o(l),!p)return!1}),e.on("shape.move.move",tE,function(s){var c=s.context,l=c.validatedShapes,p=s.hover,u={x:s.dx,y:s.dy},d={x:s.x,y:s.y},f;if(f=o(l,u,d,p),c.delta=u,c.canExecute=f,f===null){c.target=null;return}c.target=p}),e.on("shape.move.end",function(s){var c=s.context,l=c.delta,p=c.canExecute,u=p==="attach",d=c.shapes;if(p===!1)return!1;l.x=Rr(l.x),l.y=Rr(l.y),!(l.x===0&&l.y===0)&&n.moveElements(d,l,c.target,{primaryShape:c.shape,attach:u})}),e.on("element.mousedown",function(s){if(wa(s)){var c=Hu(s);if(!c)throw new Error("must supply DOM mousedown event");return a(c,s.element)}});function a(s,c,l,p){if(xt(l)&&(p=l,l=!1),!(c.waypoints||!c.parent)&&!te(s.target).has("djs-hit-no-move")){var u=rE(c);return t.init(s,u,"shape.move",{cursor:"grabbing",autoActivate:l,data:{shape:c,context:p||{}}}),!0}}this.start=a}Mf.$inject=["eventBus","dragging","modeling","selection","rules"];function oE(e){var t=Ar(e,"id");return U(e,function(n){for(;n=n.parent;)if(t[n.id])return!1;return!0})}var _u=499,jo="djs-dragging",bu="drop-ok",xu="drop-not-ok",Eu="new-parent",wu="attach-ok";function Af(e,t,n,i){function r(c){var l=o(c),p=aE(l);return p}function o(c){var l=pi(c,!0),p=l.flatMap(f=>(f.incoming||[]).concat(f.outgoing||[])),u=l.concat(p),d=[...new Set(u)];return d}function a(c,l){[wu,bu,xu,Eu].forEach(function(p){p===l?t.addMarker(c,p):t.removeMarker(c,p)})}function s(c,l,p){i.addDragger(l,c.dragGroup),p&&t.addMarker(l,jo),c.allDraggedElements?c.allDraggedElements.push(l):c.allDraggedElements=[l]}e.on("shape.move.start",_u,function(c){var l=c.context,p=l.shapes,u=l.allDraggedElements,d=r(p);if(!l.dragGroup){var f=W("g");$(f,n.cls("djs-drag-group",["no-events"]));var h=t.getActiveLayer();X(h,f),l.dragGroup=f}d.forEach(function(g){i.addDragger(g,l.dragGroup)}),u?u=xa([u,o(p)]):u=o(p),w(u,function(g){t.addMarker(g,jo)}),l.allDraggedElements=u,l.differentParents=sE(p)}),e.on("shape.move.move",_u,function(c){var l=c.context,p=l.dragGroup,u=l.target,d=l.shape.parent,f=l.canExecute;u&&(f==="attach"?a(u,wu):l.canExecute&&d&&u.id!==d.id?a(u,Eu):a(u,l.canExecute?bu:xu)),Te(p,c.dx,c.dy)}),e.on(["shape.move.out","shape.move.cleanup"],function(c){var l=c.context,p=l.target;p&&a(p,null)}),e.on("shape.move.cleanup",function(c){var l=c.context,p=l.allDraggedElements,u=l.dragGroup;w(p,function(d){t.removeMarker(d,jo)}),u&&we(u)}),this.makeDraggable=s}Af.$inject=["eventBus","canvas","styles","previewSupport"];function aE(e){var t=U(e,function(n){return ee(n)?ie(e,yt({id:n.source.id}))&&ie(e,yt({id:n.target.id})):!0});return t}function sE(e){return Eh(Ar(e,function(t){return t.parent&&t.parent.id}))!==1}const cE={__depends__:[ba,it,Zs,dt,St,Ln],__init__:["move","movePreview"],move:["type",Mf],movePreview:["type",Af]};var kf=".djs-palette-toggle",If=".entry",lE=kf+", "+If,ma="djs-palette-",uE="shown",ga="open",Su="two-column",pE=1e3;function fe(e,t){this._eventBus=e,this._canvas=t;var n=this;e.on("tool-manager.update",function(i){var r=i.tool;n.updateToolHighlight(r)}),e.on("i18n.changed",function(){n._update()}),e.on("diagram.init",function(){n._diagramInitialized=!0,n._rebuild()})}fe.$inject=["eventBus","canvas"];fe.prototype.registerProvider=function(e,t){t||(t=e,e=pE),this._eventBus.on("palette.getProviders",e,function(n){n.providers.push(t)}),this._rebuild()};fe.prototype.getEntries=function(){var e=this._getProviders();return e.reduce(fE,{})};fe.prototype._rebuild=function(){if(this._diagramInitialized){var e=this._getProviders();e.length&&(this._container||this._init(),this._update())}};fe.prototype._init=function(){var e=this,t=this._eventBus,n=this._getParentContainer(),i=this._container=be(fe.HTML_MARKUP);n.appendChild(i),ge(n).add(ma+uE),tt.bind(i,lE,"click",function(r){var o=r.delegateTarget;if(ju(o,kf))return e.toggle();e.trigger("click",r)}),H.bind(i,"mousedown",function(r){r.stopPropagation()}),tt.bind(i,If,"dragstart",function(r){e.trigger("dragstart",r)}),t.on("canvas.resized",this._layoutChanged,this),t.fire("palette.create",{container:i})};fe.prototype._getProviders=function(e){var t=this._eventBus.createEvent({type:"palette.getProviders",providers:[]});return this._eventBus.fire(t),t.providers};fe.prototype._toggleState=function(e){e=e||{};var t=this._getParentContainer(),n=this._container,i=this._eventBus,r,o=ge(n),a=ge(t);"twoColumn"in e?r=e.twoColumn:r=this._needsCollapse(t.clientHeight,this._entries||{}),o.toggle(Su,r),a.toggle(ma+Su,r),"open"in e&&(o.toggle(ga,e.open),a.toggle(ma+ga,e.open)),i.fire("palette.changed",{twoColumn:r,open:this.isOpen()})};fe.prototype._update=function(){var e=de(".djs-palette-entries",this._container),t=this._entries=this.getEntries();Xu(e),w(t,function(n,i){var r=n.group||"default",o=de("[data-group="+Qn(r)+"]",e);o||(o=be('<div class="group"></div>'),Me(o,"data-group",r),e.appendChild(o));var a=n.html||(n.separator?'<hr class="separator" />':'<div class="entry" draggable="true"></div>'),s=be(a);if(o.appendChild(s),!n.separator&&(Me(s,"data-action",i),n.title&&Me(s,"title",n.title),n.className&&dE(s,n.className),n.imageUrl)){var c=be("<img>");Me(c,"src",n.imageUrl),s.appendChild(c)}}),this.open()};fe.prototype.trigger=function(e,t,n){var i,r,o=t.delegateTarget||t.target;return o?(i=Me(o,"data-action"),r=t.originalEvent||t,this.triggerEntry(i,e,r,n)):t.preventDefault()};fe.prototype.triggerEntry=function(e,t,n,i){var r=this._entries,o,a;if(o=r[e],!!o&&(a=o.action,this._eventBus.fire("palette.trigger",{entry:o,event:n})!==!1)){if(Ke(a)){if(t==="click")return a(n,i)}else if(a[t])return a[t](n,i);n.preventDefault()}};fe.prototype._layoutChanged=function(){this._toggleState({})};fe.prototype._needsCollapse=function(e,t){var n=50,i=Object.keys(t).length*46;return e<i+n};fe.prototype.close=function(){this._toggleState({open:!1,twoColumn:!1})};fe.prototype.open=function(){this._toggleState({open:!0})};fe.prototype.toggle=function(){this.isOpen()?this.close():this.open()};fe.prototype.isActiveTool=function(e){return e&&this._activeTool===e};fe.prototype.updateToolHighlight=function(e){var t,n;this._toolsContainer||(t=de(".djs-palette-entries",this._container),this._toolsContainer=de("[data-group=tools]",t)),n=this._toolsContainer,w(n.children,function(i){var r=i.getAttribute("data-action");if(r){var o=ge(i);r=r.replace("-tool",""),o.contains("entry")&&r===e?o.add("highlighted-entry"):o.remove("highlighted-entry")}})};fe.prototype.isOpen=function(){return ge(this._container).has(ga)};fe.prototype._getParentContainer=function(){return this._canvas.getContainer()};fe.HTML_MARKUP='<div class="djs-palette"><div class="djs-palette-entries"></div><div class="djs-palette-toggle"></div></div>';function dE(e,t){var n=ge(e),i=V(t)?t:t.split(/\s+/g);i.forEach(function(r){n.add(r)})}function fE(e,t){var n=t.getPaletteEntries();return Ke(n)?n(e):(w(n,function(i,r){e[r]=i}),e)}const hE={__init__:["palette"],palette:["type",fe]};var Nf="crosshair";function ln(e,t,n,i,r,o,a){this._selection=r,this._dragging=n,this._mouse=a;var s=this,c={create:function(l){var p=t.getActiveLayer(),u;u=l.frame=W("rect"),$(u,{class:"djs-lasso-overlay",width:1,height:1,x:0,y:0}),X(p,u)},update:function(l){var p=l.frame,u=l.bbox;$(p,{x:u.x,y:u.y,width:u.width,height:u.height})},remove:function(l){l.frame&&we(l.frame)}};o.registerTool("lasso",{tool:"lasso.selection",dragging:"lasso"}),e.on("lasso.selection.end",function(l){var p=l.originalEvent.target;!l.hover&&!(p instanceof SVGElement)||e.once("lasso.selection.ended",function(){s.activateLasso(l.originalEvent,!0)})}),e.on("lasso.end",0,function(l){var p=l.context,u=Ho(l),d=i.filter(function(h){return h}),f=Wo(l);s.select(d,u,f?p.selection:[])}),e.on("lasso.start",function(l){var p=l.context;p.bbox=Ho(l),c.create(p),p.selection=r.get()}),e.on("lasso.move",function(l){var p=l.context;p.bbox=Ho(l),c.update(p)}),e.on("lasso.cleanup",function(l){var p=l.context;c.remove(p)}),e.on("element.mousedown",1500,function(l){if(Wo(l))return s.activateLasso(l.originalEvent),!0})}ln.$inject=["eventBus","canvas","dragging","elementRegistry","selection","toolManager","mouse"];ln.prototype.activateLasso=function(e,t){this._dragging.init(e,"lasso",{autoActivate:t,cursor:Nf,data:{context:{}}})};ln.prototype.activateSelection=function(e,t){this._dragging.init(e,"lasso.selection",{trapClick:!1,autoActivate:t,cursor:Nf,data:{context:{}},keepSelection:!0})};ln.prototype.select=function(e,t,n=[]){var i=Ku(e,t);this._selection.select([...n,...Mr(i)])};ln.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateSelection(e,!!e)};ln.prototype.isActive=function(){var e=this._dragging.context();return e&&/^lasso/.test(e.prefix)};function Ho(e){var t={x:e.x-e.dx,y:e.y-e.dy},n={x:e.x,y:e.y},i;return t.x<=n.x&&t.y<n.y||t.x<n.x&&t.y<=n.y?i={x:t.x,y:t.y,width:n.x-t.x,height:n.y-t.y}:t.x>=n.x&&t.y<n.y||t.x>n.x&&t.y<=n.y?i={x:n.x,y:t.y,width:t.x-n.x,height:n.y-t.y}:t.x<=n.x&&t.y>n.y||t.x<n.x&&t.y>=n.y?i={x:t.x,y:n.y,width:n.x-t.x,height:t.y-n.y}:t.x>=n.x&&t.y>n.y||t.x>n.x&&t.y>=n.y?i={x:n.x,y:n.y,width:t.x-n.x,height:t.y-n.y}:i={x:n.x,y:n.y,width:0,height:0},i}const vE={__depends__:[to,yi],__init__:["lassoTool"],lassoTool:["type",ln]};var zo=1500,Lf="grab";function On(e,t,n,i,r,o){this._dragging=n,this._mouse=o;var a=this,s=i.get("keyboard",!1);r.registerTool("hand",{tool:"hand",dragging:"hand.move"}),e.on("element.mousedown",zo,function(c){if(ni(c))return a.activateMove(c.originalEvent,!0),!1}),s&&s.addListener(zo,function(c){if(!(!Cu(c.keyEvent)||a.isActive())){var l=a._mouse.getLastMoveEvent();a.activateMove(l,!!l)}},"keyboard.keydown"),s&&s.addListener(zo,function(c){!Cu(c.keyEvent)||!a.isActive()||a.toggle()},"keyboard.keyup"),e.on("hand.end",function(c){var l=c.originalEvent.target;if(!c.hover&&!(l instanceof SVGElement))return!1;e.once("hand.ended",function(){a.activateMove(c.originalEvent,{reactivate:!0})})}),e.on("hand.move.move",function(c){var l=t.viewbox().scale;t.scroll({dx:c.dx*l,dy:c.dy*l})}),e.on("hand.move.end",function(c){var l=c.context,p=l.reactivate;return!ni(c)&&p&&e.once("hand.move.ended",function(u){a.activateHand(u.originalEvent,!0,!0)}),!1})}On.$inject=["eventBus","canvas","dragging","injector","toolManager","mouse"];On.prototype.activateMove=function(e,t,n){typeof t=="object"&&(n=t,t=!1),this._dragging.init(e,"hand.move",{autoActivate:t,cursor:Lf,data:{context:n||{}}})};On.prototype.activateHand=function(e,t,n){this._dragging.init(e,"hand",{trapClick:!1,autoActivate:t,cursor:Lf,data:{context:{reactivate:n}}})};On.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();this.activateHand(e,!!e)};On.prototype.isActive=function(){var e=this._dragging.context();return e?/^(hand|hand\.move)$/.test(e.prefix):!1};function Cu(e){return _e("Space",e)}const mE={__depends__:[to,yi],__init__:["handTool"],handTool:["type",On]};var Ru="connect-ok",Tu="connect-not-ok";function $n(e,t,n,i,r,o,a){var s=this;this._dragging=t,this._rules=o,this._mouse=a,r.registerTool("global-connect",{tool:"global-connect",dragging:"global-connect.drag"}),e.on("global-connect.hover",function(c){var l=c.context,p=c.hover,u=l.canStartConnect=s.canStartConnect(p);u!==null&&(l.startTarget=p,i.addMarker(p,u?Ru:Tu))}),e.on(["global-connect.out","global-connect.cleanup"],function(c){var l=c.context.startTarget,p=c.context.canStartConnect;l&&i.removeMarker(l,p?Ru:Tu)}),e.on(["global-connect.ended"],function(c){var l=c.context,p=l.startTarget,u={x:c.x,y:c.y},d=s.canStartConnect(p);if(d)return e.once("element.out",function(){e.once(["connect.ended","connect.canceled"],function(){e.fire("global-connect.drag.ended")}),n.start(null,p,u)}),!1})}$n.$inject=["eventBus","dragging","connect","canvas","toolManager","rules","mouse"];$n.prototype.start=function(e,t){this._dragging.init(e,"global-connect",{autoActivate:t,trapClick:!1,data:{context:{}}})};$n.prototype.toggle=function(){if(this.isActive())return this._dragging.cancel();var e=this._mouse.getLastMoveEvent();return this.start(e,!!e)};$n.prototype.isActive=function(){var e=this._dragging.context();return e&&/^global-connect/.test(e.prefix)};$n.prototype.canStartConnect=function(e){return this._rules.allowed("connection.start",{source:e})};const gE={__depends__:[Va,dt,St,to,yi],globalConnect:["type",$n]};function Qs(e,t,n,i,r,o,a,s){this._palette=e,this._create=t,this._elementFactory=n,this._spaceTool=i,this._lassoTool=r,this._handTool=o,this._globalConnect=a,this._translate=s,e.registerProvider(this)}Qs.$inject=["palette","create","elementFactory","spaceTool","lassoTool","handTool","globalConnect","translate"];Qs.prototype.getPaletteEntries=function(){var e={},t=this._create,n=this._elementFactory,i=this._spaceTool,r=this._lassoTool,o=this._handTool,a=this._globalConnect,s=this._translate;function c(u,d,f,h,g){function v(_){var x=n.createShape(S({type:u},g));t.start(_,x)}return{group:d,className:f,title:h,action:{dragstart:v,click:v}}}function l(u){var d=n.createShape({type:"bpmn:SubProcess",x:0,y:0,isExpanded:!0}),f=n.createShape({type:"bpmn:StartEvent",x:40,y:82,parent:d});t.start(u,[d,f],{hints:{autoSelect:[d]}})}function p(u){t.start(u,n.createParticipantShape())}return S(e,{"hand-tool":{group:"tools",className:"bpmn-icon-hand-tool",title:s("Activate hand tool"),action:{click:function(u){o.activateHand(u)}}},"lasso-tool":{group:"tools",className:"bpmn-icon-lasso-tool",title:s("Activate lasso tool"),action:{click:function(u){r.activateSelection(u)}}},"space-tool":{group:"tools",className:"bpmn-icon-space-tool",title:s("Activate create/remove space tool"),action:{click:function(u){i.activateSelection(u)}}},"global-connect-tool":{group:"tools",className:"bpmn-icon-connection-multi",title:s("Activate global connect tool"),action:{click:function(u){a.start(u)}}},"tool-separator":{group:"tools",separator:!0},"create.start-event":c("bpmn:StartEvent","event","bpmn-icon-start-event-none",s("Create start event")),"create.intermediate-event":c("bpmn:IntermediateThrowEvent","event","bpmn-icon-intermediate-event-none",s("Create intermediate/boundary event")),"create.end-event":c("bpmn:EndEvent","event","bpmn-icon-end-event-none",s("Create end event")),"create.exclusive-gateway":c("bpmn:ExclusiveGateway","gateway","bpmn-icon-gateway-none",s("Create gateway")),"create.task":c("bpmn:Task","activity","bpmn-icon-task",s("Create task")),"create.data-object":c("bpmn:DataObjectReference","data-object","bpmn-icon-data-object",s("Create data object reference")),"create.data-store":c("bpmn:DataStoreReference","data-store","bpmn-icon-data-store",s("Create data store reference")),"create.subprocess-expanded":{group:"activity",className:"bpmn-icon-subprocess-expanded",title:s("Create expanded sub-process"),action:{dragstart:l,click:l}},"create.participant-expanded":{group:"collaboration",className:"bpmn-icon-participant",title:s("Create pool/participant"),action:{dragstart:p,click:p}},"create.group":c("bpmn:Group","artifact","bpmn-icon-group",s("Create group"))}),e};const yE={__depends__:[hE,eo,qd,vE,mE,gE,Zu],__init__:["paletteProvider"],paletteProvider:["type",Qs]};var _E=250;function ec(e,t,n,i,r){R.call(this,e);function o(s){var c=s.canExecute.replacements;w(c,function(l){var p=l.oldElementId,u={type:l.newElementType};if(!s.visualReplacements[p]){var d=t.get(p);S(u,{x:d.x,y:d.y});var f=n.createShape(u);i.addShape(f,d.parent);var h=de('[data-element-id="'+Qn(d.id)+'"]',s.dragGroup);h&&$(h,{display:"none"});var g=r.addDragger(f,s.dragGroup);s.visualReplacements[p]=g,i.removeShape(f)}})}function a(s){var c=s.visualReplacements;w(c,function(l,p){var u=de('[data-element-id="'+Qn(p)+'"]',s.dragGroup);u&&$(u,{display:"inline"}),l.remove(),c[p]&&delete c[p]})}e.on("shape.move.move",_E,function(s){var c=s.context,l=c.canExecute;c.visualReplacements||(c.visualReplacements={}),l&&l.replacements?o(c):a(c)})}ec.$inject=["eventBus","elementRegistry","elementFactory","canvas","previewSupport"];M(ec,R);const bE={__depends__:[Ln],__init__:["bpmnReplacePreview"],bpmnReplacePreview:["type",ec]};var xE=1250,Fo=40,EE=20,wE=10,Pu=20,Of=["x","y"],SE=Math.abs;function $f(e){e.on(["connect.hover","connect.move","connect.end"],xE,function(t){var n=t.context,i=n.canExecute,r=n.start,o=n.hover,a=n.source,s=n.target;t.originalEvent&&We(t.originalEvent)||(n.initialConnectionStart||(n.initialConnectionStart=n.connectionStart),i&&o&&CE(t,o,DE(o)),o&&PE(i,["bpmn:Association","bpmn:DataInputAssociation","bpmn:DataOutputAssociation","bpmn:SequenceFlow"])?(n.connectionStart=Ue(r),z(o,["bpmn:Event","bpmn:Gateway"])&&Du(t,Ue(o)),z(o,["bpmn:Task","bpmn:SubProcess"])&&RE(t,o),m(a,"bpmn:BoundaryEvent")&&s===a.host&&TE(t)):Bf(i,"bpmn:MessageFlow")?(m(r,"bpmn:Event")&&(n.connectionStart=Ue(r)),m(o,"bpmn:Event")&&Du(t,Ue(o))):n.connectionStart=n.initialConnectionStart)})}$f.$inject=["eventBus"];function CE(e,t,n){Of.forEach(function(i){var r=jf(i,t);e[i]<t[i]+n?pe(e,i,t[i]+n):e[i]>t[i]+r-n&&pe(e,i,t[i]+r-n)})}function RE(e,t){var n=Ue(t);Of.forEach(function(i){ME(e,t,i)&&pe(e,i,n[i])})}function TE(e){var t=e.context,n=t.source,i=t.target;if(!AE(t)){var r=Ue(n),o=Se(r,i,-10),a=[];/top|bottom/.test(o)&&a.push("x"),/left|right/.test(o)&&a.push("y"),a.forEach(function(s){var c=e[s],l;SE(c-r[s])<Fo&&(c>r[s]?l=r[s]+Fo:l=r[s]-Fo,pe(e,s,l))})}}function Du(e,t){pe(e,"x",t.x),pe(e,"y",t.y)}function Bf(e,t){return e&&e.type===t}function PE(e,t){return di(t,function(n){return Bf(e,n)})}function jf(e,t){return e==="x"?t.width:t.height}function DE(e){return m(e,"bpmn:Task")?wE:EE}function ME(e,t,n){return e[n]>t[n]+Pu&&e[n]<t[n]+jf(n,t)-Pu}function AE(e){var t=e.hover,n=e.source;return t&&n&&t===n}function Vt(){this._targets={},this._snapOrigins={},this._snapLocations=[],this._defaultSnaps={}}Vt.prototype.getSnapOrigin=function(e){return this._snapOrigins[e]};Vt.prototype.setSnapOrigin=function(e,t){this._snapOrigins[e]=t,this._snapLocations.indexOf(e)===-1&&this._snapLocations.push(e)};Vt.prototype.addDefaultSnap=function(e,t){var n=this._defaultSnaps[e];n||(n=this._defaultSnaps[e]=[]),n.push(t)};Vt.prototype.getSnapLocations=function(){return this._snapLocations};Vt.prototype.setSnapLocations=function(e){this._snapLocations=e};Vt.prototype.pointsForTarget=function(e){var t=e.id||e,n=this._targets[t];return n||(n=this._targets[t]=new bo,n.initDefaults(this._defaultSnaps)),n};function bo(){this._snapValues={}}bo.prototype.add=function(e,t){var n=this._snapValues[e];n||(n=this._snapValues[e]={x:[],y:[]}),n.x.indexOf(t.x)===-1&&n.x.push(t.x),n.y.indexOf(t.y)===-1&&n.y.push(t.y)};bo.prototype.snap=function(e,t,n,i){var r=this._snapValues[t];return r&&$m(e[n],r[n],i)};bo.prototype.initDefaults=function(e){var t=this;w(e||{},function(n,i){w(n,function(r){t.add(i,r)})})};var kE=1250;function ft(e,t,n){var i=this;this._elementRegistry=e,t.on(["create.start","shape.move.start"],function(r){i.initSnap(r)}),t.on(["create.move","create.end","shape.move.move","shape.move.end"],kE,function(r){var o=r.context,a=o.shape,s=o.snapContext,c=o.target;if(!(r.originalEvent&&We(r.originalEvent))&&!(Rn(r)||!c)){var l=s.pointsForTarget(c);l.initialized||(l=i.addSnapTargetPoints(l,a,c),l.initialized=!0),n.snap(r,l)}}),t.on(["create.cleanup","shape.move.cleanup"],function(){n.hide()})}ft.$inject=["elementRegistry","eventBus","snapping"];ft.prototype.initSnap=function(e){var t=this._elementRegistry,n=e.context,i=n.shape,r=n.snapContext;r||(r=n.snapContext=new Vt);var o;t.get(i.id)?o=Ue(i,e):o={x:e.x+Ue(i).x,y:e.y+Ue(i).y};var a={x:o.x-i.width/2,y:o.y-i.height/2},s={x:o.x+i.width/2,y:o.y+i.height/2};return r.setSnapOrigin("mid",{x:o.x-e.x,y:o.y-e.y}),F(i)||(r.setSnapOrigin("top-left",{x:a.x-e.x,y:a.y-e.y}),r.setSnapOrigin("bottom-right",{x:s.x-e.x,y:s.y-e.y})),r};ft.prototype.addSnapTargetPoints=function(e,t,n){var i=this.getSnapTargets(t,n);return w(i,function(r){if(F(r)){F(t)&&e.add("mid",Ue(r));return}if(ee(r)){if(r.waypoints.length<3)return;var o=r.waypoints.slice(1,-1);w(o,function(a){e.add("mid",a)});return}e.add("mid",Ue(r))}),!G(t.x)||!G(t.y)||this._elementRegistry.get(t.id)&&e.add("mid",Ue(t)),e};ft.prototype.getSnapTargets=function(e,t){return Jp(t).filter(function(n){return!IE(n)})};function IE(e){return!!e.hidden}var Mu=1500;function Bn(e,t){t.invoke(ft,this),e.on(["create.move","create.end"],Mu,$E),e.on(["create.move","create.end","shape.move.move","shape.move.end"],Mu,function(n){var i=n.context,r=i.canExecute,o=i.target,a=r&&(r==="attach"||r.attach);a&&!Rn(n)&&NE(n,o)})}M(Bn,ft);Bn.$inject=["eventBus","injector"];Bn.prototype.initSnap=function(e){var t=ft.prototype.initSnap.call(this,e),n=e.shape,i=!!this._elementRegistry.get(n.id);return w(n.outgoing,function(r){var o=r.waypoints[0];o=o.original||o,t.setSnapOrigin(r.id+"-docking",ku(o,i,e))}),w(n.incoming,function(r){var o=r.waypoints[r.waypoints.length-1];o=o.original||o,t.setSnapOrigin(r.id+"-docking",ku(o,i,e))}),m(n,"bpmn:Participant")&&t.setSnapLocations(["top-left","bottom-right","mid"]),t};Bn.prototype.addSnapTargetPoints=function(e,t,n){ft.prototype.addSnapTargetPoints.call(this,e,t,n);var i=this.getSnapTargets(t,n);w(i,function(o){(OE(o)||LE([t,o],"bpmn:TextAnnotation"))&&(e.add("top-left",Xp(o)),e.add("bottom-right",Zp(o)))});var r=this._elementRegistry;return w(t.incoming,function(o){if(r.get(t.id)){Au(i,o.source)||e.add("mid",L(o.source));var a=o.waypoints[0];e.add(o.id+"-docking",a.original||a)}}),w(t.outgoing,function(o){if(r.get(t.id)){Au(i,o.target)||e.add("mid",L(o.target));var a=o.waypoints[o.waypoints.length-1];e.add(o.id+"-docking",a.original||a)}}),m(n,"bpmn:SequenceFlow")&&(e=this.addSnapTargetPoints(e,t,n.parent)),e};Bn.prototype.getSnapTargets=function(e,t){return ft.prototype.getSnapTargets.call(this,e,t).filter(function(n){return!m(n,"bpmn:Lane")})};function NE(e,t){var n=k(t),i=Sd(e,t),r=e.context,o=r.shape,a;o.parent?a={x:0,y:0}:a=L(o),/top/.test(i)?pe(e,"y",n.top-a.y):/bottom/.test(i)&&pe(e,"y",n.bottom-a.y),/left/.test(i)?pe(e,"x",n.left-a.x):/right/.test(i)&&pe(e,"x",n.right-a.x)}function LE(e,t){return e.every(function(n){return m(n,t)})}function OE(e){return m(e,"bpmn:SubProcess")&&Y(e)?!0:m(e,"bpmn:Participant")}function $E(e){var t=e.context,n=t.createConstraints;if(n){var i=n.top,r=n.right,o=n.bottom,a=n.left;(a&&a>=e.x||r&&r<=e.x)&&pe(e,"x",e.x),(i&&i>=e.y||o&&o<=e.y)&&pe(e,"y",e.y)}}function Au(e,t){return e.indexOf(t)!==-1}function ku(e,t,n){return t?{x:e.x-n.x,y:e.y-n.y}:{x:e.x,y:e.y}}var BE=1250;function Li(e,t){var n=this;e.on(["resize.start"],function(i){n.initSnap(i)}),e.on(["resize.move","resize.end"],BE,function(i){var r=i.context,o=r.shape,a=o.parent,s=r.direction,c=r.snapContext;if(!(i.originalEvent&&We(i.originalEvent))&&!Rn(i)){var l=c.pointsForTarget(a);l.initialized||(l=n.addSnapTargetPoints(l,o,a,s),l.initialized=!0),zE(s)&&pe(i,"x",i.x),FE(s)&&pe(i,"y",i.y),t.snap(i,l)}}),e.on(["resize.cleanup"],function(){t.hide()})}Li.prototype.initSnap=function(e){var t=e.context,n=t.shape,i=t.direction,r=t.snapContext;r||(r=t.snapContext=new Vt);var o=Hf(n,i);return r.setSnapOrigin("corner",{x:o.x-e.x,y:o.y-e.y}),r};Li.prototype.addSnapTargetPoints=function(e,t,n,i){var r=this.getSnapTargets(t,n);return w(r,function(o){e.add("corner",Zp(o)),e.add("corner",Xp(o))}),e.add("corner",Hf(t,i)),e};Li.$inject=["eventBus","snapping"];Li.prototype.getSnapTargets=function(e,t){return Jp(t).filter(function(n){return!jE(n,e)&&!ee(n)&&!HE(n)&&!F(n)})};function Hf(e,t){var n=L(e),i=k(e),r={x:n.x,y:n.y};return t.indexOf("n")!==-1?r.y=i.top:t.indexOf("s")!==-1&&(r.y=i.bottom),t.indexOf("e")!==-1?r.x=i.right:t.indexOf("w")!==-1&&(r.x=i.left),r}function jE(e,t){return e.host===t}function HE(e){return!!e.hidden}function zE(e){return e==="n"||e==="s"}function FE(e){return e==="e"||e==="w"}var GE=7,VE=1e3;function Ut(e){this._canvas=e,this._asyncHide=wh(nn(this.hide,this),VE)}Ut.$inject=["canvas"];Ut.prototype.snap=function(e,t){var n=e.context,i=n.snapContext,r=i.getSnapLocations(),o={x:Rn(e,"x"),y:Rn(e,"y")};w(r,function(a){var s=i.getSnapOrigin(a),c={x:e.x+s.x,y:e.y+s.y};if(w(["x","y"],function(l){var p;o[l]||(p=t.snap(c,a,l,GE),p!==void 0&&(o[l]={value:p,originValue:p-s[l]}))}),o.x&&o.y)return!1}),this.showSnapLine("vertical",o.x&&o.x.value),this.showSnapLine("horizontal",o.y&&o.y.value),w(["x","y"],function(a){var s=o[a];xt(s)&&pe(e,a,s.originValue)})};Ut.prototype._createLine=function(e){var t=this._canvas.getLayer("snap"),n=W("path");return $(n,{d:"M0,0 L0,0"}),te(n).add("djs-snap-line"),X(t,n),{update:function(i){G(i)?e==="horizontal"?$(n,{d:"M-100000,"+i+" L+100000,"+i,display:""}):$(n,{d:"M "+i+",-100000 L "+i+", +100000",display:""}):$(n,{display:"none"})}}};Ut.prototype._createSnapLines=function(){this._snapLines={horizontal:this._createLine("horizontal"),vertical:this._createLine("vertical")}};Ut.prototype.showSnapLine=function(e,t){var n=this.getSnapLine(e);n&&n.update(t),this._asyncHide()};Ut.prototype.getSnapLine=function(e){return this._snapLines||this._createSnapLines(),this._snapLines[e]};Ut.prototype.hide=function(){w(this._snapLines,function(e){e.update()})};const UE={__init__:["createMoveSnapping","resizeSnapping","snapping"],createMoveSnapping:["type",ft],resizeSnapping:["type",Li],snapping:["type",Ut]},WE={__depends__:[UE],__init__:["connectSnapping","createMoveSnapping"],connectSnapping:["type",$f],createMoveSnapping:["type",Bn]};var zf=300;function B(e,t,n,i){this._open=!1,this._results={},this._eventMaps=[],this._cachedRootElement=null,this._cachedSelection=null,this._cachedViewbox=null,this._canvas=e,this._eventBus=t,this._selection=n,this._translate=i,this._container=this._getBoxHtml(),this._searchInput=de(B.INPUT_SELECTOR,this._container),this._resultsContainer=de(B.RESULTS_CONTAINER_SELECTOR,this._container),this._canvas.getContainer().appendChild(this._container),t.on(["canvas.destroy","diagram.destroy","drag.init","elements.changed"],this.close,this)}B.$inject=["canvas","eventBus","selection","translate"];B.prototype._bindEvents=function(){var e=this;function t(n,i,r,o){e._eventMaps.push({el:n,type:r,listener:tt.bind(n,i,r,o)})}t(document,"html","click",function(n){e.close(!1)}),t(this._container,B.INPUT_SELECTOR,"click",function(n){n.stopPropagation(),n.delegateTarget.focus()}),t(this._container,B.RESULT_SELECTOR,"mouseover",function(n){n.stopPropagation(),e._scrollToNode(n.delegateTarget),e._preselect(n.delegateTarget)}),t(this._container,B.RESULT_SELECTOR,"click",function(n){n.stopPropagation(),e._select(n.delegateTarget)}),t(this._container,B.INPUT_SELECTOR,"keydown",function(n){_e("ArrowUp",n)&&n.preventDefault(),_e("ArrowDown",n)&&n.preventDefault()}),t(this._container,B.INPUT_SELECTOR,"keyup",function(n){if(_e("Escape",n))return e.close();if(_e("Enter",n)){var i=e._getCurrentResult();return i?e._select(i):e.close(!1)}if(_e("ArrowUp",n))return e._scrollToDirection(!0);if(_e("ArrowDown",n))return e._scrollToDirection();_e(["ArrowLeft","ArrowRight"],n)||e._search(n.delegateTarget.value)})};B.prototype._unbindEvents=function(){this._eventMaps.forEach(function(e){tt.unbind(e.el,e.type,e.listener)})};B.prototype._search=function(e){var t=this;if(this._clearResults(),!!e.trim()){var n=this._searchProvider.find(e);if(n=n.filter(function(r){return!t._canvas.getRootElements().includes(r.element)}),!n.length){this._selection.select(null);return}n.forEach(function(r){var o=r.element.id,a=t._createResultNode(r,o);t._results[o]={element:r.element,node:a}});var i=de(B.RESULT_SELECTOR,this._resultsContainer);this._scrollToNode(i),this._preselect(i)}};B.prototype._scrollToDirection=function(e){var t=this._getCurrentResult();if(t){var n=e?t.previousElementSibling:t.nextElementSibling;n&&(this._scrollToNode(n),this._preselect(n))}};B.prototype._scrollToNode=function(e){if(!(!e||e===this._getCurrentResult())){var t=e.offsetTop,n=this._resultsContainer.scrollTop,i=t-this._resultsContainer.clientHeight+e.clientHeight;t<n?this._resultsContainer.scrollTop=t:n<i&&(this._resultsContainer.scrollTop=i)}};B.prototype._clearResults=function(){Xu(this._resultsContainer),this._results={},this._eventBus.fire("searchPad.cleared")};B.prototype._getCurrentResult=function(){return de(B.RESULT_SELECTED_SELECTOR,this._resultsContainer)};B.prototype._createResultNode=function(e,t){var n=be(B.RESULT_HTML);return e.primaryTokens.length>0&&Iu(n,e.primaryTokens,B.RESULT_PRIMARY_HTML),Iu(n,e.secondaryTokens,B.RESULT_SECONDARY_HTML),Me(n,B.RESULT_ID_ATTRIBUTE,t),this._resultsContainer.appendChild(n),n};B.prototype.registerProvider=function(e){this._searchProvider=e};B.prototype.open=function(){if(!this._searchProvider)throw new Error("no search provider registered");this.isOpen()||(this._cachedRootElement=this._canvas.getRootElement(),this._cachedSelection=this._selection.get(),this._cachedViewbox=this._canvas.viewbox(),this._selection.select(null),this._bindEvents(),this._open=!0,ge(this._canvas.getContainer()).add("djs-search-open"),ge(this._container).add("open"),this._searchInput.focus(),this._eventBus.fire("searchPad.opened"))};B.prototype.close=function(e=!0){this.isOpen()&&(e&&(this._cachedRootElement&&this._canvas.setRootElement(this._cachedRootElement),this._cachedSelection&&this._selection.select(this._cachedSelection),this._cachedViewbox&&this._canvas.viewbox(this._cachedViewbox),this._eventBus.fire("searchPad.restored")),this._cachedRootElement=null,this._cachedSelection=null,this._cachedViewbox=null,this._unbindEvents(),this._open=!1,ge(this._canvas.getContainer()).remove("djs-search-open"),ge(this._container).remove("open"),this._clearResults(),this._searchInput.value="",this._searchInput.blur(),this._eventBus.fire("searchPad.closed"),this._canvas.restoreFocus())};B.prototype.toggle=function(){this.isOpen()?this.close():this.open()};B.prototype.isOpen=function(){return this._open};B.prototype._preselect=function(e){var t=this._getCurrentResult();if(e!==t){t&&ge(t).remove(B.RESULT_SELECTED_CLASS);var n=Me(e,B.RESULT_ID_ATTRIBUTE),i=this._results[n].element;ge(e).add(B.RESULT_SELECTED_CLASS),this._canvas.scrollToElement(i,{top:zf}),this._selection.select(i),this._eventBus.fire("searchPad.preselected",i)}};B.prototype._select=function(e){var t=Me(e,B.RESULT_ID_ATTRIBUTE),n=this._results[t].element;this._cachedSelection=null,this._cachedViewbox=null,this.close(!1),this._canvas.scrollToElement(n,{top:zf}),this._selection.select(n),this._eventBus.fire("searchPad.selected",n)};B.prototype._getBoxHtml=function(){const e=be(B.BOX_HTML),t=de(B.INPUT_SELECTOR,e);return t&&t.setAttribute("aria-label",this._translate("Search in diagram")),e};function Iu(e,t,n){var i=KE(t),r=be(n);r.innerHTML=i,e.appendChild(r)}function KE(e){var t="";return e.forEach(function(n){var i=Sh(n.value||n.matched||n.normal),r=n.match||n.matched;r?t+='<b class="'+B.RESULT_HIGHLIGHT_CLASS+'">'+i+"</b>":t+=i}),t!==""?t:null}B.CONTAINER_SELECTOR=".djs-search-container";B.INPUT_SELECTOR=".djs-search-input input";B.RESULTS_CONTAINER_SELECTOR=".djs-search-results";B.RESULT_SELECTOR=".djs-search-result";B.RESULT_SELECTED_CLASS="djs-search-result-selected";B.RESULT_SELECTED_SELECTOR="."+B.RESULT_SELECTED_CLASS;B.RESULT_ID_ATTRIBUTE="data-result-id";B.RESULT_HIGHLIGHT_CLASS="djs-search-highlight";B.BOX_HTML=`<div class="djs-search-container djs-scrollable">
  <div class="djs-search-input">
    <svg class="djs-search-icon" width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" clip-rule="evenodd" d="M9.0325 8.5H9.625L13.3675 12.25L12.25 13.3675L8.5 9.625V9.0325L8.2975 8.8225C7.4425 9.5575 6.3325 10 5.125 10C2.4325 10 0.25 7.8175 0.25 5.125C0.25 2.4325 2.4325 0.25 5.125 0.25C7.8175 0.25 10 2.4325 10 5.125C10 6.3325 9.5575 7.4425 8.8225 8.2975L9.0325 8.5ZM1.75 5.125C1.75 6.9925 3.2575 8.5 5.125 8.5C6.9925 8.5 8.5 6.9925 8.5 5.125C8.5 3.2575 6.9925 1.75 5.125 1.75C3.2575 1.75 1.75 3.2575 1.75 5.125Z" fill="#22242A"/>
    </svg>
    <input type="text" spellcheck="false" />
  </div>
  <div class="djs-search-results" />
</div>`;B.RESULT_HTML='<div class="djs-search-result"></div>';B.RESULT_PRIMARY_HTML='<div class="djs-search-result-primary"></div>';B.RESULT_SECONDARY_HTML='<p class="djs-search-result-secondary"></p>';const YE={__depends__:[Zu,Bu,it],searchPad:["type",B]};function tc(e,t,n,i){this._elementRegistry=e,this._canvas=n,this._search=i,t.registerProvider(this)}tc.$inject=["elementRegistry","searchPad","canvas","search"];tc.prototype.find=function(e){var t=this._canvas.getRootElements(),n=this._elementRegistry.filter(function(i){return!F(i)&&!t.includes(i)});return this._search(n.map(i=>({element:i,label:rn(i),id:i.id})),e,{keys:["label","id"]}).map(qE)};function qE(e){const{item:{element:t},tokens:n}=e;return{element:t,primaryTokens:n.label,secondaryTokens:n.id}}const XE={__depends__:[YE,Mp],__init__:["bpmnSearch"],bpmnSearch:["type",tc]},ZE="M44.7648 11.3263L36.9892 2.64074C36.0451 1.58628 34.5651 0.988708 33.1904 0.988708H5.98667C3.22688 0.988708 0.989624 3.34892 0.989624 6.26039V55.0235C0.989624 57.9349 3.22688 60.2952 5.98667 60.2952H40.966C43.7257 60.2952 45.963 57.9349 45.963 55.0235V14.9459C45.963 13.5998 45.6407 12.3048 44.7648 11.3263Z",JE="M1.03845 48.1347C1.03845 49.3511 1.07295 50.758 1.38342 52.064C1.69949 53.3938 2.32428 54.7154 3.56383 55.6428C6.02533 57.4841 10.1161 58.7685 14.8212 59.6067C19.5772 60.4538 25.1388 60.8738 30.6831 60.8738C36.2276 60.8738 41.7891 60.4538 46.545 59.6067C51.2504 58.7687 55.3412 57.4842 57.8028 55.6429C59.0424 54.7156 59.6673 53.3938 59.9834 52.064C60.2938 50.7579 60.3285 49.351 60.3285 48.1344V13.8415C60.3285 12.6249 60.2938 11.218 59.9834 9.91171C59.6673 8.58194 59.0423 7.2602 57.8027 6.33294C55.341 4.49168 51.2503 3.20723 46.545 2.36914C41.7891 1.522 36.2276 1.10204 30.6831 1.10205C25.1388 1.10206 19.5772 1.52206 14.8213 2.36923C10.1162 3.20734 6.02543 4.49183 3.5639 6.33314C2.32433 7.26038 1.69951 8.58206 1.38343 9.91181C1.07295 11.2179 1.03845 12.6247 1.03845 13.8411V48.1347Z",QE={width:36,height:50},ew={width:50,height:50};function Nu(e,t,n){return W("path",{d:e,strokeWidth:2,transform:`translate(${t.x}, ${t.y})`,...n})}const Fe=5;function xo(e,t){this._styles=t,e.registerProvider(this)}xo.$inject=["outline","styles"];xo.prototype.getOutline=function(e){const t=this._styles.cls("djs-outline",["no-fill"]);var n;if(Ch(e))return n=W("rect"),$(n,S({x:-Fe,y:-Fe,rx:4,width:e.width+Fe*2,height:e.height+Fe*2},t)),n;if(!F(e))return m(e,"bpmn:Gateway")?(n=W("rect"),S(n.style,{"transform-box":"fill-box",transform:"rotate(45deg)","transform-origin":"center"}),$(n,S({x:2,y:2,rx:4,width:e.width-4,height:e.height-4},t))):z(e,["bpmn:Task","bpmn:SubProcess","bpmn:Group","bpmn:CallActivity"])?(n=W("rect"),$(n,S({x:-Fe,y:-Fe,rx:14,width:e.width+Fe*2,height:e.height+Fe*2},t))):m(e,"bpmn:EndEvent")?(n=W("circle"),$(n,S({cx:e.width/2,cy:e.height/2,r:e.width/2+Fe+1},t))):m(e,"bpmn:Event")?(n=W("circle"),$(n,S({cx:e.width/2,cy:e.height/2,r:e.width/2+Fe},t))):m(e,"bpmn:DataObjectReference")&&Lu(e,"bpmn:DataObjectReference")?n=Nu(ZE,{x:-6,y:-6},t):m(e,"bpmn:DataStoreReference")&&Lu(e,"bpmn:DataStoreReference")&&(n=Nu(JE,{x:-6,y:-6},t)),n};xo.prototype.updateOutline=function(e,t){if(!F(e))return z(e,["bpmn:SubProcess","bpmn:Group"])?($(t,{width:e.width+Fe*2,height:e.height+Fe*2}),!0):!!z(e,["bpmn:Event","bpmn:Gateway","bpmn:DataStoreReference","bpmn:DataObjectReference"])};function Lu(e,t){var n;return t==="bpmn:DataObjectReference"?n=QE:t==="bpmn:DataStoreReference"&&(n=ew),e.width===n.width&&e.height===n.height}const tw={__depends__:[Zs],__init__:["outlineProvider"],outlineProvider:["type",xo]};var nw='<?xml version="1.0" encoding="UTF-8"?><bpmn:definitions xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" targetNamespace="http://bpmn.io/schema/bpmn" id="Definitions_1"><bpmn:process id="Process_1" isExecutable="false"><bpmn:startEvent id="StartEvent_1"/></bpmn:process><bpmndi:BPMNDiagram id="BPMNDiagram_1"><bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="Process_1"><bpmndi:BPMNShape id="_BPMNShape_StartEvent_2" bpmnElement="StartEvent_1"><dc:Bounds height="36.0" width="36.0" x="173.0" y="102.0"/></bpmndi:BPMNShape></bpmndi:BPMNPlane></bpmndi:BPMNDiagram></bpmn:definitions>';function lt(e){fi.call(this,e)}M(lt,fi);lt.Viewer=ui;lt.NavigatedViewer=ii;lt.prototype.createDiagram=function(){return this.importXML(nw)};lt.prototype._interactionModules=[tp,op,cp];lt.prototype._modelingModules=[Xv,ja,_m,fm,jm,Va,Um,Jb,Gd,eo,nx,ox,Ex,Sx,Cx,Mx,Fx,Kx,ff,eE,cE,yE,bE,Cf,WE,XE,tw];lt.prototype._modules=[].concat(ui.prototype._modules,lt.prototype._interactionModules,lt.prototype._modelingModules);const iw={key:0,class:"px-4 py-3 border-b border-slate-100 dark:border-slate-800 bg-slate-50/50 dark:bg-slate-900/50 flex justify-between items-center shrink-0"},rw={class:"font-bold text-xs uppercase tracking-wider text-slate-500"},ow={class:"flex-1 overflow-y-auto p-4 space-y-4"},aw=Ou({__name:"InspectorPanel",props:{title:{},width:{default:"w-72"}},setup(e){return(t,n)=>(Be(),ze("div",{class:cr(["bg-white dark:bg-slate-900 border-l border-slate-200 dark:border-slate-800 flex flex-col shadow-xl z-20 shrink-0 h-full",e.width])},[e.title?(Be(),ze("div",iw,[K("h3",rw,$u(e.title),1),ic(t.$slots,"header-actions")])):ht("",!0),K("div",ow,[ic(t.$slots,"default")])],2))}});function sw(){function e(t,n,i="text/plain"){let r;typeof t=="string"?r=new Blob([t],{type:i}):r=t;const o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=n,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}return{downloadBlob:e}}const cw={name:"Camunda",uri:"http://camunda.org/schema/1.0/bpmn",prefix:"camunda",xml:{tagAlias:"lowerCase"},associations:[],types:[{name:"Topic",isAbstract:!0,extends:["bpmn:ServiceTask"],properties:[{name:"topic",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"}]},{name:"Form",isAbstract:!0,extends:["bpmn:UserTask"],properties:[{name:"formKey",isAttr:!0,type:"String"},{name:"formData",type:"FormData"}]},{name:"FormData",superClass:["Element"],properties:[{name:"fields",isMany:!0,type:"FormField"}]},{name:"FormField",superClass:["Element"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"label",isAttr:!0,type:"String"},{name:"type",isAttr:!0,type:"String"},{name:"validation",type:"Validation"},{name:"values",isMany:!0,type:"Value"}]},{name:"Validation",superClass:["Element"],properties:[{name:"constraints",isMany:!0,type:"Constraint"}]},{name:"Constraint",superClass:["Element"],properties:[{name:"name",isAttr:!0,type:"String"},{name:"config",isAttr:!0,type:"String"}]},{name:"Value",superClass:["Element"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"}]},{name:"Properties",superClass:["Element"],meta:{allowedIn:["bpmn:ExtensionElements"]},properties:[{name:"values",isMany:!0,type:"Property"}]},{name:"Property",superClass:["Element"],properties:[{name:"id",isAttr:!0,type:"String"},{name:"name",isAttr:!0,type:"String"},{name:"value",isAttr:!0,type:"String"}]}]},lw={key:0,class:"flex items-center gap-3"},uw={class:"flex items-center gap-2"},pw={class:"flex items-center gap-2"},dw={key:0,class:"flex items-center gap-2"},fw={key:0,class:"absolute inset-0 flex flex-col items-center justify-center pointer-events-none z-0"},hw={class:"w-16 h-16 mb-4 rounded-full bg-slate-200 dark:bg-slate-800 flex items-center justify-center"},vw={class:"h-full flex flex-col relative"},mw={class:"flex border-b border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900"},gw={class:"flex-grow flex flex-col p-4"},yw={class:"relative flex-grow flex flex-col"},_w={key:0,class:"absolute bottom-2 right-2"},bw={class:"flex-grow flex flex-col relative border-t border-slate-200 dark:border-slate-700"},xw={key:0,class:"absolute inset-0 bg-slate-50 dark:bg-slate-900 z-20 flex flex-col animate-in slide-in-from-right duration-200"},Ew={class:"space-y-4 p-4 overflow-y-auto flex-1"},ww={key:0,class:"pt-4 border-t border-slate-100 dark:border-slate-800"},Sw={class:"flex items-center gap-2 text-indigo-500 mb-2"},Cw={className:"grid grid-cols-2 gap-2"},Rw={key:1,class:"pt-4 border-t border-slate-100 dark:border-slate-800"},Tw={class:"flex items-center gap-2 text-pink-500 mb-2"},Pw={class:"mt-3"},Dw={class:"space-y-2"},Mw=["onUpdate:modelValue"],Aw=["onClick"],kw={key:0,class:"text-[10px] text-slate-400 italic text-center"},Iw=Ou({__name:"ProcessTool",setup(e){const{add:t}=Th(),{copy:n}=Dh(),{downloadBlob:i}=sw(),r=Ne("input"),o=Hi("process:inputString",""),a=Hi("process:xmlContent",""),s=Ne(""),c=Ne("info"),l=Hi("process:targetObject","t.exampleProcess"),p=Hi("process:filename","process_diagram"),u=Ne(!1),d=Ne(!1),f=Ne(""),h=Ne(""),g=Ne(!1),v=Ne(!1),_=Ne({id:"",name:"",topic:"",formKey:"",roles:[]}),x=Ne({script:"",variable:""}),y=Ne(!1),b=Ne(400),E=rc(null),C=rc(null),D=Ne(!1);let A=null;Xf(async()=>{await oc();try{I()}catch(O){console.error("Failed to init BpmnJS:",O),t("Failed to load BPMN Editor. Please check console.","error")}});const I=()=>{document.querySelector("#canvas")&&(E.value=new lt({container:"#canvas",keyboard:{bindTo:window},moddleExtensions:{camunda:cw}}),E.value.on("commandStack.changed",async()=>{try{const{xml:T}=await E.value.saveXML({format:!0});D.value=!0,a.value=T,D.value=!1}catch(T){console.error(T)}}),E.value.on("selection.changed",T=>{const N=T.newSelection;N.length===1?Eo(N?.[0]):(C.value=null,d.value=!1)}),a.value&&et(a.value).catch(()=>{u.value=!1}))},j=async()=>{try{await E.value.createDiagram(),u.value=!0,r.value="xml",s.value="Created new diagram",o.value=""}catch(O){console.error("Error creating diagram",O),s.value="Error creating diagram",c.value="error"}},q=()=>{E.value.clear(),u.value=!1,d.value=!1,a.value="",o.value="",s.value="Reset complete"},ne=()=>{s.value="";let O=o.value.trim();if(O)try{if(O.includes(":=")){const N=O.match(/content\s*:=\s*'([^']+)'/);N&&N[1]&&(O=N[1])}if(O.includes(";")){const N=O.split(";"),ce=N.find(at=>at.trim().startsWith("H4s")),Ie=N[N.length-1];O=ce?ce.trim():(Ie||"").trim()}O=O.replace(/^'|'$/g,"").replace(/,$/,"");const T=Ih(O);a.value=T,et(T),s.value="Decoded successfully",c.value="info",r.value="xml"}catch{O.length>20&&(s.value="Invalid format",c.value="error")}},Q=()=>{clearTimeout(A),A=setTimeout(()=>{D.value||et(a.value)},500)},et=async O=>{try{await E.value.importXML(O),u.value=!0,await oc(),E.value.get("canvas").zoom("fit-viewport")}catch{s.value="Invalid BPMN XML",c.value="error"}},Oi=async()=>{if(u.value)try{const{xml:O}=await E.value.saveXML({format:!0}),T=Nh(O);let N=p.value.trim()||"process_diagram";N.toLowerCase().endsWith(".bpmn")||(N+=".bpmn");const ce=`${N};application/xml;${T}`,Ie=Lh(ce),at=l.value.trim()||"this.object",Wt=new kh;Wt.callMethod(at,"change",{content:Ie});const qf=Wt.toString();n(qf,"Extended Script")}catch(O){t("Export failed: "+O.message,"error")}},$e=async()=>{try{const{svg:O}=await E.value.saveSVG({format:!0});i(O,`${p.value||"diagram"}.svg`,"image/svg+xml")}catch(O){t(O.message,"error")}},Ff=async()=>{try{const{xml:O}=await E.value.saveXML({format:!0});i(O,`${p.value||"diagram"}.bpmn`,"text/xml")}catch(O){t(O.message,"error")}},Eo=O=>{C.value=O;const T=O.businessObject;if(d.value=!0,f.value=T.name||T.id,h.value=O.type,g.value=O.type==="bpmn:ServiceTask",v.value=O.type==="bpmn:UserTask",_.value.id=T.id,_.value.name=T.name||"",_.value.topic="",_.value.formKey="",_.value.roles=[],x.value={script:"",variable:""},g.value){_.value.topic=T.topic||"";const N=_.value.topic.split(";");N.length>=3&&(x.value.script=N[1]||"",x.value.variable=N[2]||"")}if(v.value&&(_.value.formKey=T.formKey||"",T.extensionElements&&T.extensionElements.values)){const N=T.extensionElements.values.find(ce=>ce.$type==="camunda:Properties");N&&N.values&&(_.value.roles=N.values.filter(ce=>ce.name==="role-participant").map(ce=>({value:ce.value,obj:ce})))}},jn=()=>{if(!C.value)return;const O=E.value.get("modeling");let T={id:_.value.id,name:_.value.name};g.value&&(T["camunda:topic"]=_.value.topic,T["camunda:type"]="external"),v.value&&(T["camunda:formKey"]=_.value.formKey),O.updateProperties(C.value,T),f.value=_.value.name||_.value.id},nc=()=>{if(x.value.script||x.value.variable){const O=x.value.script||"null",T=x.value.variable||"null";_.value.topic=`Extended;${O};${T}`,jn()}},Gf=()=>{if(!C.value)return;const O=E.value.get("moddle"),T=E.value.get("modeling");let ce=C.value.businessObject.extensionElements;ce||(ce=O.create("bpmn:ExtensionElements"),T.updateProperties(C.value,{extensionElements:ce}));let Ie=ce.values.find(Wt=>Wt.$type==="camunda:Properties");Ie||(Ie=O.create("camunda:Properties"),ce.get("values").push(Ie));const at=O.create("camunda:Property",{name:"role-participant",value:"newPropID"});Ie.get("values").push(at),Eo(C.value)},Vf=O=>{if(!C.value)return;const T=E.value.get("modeling"),N=C.value.businessObject,ce=_.value.roles[O]?.obj;if(!ce)return;const Ie=N.extensionElements?.values.find(at=>at.$type==="camunda:Properties");if(Ie){const at=Ie.get("values"),Wt=at.indexOf(ce);Wt>-1&&(at.splice(Wt,1),T.updateProperties(C.value,{extensionElements:N.extensionElements}),Eo(C.value))}},Uf=()=>{_.value.roles.forEach(O=>{O.obj.value=O.value})},Wf=()=>{y.value=!0,document.body.style.cursor="col-resize"},Kf=O=>{if(y.value){const N=document.body.getBoundingClientRect().width-O.clientX;b.value=Math.max(200,Math.min(N,600))}},Yf=()=>{y.value=!1,document.body.style.cursor=""};return(O,T)=>(Be(),Zf(Ah,{sidebarStyle:{width:b.value+"px"},sidebarClass:"resize-sidebar",onMousemove:Kf,onMouseup:Yf,class:"select-none"},{main:st(()=>[se(Mh,{title:"Process Modeler",icon:Re(uc),"icon-color":"text-blue-600 dark:text-blue-400"},{center:st(()=>[u.value?(Be(),ze("div",lw,[K("div",uw,[T[13]||(T[13]=K("span",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Name",-1)),un(K("input",{"onUpdate:modelValue":T[0]||(T[0]=N=>wo(p)?p.value=N:null),class:"w-32 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-indigo-500 text-xs font-bold text-slate-700 dark:text-slate-200 outline-none transition-colors",placeholder:"filename"},null,512),[[$i,Re(p)]])]),K("div",pw,[T[14]||(T[14]=K("span",{class:"text-[10px] font-bold text-slate-400 uppercase tracking-widest"},"Target",-1)),un(K("input",{"onUpdate:modelValue":T[1]||(T[1]=N=>wo(l)?l.value=N:null),class:"w-32 bg-transparent border-b border-transparent hover:border-slate-300 focus:border-indigo-500 text-xs font-mono text-purple-600 dark:text-purple-400 outline-none transition-colors",placeholder:"t.obj"},null,512),[[$i,Re(l)]])])])):ht("",!0)]),actions:st(()=>[u.value?(Be(),ze("div",dw,[se(ji,{size:"sm",variant:"outline",onClick:$e,title:"Export SVG"},{default:st(()=>[se(Re(jh),{class:"w-4 h-4"})]),_:1}),se(ji,{size:"sm",variant:"outline",onClick:Ff,title:"Export XML"},{default:st(()=>[se(Re(Hh),{class:"w-4 h-4"})]),_:1}),se(ji,{size:"sm",onClick:Oi,title:"Copy Extended Script"},{default:st(()=>[se(Re(zh),{class:"w-4 h-4 mr-2"}),T[15]||(T[15]=Bi(" Script",-1))]),_:1}),T[16]||(T[16]=K("div",{class:"w-px h-6 bg-slate-200 dark:bg-slate-700 mx-1"},null,-1)),K("button",{onClick:q,class:"text-slate-400 hover:text-red-500 transition-colors",title:"Reset"},[se(Re(Fh),{class:"w-4 h-4"})])])):ht("",!0)]),_:1},8,["icon"]),T[19]||(T[19]=K("div",{id:"canvas",class:"w-full h-full bg-slate-50 dark:bg-slate-900 bg-grid-pattern relative"},null,-1)),u.value?ht("",!0):(Be(),ze("div",fw,[K("div",hw,[se(Re(uc),{class:"w-8 h-8 text-slate-400"})]),T[18]||(T[18]=K("p",{class:"text-sm font-medium text-slate-500 mb-4"},"Waiting for BPMN data...",-1)),se(ji,{onClick:j,class:"pointer-events-auto"},{default:st(()=>[se(Re(Gh),{class:"w-4 h-4 mr-2"}),T[17]||(T[17]=Bi(" Create New Diagram ",-1))]),_:1})]))]),sidebar:st(()=>[K("div",{class:"absolute left-0 top-0 bottom-0 w-1 cursor-col-resize z-50 -ml-0.5 hover:bg-indigo-500 transition-colors",onMousedown:Wf},null,32),K("div",vw,[K("div",mw,[K("button",{onClick:T[2]||(T[2]=N=>r.value="input"),class:cr([r.value==="input"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-slate-400 hover:text-slate-600","flex-1 py-3 text-[10px] font-bold uppercase tracking-wider border-b-2 transition-colors"])},"Input",2),K("button",{onClick:T[3]||(T[3]=N=>r.value="xml"),class:cr([r.value==="xml"?"border-indigo-500 text-indigo-600 dark:text-indigo-400":"border-transparent text-slate-400 hover:text-slate-600","flex-1 py-3 text-[10px] font-bold uppercase tracking-wider border-b-2 transition-colors"])},"XML Editor",2)]),un(K("div",gw,[K("div",yw,[un(K("textarea",{"onUpdate:modelValue":T[4]||(T[4]=N=>wo(o)?o.value=N:null),onInput:ne,class:"w-full h-full p-3 text-xs font-mono bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-lg text-slate-600 dark:text-slate-300 focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 outline-none resize-none placeholder-slate-400",placeholder:"Paste extended script or gzip content..."},null,544),[[$i,Re(o)]]),s.value==="Decoded successfully"?(Be(),ze("div",_w,[se(Re(Oh),{class:"w-4 h-4 text-emerald-500"})])):ht("",!0)]),K("div",{class:cr(["mt-2 text-xs h-4",c.value==="error"?"text-pink-500":"text-emerald-500"])},$u(s.value),3)],512),[[ac,r.value==="input"]]),un(K("div",bw,[se(Rh,{title:"XML Editor",code:Re(a),editable:!0,"onUpdate:code":T[5]||(T[5]=N=>{a.value=N,Q()})},null,8,["code"])],512),[[ac,r.value==="xml"]]),d.value?(Be(),ze("div",xw,[se(aw,{title:f.value,subtitle:h.value},{"header-actions":st(()=>[K("button",{onClick:T[6]||(T[6]=N=>d.value=!1),class:"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 p-1"},[se(Re(lc),{class:"w-4 h-4"})])]),default:st(()=>[K("div",Ew,[se(pn,{label:"ID",modelValue:_.value.id,"onUpdate:modelValue":T[7]||(T[7]=N=>_.value.id=N),onChange:jn},null,8,["modelValue"]),se(pn,{label:"Name",modelValue:_.value.name,"onUpdate:modelValue":T[8]||(T[8]=N=>_.value.name=N),onChange:jn},null,8,["modelValue"]),g.value?(Be(),ze("div",ww,[K("div",Sw,[se(Re($h),{class:"w-3.5 h-3.5"}),T[20]||(T[20]=Bi()),T[21]||(T[21]=K("span",{class:"text-xs font-bold uppercase"},"Extended Logic",-1))]),se(pn,{label:"Topic (Raw)",modelValue:_.value.topic,"onUpdate:modelValue":T[9]||(T[9]=N=>_.value.topic=N),onChange:jn,mono:"",class:"mb-2"},null,8,["modelValue"]),K("div",Cw,[se(pn,{label:"Script Name",modelValue:x.value.script,"onUpdate:modelValue":T[10]||(T[10]=N=>x.value.script=N),onInput:nc},null,8,["modelValue"]),se(pn,{label:"Variable",modelValue:x.value.variable,"onUpdate:modelValue":T[11]||(T[11]=N=>x.value.variable=N),onInput:nc},null,8,["modelValue"])])])):ht("",!0),v.value?(Be(),ze("div",Rw,[K("div",Tw,[se(Re(Bh),{class:"w-3.5 h-3.5"}),T[22]||(T[22]=Bi()),T[23]||(T[23]=K("span",{class:"text-xs font-bold uppercase"},"Form Config",-1))]),se(pn,{label:"Form Key",modelValue:_.value.formKey,"onUpdate:modelValue":T[12]||(T[12]=N=>_.value.formKey=N),onChange:jn},null,8,["modelValue"]),K("div",Pw,[K("div",{class:"flex justify-between items-center mb-1"},[T[24]||(T[24]=K("label",{class:"text-xs font-bold text-slate-500"},"Roles",-1)),K("button",{onClick:Gf,class:"text-[10px] bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded text-slate-600 dark:text-slate-300"},"+ Add")]),K("div",Dw,[(Be(!0),ze(Jf,null,Qf(_.value.roles,(N,ce)=>(Be(),ze("div",{key:ce,class:"flex gap-1"},[un(K("input",{type:"text","onUpdate:modelValue":Ie=>N.value=Ie,onChange:Uf,class:"flex-1 text-xs p-1 bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 rounded"},null,40,Mw),[[$i,N.value]]),K("button",{onClick:Ie=>Vf(ce),class:"text-slate-400 hover:text-red-500"},[se(Re(lc),{class:"w-4 h-4"})],8,Aw)]))),128)),_.value.roles.length===0?(Be(),ze("p",kw,"No roles assigned")):ht("",!0)])])])):ht("",!0)])]),_:1},8,["title","subtitle"])])):ht("",!0)])]),_:1},8,["sidebarStyle"]))}}),Gw=Ph(Iw,[["__scopeId","data-v-770b7442"]]);export{Gw as default};
