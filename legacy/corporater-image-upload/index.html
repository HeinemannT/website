---
layout: null
permalink: /tools/corporater-image-upload/
---
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corporater Image Encoder</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Pako for Gzip -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        brand: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* --- MANDATORY GRID PATTERN --- */
        .bg-grid-pattern {
            background-color: #f8fafc;
            background-image: linear-gradient(#e2e8f0 1px, transparent 1px), linear-gradient(90deg, #e2e8f0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .dark .bg-grid-pattern {
            background-color: #0f172a;
            background-image: linear-gradient(#1e293b 1px, transparent 1px), linear-gradient(90deg, #1e293b 1px, transparent 1px);
        }

        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
        }

        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>

<body class="bg-grid-pattern min-h-screen text-slate-800 dark:text-slate-200 transition-colors duration-300">

    <!-- Top Navigation / Header -->
    <nav class="fixed top-0 w-full z-50 glass-panel border-b px-6 py-4 flex justify-between items-center shadow-sm">
        <div class="flex items-center gap-3">
            <div
                class="w-10 h-10 bg-gradient-to-br from-brand-500 to-brand-700 rounded-xl flex items-center justify-center text-white shadow-lg shadow-brand-500/30">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
            </div>
            <div>
                <h1 class="font-bold text-xl tracking-tight leading-none">Corporater Image Encoder</h1>
                <p class="text-xs text-slate-500 dark:text-slate-400 font-mono mt-0.5 uppercase tracking-wide">Image to
                    script converter</p>
            </div>
        </div>
        <div class="flex items-center gap-4">
            <button id="themeToggle"
                class="p-2 rounded-lg hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors text-slate-600 dark:text-slate-400">
                <!-- Sun Icon -->
                <svg id="sunIcon" class="w-5 h-5 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <!-- Moon Icon -->
                <svg id="moonIcon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M20.354 24.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="pt-24 pb-12 px-4 max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">

        <!-- LEFT COLUMN: Input & Staging -->
        <div class="lg:col-span-7 space-y-6">

            <!-- Drop Zone -->
            <div id="dropZone"
                class="group relative glass-panel rounded-2xl border-2 border-dashed border-slate-300 dark:border-slate-600 hover:border-brand-500 dark:hover:border-brand-500 transition-all duration-300 p-10 text-center cursor-pointer">
                <input type="file" id="fileInput" multiple
                    class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                <div class="pointer-events-none transform transition-transform group-hover:scale-105 duration-300">
                    <div
                        class="w-16 h-16 bg-brand-50 dark:bg-slate-800 text-brand-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                        <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                        </svg>
                    </div>
                    <h3 class="text-lg font-bold text-slate-700 dark:text-slate-200">Drag & Drop images here</h3>
                    <p class="text-slate-500 dark:text-slate-400 mt-1">or click to browse local files</p>
                </div>
            </div>

            <!-- URL Input Bar -->
            <div class="glass-panel rounded-xl p-2 flex gap-2 shadow-sm">
                <div class="relative flex-grow">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                    </div>
                    <input type="text" id="urlInput" placeholder="Paste image URL here..."
                        class="block w-full pl-10 pr-3 py-3 bg-transparent border-none focus:ring-0 text-sm placeholder-slate-400 text-slate-700 dark:text-slate-200" />
                </div>
                <button id="addUrlBtn"
                    class="bg-slate-800 hover:bg-slate-700 dark:bg-slate-700 dark:hover:bg-slate-600 text-white px-6 py-2 rounded-lg font-semibold text-sm transition-all shadow-md">
                    Add URL
                </button>
            </div>

            <!-- Settings Bar -->
            <div class="flex items-center justify-between text-sm px-1">
                <div class="flex items-center gap-2 text-slate-500 dark:text-slate-400">
                    <label
                        class="flex items-center gap-3 cursor-pointer group bg-brand-50 dark:bg-slate-800/80 px-4 py-2 rounded-lg border border-brand-200 dark:border-slate-600 shadow-sm hover:border-brand-400 hover:shadow-md transition-all">
                        <span class="font-bold text-brand-700 dark:text-brand-400 tracking-tight">Target Folder:</span>
                        <input type="text" id="folderVarName" value="vFolder"
                            class="bg-white dark:bg-slate-900 border border-slate-300 dark:border-slate-500 rounded px-2 py-0.5 text-slate-800 dark:text-slate-200 focus:border-brand-500 focus:ring-2 focus:ring-brand-500/20 w-32 text-center font-mono font-bold outline-none transition-all shadow-inner"
                            title="Edit the variable name used in the generated script">
                    </label>
                </div>
                <button id="clearAllBtn"
                    class="text-red-500 hover:text-red-600 text-xs font-semibold uppercase tracking-wide opacity-0 pointer-events-none transition-opacity hover:bg-red-50 dark:hover:bg-red-900/20 px-3 py-1.5 rounded-md">Clear
                    All</button>
            </div>

            <!-- Staging Area (Grid) -->
            <div id="stagingArea" class="grid grid-cols-1 md:grid-cols-2 gap-4 animate-fade-in">
                <!-- Empty State -->
                <div id="emptyState"
                    class="col-span-full py-12 text-center text-slate-400 border-2 border-dashed border-slate-200 dark:border-slate-700 rounded-xl">
                    <p>No images selected yet.</p>
                </div>
                <!-- Items will be injected here via JS -->
            </div>

            <!-- Generate Action -->
            <button id="generateBtn" disabled
                class="w-full group relative bg-brand-600 hover:bg-brand-700 disabled:opacity-50 disabled:cursor-not-allowed text-white text-lg font-bold py-4 rounded-xl shadow-lg shadow-brand-500/30 transition-all transform hover:scale-[1.01] active:scale-[0.99] overflow-hidden">
                <div
                    class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300">
                </div>
                <span class="relative flex items-center justify-center gap-2">
                    <span>Generate Script Block</span>
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                </span>
            </button>
        </div>

        <!-- RIGHT COLUMN: Output -->
        <div class="lg:col-span-5 h-[calc(100vh-8rem)] sticky top-28">
            <div class="h-full glass-panel rounded-2xl shadow-xl flex flex-col overflow-hidden">
                <div
                    class="bg-slate-100 dark:bg-slate-800/50 px-4 py-3 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
                    <span class="font-mono text-sm font-semibold text-slate-600 dark:text-slate-300">Output</span>
                    <button id="copyBtn"
                        class="flex items-center gap-1.5 text-xs font-medium bg-white dark:bg-slate-700 border border-slate-200 dark:border-slate-600 hover:border-brand-500 px-3 py-1.5 rounded-md transition-colors text-slate-600 dark:text-slate-300">
                        <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        <span id="copyBtnText">Copy</span>
                    </button>
                </div>
                <div class="relative flex-grow bg-slate-50 dark:bg-[#0d1117]">
                    <textarea id="output" readonly
                        class="w-full h-full resize-none bg-transparent p-4 font-mono text-xs md:text-sm text-slate-800 dark:text-slate-300 focus:outline-none"
                        placeholder="// Generated script will appear here..."></textarea>

                    <!-- Loading Overlay -->
                    <div id="processingOverlay"
                        class="absolute inset-0 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm flex items-center justify-center z-10 hidden">
                        <div class="text-center">
                            <div
                                class="w-12 h-12 border-4 border-brand-200 border-t-brand-600 rounded-full animate-spin mx-auto mb-3">
                            </div>
                            <p class="text-brand-700 dark:text-brand-400 font-semibold animate-pulse">Processing...</p>
                            <p id="progressText" class="text-xs text-slate-500 mt-1">Starting...</p>
                        </div>
                    </div>
                </div>
                <div
                    class="px-4 py-3 bg-slate-100 dark:bg-slate-800 border-t border-slate-200 dark:border-slate-700 text-[10px] text-slate-500 dark:text-slate-400 text-center leading-relaxed">
                    We compress the image using Gzip, encode it in Base64, and wrap it into a valid Corporater script
                    format automatically.
                </div>
            </div>
        </div>

    </main>

    <!-- Notification Toast -->
    <div id="toast"
        class="fixed bottom-6 right-6 translate-y-20 opacity-0 transition-all duration-300 z-50 bg-slate-800 dark:bg-white text-white dark:text-slate-900 px-6 py-3 rounded-lg shadow-2xl flex items-center gap-3">
        <div id="toastIcon"></div>
        <span id="toastMsg" class="font-medium text-sm">Notification</span>
    </div>

    <!-- Logic -->
    <script>
        // --- State Management ---
        let items = []; // { id, type: 'file'|'url', source, fileObj?, scriptId, resourceName, status: 'pending'|'done'|'error', result }

        // --- DOM Elements ---
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const urlInput = document.getElementById('urlInput');
        const addUrlBtn = document.getElementById('addUrlBtn');
        const stagingArea = document.getElementById('stagingArea');
        const emptyState = document.getElementById('emptyState');
        const generateBtn = document.getElementById('generateBtn');
        const output = document.getElementById('output');
        const processingOverlay = document.getElementById('processingOverlay');
        const progressText = document.getElementById('progressText');
        const copyBtn = document.getElementById('copyBtn');
        const copyBtnText = document.getElementById('copyBtnText');
        const clearAllBtn = document.getElementById('clearAllBtn');
        const folderVarInput = document.getElementById('folderVarName');

        // --- Theme Toggle ---
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        // Check system preference
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.classList.add('dark');
            document.getElementById('moonIcon').classList.add('hidden');
            document.getElementById('sunIcon').classList.remove('hidden');
        }

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark');
            document.getElementById('moonIcon').classList.toggle('hidden');
            document.getElementById('sunIcon').classList.toggle('hidden');
        });

        // --- Drag & Drop Handlers ---
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight() {
            dropZone.classList.add('border-brand-500', 'bg-brand-50', 'dark:bg-slate-800');
        }

        function unhighlight() {
            dropZone.classList.remove('border-brand-500', 'bg-brand-50', 'dark:bg-slate-800');
        }

        dropZone.addEventListener('drop', handleDrop, false);
        fileInput.addEventListener('change', handleFilesSelect, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFilesSelect(e) {
            const files = e.target.files;
            handleFiles(files);
            // Reset input so same file can be selected again if deleted
            fileInput.value = '';
        }

        function handleFiles(files) {
            const newItems = Array.from(files).filter(f => f.type.startsWith('image/')).map(file => {
                const baseName = file.name.split('.')[0].replace(/[^a-zA-Z0-9_-]/g, '_');
                return {
                    id: crypto.randomUUID(),
                    type: 'file',
                    source: URL.createObjectURL(file), // Create preview URL
                    fileObj: file,
                    scriptId: `img_${baseName}`,
                    resourceName: baseName,
                    status: 'pending',
                    result: null,
                    size: (file.size / 1024).toFixed(1) + ' KB'
                };
            });
            addItems(newItems);
        }

        // --- URL Handling ---
        addUrlBtn.addEventListener('click', addUrl);
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addUrl();
        });

        function addUrl() {
            const url = urlInput.value.trim();
            if (!url) return;

            // Check if it's multiple lines
            const lines = url.split(/\r?\n/).filter(line => line.trim() !== '');

            const newItems = lines.map(line => {
                const cleanUrl = line.trim();
                let name = 'image';
                try {
                    const path = new URL(cleanUrl).pathname;
                    name = path.substring(path.lastIndexOf('/') + 1).split('?')[0].split('.')[0] || 'image';
                } catch (e) { }

                const baseName = name.replace(/[^a-zA-Z0-9_-]/g, '_');

                return {
                    id: crypto.randomUUID(),
                    type: 'url',
                    source: cleanUrl,
                    scriptId: `img_${baseName}`,
                    resourceName: baseName,
                    status: 'pending',
                    result: null,
                    size: 'Remote'
                };
            });

            addItems(newItems);
            urlInput.value = '';
        }

        // --- Core Item Management ---
        function addItems(newItems) {
            if (newItems.length === 0) return;
            items = [...items, ...newItems];
            renderStaging();
        }

        function removeItem(id) {
            items = items.filter(item => item.id !== id);
            renderStaging();
        }

        function updateItemField(id, field, value) {
            const item = items.find(i => i.id === id);
            if (item) {
                // Sanitize scriptId to be safe for scripts
                if (field === 'scriptId') {
                    item.scriptId = value.replace(/[^a-zA-Z0-9_-]/g, '_');
                } else {
                    item.resourceName = value;
                }
            }
        }

        clearAllBtn.addEventListener('click', () => {
            items = [];
            renderStaging();
        });

        // --- Rendering ---
        function renderStaging() {
            // Toggle Empty State
            if (items.length === 0) {
                stagingArea.innerHTML = '';
                stagingArea.appendChild(emptyState);
                emptyState.classList.remove('hidden');
                generateBtn.disabled = true;
                clearAllBtn.classList.add('opacity-0', 'pointer-events-none');
                return;
            }

            emptyState.classList.add('hidden');
            generateBtn.disabled = false;
            clearAllBtn.classList.remove('opacity-0', 'pointer-events-none');

            // Re-render list (optimization: only render if needed could be better, but for <50 items innerHTML is fine)
            stagingArea.innerHTML = '';

            items.forEach((item, index) => {
                const el = document.createElement('div');
                el.className = 'glass-panel rounded-xl p-3 flex gap-3 items-center animate-slide-up hover:border-brand-300 dark:hover:border-slate-500 transition-colors';
                el.style.animationDelay = `${index * 50}ms`;

                // Status Indicator Logic
                let statusColor = 'bg-slate-200 dark:bg-slate-700';
                if (item.status === 'done') statusColor = 'bg-green-100 text-green-600 border border-green-200';
                if (item.status === 'error') statusColor = 'bg-red-100 text-red-600 border border-red-200';
                if (item.status === 'processing') statusColor = 'bg-brand-100 text-brand-600 border border-brand-200 animate-pulse';

                // Image Preview
                const imgSource = item.type === 'file' ? item.source : item.source; // Use URL for both, logic is same for src

                el.innerHTML = `
                    <div class="relative w-16 h-16 shrink-0 bg-slate-100 dark:bg-slate-800 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700 flex items-center justify-center self-start mt-1">
                        <img src="${imgSource}" class="w-full h-full object-cover" onerror="this.src='data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGZpbGw9Im5vbmUiIHZpZXdCb3g9IjAgMCAyNCAyNCIgc3Ryb2tlPSIjOTRhM2I4Ij48cGF0aCBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHN0cm9rZS13aWR0aD0iMiIgZD0iTTQgMTZsNC41ODYtNC41ODZhMiAyIDAgMDEyLjgyOCAwTTE2IDE2bC0yLTJsMS41ODYtMS41ODZhMiAyIDAgMDEyLjgyOCAwTTIwIDE0bS02LTZo.01TTYgMjBoMTJhMiAyIDAgMDAyLTJWNmEyIDAgMDAtMi0ySDZhMiAyIDAgMDAtMiAydjEyYTIgMiAwIDAwMiAyeiIgLz48L3N2Zz4='">
                        ${item.type === 'url' ? '<div class="absolute bottom-0 right-0 bg-blue-500 text-white text-[8px] px-1 py-0.5 rounded-tl">URL</div>' : ''}
                    </div>
                    
                    <div class="flex-grow min-w-0">
                        <div class="grid grid-cols-2 gap-2 mb-1">
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-0.5">Script ID</label>
                                <input type="text" value="${item.scriptId}" 
                                       onchange="updateItemField('${item.id}', 'scriptId', this.value)"
                                       class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-sm font-mono text-slate-700 dark:text-slate-300 focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all">
                            </div>
                            <div>
                                <label class="text-[10px] font-bold text-slate-400 uppercase tracking-wider block mb-0.5">Resource Name</label>
                                <input type="text" value="${item.resourceName}" 
                                       onchange="updateItemField('${item.id}', 'resourceName', this.value)"
                                       class="w-full bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded px-2 py-1 text-sm font-mono text-slate-700 dark:text-slate-300 focus:border-brand-500 focus:ring-1 focus:ring-brand-500 outline-none transition-all">
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-[10px] text-slate-400 font-mono truncate max-w-[120px]">${item.size}</span>
                             <div class="text-[10px] px-1.5 py-0.5 rounded ${statusColor} font-medium transition-colors" id="status-${item.id}">
                                ${item.status.toUpperCase()}
                            </div>
                        </div>
                    </div>

                    <button onclick="removeItem('${item.id}')" class="p-2 text-slate-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors self-start mt-1">
                        <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                `;
                stagingArea.appendChild(el);
            });
        }

        // --- Processing Logic ---
        generateBtn.addEventListener('click', startProcessing);

        async function startProcessing() {
            if (items.length === 0) return;

            setProcessing(true);
            const folderVar = folderVarInput.value.trim() || 'vFolder';
            let successCount = 0;
            const results = [];

            // Reset statuses
            items.forEach(i => {
                i.status = 'pending';
                document.getElementById(`status-${i.id}`).className = 'text-[10px] px-1.5 py-0.5 rounded bg-slate-200 dark:bg-slate-700 font-medium transition-colors';
                document.getElementById(`status-${i.id}`).innerText = 'PENDING';
            });

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                const statusEl = document.getElementById(`status-${item.id}`);

                // Update UI to Processing
                item.status = 'processing';
                statusEl.className = 'text-[10px] px-1.5 py-0.5 rounded bg-brand-100 text-brand-600 border border-brand-200 animate-pulse font-medium';
                statusEl.innerText = 'PROCESSING';
                progressText.innerText = `Processing ${i + 1}/${items.length}: ${item.resourceName}`;

                try {
                    let base64String = '';
                    let mimeType = '';

                    if (item.type === 'file') {
                        const arrayBuffer = await item.fileObj.arrayBuffer();
                        const compressedData = pako.gzip(new Uint8Array(arrayBuffer));
                        const compressedBlob = new Blob([compressedData], { type: 'application/gzip' });
                        base64String = await blobToBase64(compressedBlob);
                        mimeType = item.fileObj.type || 'image/png';
                    } else {
                        // URL Fetch with Fallback Proxy Strategy
                        const blob = await fetchBlobWithRetry(item.source);
                        const arrayBuffer = await blob.arrayBuffer();
                        const compressedData = pako.gzip(new Uint8Array(arrayBuffer));
                        const compressedBlob = new Blob([compressedData], { type: 'application/gzip' });
                        base64String = await blobToBase64(compressedBlob);
                        mimeType = blob.type || 'image/png';
                    }

                    const chunkedBase64 = chunkString(base64String, 76);
                    const contentString = `${item.resourceName};${mimeType};${chunkedBase64}`;
                    const scriptLine = `${folderVar}.add(FileResource, id := '${item.scriptId}', name := '${item.resourceName}', content := '${contentString}')`;

                    results.push(scriptLine);
                    successCount++;

                    // Update UI to Done
                    item.status = 'done';
                    statusEl.className = 'text-[10px] px-1.5 py-0.5 rounded bg-green-100 text-green-600 border border-green-200 font-medium';
                    statusEl.innerText = 'DONE';

                } catch (error) {
                    console.error(error);
                    item.status = 'error';
                    statusEl.className = 'text-[10px] px-1.5 py-0.5 rounded bg-red-100 text-red-600 border border-red-200 font-medium';
                    statusEl.innerText = 'FAILED';
                }
            }

            // Final Output
            output.value = results.join('\n\n');
            setProcessing(false);

            if (successCount > 0) {
                showToast(`Successfully generated script for ${successCount} items`, 'success');
            } else {
                showToast('Failed to process items', 'error');
            }
        }

        async function fetchBlobWithRetry(url) {
            // List of proxies to try in order
            const strategies = [
                // Strategy 1: AllOrigins
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                // Strategy 2: CorsProxy.io
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                // Strategy 3: ThingProxy
                `https://thingproxy.freeboard.io/fetch/${url}`
            ];

            let lastError;
            for (const proxyUrl of strategies) {
                try {
                    const response = await fetch(proxyUrl);
                    if (!response.ok) throw new Error(`Status ${response.status}`);
                    return await response.blob();
                } catch (e) {
                    console.warn(`Failed to fetch via ${proxyUrl}:`, e);
                    lastError = e;
                }
            }
            throw lastError || new Error('Fetch failed');
        }

        // --- Helpers ---
        function setProcessing(active) {
            if (active) {
                processingOverlay.classList.remove('hidden');
                generateBtn.disabled = true;
                output.value = '';
            } else {
                processingOverlay.classList.add('hidden');
                generateBtn.disabled = false;
            }
        }

        function blobToBase64(blob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onloadend = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(blob);
            });
        }

        function chunkString(str, length) {
            return str.match(new RegExp('.{1,' + length + '}', 'g')).join('\n');
        }

        function showToast(msg, type) {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toastMsg');
            const toastIcon = document.getElementById('toastIcon');

            toastMsg.innerText = msg;

            if (type === 'success') {
                toastIcon.innerHTML = `<svg class="w-6 h-6 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
            } else {
                toastIcon.innerHTML = `<svg class="w-6 h-6 text-red-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
            }

            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-20', 'opacity-0');
            }, 3000);
        }

        copyBtn.addEventListener('click', () => {
            if (!output.value) return;
            output.select();
            document.execCommand('copy');
            copyBtnText.innerText = 'Copied!';
            showToast('Script copied to clipboard', 'success');
            setTimeout(() => copyBtnText.innerText = 'Copy', 2000);
        });

    </script>
</body>

</html>