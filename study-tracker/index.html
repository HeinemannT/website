<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Study Tracker // Sleek Edition v10</title>
    <meta name="theme-color" content="#F9FAFB"/> 
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background-color: #F9FAFB; 
            color: #1F2937; 
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .main-layout {
            display: flex;
        }
        .content-area {
            flex-grow: 1;
        }
        #tableOfContentsContainer {
            width: 280px; 
            flex-shrink: 0;
            position: sticky;
            top: 1rem; 
            height: calc(100vh - 2rem); 
            overflow-y: auto;
            padding-right: 1rem; 
            margin-left: 1.5rem; 
            padding-left: 0.5rem; 
        }
        #tableOfContentsContainer .toc-header { 
            font-size: 1.125rem; 
            font-weight: 600; 
            color: #111827; 
            margin-bottom: 0.75rem; 
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem;
        }
        #tableOfContentsContainer ul { list-style: none; padding: 0; }
        #tableOfContentsContainer li a {
            display: block; padding: 0.5rem 0.75rem; font-size: 0.875rem;
            color: #374151; border-radius: 6px; text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        #tableOfContentsContainer li a:hover { background-color: #E5E7EB; color: #111827; }
        #tableOfContentsContainer li a.active-toc-link { background-color: #DBEAFE; color: #1D4ED8; font-weight: 600; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .progress-dot {
            width: 7px; height: 7px; border-radius: 50%; border: 1px solid #D1D5DB; 
            margin: 0 2px; background-color: #E5E7EB; 
        }
        .progress-dot.completed { background-color: #10B981; border-color: #059669; }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #F3F4F6; }
        ::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #9CA3AF; }

        .subject-progress-visual-blocks {
            width: 100%; height: 20px; 
            background-color: #E5E7EB; display: flex;
            gap: 2px; border-radius: 8px; padding: 2px; overflow: hidden;
        }
        .progress-block-segment {
            flex-grow: 1; height: 100%; background-color: #D1D5DB; 
            border-radius: 6px; transition: background-color 0.4s ease-out;
            min-width: 8px; 
        }
        .progress-block-segment.yellow { background-color: #F59E0B; } 
        .progress-block-segment.green { background-color: #10B981; } 
        .progress-block-segment.no-goals { background-color: #E5E7EB; border: 1px dashed #CBD5E1; } 

        .chapter-details-collapsible ul { list-style-type: disc; padding-left: 1.25rem; margin-top: 0.5rem; margin-bottom: 0.75rem; color: #4B5563; }
        .chapter-details-collapsible li { margin-bottom: 0.375rem; line-height: 1.5; }
        .detail-section-title { 
            font-weight: 600; color: #111827; margin-top: 1.25rem; 
            margin-bottom: 0.5rem; font-size: 1rem; 
            border-bottom: 1px solid #E5E7EB; padding-bottom: 0.25rem;
        }
        .detail-section-title:first-child { margin-top: 0.5rem; }

        .content-container { 
            border: 1px solid #E5E7EB; padding: 1.5rem; background-color: #ffffff; 
            margin-bottom: 1.5rem; border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); 
        }
        .control-button { 
            background-color: #FFFFFF; color: #374151; border: 1px solid #D1D5DB; 
            padding: 0.625rem 1.25rem; text-decoration: none; cursor: pointer; 
            font-size: 0.875rem; font-weight: 500; border-radius: 8px; 
            transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }
        .data-action-button-round { /* New style for round export/import buttons */
            background-color: #FFFFFF; color: #374151; border: 1px solid #D1D5DB; 
            width: 2.5rem; /* w-10 */ height: 2.5rem; /* h-10 */
            text-decoration: none; cursor: pointer; 
            font-size: 1.25rem; /* text-xl for bigger arrows */
            font-weight: 500; border-radius: 9999px; /* rounded-full */
            display: inline-flex; align-items: center; justify-content: center;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            line-height: 1; /* Ensure arrow is centered vertically */
        }

        .control-button:hover, .data-action-button-round:hover { background-color: #F3F4F6; border-color: #9CA3AF; } 
        .control-button.active-tab { 
            background-color: #2563EB; color: #FFFFFF; border-color: #2563EB;
            box-shadow: 0 2px 4px rgba(0,0,0,0.07);
        }
        .page-header { font-size: 2rem; font-weight: 700; color: #111827; margin-bottom: 1.5rem; text-align: center; } 
        .subject-title-main { font-size: 1.25rem; font-weight: 600; color: #1F2937; text-align: center; }
        
        .chapter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; }
        .chapter-title { font-size: 1.125rem; font-weight: 600; color: #1D4ED8; }
        
        .study-guide-details-toggle {
            font-size: 0.875rem; color: #2563EB; cursor: pointer;
            background: none; border: none; padding: 0.25rem 0.5rem;
            display: flex; align-items: center; margin-top: 0.75rem; font-weight: 500;
        }
        .study-guide-details-toggle:hover { text-decoration: underline; }
        .toggle-icon-details { margin-left: 0.3rem; transition: transform 0.2s ease-in-out; font-size: 0.9rem; }
        .toggle-icon-details.rotated { transform: rotate(90deg); }

        .task-checkbox-label { 
            appearance: none; width: 1.125rem; height: 1.125rem; 
            border: 2px solid #CBD5E1; background-color: #fff; 
            margin-right: 0.75rem; cursor: pointer; position: relative; 
            border-radius: 4px; flex-shrink: 0;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .task-checkbox-label:checked { background-color: #2563EB; border-color: #1D4ED8; }
        .task-checkbox-label:checked::after { 
            content: '✔'; font-size: 0.875rem; color: #fff; 
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-weight: bold;
        }
        .overall-progress-section { 
            margin-bottom: 1rem; padding: 1rem; border: 1px solid #E5E7EB; 
            background-color: #FFFFFF; border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.04);
        }
        .overall-progress-title { 
            font-size: 0.875rem; font-weight: 600; color: #374151; 
            margin-bottom: 0.5rem; 
        }
        .task-item-div { 
            display: flex; align-items: center; margin-bottom: 0.625rem; 
            padding: 0.5rem 0.25rem; 
            border-radius: 6px; transition: background-color 0.15s ease;
        }
        .task-item-div:hover { background-color: #F3F4F6; }
        .task-description-label { 
            font-size: 0.9375rem; color: #374151; 
        }
        .task-description-label.completed { text-decoration: line-through; color: #9CA3AF; }
        .chapter-card { 
             margin-bottom: 1.25rem; padding: 1.25rem; background-color: #FFFFFF;
             border: 1px solid #E5E7EB; border-radius: 10px; 
             box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .trackable-goals-title {
            font-weight: 600; color: #111827; margin-top: 1.25rem; 
            margin-bottom: 0.75rem; font-size: 1rem;
            border-top: 1px solid #E5E7EB; padding-top: 1.25rem;
        }
        .data-actions-container-toc { 
            margin-bottom: 1rem;
            padding-right: 0.5rem; 
            display: flex; /* For horizontal buttons */
            justify-content: flex-start; /* Align to start */
            gap: 0.5rem; /* space-x-2 */
        }
        @media (max-width: 1024px) {
            #tableOfContentsContainer { display: none; }
            .main-layout > .content-area { width: 100%; }
            .data-actions-container-main { 
                display: flex;
                justify-content: center;
                gap: 0.75rem; 
                margin-top: 1rem;
                margin-bottom: 1.5rem; 
            }
        }
         @media (min-width: 1025px) {
            .data-actions-container-main { 
                display: none;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="main-layout container mx-auto">
        <div class="content-area">
            <div class="max-w-3xl mx-auto"> 
                <header class="mb-8">
                    <h1 class="page-header">Study Progress Tracker</h1>
                </header>

                <div id="messageArea" class="hidden p-3 mb-4 rounded-lg text-sm fixed top-5 right-5 z-50 shadow-lg"></div>

                <div id="overallProgressArea" class="mb-8 space-y-4">
                    <div class="overall-progress-section">
                        <p class="overall-progress-title">SCRUM MASTER CERTIFICATION</p>
                        <div id="overall-scrum-progress-blocks" class="subject-progress-visual-blocks"></div>
                        <p id="overall-scrum-progress-text" class="text-xs text-gray-500 text-right mt-1">0%</p>
                    </div>
                    <div class="overall-progress-section">
                        <p class="overall-progress-title">ISO 27001 LEAD AUDITOR</p>
                        <div id="overall-iso27001-progress-blocks" class="subject-progress-visual-blocks"></div>
                        <p id="overall-iso27001-progress-text" class="text-xs text-gray-500 text-right mt-1">0%</p>
                    </div>
                </div>

                <div class="mb-6 flex justify-center gap-4"> 
                    <button data-tab="scrumTab" class="control-button active-tab">SCRUM Master</button> 
                    <button data-tab="iso27001Tab" class="control-button">ISO 27001 Lead Auditor</button> 
                </div>
                
                <div class="data-actions-container-main">
                     {/* Buttons for smaller screens - using round style */}
                    <button id="exportProgressBtnMain" class="data-action-button-round" title="Export Progress">↓</button>
                    <button id="importProgressBtnMain" class="data-action-button-round" title="Import Progress">↑</button>
                </div>


                <div id="scrumTab" class="tab-content active content-container"></div>
                <div id="iso27001Tab" class="tab-content content-container"></div>
                
                <div id="loadingIndicator" class="text-center py-10 content-container">
                    <p class="text-gray-600">Loading study plan...</p>
                </div>
            </div>
        </div>
        <aside id="tableOfContentsContainer" class="hidden lg:block"> 
            <div class="data-actions-container-toc">
                <button id="exportProgressBtnToc" class="data-action-button-round" title="Export Progress">↓</button>
                <button id="importProgressBtnToc" class="data-action-button-round" title="Import Progress">↑</button>
            </div>
            <h4 class="toc-header">Table of Contents</h4>
            <ul id="tocList" class="space-y-1"></ul>
        </aside>
        <input type="file" id="importFile" accept=".json" style="display: none;">
    </div>

    <script type="module">
        const studyPlanData = { // FULLY EXPANDED studyPlanData with rephrased content and English-only titles
            scrum: {
                id: "scrum",
                title: "SCRUM Master Focus",
                chapters: [
                    {
                        id: "scrum_c1", title: "1. Agile Manifesto & Scrum Foundations",
                        importance: "The Agile Manifesto and Scrum's empirical nature form the core of agile practice. Understanding these principles shapes your approach to complex work and team collaboration. These concepts are frequently tested as they define the agile mindset.",
                        objectives: [
                            "Internalize the 4 Values of the Agile Manifesto and explain their practical application.",
                            "Articulate the 12 Principles behind the Agile Manifesto and connect them to Scrum practices.",
                            "Clearly define Empiricism and its three pillars (Transparency, Inspection, Adaptation) as the foundation of Scrum, providing concrete examples.",
                            "Explain that Scrum is a framework for developing and sustaining complex products, not a rigid methodology."
                        ],
                        estimatedTime: "5-6 hours",
                        revisitPoints: [
                            "The 4 Agile Values: Focus on *why* one is valued 'over' the other.",
                            "The 12 Agile Principles: Especially those related to customer satisfaction, working software, collaboration, and responding to change.",
                            "Empiricism's pillars: How Scrum events and artifacts enable each.",
                            "Scrum Guide's definition of Scrum and its intended use."
                        ],
                        keyConcepts: ["Agile Manifesto (Values & Principles)", "Empiricism (Transparency, Inspection, Adaptation)", "Iterative & Incremental Development", "Complex Adaptive Problems", "Framework vs. Methodology", "Lean Thinking principles"],
                        studyTips: [
                            "Read the official Agile Manifesto and Scrum Guide multiple times. They are your primary sources.",
                            "For each Agile Value and Principle, think of a real-world scenario illustrating its application (or misapplication) in a team setting.",
                            "Create a mind map that links Empiricism and its pillars to each Scrum Event and Artifact, showing the feedback loops.",
                            "Analyze past projects: How could Agile principles or Scrum's empirical approach have led to better outcomes?",
                            "Explain these concepts to someone unfamiliar with agile to test your own understanding."
                        ],
                        studyGoals: [ 
                            { id: "s_c1_sg1", description: "Explain the 4 Agile Values and their significance in product development." },
                            { id: "s_c1_sg2", description: "Articulate at least 6 Agile Principles and their direct link to Scrum practices." },
                            { id: "s_c1_sg3", description: "Define Empiricism and illustrate each pillar with a clear Scrum example." },
                            { id: "s_c1_sg4", description: "Distinguish between Scrum as a framework and a prescriptive methodology." },
                            { id: "s_c1_sg5", description: "Summarize the core purpose of Scrum according to the Scrum Guide." }
                        ]
                    },
                    {
                        id: "scrum_c2", title: "2. The Scrum Values",
                        importance: "The Scrum Values (Commitment, Courage, Focus, Openness, Respect) build trust and enable empiricism. A Scrum Master's role in cultivating an environment where these values thrive is key to team performance and is often assessed.",
                        objectives: [
                            "List and define each of the five Scrum Values.",
                            "Provide concrete examples of behaviors that demonstrate each Scrum Value within a team.",
                            "Explain how the Scrum Values support Transparency, Inspection, and Adaptation.",
                            "Understand the Scrum Master's role in fostering and protecting these values."
                        ],
                        estimatedTime: "3-4 hours",
                        revisitPoints: [
                            "The definition and practical meaning of each Scrum Value.",
                            "How each Value contributes to effective teamwork and Scrum's success.",
                            "Scenarios where a lack of a specific Value could hinder the team.",
                            "How a Scrum Master can actively promote and safeguard these values."
                        ],
                        keyConcepts: ["Commitment (to goals, team, quality)", "Courage (to act, be transparent, challenge)", "Focus (on Sprint Goal, priorities)", "Openness (about work, challenges, learning)", "Respect (for individuals, skills, opinions)"],
                        studyTips: [
                            "For each Scrum Value, list 2-3 observable 'Do's' and 'Don'ts' for team behavior.",
                            "Connect each Scrum Value to one or more pillars of empiricism, explaining the link.",
                            "Reflect on team experiences where these values (or their absence) significantly impacted outcomes.",
                            "Consider how you, as a Scrum Master, would address a situation where a Scrum Value is consistently ignored."
                        ],
                        studyGoals: [
                            { id: "s_c2_sg1", description: "Define each of the five Scrum Values and explain its importance to the team." },
                            { id: "s_c2_sg2", description: "Identify behaviors that exemplify (or contradict) each Scrum Value." },
                            { id: "s_c2_sg3", description: "Understand how the Scrum Values enable the pillars of empiricism to function effectively." },
                            { id: "s_c2_sg4", description: "Articulate specific actions a Scrum Master can take to foster the Scrum Values." }
                        ]
                    },
                    {
                        id: "scrum_c3", title: "3. The Scrum Team – Accountabilities & Dynamics",
                        importance: "Scrum defines three distinct accountabilities: Product Owner, Scrum Master, and Developers. No sub-teams or hierarchies exist. A clear understanding of these accountabilities, their responsibilities, and interactions is vital for effective Scrum and is a common exam focus. Misunderstanding these roles often leads to problems.",
                        objectives: [
                            "Product Owner (PO): Define the PO's primary accountability (maximizing product value). Detail key responsibilities like developing the Product Goal, managing the Product Backlog (creation, communication, ordering), and stakeholder engagement.",
                            "Scrum Master (SM): Define the SM's accountability (Scrum implementation and team effectiveness). Describe the SM's service to the Scrum Team, Product Owner, and Organization.",
                            "Developers: Define their accountability (creating a usable Increment each Sprint). Describe characteristics like self-management, cross-functionality, and ensuring quality via the Definition of Done.",
                            "The Scrum Team: Explain its characteristics (self-managing, cross-functional, typically 10 or fewer, collectively accountable for the Increment).",
                            "Interactions: Analyze effective collaboration patterns and common dysfunctions arising from role misunderstandings."
                        ],
                        estimatedTime: "4-5 hours",
                        revisitPoints: [
                            "The PO is one person, accountable for the Product Backlog.",
                            "The SM is a servant-leader, not a manager.",
                            "Developers are collectively accountable for the Increment; no titles within this group.",
                            "Rationale for team size (10 or fewer).",
                            "Meaning of self-management and cross-functionality in practice."
                        ],
                        keyConcepts: ["Product Owner Accountabilities", "Scrum Master Accountabilities", "Developer Accountabilities", "Self-Management", "Cross-Functionality", "Collective Accountability", "Product Goal", "Sprint Goal", "Definition of Done", "Team Size", "Servant Leadership"],
                        studyTips: [
                            "Create a chart comparing PO, SM, and Developers on: Focus, Accountabilities, Common Anti-Patterns, Support for Empiricism.",
                            "Narrate 'A Sprint in the Life of a [PO/SM/Developer]' detailing their activities and concerns.",
                            "Research common Scrum role anti-patterns and their impact.",
                            "Pay close attention to the Scrum Guide's precise wording for accountabilities."
                        ],
                        studyGoals: [
                            { id: "s_c3_sg1", description: "Clearly define the accountabilities of the Product Owner, Scrum Master, and Developers." },
                            { id: "s_c3_sg2", description: "Understand the concept of a self-managing and cross-functional Scrum Team." },
                            { id: "s_c3_sg3", description: "Explain how the Scrum Master serves the Product Owner, the Developers, and the organization." },
                            { id: "s_c3_sg4", description: "Identify potential challenges and solutions related to Scrum Team dynamics." }
                        ]
                    },
                    {
                        id: "scrum_c4", title: "4. The Scrum Events – The Heartbeat of Empiricism",
                        importance: "The five Scrum Events provide the rhythm for Scrum, enabling regular inspection and adaptation. They are not just meetings but are designed to minimize other, less productive gatherings. A deep understanding of each event's purpose, time-box, attendees, and outcomes is fundamental for Scrum Masters and is thoroughly tested.",
                        objectives: [
                            "List and describe all five Scrum Events: The Sprint, Sprint Planning, Daily Scrum, Sprint Review, Sprint Retrospective.",
                            "For each Event: Articulate its purpose, state its maximum time-box (for a one-month Sprint and scaled for shorter Sprints), identify attendees, and describe key inputs/outputs.",
                            "Explain The Sprint as a container event and the core of Scrum.",
                            "Detail Sprint Planning's three topics: Why (Sprint Goal), What (PBIs), How (initial plan).",
                            "Understand the Daily Scrum's purpose for Developers: inspect progress toward Sprint Goal and adapt Sprint Backlog.",
                            "Clarify the Sprint Review as a working session to inspect the Increment and adapt the Product Backlog.",
                            "Explain the Sprint Retrospective's purpose: for the team to inspect itself and plan improvements."
                        ],
                        estimatedTime: "6-7 hours",
                        revisitPoints: [
                            "The exact purpose of each event from the Scrum Guide.",
                            "Daily Scrum is *for the Developers*.",
                            "Sprint Review is a *working session*, not just a demo.",
                            "Sprint Retrospective results in *actionable improvements*.",
                            "Scrum Master's role in ensuring effective events.",
                            "The Sprint Goal's central role."
                        ],
                        keyConcepts: ["The Sprint", "Sprint Planning (Topics 1, 2, 3)", "Daily Scrum", "Sprint Review", "Sprint Retrospective", "Time-boxing", "Sprint Goal", "Facilitation"],
                        studyTips: [
                            "Create a detailed table for all events (Purpose, Time-box, Attendees, Inputs, Outputs).",
                            "Visualize the flow of events and information within a Sprint.",
                            "Practice explaining each event's purpose and key activities concisely.",
                            "For each event, identify how it supports Transparency, Inspection, and Adaptation."
                        ],
                        studyGoals: [
                            { id: "s_c4_sg1", description: "Be able to describe the purpose, maximum time-box, and key participants for each of the five Scrum Events." },
                            { id: "s_c4_sg2", description: "Understand how each Scrum Event facilitates Transparency, Inspection, and Adaptation." },
                            { id: "s_c4_sg3", description: "Explain the three topics of Sprint Planning and their outcomes." },
                            { id: "s_c4_sg4", description: "Differentiate the purpose and outcomes of the Sprint Review versus the Sprint Retrospective." }
                        ]
                    },
                    {
                        id: "scrum_c5", title: "5. Scrum Artifacts & Commitments – Providing Transparency",
                        importance: "Scrum's artifacts (Product Backlog, Sprint Backlog, Increment) represent work or value and are designed to maximize transparency. Each artifact has a commitment (Product Goal, Sprint Goal, Definition of Done) providing focus and a measure for progress. Understanding these is crucial for effective Scrum and certification.",
                        objectives: [
                            "Identify and describe the three Scrum Artifacts.",
                            "For each Artifact: Articulate its purpose, identify accountability, and describe its associated Commitment.",
                            "Product Backlog: Explain its characteristics (dynamic, emergent, single source, ordered).",
                            "Sprint Backlog: Explain its components (Sprint Goal, selected PBIs, actionable plan).",
                            "Increment: Explain it as a usable stepping stone toward the Product Goal, meeting the Definition of Done.",
                            "Definition of Done: Understand its role in ensuring quality and transparency."
                        ],
                        estimatedTime: "5-6 hours",
                        revisitPoints: [
                            "Product Backlog is *ordered*.",
                            "Sprint Backlog *belongs to the Developers* and emerges.",
                            "Increment *must be usable* and meet DoD.",
                            "Definition of Done is critical for quality and transparency.",
                            "Purpose of each of the three commitments."
                        ],
                        keyConcepts: ["Product Backlog", "Sprint Backlog", "Increment", "Product Goal", "Sprint Goal", "Definition of Done (DoD)", "Transparency", "Emergence", "Ordering vs. Prioritizing", "Product Backlog Refinement"],
                        studyTips: [
                            "Diagram the relationship between each artifact and its commitment.",
                            "Explain how each artifact provides transparency to stakeholders.",
                            "Consider the impact of a weak or missing commitment.",
                            "Draft a sample Definition of Done for a non-software product."
                        ],
                        studyGoals: [
                            { id: "s_c5_sg1", description: "Define each of the three Scrum Artifacts and their corresponding Commitments." },
                            { id: "s_c5_sg2", description: "Understand who is accountable for each Scrum Artifact." },
                            { id: "s_c5_sg3", description: "Explain the importance of the Definition of Done and how it contributes to a usable Increment." },
                            { id: "s_c5_sg4", description: "Describe how the Product Goal, Sprint Goal, and Definition of Done provide clarity and focus." }
                        ]
                    }
                ]
            },
            iso27001: { // ISO 27001 Lead Auditor content, with English titles and expanded details
                id: "iso27001",
                title: "ISO 27001 Lead Auditor Focus",
                chapters: [ 
                    // --- Section A: Information Security ---
                    {
                        id: "iso_A1", title: "A.1: Information Security & Its Significance",
                        importance: "A Lead Auditor must understand that information security is a strategic business concern, not merely a technical one. This involves protecting information assets to ensure business continuity, meet legal obligations, maintain reputation, and foster stakeholder trust. This holistic view is vital for evaluating an ISMS effectively.",
                        objectives: [
                            "Articulate a comprehensive definition of information security, encompassing its objectives beyond just preventing breaches.",
                            "Explain the strategic importance of information security to diverse organizations, linking it to overall business goals, resilience, and competitive advantage.",
                            "Thoroughly understand and explain the core principles of Confidentiality, Integrity, and Availability (CIA Triad), providing practical examples of how these are maintained and the consequences of their compromise.",
                            "Identify various types of information assets (data, software, hardware, intellectual property, personnel expertise, brand image) and discuss methods an organization might use to determine their value."
                        ],
                        estimatedTime: "4-6 hours",
                        revisitPoints: [
                            "Role of information security in supporting key business objectives.",
                            "CIA Triad: Clear definitions, distinct examples, and interrelations.",
                            "Asset valuation and its input into risk assessment.",
                            "Information security's contribution to stakeholder trust."
                        ],
                        keyConcepts: ["Information Security Definition & Objectives", "Confidentiality", "Integrity", "Availability (CIA Triad)", "Information Assets (classification, ownership)", "Business Impact of Security Incidents", "Stakeholder Requirements for Security", "Strategic Alignment of InfoSec"],
                        studyTips: [
                            "Analyze public data breaches: identify assets, CIA failures, impacts, and unmet security objectives.",
                            "For a specific sector, list critical information assets and justify their business value.",
                            "Research asset valuation approaches (qualitative/quantitative).",
                            "Consider different stakeholder expectations for information security."
                        ],
                        studyGoals: [
                            { id: "iso_A1_sg1", description: "Define Information Security and explain its strategic importance." },
                            { id: "iso_A1_sg2", description: "Understand and explain Confidentiality, Integrity, and Availability with examples." },
                            { id: "iso_A1_sg3", description: "Identify five types of information assets and discuss their potential value." },
                            { id: "iso_A1_sg4", description: "Explain how information security acts as a business enabler." }
                        ]
                    },
                    {
                        id: "iso_A2", title: "A.2: Relevant Standards Overview",
                        importance: "The ISO 27000 series provides the ISMS framework. Lead Auditors need deep familiarity with ISO 27001 (requirements), ISO 27002 (controls guidance), ISO 27000 (vocabulary), and how ISO 31000 (risk management) applies. ISO 19011 (auditing) and ISO 17021-1 (certification bodies) define the audit context.",
                        objectives: [
                            "Master the structure, purpose, scope, and application of ISO/IEC 27001:2022, especially clauses 4-10 and Annex A.",
                            "Explain ISO/IEC 27002:2022's role in guiding Annex A control implementation, including its themes and attributes.",
                            "Use ISO/IEC 27000:2018 for accurate ISMS terminology.",
                            "Describe how ISO 31000:2018 principles support ISO 27001 risk management.",
                            "Understand ISO/IEC 17021-1's context for certification audits.",
                            "Internalize ISO/IEC 19011:2018 for all aspects of management system audits."
                        ],
                        estimatedTime: "8-10 hours",
                        revisitPoints: [
                            "ISO 27001's normative nature ('shall') vs. guidance standards ('should').",
                            "Key ISO 27000 definitions (ISMS, risk, control, policy, effectiveness).",
                            "PDCA cycle in ISO 27001 clauses.",
                            "ISO 27001 Annex A link to ISO 27002 (2022 updates).",
                            "ISO 31000 risk management principles.",
                            "ISO 19011 audit principles and process."
                        ],
                        keyConcepts: ["ISO/IEC 27001:2022", "ISO/IEC 27002:2022", "ISO/IEC 27000:2018", "ISO 31000:2018", "ISO/IEC 19011:2018", "ISO/IEC 17021-1", "Normative vs. Informative", "Statement of Applicability (SoA)", "High-Level Structure (HLS)"],
                        studyTips: [
                            "Read ISO 27001 and ISO 19011 thoroughly. Skim ISO 27002 and ISO 27000.",
                            "Map ISO 27001 clauses to ISO 31000 principles and ISO 19011 audit stages.",
                            "Cross-reference Annex A controls with ISO 27002:2022 guidance.",
                            "Practice using correct ISO 27000 terminology."
                        ],
                        studyGoals: [
                            { id: "iso_A2_sg1", description: "Explain the primary purpose of ISO 27001, 27002, 27000, 31000, and 19011." },
                            { id: "iso_A2_sg2", description: "Understand ISO 27001:2022 structure (clauses, Annex A)." },
                            { id: "iso_A2_sg3", description: "Explain how ISO 27002 supports ISO 27001 Annex A." },
                            { id: "iso_A2_sg4", description: "Articulate key ISO 31000 risk management principles for an ISMS." },
                            { id: "iso_A2_sg5", description: "Understand ISO 19011's role in guiding audits." }
                        ]
                    },
                    {
                        id: "iso_A3", title: "A.3: Cybersecurity Legislation",
                        importance: "An ISMS must ensure compliance with diverse legal, statutory, regulatory, and contractual requirements. Lead Auditors verify an organization's processes for identifying, integrating, and maintaining compliance with these obligations, a key aspect of governance and risk management under ISO 27001.",
                        objectives: [
                            "Understand an organization's ISO 27001 responsibility (Cl. 4.2.c, 6.1.1.c, A.5.31, A.5.32) for identifying, accessing, and complying with applicable legal and contractual information security requirements.",
                            "Identify common categories of cybersecurity and data privacy legislation (e.g., GDPR, national cybercrime acts, industry-specific regulations) and their general ISMS implications.",
                            "Explain how organizations establish and maintain processes to identify, document (e.g., legal register), and stay current with relevant legal obligations.",
                            "Understand the business, financial, legal, and reputational impacts of non-compliance.",
                            "Determine how to audit these processes effectively, focusing on process adequacy, not providing legal counsel."
                        ],
                        estimatedTime: "5-7 hours",
                        revisitPoints: [
                            "ISO 27001 Clauses 4.2.c, 6.1.1.c.",
                            "Annex A controls: A.5.31 (Identification of requirements), A.5.32 (IPR), A.5.33 (Protection of records), A.5.34 (Privacy of PII).",
                            "Concept of a 'legal and regulatory register'.",
                            "Incorporating these requirements into risk assessment and control selection.",
                            "Auditor's role: verify the *process*, not determine absolute legal compliance."
                        ],
                        keyConcepts: ["Legal, Statutory, Regulatory, Contractual Requirements (LSRCR)", "Data Protection Laws (GDPR, etc.)", "Privacy Principles", "Cybercrime Legislation", "Industry-Specific Regulations", "Intellectual Property Rights", "Record Protection", "Contractual Security Obligations (SLAs, DPAs)", "Compliance Management", "Legal & Regulatory Risk"],
                        studyTips: [
                            "Research key data privacy/cybersecurity laws in your region and one major international framework (e.g., GDPR).",
                            "Consider industry-specific regulations (e.g., finance, healthcare).",
                            "Think about how an organization demonstrates a robust process for managing LSRCRs.",
                            "Review ISO 27002 guidance for A.5.31-A.5.34."
                        ],
                        studyGoals: [
                            { id: "iso_A3_sg1", description: "Identify several types of cybersecurity legislation relevant to organizations." },
                            { id: "iso_A3_sg2", description: "Understand an organization's process for managing legal and regulatory obligations for information security (ISO 27001 A.5.31)." },
                            { id: "iso_A3_sg3", description: "Explain potential consequences of non-compliance with cybersecurity legislation." },
                            { id: "iso_A3_sg4", description: "Understand how contractual requirements impact an ISMS." }
                        ]
                    },
                     {
                        id: "iso_A4", title: "A.4: Assessing Security Vulnerabilities & Threats",
                        importance: "Systematically identifying, analyzing, and evaluating information security threats and vulnerabilities is foundational to effective risk assessment. A Lead Auditor must assess if an organization's approach to this is adequate and effective, informing risk decisions and controls. The auditor assesses the organization's capability, not finds vulnerabilities themselves.",
                        objectives: [
                            "Define 'threat' and 'vulnerability' in information security, with diverse examples.",
                            "Understand internal/external sources for threat intelligence and vulnerability information.",
                            "Describe common methods for identifying threats (e.g., threat modeling) and vulnerabilities (e.g., scanning, testing).",
                            "Explain how organizations link identified threats and vulnerabilities to assets and potential business impacts."
                        ],
                        estimatedTime: "6-8 hours",
                        revisitPoints: [
                            "Relationship: Asset + Vulnerability + Threat = Risk.",
                            "Categories of threats and vulnerabilities.",
                            "Importance of a repeatable, systematic identification process.",
                            "ISO 27001 Clauses 6.1.2.c (threats) & 6.1.2.d (vulnerabilities)."
                        ],
                        keyConcepts: ["Threat Source/Agent", "Threat Event", "Vulnerability", "Exploit", "Attack Vector", "Threat Modelling", "Vulnerability Scanning", "Penetration Testing", "Security Assessments", "CVE", "CWE", "Threat Intelligence", "Internal/External Threats"],
                        studyTips: [
                            "For a given asset, brainstorm potential threats and vulnerabilities.",
                            "Research CVE and other vulnerability databases.",
                            "Explore basic threat modeling concepts (e.g., STRIDE)."
                        ],
                        studyGoals: [
                            { id: "iso_A4_sg1", description: "Clearly define 'threat' and 'vulnerability' with multiple examples." },
                            { id: "iso_A4_sg2", description: "Understand common methods for identifying threats and vulnerabilities." },
                            { id: "iso_A4_sg3", description: "Explain how threats and vulnerabilities are documented and analyzed in risk assessment." },
                            { id: "iso_A4_sg4", description: "Recognize the importance of considering internal and external threat sources." }
                        ]
                    },
                    {
                        id: "iso_A5", title: "A.5: Managing Information Security Risks",
                        importance: "Risk management is central to ISO 27001. An organization needs a formal risk assessment and treatment process. A Lead Auditor must thoroughly evaluate the conformity and effectiveness of these processes, including criteria, risk identification, analysis, evaluation, treatment options, and the Statement of Applicability (SoA).",
                        objectives: [
                            "Understand ISO 27001 Clause 6.1.2 (risk assessment) and 6.1.3 (risk treatment) in detail.",
                            "Explain risk management process components: context, identification, analysis, evaluation, treatment.",
                            "Describe risk treatment options (modify, retain, avoid, share) and selection criteria.",
                            "Understand the SoA's purpose, content, development, and importance, including justifying control inclusions/exclusions.",
                            "Explain risk acceptance criteria and residual risk concepts, and risk owner roles."
                        ],
                        estimatedTime: "8-10 hours",
                        revisitPoints: [
                            "All sub-clauses of 6.1.2 and 6.1.3.",
                            "The SoA as a key auditable document linking risk treatment to controls.",
                            "Link between risk assessment, treatment decisions, and Annex A control selection.",
                            "Formal approval of residual risks by risk owners.",
                            "Ongoing nature of risk assessment and treatment, ensuring consistent, valid, comparable results."
                        ],
                        keyConcepts: ["Risk Management Process", "Risk Assessment Criteria", "Risk Acceptance Criteria", "Risk Identification", "Risk Analysis", "Risk Evaluation", "Risk Treatment Options", "Risk Treatment Plan", "Statement of Applicability (SoA)", "Residual Risk", "Risk Owner", "Information Security Risk", "Risk Appetite"],
                        studyTips: [
                            "Flowchart an ISO 27001 compliant risk assessment/treatment process, noting relevant sub-clauses.",
                            "Practice with sample risks: analyze, evaluate, treat, and select Annex A controls for a mock SoA.",
                            "Review ISO 27005 for detailed risk management guidance.",
                            "Formulate audit questions for each part of the risk management process."
                        ],
                        studyGoals: [
                            { id: "iso_A5_sg1", description: "Explain the entire information security risk management process per ISO 27001 (Clauses 6.1.2 & 6.1.3)." },
                            { id: "iso_A5_sg2", description: "Understand the four main risk treatment options and their appropriate use." },
                            { id: "iso_A5_sg3", description: "Clearly define the Statement of Applicability (SoA) and its ISMS purpose." },
                            { id: "iso_A5_sg4", description: "Explain how an organization determines risk acceptance criteria and manages residual risks." },
                            { id: "iso_A5_sg5", description: "Understand the importance of assigning risk ownership." }
                        ]
                    },
                    {
                        id: "iso_A6", title: "A.6: Use of Software/Tools in ISMS",
                        importance: "While not mandated, organizations often use tools (GRC, scanners) for their ISMS. Lead Auditors should understand how these tools can aid ISMS effectiveness and efficiency, and how to audit tool-assisted processes, focusing on outcomes and data integrity, not tool features.",
                        objectives: [
                            "Identify common tool categories for ISMS management (risk, vulnerability, logs, documents).",
                            "Understand benefits and pitfalls of using tools for ISMS processes.",
                            "Focus on auditing the ISMS process itself, even when tool-assisted, verifying tool-generated evidence integrity."
                        ],
                        estimatedTime: "2-3 hours",
                        revisitPoints: [
                            "Tools as enablers, not process replacements.",
                            "Auditing the process, not tool features.",
                            "Integrity and relevance of tool-generated evidence."
                        ],
                        keyConcepts: ["GRC Platforms", "SIEM Systems", "Vulnerability Scanners", "Document Control Systems", "Log Management", "Tool Validation (by organization)"],
                        studyTips: [
                            "Research common GRC/SIEM tools and their ISMS functionalities.",
                            "Consider how to verify accuracy of tool-generated reports.",
                            "Think about audit questions for data integrity and access controls for ISMS tools."
                        ],
                        studyGoals: [
                            { id: "iso_A6_sg1", description: "List categories of tools commonly supporting an ISMS and their purpose." },
                            { id: "iso_A6_sg2", description: "Understand that audit focus is on the ISMS process, not the tool itself." },
                            { id: "iso_A6_sg3", description: "Recognize how tool outputs can serve as audit evidence." }
                        ]
                    },

                    // --- Section B: Management System ---
                    {
                        id: "iso_B1", title: "B.1: ISMS & Data Protection",
                        importance: "Integrating data protection (privacy) into the ISMS is vital, especially with regulations like GDPR. Lead Auditors must understand how privacy principles are addressed within the ISMS, including policies, risk assessments, and controls (especially Annex A for PII and privacy by design).",
                        objectives: [
                            "Understand the relationship and distinctions between information security and data protection.",
                            "Identify key data protection principles (e.g., from GDPR).",
                            "Recognize how ISO 27001 and ISO 27701 (PIMS) can work together.",
                            "Know how to find evidence that data protection requirements are considered in the ISMS (context, risk assessment, controls, operations)."
                        ],
                        estimatedTime: "4-6 hours",
                        revisitPoints: [
                            "ISO 27001 Annex A controls for PII (A.5.34, A.7.14, A.8.2, A.8.33 etc. in ISO 27002:2022 context).",
                            "Concept of 'Privacy by Design and by Default'.",
                            "Data Protection Impact Assessments (DPIA) role.",
                            "Data Protection Officer (DPO) role, if applicable."
                        ],
                        keyConcepts: ["PII", "Data Controller/Processor", "Data Subject Rights", "Privacy Principles", "ISO/IEC 27701 (PIMS)", "Privacy by Design/Default", "DPIA", "Consent Management", "PII Breach Notification"],
                        studyTips: [
                            "Compare information security objectives (CIA) with data privacy objectives.",
                            "Review Annex A controls with privacy implications, using ISO 27002 for guidance.",
                            "Consider a PII-heavy organization: what ISMS processes/controls would an auditor expect for security and privacy?"
                        ],
                        studyGoals: [
                            { id: "iso_B1_sg1", description: "Explain key differences and overlaps between information security and data protection." },
                            { id: "iso_B1_sg2", description: "Understand fundamental data privacy principles." },
                            { id: "iso_B1_sg3", description: "Identify how an ISMS supports data protection compliance." },
                            { id: "iso_B1_sg4", description: "Recognize ISO 27701's role as a privacy extension to ISO 27001." }
                        ]
                    },
                    {
                        id: "iso_B2", title: "B.2: Process-Oriented Approach & PDCA in ISMS",
                        importance: "ISO 27001 uses a process approach and the PDCA cycle for establishing, implementing, maintaining, and continually improving the ISMS. Lead Auditors must understand this cyclical nature and how standard clauses map to each phase to assess ISMS structure, operation, and improvement.",
                        objectives: [
                            "Explain benefits of a process-oriented ISMS approach.",
                            "Clearly map ISO 27001:2022 clauses 4-10 to Plan, Do, Check, Act phases.",
                            "Understand how PDCA drives ISMS continual improvement.",
                            "Identify audit evidence demonstrating effective PDCA application."
                        ],
                        estimatedTime: "4-5 hours",
                        revisitPoints: [
                            "Specific ISO 27001 clauses for each PDCA phase (Plan: 4-7, Do: 8, Check: 9, Act: 10).",
                            "Information flow between PDCA phases.",
                            "Continual improvement as ongoing, not a one-off fix.",
                            "Risk-based thinking throughout PDCA."
                        ],
                        keyConcepts: ["Process Approach", "PDCA Cycle", "Management System Processes", "Interrelation of Processes", "Continual Improvement Philosophy"],
                        studyTips: [
                            "Diagram PDCA with corresponding ISO 27001 clauses and activities.",
                            "Trace an ISMS process (e.g., incident management) through its PDCA cycle for improvement."
                        ],
                        studyGoals: [
                            { id: "iso_B2_sg1", description: "Explain the PDCA cycle and its application to an ISMS." },
                            { id: "iso_B2_sg2", description: "Map ISO 27001 clauses 4-10 to the correct PDCA phase." },
                            { id: "iso_B2_sg3", description: "Understand how the 'Check' phase (audits, reviews) informs the 'Act' phase (improvement)." }
                        ]
                    },
                     {
                        id: "iso_B3", title: "B.3: ISMS Process Landscape & Documented Information",
                        importance: "An effective ISMS uses well-defined processes and appropriate documented information for support and evidence. Lead Auditors assess if the organization identified necessary ISMS processes and maintains/retains documented information per ISO 27001 and for ISMS effectiveness. Clause 7.5 is key.",
                        objectives: [
                            "Identify key processes in an ISMS landscape (risk management, incident management, etc.).",
                            "Understand ISO 27001 Clause 7.5 (Documented Information) requirements for creation, update, control.",
                            "Differentiate 'maintaining' (policies, plans) vs. 'retaining' (records) documented information.",
                            "Recognize documented information explicitly required by ISO 27001:2022 and that deemed necessary by the organization."
                        ],
                        estimatedTime: "5-7 hours",
                        revisitPoints: [
                            "Clause 7.5 in full (7.5.1, 7.5.2, 7.5.3).",
                            "Key documents: Scope, Policy, Risk Assessment/Treatment, SoA, Competence evidence, Audit program/results, Management review outputs, Nonconformity/corrective action records.",
                            "Control aspects: identification, format, review/approval, availability, protection, distribution, access, storage, change control, retention."
                        ],
                        keyConcepts: ["ISMS Processes", "Documented Information (Policy, Procedure, Record)", "Control of Documented Information", "Key ISMS Documents"],
                        studyTips: [
                            "List all mandatory documented information in ISO 27001:2022 (maintained vs. retained).",
                            "For Clause 7.5 sub-clauses, formulate audit questions.",
                            "Consider how to assess if documented information is 'appropriate' and 'adequate'."
                        ],
                        studyGoals: [
                            { id: "iso_B3_sg1", description: "Identify at least five key processes in a typical ISMS." },
                            { id: "iso_B3_sg2", description: "Understand ISO 27001 Clause 7.5 requirements for documented information." },
                            { id: "iso_B3_sg3", description: "Distinguish 'maintaining' vs. 'retaining' documented information, with examples." },
                            { id: "iso_B3_sg4", description: "List five pieces of documented information explicitly required by ISO 27001:2022." }
                        ]
                    },
                    {
                        id: "iso_B4", title: "B.4: ISMS Lifecycle (Clauses 4-10 Deep Dive)",
                        importance: "This covers ISO 27001 clauses 4-10 (Context, Leadership, Planning, Support, Operation, Performance Evaluation, Improvement) regarding how an organization establishes, implements, maintains, and continually improves its ISMS. This holistic view is vital before auditing specific clauses.",
                        objectives: [
                            "For each clause (4-10), understand its core requirements and intent.",
                            "Explain how an organization determines context, identifies interested parties, and defines ISMS scope (Clause 4).",
                            "Describe how top management demonstrates leadership, commitment, establishes policy, and assigns roles/responsibilities (Clause 5).",
                            "Detail ISMS planning: addressing risks/opportunities, risk assessment/treatment, setting objectives (Clause 6).",
                            "Understand requirements for resources, competence, awareness, communication, documented information (Clause 7).",
                            "Explain operational planning/control, risk assessment/treatment implementation (Clause 8).",
                            "Describe processes for monitoring, measurement, analysis, evaluation, internal audit, management review (Clause 9).",
                            "Understand management of nonconformities, corrective actions, continual improvement (Clause 10)."
                        ],
                        estimatedTime: "12-15 hours",
                        revisitPoints: [
                            "All 'shall' statements in Clauses 4-10.",
                            "Top Management responsibilities (Clause 5, 9.3).",
                            "Risk-based thinking throughout.",
                            "Inputs/outputs of internal audit (9.2) and management review (9.3).",
                            "Nonconformity and corrective action cycle (10.1).",
                            "Continual improvement (10.2) of ISMS suitability, adequacy, effectiveness."
                        ],
                        keyConcepts: ["Context (4.1-4.3)", "Leadership (5.1-5.3)", "Planning (6.1-6.2)", "Support (7.1-7.5)", "Operation (8.1-8.3)", "Performance Evaluation (9.1-9.3)", "Improvement (10.1-10.2)", "InfoSec Objectives", "Resources", "Competence", "Awareness", "Communication", "Operational Control"],
                        studyTips: [
                            "Read ISO 27001:2022 clauses 4-10 multiple times, highlighting 'shall' statements.",
                            "Summarize each clause's main purpose.",
                            "Mind map interconnections between clauses (e.g., context -> planning, performance -> improvement)."
                        ],
                        studyGoals: [
                            { id: "iso_B4_sg1", description: "Explain purpose and key requirements of ISO 27001 Clauses 4 (Context) and 5 (Leadership)." },
                            { id: "iso_B4_sg2", description: "Understand detailed requirements for ISMS Planning (Clause 6)." },
                            { id: "iso_B4_sg3", description: "Describe requirements for Support (Clause 7) and Operation (Clause 8)." },
                            { id: "iso_B4_sg4", description: "Explain processes for Performance Evaluation (Clause 9) and Improvement (Clause 10)." },
                            { id: "iso_B4_sg5", description: "Understand how Clauses 4-10 form a cohesive management system." }
                        ]
                    },
                    {
                        id: "iso_B5", title: "B.5: ISMS Interrelations & Legal Framework Integration",
                        importance: "An ISMS often integrates with other management systems (e.g., Business Continuity - ISO 22301) and must align with the organization's overall risk management (ISO 31000) and legal framework. Understanding these interfaces is key for a holistic ISMS.",
                        objectives: [
                            "Explain how ISO 27001 integrates with other MSS (e.g., ISO 9001, ISO 22301) using the High-Level Structure (HLS).",
                            "Describe how ISO 31000 principles support ISO 27001 risk management.",
                            "Reiterate how legal, regulatory, and contractual requirements are integrated into ISMS design and operation."
                        ],
                        estimatedTime: "3-5 hours",
                        revisitPoints: ["Common MSS elements (context, leadership, etc.).", "Risk management as a common theme.", "ISMS supporting overall business objectives including business continuity."],
                        keyConcepts: ["Integrated Management System (IMS)", "Business Continuity (ISO 22301)", "Risk Management Alignment (ISO 31000)", "High-Level Structure (HLS)/Annex L"],
                        studyTips: ["Compare structures of ISO 27001 and another MSS.", "Consider scenarios of integrating ISMS with BCMS."],
                        studyGoals: [
                            { id: "iso_B5_sg1", description: "Understand the benefits of an Integrated Management System (IMS)." },
                            { id: "iso_B5_sg2", description: "Explain how ISO 27001 risk assessment can inform business continuity planning (ISO 22301)." },
                            { id: "iso_B5_sg3", description: "Recognize how the High-Level Structure (Annex L) facilitates MSS integration." }
                        ]
                    },

                    // --- Section C: Auditor-Specific Skills ---
                    {
                        id: "iso_C1", title: "C.1: Lead Auditor Skills, Competencies & Responsibilities",
                        importance: "Beyond technical knowledge of ISO 27001, a Lead Auditor needs specific skills to effectively plan, conduct, lead, and report on an audit, guided by ISO 19011. These skills ensure the credibility, objectivity, and value of the audit.",
                        objectives: [
                            "Master and apply the Principles of Auditing (ISO 19011, Clause 4: Integrity, Fair Presentation, Due Professional Care, Confidentiality, Independence, Evidence-based Approach, Risk-based Approach).",
                            "Understand managing an audit programme (ISO 19011, Clause 5), including objectives, risks, procedures, resources, and records.",
                            "Be proficient in all stages of performing an audit (ISO 19011, Clause 6): initiating, preparing, conducting on-site activities (opening/closing meetings, evidence collection via interviews, observation, document review), generating findings, preparing conclusions, reporting, and follow-up.",
                            "Understand auditor competence requirements (generic and discipline-specific) and Lead Auditor responsibilities (ISO 19011, Clause 7)."
                        ],
                        estimatedTime: "10-12 hours",
                        revisitPoints: [
                            "The 7 Principles of Auditing.",
                            "The entire audit lifecycle: Plan -> Prepare -> Conduct -> Report -> Follow-up.",
                            "Effective interviewing, observation, and sampling techniques.",
                            "Writing clear, concise, evidence-based nonconformity statements.",
                            "Managing audit teams, communication, and conflict resolution."
                        ],
                        keyConcepts: ["Audit Principles", "Audit Programme Management", "Audit Plan", "Audit Scope, Objectives, Criteria", "Audit Team", "Opening/Closing Meetings", "Evidence Collection Techniques", "Audit Sampling", "Audit Findings (Conformity, Nonconformity, OFI)", "Audit Conclusions", "Audit Report", "Corrective Action & Follow-up", "Auditor Competence & Evaluation"],
                        studyTips: [
                            "Thoroughly study ISO 19011:2018, especially clauses 4, 5, 6, and 7.",
                            "Practice writing mock audit findings (conformities and nonconformities) against ISO 27001 clauses.",
                            "Role-play audit scenarios: opening meetings, interviews (with various auditee types), closing meetings, presenting findings.",
                            "Develop personal checklists for key audit phases (planning, on-site, reporting).",
                            "Study questioning techniques (open, closed, probing) and active listening."
                        ],
                        studyGoals: [
                            { id: "iso_C1_sg1", description: "Explain and apply all 7 Principles of Auditing from ISO 19011." },
                            { id: "iso_C1_sg2", description: "Understand key activities in managing an audit programme." },
                            { id: "iso_C1_sg3", description: "Describe steps in planning and preparing for an ISMS audit." },
                            { id: "iso_C1_sg4", description: "Master techniques for conducting audit activities (evidence gathering, interviews, observation)." },
                            { id: "iso_C1_sg5", description: "Write clear, evidence-based audit findings and understand audit report structure." },
                            { id: "iso_C1_sg6", description: "Understand audit follow-up and verifying corrective actions' effectiveness." },
                            { id: "iso_C1_sg7", description: "Articulate a Lead Auditor's responsibilities in managing an audit team and process." }
                        ]
                    }
                ]
            }
        };

        let allTasks = []; 
        const LOCAL_STORAGE_KEY = 'studyTrackerProgress_v1.apple.enriched.v9_goals'; 

        function renderSubject(subjectKey) {
            const subjectData = studyPlanData[subjectKey];
            const containerId = `${subjectKey}Tab`;
            const container = document.getElementById(containerId);
            if (!container || !subjectData) { console.error(`Container or data not found for ${subjectKey}`); return; }
            container.innerHTML = ''; 

            const subjectHeaderDiv = document.createElement('div');
            subjectHeaderDiv.className = 'mb-6 text-center';
            const subjectTitleEl = document.createElement('h2');
            subjectTitleEl.className = 'subject-title-main mb-4';
            subjectTitleEl.textContent = subjectData.title;
            subjectHeaderDiv.appendChild(subjectTitleEl);
            container.appendChild(subjectHeaderDiv);

            if (subjectData.chapters && subjectData.chapters.length > 0) {
                subjectData.chapters.forEach(chapter => {
                    const chapterDiv = document.createElement('div');
                    chapterDiv.className = 'chapter-card';
                    chapterDiv.id = `chapter-${chapter.id}`; 

                    const chapterHeader = document.createElement('div');
                    chapterHeader.className = 'chapter-header';
                    const chapterTitleEl = document.createElement('h3');
                    chapterTitleEl.className = 'chapter-title';
                    chapterTitleEl.textContent = chapter.title;
                    chapterHeader.appendChild(chapterTitleEl);

                    const chapterProgressDotsContainer = document.createElement('div');
                    chapterProgressDotsContainer.className = 'flex items-center';
                    chapterProgressDotsContainer.id = `dots-${chapter.id}`;
                    if (chapter.studyGoals && chapter.studyGoals.length > 0) {
                        chapter.studyGoals.forEach(goal => {
                            const dot = document.createElement('div');
                            dot.className = 'progress-dot';
                            dot.id = `dot-${goal.id}`;
                            chapterProgressDotsContainer.appendChild(dot);
                        });
                    }
                    chapterHeader.appendChild(chapterProgressDotsContainer);
                    chapterDiv.appendChild(chapterHeader);
                    
                    const studyGuideToggle = document.createElement('button');
                    studyGuideToggle.className = 'study-guide-details-toggle';
                    studyGuideToggle.innerHTML = `View Study Guide Details <span class="toggle-icon-details ml-1">▶</span>`;
                    
                    const chapterContentDetailsDiv = document.createElement('div');
                    chapterContentDetailsDiv.className = 'chapter-details-collapsible hidden mt-3 pl-1 space-y-4';

                    studyGuideToggle.onclick = (e) => {
                        e.preventDefault();
                        chapterContentDetailsDiv.classList.toggle('hidden');
                        const icon = studyGuideToggle.querySelector('.toggle-icon-details');
                        const isHidden = chapterContentDetailsDiv.classList.contains('hidden');
                        if (icon) {
                            icon.classList.toggle('rotated', !isHidden);
                            icon.textContent = isHidden ? '▶' : '▼';
                        }
                        studyGuideToggle.childNodes[0].nodeValue = isHidden ? 'View Study Guide Details ' : 'Hide Study Guide Details ';
                    };
                    chapterDiv.appendChild(studyGuideToggle);

                    function createDetailSection(title, contentArrayOrString, isList = true) {
                        if (!contentArrayOrString || (Array.isArray(contentArrayOrString) && contentArrayOrString.length === 0 && isList) || (!isList && typeof contentArrayOrString === 'string' && !contentArrayOrString.trim()) ) return;
                        const sectionWrapper = document.createElement('div');
                        const titleEl = document.createElement('h5');
                        titleEl.className = 'detail-section-title';
                        titleEl.textContent = title;
                        sectionWrapper.appendChild(titleEl);
                        if (isList && Array.isArray(contentArrayOrString)) {
                            const listEl = document.createElement('ul');
                            listEl.className = 'text-sm text-gray-700 leading-relaxed list-disc pl-5 space-y-1';
                            contentArrayOrString.forEach(item => { const li = document.createElement('li'); li.textContent = item; listEl.appendChild(li); });
                            sectionWrapper.appendChild(listEl);
                        } else {
                            const contentEl = document.createElement('p');
                            contentEl.className = 'text-sm text-gray-700 leading-relaxed';
                            contentEl.innerHTML = String(contentArrayOrString).replace(/\n/g, '<br>');
                            sectionWrapper.appendChild(contentEl);
                        }
                        chapterContentDetailsDiv.appendChild(sectionWrapper);
                    }

                    createDetailSection("Importance", chapter.importance, false);
                    createDetailSection("Core Learning Objectives", chapter.objectives);
                    createDetailSection("Key Concepts & Terminology", chapter.keyConcepts);
                    createDetailSection("Actionable Study Tips & Techniques", chapter.studyTips);
                    createDetailSection("Estimated Study Time", chapter.estimatedTime, false);
                    createDetailSection("Crucial Revisit Points", chapter.revisitPoints);
                    chapterDiv.appendChild(chapterContentDetailsDiv);

                    if (chapter.studyGoals && chapter.studyGoals.length > 0) {
                        const goalsTitle = document.createElement('h4');
                        goalsTitle.className = 'trackable-goals-title';
                        goalsTitle.textContent = 'Trackable Study Goals';
                        chapterDiv.appendChild(goalsTitle);

                        chapter.studyGoals.forEach(goal => { 
                            const goalState = allTasks.find(t => t.id === goal.id) || { id: goal.id, completed: false };
                            const goalDiv = document.createElement('div');
                            goalDiv.className = 'task-item-div';
                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.id = goal.id;
                            checkbox.checked = goalState.completed;
                            checkbox.className = 'task-checkbox-label';
                            checkbox.onchange = () => toggleTaskStatus(goal.id);
                            const label = document.createElement('label');
                            label.htmlFor = goal.id;
                            label.textContent = goal.description;
                            label.className = `task-description-label ${goalState.completed ? 'completed' : ''} cursor-pointer`;
                            label.id = `label-${goal.id}`;
                            goalDiv.appendChild(checkbox); 
                            goalDiv.appendChild(label);
                            chapterDiv.appendChild(goalDiv);
                        });
                    }
                    container.appendChild(chapterDiv);
                });
            } else {
                 container.innerHTML += '<p class="text-center text-gray-500 py-5">No chapters defined for this subject yet.</p>';
            }
        }
        
        function toggleTaskStatus(goalId) {
            const goal = allTasks.find(t => t.id === goalId);
            if (goal) {
                goal.completed = !goal.completed;
                const label = document.getElementById(`label-${goalId}`);
                if (label) label.classList.toggle('completed', goal.completed);
                const dot = document.getElementById(`dot-${goalId}`);
                if (dot) dot.classList.toggle('completed', goal.completed);
                updateProgressIndicators();
                saveProgressToLocalStorage();
            }
        }

        function saveProgressToLocalStorage() {
            try {
                if (!allTasks || !Array.isArray(allTasks)) { console.error("saveProgress: allTasks is not valid."); return; }
                const progressToSave = allTasks.map(task => ({ id: task.id, completed: task.completed }));
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(progressToSave));
            } catch (e) {
                console.error("Error saving progress to LocalStorage:", e);
                showMessage("ERROR: Could not save progress. " + e.message, "error");
            }
        }

        function loadProgressFromLocalStorage() {
            try {
                const savedProgressString = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (savedProgressString) {
                    const savedProgress = JSON.parse(savedProgressString);
                    if (Array.isArray(savedProgress) && allTasks && allTasks.length > 0) {
                        allTasks.forEach(task => {
                            const savedTask = savedProgress.find(st => st.id === task.id);
                            if (savedTask) task.completed = savedTask.completed;
                        });
                    }
                }
            } catch (e) { console.error("Error loading progress from LocalStorage:", e); }
        }
        
        function updateProgressIndicators() {
            try {
                Object.keys(studyPlanData).forEach(subjectKey => {
                    const subject = studyPlanData[subjectKey];
                    const overallBlocksContainer = document.getElementById(`overall-${subjectKey}-progress-blocks`);
                    const overallTextEl = document.getElementById(`overall-${subjectKey}-progress-text`);
        
                    if (!subject || !subject.chapters || !Array.isArray(subject.chapters) || subject.chapters.length === 0) {
                        if (overallBlocksContainer) overallBlocksContainer.innerHTML = ''; 
                        if (overallTextEl) overallTextEl.textContent = '0%';
                        console.warn(`No chapters found for subject: ${subjectKey} in updateProgressIndicators.`);
                        return;
                    }
        
                    if (overallBlocksContainer) {
                        overallBlocksContainer.innerHTML = ''; // Clear previous blocks
        
                        subject.chapters.forEach(chapter => {
                            if (!chapter || !chapter.id) { 
                                console.warn(`Skipping invalid chapter in ${subjectKey}:`, chapter);
                                return; 
                            }
                            const chapterBlock = document.createElement('div');
                            chapterBlock.className = 'progress-block-segment';
                            chapterBlock.title = chapter.title; 
        
                            const goals = chapter.studyGoals || [];
                            const totalChapterGoals = goals.length;
                            let completedChapterGoals = 0;
        
                            if (totalChapterGoals > 0) {
                                goals.forEach(goal => {
                                    if (goal && goal.id) { 
                                        const goalState = allTasks.find(t => t.id === goal.id);
                                        if (goalState && goalState.completed) {
                                            completedChapterGoals++;
                                        }
                                    }
                                });
                                if (completedChapterGoals === totalChapterGoals) chapterBlock.classList.add('green');
                                else if (completedChapterGoals > 0) chapterBlock.classList.add('yellow');
                            } else {
                                chapterBlock.classList.add('no-goals'); 
                            }
                            overallBlocksContainer.appendChild(chapterBlock);
                        });
                    }
        
                    const allSubjectGoals = [];
                    subject.chapters.forEach(ch => {
                        const goals = ch.studyGoals || [];
                        if (Array.isArray(goals)) goals.forEach(g => { if (g && g.id) allSubjectGoals.push(g.id); });
                    });
                    const totalSubjectGoals = allSubjectGoals.length;
                    let completedOverallSubjectGoals = 0;
        
                    if (totalSubjectGoals > 0) {
                        allSubjectGoals.forEach(goalId => {
                            const goalState = allTasks.find(t => t.id === goalId);
                            if (goalState && goalState.completed) completedOverallSubjectGoals++;
                        });
                        const subjectProgressPercent = (completedOverallSubjectGoals / totalSubjectGoals) * 100;
                        if (overallTextEl) overallTextEl.textContent = `${Math.round(subjectProgressPercent)}%`;
                    } else {
                        if (overallTextEl) overallTextEl.textContent = '0%';
                    }
        
                    subject.chapters.forEach(chapter => { // This loop updates the dots next to chapter titles
                        const goals = chapter.studyGoals || [];
                        goals.forEach(goal => {
                             const dot = document.getElementById(`dot-${goal.id}`);
                             if (dot) {
                                const goalState = allTasks.find(t => t.id === goal.id);
                                dot.classList.toggle('completed', goalState && goalState.completed);
                             }
                        });
                    });
                });
            } catch (e) { console.error("Error updating progress indicators:", e); }
        }

        function populateTableOfContents(activeSubjectKey) {
            const tocList = document.getElementById('tocList');
            if (!tocList) return;
            tocList.innerHTML = ''; 

            const subject = studyPlanData[activeSubjectKey];
            if (subject && subject.chapters && Array.isArray(subject.chapters)) {
                subject.chapters.forEach(chapter => {
                    if (!chapter || !chapter.id || !chapter.title) return; 
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `#chapter-${chapter.id}`;
                    link.textContent = chapter.title; 
                    link.onclick = (e) => {
                        e.preventDefault();
                        const targetElement = document.getElementById(`chapter-${chapter.id}`);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                            document.querySelectorAll('#tocList a').forEach(a => a.classList.remove('active-toc-link'));
                            link.classList.add('active-toc-link');
                        }
                    };
                    listItem.appendChild(link);
                    tocList.appendChild(listItem);
                });
            }
        }

        function setupTabs() {
            const tabButtons = document.querySelectorAll('.control-button');
            const tabContents = document.querySelectorAll('.tab-content');
            let initialActiveTabKey = 'scrum'; 

            const activeBtn = Array.from(tabButtons).find(btn => btn.classList.contains('active-tab'));
            if (activeBtn) {
                initialActiveTabKey = activeBtn.dataset.tab.replace('Tab','');
            } else { 
                 if(tabButtons.length > 0) {
                    tabButtons[0].classList.add('active-tab');
                    initialActiveTabKey = tabButtons[0].dataset.tab.replace('Tab','');
                 }
            }
             tabContents.forEach(content => { 
                content.classList.toggle('active', content.id === `${initialActiveTabKey}Tab`);
            });


            tabButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    tabButtons.forEach(btn => btn.classList.remove('active-tab'));
                    button.classList.add('active-tab');
                    const targetTab = button.dataset.tab;
                    let activeKey = '';
                    tabContents.forEach(content => {
                        const isActive = content.id === targetTab;
                        content.classList.toggle('active', isActive);
                        if(isActive) activeKey = content.id.replace('Tab',''); 
                    });
                    populateTableOfContents(activeKey); 
                });
            });
            populateTableOfContents(initialActiveTabKey);
        }
        
        function showMessage(message, type = "info") {
            const messageArea = document.getElementById('messageArea');
            if (!messageArea) return;
            messageArea.textContent = message;
            messageArea.className = 'p-3 mb-4 rounded-lg text-sm fixed top-5 right-5 z-50 shadow-lg ';
            if (type === "error") messageArea.classList.add('bg-red-100', 'text-red-700', 'border', 'border-red-300');
            else if (type === "success") messageArea.classList.add('bg-green-100', 'text-green-700', 'border', 'border-green-300');
            else messageArea.classList.add('bg-blue-100', 'text-blue-700', 'border', 'border-blue-300');
            messageArea.classList.remove('hidden');
            setTimeout(() => { messageArea.classList.add('hidden'); }, 3500);
        }

        // --- Export/Import Functions ---
        function exportProgress() {
            try {
                if (!allTasks || !Array.isArray(allTasks)) {
                    showMessage("No progress data to export.", "error");
                    return;
                }
                const progressToExport = allTasks.map(task => ({ id: task.id, completed: task.completed }));
                const jsonString = JSON.stringify(progressToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'study_progress.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                showMessage("Progress exported successfully!", "success");
            } catch (e) {
                console.error("Error exporting progress:", e);
                showMessage("Error exporting progress: " + e.message, "error");
            }
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }
            if (file.type !== "application/json") {
                showMessage("Invalid file type. Please select a JSON file.", "error");
                event.target.value = null; 
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedProgress = JSON.parse(e.target.result);
                    if (!Array.isArray(importedProgress)) {
                        throw new Error("Imported data is not a valid array.");
                    }
                    
                    const isValid = importedProgress.every(item => 
                        typeof item === 'object' && item !== null && 
                        'id' in item && typeof item.id === 'string' &&
                        'completed' in item && typeof item.completed === 'boolean'
                    );

                    if (!isValid && importedProgress.length > 0) { 
                        throw new Error("Imported data has an invalid structure.");
                    }

                    allTasks.forEach(task => {
                        const importedTask = importedProgress.find(it => it.id === task.id);
                        if (importedTask) {
                            task.completed = importedTask.completed;
                        } 
                    });

                    saveProgressToLocalStorage();
                    renderSubject('scrum'); 
                    renderSubject('iso27001');
                    updateProgressIndicators(); 
                    
                    const activeTabButton = document.querySelector('.control-button.active-tab');
                    if (activeTabButton) {
                        populateTableOfContents(activeTabButton.dataset.tab.replace('Tab', ''));
                    }

                    showMessage("Progress imported successfully!", "success");
                } catch (err) {
                    console.error("Error importing progress:", err);
                    showMessage("Error importing progress: " + err.message, "error");
                } finally {
                     event.target.value = null; 
                }
            };
            reader.readAsText(file);
        }


        function initializeApp() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) loadingIndicator.style.display = 'none';
            allTasks = []; 
            Object.values(studyPlanData).forEach(subject => {
                if (subject && subject.chapters && Array.isArray(subject.chapters)) {
                    subject.chapters.forEach(chapter => {
                        const goals = chapter.studyGoals; 
                        if (goals && Array.isArray(goals)) {
                            goals.forEach(goal => {
                                if(goal && goal.id) { 
                                    allTasks.push({ id: goal.id, completed: false, subjectId: subject.id, chapterId: chapter.id });
                                } else {
                                    console.warn("Malformed goal object in chapter:", chapter ? chapter.id : 'undefined chapter', goal);
                                }
                            });
                        } else {
                             console.warn("Study goals missing or not an array for chapter:", chapter ? chapter.id : 'undefined chapter', chapter);
                        }
                    });
                } else {
                     console.warn("Subject chapters missing or not an array for subject:", subject ? subject.id : 'undefined subject');
                }
            });
            
            if(allTasks.length === 0 && ( (studyPlanData.scrum.chapters && studyPlanData.scrum.chapters.length > 0) || (studyPlanData.iso27001.chapters && studyPlanData.iso27001.chapters.length > 0) ) ) {
                // This check is more robust: if chapters are defined but allTasks is empty, it's an issue.
                const scrumChapterCount = studyPlanData.scrum.chapters ? studyPlanData.scrum.chapters.length : 0;
                const isoChapterCount = studyPlanData.iso27001.chapters ? studyPlanData.iso27001.chapters.length : 0;
                if(scrumChapterCount > 0 || isoChapterCount > 0) {
                    console.error("CRITICAL: allTasks array is empty after initialization, but chapters with studyGoals were expected. Check studyPlanData structure and 'studyGoals' definitions for all chapters.");
                    showMessage("Error: Study plan goals could not be loaded. Please check console for details.", "error");
                }
            }
            loadProgressFromLocalStorage();
            renderSubject('scrum');
            renderSubject('iso27001');
            setupTabs(); 
            updateProgressIndicators(); 

            // Setup Export/Import Listeners for both sets of buttons
            document.getElementById('exportProgressBtnToc').addEventListener('click', exportProgress);
            const importFileElement = document.getElementById('importFile'); // Single file input
            document.getElementById('importProgressBtnToc').addEventListener('click', () => importFileElement.click());
            
            document.getElementById('exportProgressBtnMain').addEventListener('click', exportProgress);
            document.getElementById('importProgressBtnMain').addEventListener('click', () => importFileElement.click());
            
            importFileElement.addEventListener('change', importProgress);
        }
        
        window.onload = () => {
            try {
                initializeApp();
                if ('serviceWorker' in navigator) {
                    navigator.serviceWorker.register('./sw.js') 
                        .then((reg) => console.log('Service worker registered.', reg.scope))
                        .catch((err) => console.error('Service worker registration failed:', err));
                }
            } catch (e) {
                console.error("CRITICAL ERROR during initialization:", e);
                const loadingIndicator = document.getElementById('loadingIndicator');
                if(loadingIndicator) loadingIndicator.innerHTML = `<p style="color:red;">SYSTEM ERROR. Details: ${e.message}</p>`;
                showMessage("FATAL ERROR: App could not start. " + e.message, "error");
            }
        };
    </script>
</body>
</html>
